{"version":3,"file":"index.cjs.js","sources":["../src/commands/index.ts","../src/index.ts"],"sourcesContent":["/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { Command } from 'commander';\nimport { TechdocsGenerator } from '@backstage/plugin-techdocs-node';\n\nconst defaultDockerImage = TechdocsGenerator.defaultDockerImage;\n\nexport function registerCommands(program: Command) {\n  program\n    .command('generate')\n    .description('Generate TechDocs documentation site using MkDocs.')\n    .option(\n      '--source-dir <PATH>',\n      'Source directory containing mkdocs.yml and docs/ directory.',\n      '.',\n    )\n    .option(\n      '--output-dir <PATH>',\n      'Output directory containing generated TechDocs site.',\n      './site/',\n    )\n    .option(\n      '--docker-image <DOCKER_IMAGE>',\n      'The mkdocs docker container to use',\n      defaultDockerImage,\n    )\n    .option('--no-pull', 'Do not pull the latest docker image')\n    .option(\n      '--no-docker',\n      'Do not use Docker, use MkDocs executable and plugins in current user environment.',\n    )\n    .option(\n      '--techdocs-ref <HOST_TYPE:URL>',\n      'The repository hosting documentation source files e.g. url:https://ghe.mycompany.net.com/org/repo.' +\n        '\\nThis value is same as the backstage.io/techdocs-ref annotation of the corresponding Backstage entity.' +\n        '\\nIt is completely fine to skip this as it is only being used to set repo_url in mkdocs.yml if not found.\\n',\n    )\n    .option(\n      '--etag <ETAG>',\n      'A unique identifier for the prepared tree e.g. commit SHA. If provided it will be stored in techdocs_metadata.json.',\n    )\n    .option('-v --verbose', 'Enable verbose output.', false)\n    .option(\n      '--omitTechdocsCoreMkdocsPlugin',\n      \"Don't patch MkDocs file automatically with techdocs-core plugin.\",\n      false,\n    )\n    .option(\n      '--legacyCopyReadmeMdToIndexMd',\n      'Attempt to ensure an index.md exists falling back to using <docs-dir>/README.md or README.md in case a default <docs-dir>/index.md is not provided.',\n      false,\n    )\n    .alias('build')\n    .action(lazy(() => import('./generate/generate').then(m => m.default)));\n\n  program\n    .command('migrate')\n    .description(\n      'Migrate objects with case-sensitive entity triplets to lower-case versions.',\n    )\n    .requiredOption(\n      '--publisher-type <TYPE>',\n      '(Required always) awsS3 | googleGcs | azureBlobStorage | openStackSwift - same as techdocs.publisher.type in Backstage app-config.yaml',\n    )\n    .requiredOption(\n      '--storage-name <BUCKET/CONTAINER NAME>',\n      '(Required always) In case of AWS/GCS, use the bucket name. In case of Azure, use container name. Same as techdocs.publisher.[TYPE].bucketName',\n    )\n    .option(\n      '--azureAccountName <AZURE ACCOUNT NAME>',\n      '(Required for Azure) specify when --publisher-type azureBlobStorage',\n    )\n    .option(\n      '--azureAccountKey <AZURE ACCOUNT KEY>',\n      'Azure Storage Account key to use for authentication. If not specified, you must set AZURE_TENANT_ID, AZURE_CLIENT_ID & AZURE_CLIENT_SECRET as environment variables.',\n    )\n    .option(\n      '--awsRoleArn <AWS ROLE ARN>',\n      'Optional AWS ARN of role to be assumed.',\n    )\n    .option(\n      '--awsEndpoint <AWS ENDPOINT>',\n      'Optional AWS endpoint to send requests to.',\n    )\n    .option(\n      '--awsS3ForcePathStyle',\n      'Optional AWS S3 option to force path style.',\n    )\n    .option(\n      '--awsBucketRootPath',\n      'Optional sub-directory to store files in Amazon S3',\n    )\n    .option(\n      '--osCredentialId <OPENSTACK SWIFT APPLICATION CREDENTIAL ID>',\n      '(Required for OpenStack) specify when --publisher-type openStackSwift',\n    )\n    .option(\n      '--osSecret <OPENSTACK SWIFT APPLICATION CREDENTIAL SECRET>',\n      '(Required for OpenStack) specify when --publisher-type openStackSwift',\n    )\n    .option(\n      '--osAuthUrl <OPENSTACK SWIFT AUTHURL>',\n      '(Required for OpenStack) specify when --publisher-type openStackSwift',\n    )\n    .option(\n      '--osSwiftUrl <OPENSTACK SWIFT SWIFTURL>',\n      '(Required for OpenStack) specify when --publisher-type openStackSwift',\n    )\n    .option(\n      '--removeOriginal',\n      'Optional Files are copied by default. If flag is set, files are renamed/moved instead.',\n      false,\n    )\n    .option(\n      '--concurrency <MAX CONCURRENT REQS>',\n      'Optional Controls the number of API requests allowed to be performed simultaneously.',\n      '25',\n    )\n    .option('-v --verbose', 'Enable verbose output.', false)\n    .action(lazy(() => import('./migrate/migrate').then(m => m.default)));\n\n  program\n    .command('publish')\n    .description(\n      'Publish generated TechDocs site to an external storage AWS S3, Google GCS, etc.',\n    )\n    .requiredOption(\n      '--publisher-type <TYPE>',\n      '(Required always) awsS3 | googleGcs | azureBlobStorage | openStackSwift - same as techdocs.publisher.type in Backstage app-config.yaml',\n    )\n    .requiredOption(\n      '--storage-name <BUCKET/CONTAINER NAME>',\n      '(Required always) In case of AWS/GCS, use the bucket name. In case of Azure, use container name. Same as techdocs.publisher.[TYPE].bucketName',\n    )\n    .requiredOption(\n      '--entity <NAMESPACE/KIND/NAME>',\n      '(Required always) Entity uid separated by / in namespace/kind/name order (case-sensitive). Example: default/Component/myEntity ',\n    )\n    .option(\n      '--legacyUseCaseSensitiveTripletPaths',\n      'Publishes objects with cased entity triplet prefix when set (e.g. namespace/Kind/name). Only use if your TechDocs backend is configured the same way.',\n      false,\n    )\n    .option(\n      '--azureAccountName <AZURE ACCOUNT NAME>',\n      '(Required for Azure) specify when --publisher-type azureBlobStorage',\n    )\n    .option(\n      '--azureAccountKey <AZURE ACCOUNT KEY>',\n      'Azure Storage Account key to use for authentication. If not specified, you must set AZURE_TENANT_ID, AZURE_CLIENT_ID & AZURE_CLIENT_SECRET as environment variables.',\n    )\n    .option(\n      '--awsRoleArn <AWS ROLE ARN>',\n      'Optional AWS ARN of role to be assumed.',\n    )\n    .option(\n      '--awsEndpoint <AWS ENDPOINT>',\n      'Optional AWS endpoint to send requests to.',\n    )\n    .option('--awsS3sse <AWS SSE>', 'Optional AWS S3 Server Side Encryption.')\n    .option(\n      '--awsS3ForcePathStyle',\n      'Optional AWS S3 option to force path style.',\n    )\n    .option(\n      '--osCredentialId <OPENSTACK SWIFT APPLICATION CREDENTIAL ID>',\n      '(Required for OpenStack) specify when --publisher-type openStackSwift',\n    )\n    .option(\n      '--osSecret <OPENSTACK SWIFT APPLICATION CREDENTIAL SECRET>',\n      '(Required for OpenStack) specify when --publisher-type openStackSwift',\n    )\n    .option(\n      '--osAuthUrl <OPENSTACK SWIFT AUTHURL>',\n      '(Required for OpenStack) specify when --publisher-type openStackSwift',\n    )\n    .option(\n      '--osSwiftUrl <OPENSTACK SWIFT SWIFTURL>',\n      '(Required for OpenStack) specify when --publisher-type openStackSwift',\n    )\n    .option(\n      '--gcsBucketRootPath',\n      'Optional sub-directory to store files in Google cloud storage',\n    )\n    .option(\n      '--directory <PATH>',\n      'Path of the directory containing generated files to publish',\n      './site/',\n    )\n    .action(lazy(() => import('./publish/publish').then(m => m.default)));\n\n  program\n    .command('serve:mkdocs')\n    .description('Serve a documentation project locally using MkDocs serve.')\n    .option(\n      '-i, --docker-image <DOCKER_IMAGE>',\n      'The mkdocs docker container to use',\n      defaultDockerImage,\n    )\n    .option(\n      '--docker-entrypoint <DOCKER_ENTRYPOINT>',\n      'Override the image entrypoint',\n    )\n    .option(\n      '--docker-option <DOCKER_OPTION...>',\n      'Extra options to pass to the docker run command, e.g. \"--add-host=internal.host:192.168.11.12\" (can be added multiple times).',\n    )\n    .option(\n      '--no-docker',\n      'Do not use Docker, run `mkdocs serve` in current user environment.',\n    )\n    .option('-p, --port <PORT>', 'Port to serve documentation locally', '8000')\n    .option('-v --verbose', 'Enable verbose output.', false)\n    .action(lazy(() => import('./serve/mkdocs').then(m => m.default)));\n\n  program\n    .command('serve')\n    .description(\n      'Serve a documentation project locally in a Backstage app-like environment',\n    )\n    .option(\n      '-i, --docker-image <DOCKER_IMAGE>',\n      'The mkdocs docker container to use',\n      defaultDockerImage,\n    )\n    .option(\n      '--docker-entrypoint <DOCKER_ENTRYPOINT>',\n      'Override the image entrypoint',\n    )\n    .option(\n      '--docker-option <DOCKER_OPTION...>',\n      'Extra options to pass to the docker run command, e.g. \"--add-host=internal.host:192.168.11.12\" (can be added multiple times).',\n    )\n    .option(\n      '--no-docker',\n      'Do not use Docker, use MkDocs executable in current user environment.',\n    )\n    .option('--mkdocs-port <PORT>', 'Port for MkDocs server to use', '8000')\n    .option('-v --verbose', 'Enable verbose output.', false)\n    .action(lazy(() => import('./serve/serve').then(m => m.default)));\n}\n\n// Wraps an action function so that it always exits and handles errors\n// Humbly taken from backstage-cli's registerCommands\nfunction lazy(\n  getActionFunc: () => Promise<(...args: any[]) => Promise<void>>,\n): (...args: any[]) => Promise<never> {\n  return async (...args: any[]) => {\n    try {\n      const actionFunc = await getActionFunc();\n      await actionFunc(...args);\n      process.exit(0);\n    } catch (error) {\n      // eslint-disable-next-line no-console\n      console.error(error.message);\n      process.exit(1);\n    }\n  };\n}\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { program } from 'commander';\nimport { registerCommands } from './commands';\nimport { version } from '../package.json';\n\nconst main = (argv: string[]) => {\n  program.name('techdocs-cli').version(version);\n\n  registerCommands(program);\n\n  program.parse(argv);\n};\n\nmain(process.argv);\n"],"names":["TechdocsGenerator","program"],"mappings":"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"}