{"version":3,"sources":["webpack://techdocs-cli-embedded-app/../catalog-client/src/types/api.ts","webpack://techdocs-cli-embedded-app/../catalog-client/src/CatalogClient.ts","webpack://techdocs-cli-embedded-app/../catalog-model/src/entity/constants.ts","webpack://techdocs-cli-embedded-app/../catalog-model/src/entity/policies/DefaultNamespaceEntityPolicy.ts","webpack://techdocs-cli-embedded-app/../catalog-model/src/validation/CommonValidatorFunctions.ts","webpack://techdocs-cli-embedded-app/../catalog-model/src/validation/ajv.ts","webpack://techdocs-cli-embedded-app/../catalog-model/src/validation/entityEnvelopeSchemaValidator.ts","webpack://techdocs-cli-embedded-app/../catalog-model/src/validation/entityKindSchemaValidator.ts","webpack://techdocs-cli-embedded-app/../catalog-model/src/validation/entitySchemaValidator.ts","webpack://techdocs-cli-embedded-app/../catalog-model/src/validation/KubernetesValidatorFunctions.ts","webpack://techdocs-cli-embedded-app/../catalog-model/src/validation/makeValidator.ts","webpack://techdocs-cli-embedded-app/../catalog-model/src/entity/policies/FieldFormatEntityPolicy.ts","webpack://techdocs-cli-embedded-app/../catalog-model/src/entity/policies/SchemaValidEntityPolicy.ts","webpack://techdocs-cli-embedded-app/../catalog-model/src/entity/ref.ts","webpack://techdocs-cli-embedded-app/../catalog-model/src/EntityPolicies.ts","webpack://techdocs-cli-embedded-app/../catalog-model/src/kinds/util.ts","webpack://techdocs-cli-embedded-app/../catalog-model/src/kinds/ApiEntityV1alpha1.ts","webpack://techdocs-cli-embedded-app/../catalog-model/src/kinds/ComponentEntityV1alpha1.ts","webpack://techdocs-cli-embedded-app/../catalog-model/src/kinds/DomainEntityV1alpha1.ts","webpack://techdocs-cli-embedded-app/../catalog-model/src/kinds/GroupEntityV1alpha1.ts","webpack://techdocs-cli-embedded-app/../catalog-model/src/kinds/LocationEntityV1alpha1.ts","webpack://techdocs-cli-embedded-app/../catalog-model/src/kinds/relations.ts","webpack://techdocs-cli-embedded-app/../catalog-model/src/kinds/ResourceEntityV1alpha1.ts","webpack://techdocs-cli-embedded-app/../catalog-model/src/kinds/SystemEntityV1alpha1.ts","webpack://techdocs-cli-embedded-app/../catalog-model/src/kinds/UserEntityV1alpha1.ts","webpack://techdocs-cli-embedded-app/../catalog-model/src/location/annotation.ts","webpack://techdocs-cli-embedded-app/../catalog-model/src/location/helpers.ts","webpack://techdocs-cli-embedded-app/../core-components/src/components/AlertDisplay/AlertDisplay.tsx","webpack://techdocs-cli-embedded-app/../core-components/src/components/Avatar/Avatar.tsx","webpack://techdocs-cli-embedded-app/../core-components/src/components/Link/Link.tsx","webpack://techdocs-cli-embedded-app/../core-components/src/components/Button/Button.tsx","webpack://techdocs-cli-embedded-app/../core-components/src/components/CopyTextButton/CopyTextButton.tsx","webpack://techdocs-cli-embedded-app/../core-components/src/components/CodeSnippet/CodeSnippet.tsx","webpack://techdocs-cli-embedded-app/../core-components/src/components/CreateButton/CreateButton.tsx","webpack://techdocs-cli-embedded-app/../core-components/src/components/DependencyGraph/types.ts","webpack://techdocs-cli-embedded-app/../core-components/src/components/DependencyGraph/DefaultNode.tsx","webpack://techdocs-cli-embedded-app/../core-components/src/components/DependencyGraph/constants.ts","webpack://techdocs-cli-embedded-app/../core-components/src/components/DependencyGraph/Node.tsx","webpack://techdocs-cli-embedded-app/../core-components/src/components/DependencyGraph/DefaultLabel.tsx","webpack://techdocs-cli-embedded-app/../core-components/src/components/DependencyGraph/Edge.tsx","webpack://techdocs-cli-embedded-app/../core-components/src/components/DependencyGraph/DependencyGraph.tsx","webpack://techdocs-cli-embedded-app/../core-components/src/components/DismissableBanner/DismissableBanner.tsx","webpack://techdocs-cli-embedded-app/../core-components/src/components/EmptyState/EmptyStateImage.tsx","webpack://techdocs-cli-embedded-app/../core-components/src/components/EmptyState/EmptyState.tsx","webpack://techdocs-cli-embedded-app/../core-components/src/components/EmptyState/MissingAnnotationEmptyState.tsx","webpack://techdocs-cli-embedded-app/../core-components/src/components/WarningPanel/WarningPanel.tsx","webpack://techdocs-cli-embedded-app/../core-components/src/components/ErrorPanel/ErrorPanel.tsx","webpack://techdocs-cli-embedded-app/../core-components/src/components/ResponseErrorPanel/ResponseErrorPanel.tsx","webpack://techdocs-cli-embedded-app/../core-components/src/components/FeatureDiscovery/lib/usePortal.ts","webpack://techdocs-cli-embedded-app/../core-components/src/components/FeatureDiscovery/lib/useShowCallout.ts","webpack://techdocs-cli-embedded-app/../core-components/src/components/FeatureDiscovery/FeatureCalloutCircular.tsx","webpack://techdocs-cli-embedded-app/../core-components/src/components/HeaderIconLinkRow/IconLinkVertical.tsx","webpack://techdocs-cli-embedded-app/../core-components/src/components/HeaderIconLinkRow/HeaderIconLinkRow.tsx","webpack://techdocs-cli-embedded-app/../core-components/src/components/HorizontalScrollGrid/HorizontalScrollGrid.tsx","webpack://techdocs-cli-embedded-app/../core-components/src/components/Lifecycle/Lifecycle.tsx","webpack://techdocs-cli-embedded-app/../core-components/src/components/LogViewer/LogViewer.tsx","webpack://techdocs-cli-embedded-app/../core-components/src/components/MarkdownContent/MarkdownContent.tsx","webpack://techdocs-cli-embedded-app/../core-components/src/components/OAuthRequestDialog/LoginRequestListItem.tsx","webpack://techdocs-cli-embedded-app/../core-components/src/components/OAuthRequestDialog/OAuthRequestDialog.tsx","webpack://techdocs-cli-embedded-app/../core-components/src/components/OverflowTooltip/OverflowTooltip.tsx","webpack://techdocs-cli-embedded-app/../core-components/src/components/Progress/Progress.tsx","webpack://techdocs-cli-embedded-app/../core-components/src/layout/BottomLink/BottomLink.tsx","webpack://techdocs-cli-embedded-app/../core-components/src/layout/ErrorBoundary/ErrorBoundary.tsx","webpack://techdocs-cli-embedded-app/../core-components/src/layout/InfoCard/InfoCard.tsx","webpack://techdocs-cli-embedded-app/../core-components/src/components/ProgressBars/Gauge.tsx","webpack://techdocs-cli-embedded-app/../core-components/src/components/ProgressBars/GaugeCard.tsx","webpack://techdocs-cli-embedded-app/../core-components/src/components/ProgressBars/LinearGauge.tsx","webpack://techdocs-cli-embedded-app/../core-components/src/components/Select/static/ClosedDropdown.tsx","webpack://techdocs-cli-embedded-app/../core-components/src/components/Select/static/OpenedDropdown.tsx","webpack://techdocs-cli-embedded-app/../core-components/src/components/Select/Select.tsx","webpack://techdocs-cli-embedded-app/../core-components/src/components/SimpleStepper/SimpleStepper.tsx","webpack://techdocs-cli-embedded-app/../core-components/src/components/SimpleStepper/SimpleStepperFooter.tsx","webpack://techdocs-cli-embedded-app/../core-components/src/components/SimpleStepper/SimpleStepperStep.tsx","webpack://techdocs-cli-embedded-app/../core-components/src/components/Status/Status.tsx","webpack://techdocs-cli-embedded-app/../core-components/src/components/StructuredMetadataTable/MetadataTable.tsx","webpack://techdocs-cli-embedded-app/../core-components/src/components/StructuredMetadataTable/StructuredMetadataTable.tsx","webpack://techdocs-cli-embedded-app/../core-components/src/hooks/useQueryParamState.ts","webpack://techdocs-cli-embedded-app/../core-components/src/hooks/useSupportConfig.ts","webpack://techdocs-cli-embedded-app/../core-components/src/icons/icons.tsx","webpack://techdocs-cli-embedded-app/../core-components/src/components/SupportButton/SupportButton.tsx","webpack://techdocs-cli-embedded-app/../core-components/src/layout/Sidebar/config.ts","webpack://techdocs-cli-embedded-app/../core-components/src/layout/Sidebar/localStorage.ts","webpack://techdocs-cli-embedded-app/../core-components/src/layout/Sidebar/SidebarPinStateContext.tsx","webpack://techdocs-cli-embedded-app/../core-components/src/layout/Sidebar/Page.tsx","webpack://techdocs-cli-embedded-app/../core-components/src/layout/Sidebar/SidebarOpenStateContext.tsx","webpack://techdocs-cli-embedded-app/../core-components/src/layout/Sidebar/SidebarGroup.tsx","webpack://techdocs-cli-embedded-app/../core-components/src/layout/Sidebar/MobileSidebar.tsx","webpack://techdocs-cli-embedded-app/../core-components/src/layout/Sidebar/Bar.tsx","webpack://techdocs-cli-embedded-app/../core-components/src/layout/Sidebar/utils.ts","webpack://techdocs-cli-embedded-app/../core-components/src/layout/Sidebar/SidebarSubmenuItem.tsx","webpack://techdocs-cli-embedded-app/../core-components/src/layout/Sidebar/SidebarSubmenu.tsx","webpack://techdocs-cli-embedded-app/../core-components/src/layout/Sidebar/icons/DoubleArrowLeft.tsx","webpack://techdocs-cli-embedded-app/../core-components/src/layout/Sidebar/icons/DoubleArrowRight.tsx","webpack://techdocs-cli-embedded-app/../core-components/src/layout/Sidebar/Items.tsx","webpack://techdocs-cli-embedded-app/../core-components/src/layout/Sidebar/Intro.tsx","webpack://techdocs-cli-embedded-app/../core-components/src/layout/Content/Content.tsx","webpack://techdocs-cli-embedded-app/../core-components/src/layout/HeaderTabs/HeaderTabs.tsx","webpack://techdocs-cli-embedded-app/../core-components/src/components/TabbedLayout/RoutedTabs.tsx","webpack://techdocs-cli-embedded-app/../core-components/src/components/TabbedLayout/TabbedLayout.tsx","webpack://techdocs-cli-embedded-app/../core-components/src/components/Table/SubvalueCell.tsx","webpack://techdocs-cli-embedded-app/../core-components/src/components/Table/Filters.tsx","webpack://techdocs-cli-embedded-app/../core-components/src/components/Table/Table.tsx","webpack://techdocs-cli-embedded-app/../core-components/src/components/Tabs/TabPanel.tsx","webpack://techdocs-cli-embedded-app/../core-components/src/components/Tabs/TabIcon.tsx","webpack://techdocs-cli-embedded-app/../core-components/src/components/Tabs/Tab.tsx","webpack://techdocs-cli-embedded-app/../core-components/src/components/Tabs/TabBar.tsx","webpack://techdocs-cli-embedded-app/../core-components/src/components/Tabs/Tabs.tsx","webpack://techdocs-cli-embedded-app/../core-components/src/components/TrendLine/TrendLine.tsx","webpack://techdocs-cli-embedded-app/../core-components/src/layout/ContentHeader/ContentHeader.tsx","webpack://techdocs-cli-embedded-app/../core-components/src/layout/ErrorPage/MicDrop.tsx","webpack://techdocs-cli-embedded-app/../core-components/src/layout/ErrorPage/ErrorPage.tsx","webpack://techdocs-cli-embedded-app/../core-components/src/layout/Breadcrumbs/Breadcrumbs.tsx","webpack://techdocs-cli-embedded-app/../core-components/src/layout/Header/Header.tsx","webpack://techdocs-cli-embedded-app/../core-components/src/layout/HeaderActionMenu/HeaderActionMenu.tsx","webpack://techdocs-cli-embedded-app/../core-components/src/layout/HeaderLabel/HeaderLabel.tsx","webpack://techdocs-cli-embedded-app/../core-components/src/layout/HomepageTimer/HomepageTimer.tsx","webpack://techdocs-cli-embedded-app/../core-components/src/layout/ItemCard/ItemCardHeader.tsx","webpack://techdocs-cli-embedded-app/../core-components/src/layout/ItemCard/ItemCard.tsx","webpack://techdocs-cli-embedded-app/../core-components/src/layout/ItemCard/ItemCardGrid.tsx","webpack://techdocs-cli-embedded-app/../core-components/src/layout/Page/Page.tsx","webpack://techdocs-cli-embedded-app/../core-components/src/layout/Page/PageWithHeader.tsx","webpack://techdocs-cli-embedded-app/../core-components/src/layout/ProxiedSignInPage/types.ts","webpack://techdocs-cli-embedded-app/../core-components/src/layout/ProxiedSignInPage/ProxiedSignInIdentity.ts","webpack://techdocs-cli-embedded-app/../core-components/src/layout/ProxiedSignInPage/ProxiedSignInPage.tsx","webpack://techdocs-cli-embedded-app/../core-components/src/layout/SignInPage/styles.tsx","webpack://techdocs-cli-embedded-app/../core-components/src/layout/SignInPage/GuestUserIdentity.ts","webpack://techdocs-cli-embedded-app/../core-components/src/layout/SignInPage/LegacyUserIdentity.ts","webpack://techdocs-cli-embedded-app/../core-components/src/layout/SignInPage/UserIdentity.ts","webpack://techdocs-cli-embedded-app/../core-components/src/layout/SignInPage/commonProvider.tsx","webpack://techdocs-cli-embedded-app/../core-components/src/layout/SignInPage/guestProvider.tsx","webpack://techdocs-cli-embedded-app/../core-components/src/layout/SignInPage/customProvider.tsx","webpack://techdocs-cli-embedded-app/../core-components/src/layout/SignInPage/providers.tsx","webpack://techdocs-cli-embedded-app/../core-components/src/layout/SignInPage/SignInPage.tsx","webpack://techdocs-cli-embedded-app/../core-components/src/layout/TabbedCard/TabbedCard.tsx","webpack://techdocs-cli-embedded-app/../core-plugin-api/src/analytics/AnalyticsContext.tsx","webpack://techdocs-cli-embedded-app/../core-plugin-api/src/apis/system/useApi.tsx","webpack://techdocs-cli-embedded-app/../core-plugin-api/src/apis/system/ApiRef.ts","webpack://techdocs-cli-embedded-app/../core-plugin-api/src/apis/system/helpers.ts","webpack://techdocs-cli-embedded-app/../core-plugin-api/src/apis/definitions/auth.ts","webpack://techdocs-cli-embedded-app/../core-plugin-api/src/apis/definitions/AlertApi.ts","webpack://techdocs-cli-embedded-app/../core-plugin-api/src/apis/definitions/AnalyticsApi.ts","webpack://techdocs-cli-embedded-app/../core-plugin-api/src/apis/definitions/AppThemeApi.ts","webpack://techdocs-cli-embedded-app/../core-plugin-api/src/apis/definitions/ConfigApi.ts","webpack://techdocs-cli-embedded-app/../core-plugin-api/src/apis/definitions/DiscoveryApi.ts","webpack://techdocs-cli-embedded-app/../core-plugin-api/src/apis/definitions/ErrorApi.ts","webpack://techdocs-cli-embedded-app/../core-plugin-api/src/apis/definitions/FeatureFlagsApi.ts","webpack://techdocs-cli-embedded-app/../core-plugin-api/src/apis/definitions/FetchApi.ts","webpack://techdocs-cli-embedded-app/../core-plugin-api/src/apis/definitions/IdentityApi.ts","webpack://techdocs-cli-embedded-app/../core-plugin-api/src/apis/definitions/OAuthRequestApi.ts","webpack://techdocs-cli-embedded-app/../core-plugin-api/src/apis/definitions/StorageApi.ts","webpack://techdocs-cli-embedded-app/../core-plugin-api/src/analytics/Tracker.ts","webpack://techdocs-cli-embedded-app/../core-plugin-api/src/analytics/useAnalytics.tsx","webpack://techdocs-cli-embedded-app/../core-plugin-api/src/plugin-options/usePluginOptions.tsx","webpack://techdocs-cli-embedded-app/../core-plugin-api/src/app/useApp.tsx","webpack://techdocs-cli-embedded-app/../core-plugin-api/src/extensions/componentData.tsx","webpack://techdocs-cli-embedded-app/../core-plugin-api/src/routing/types.ts","webpack://techdocs-cli-embedded-app/../core-plugin-api/src/routing/RouteRef.ts","webpack://techdocs-cli-embedded-app/../core-plugin-api/src/routing/SubRouteRef.ts","webpack://techdocs-cli-embedded-app/../core-plugin-api/src/routing/ExternalRouteRef.ts","webpack://techdocs-cli-embedded-app/../core-plugin-api/src/routing/useRouteRef.tsx","webpack://techdocs-cli-embedded-app/../core-plugin-api/src/routing/useRouteRefParams.ts","webpack://techdocs-cli-embedded-app/../core-plugin-api/src/extensions/PluginErrorBoundary.tsx","webpack://techdocs-cli-embedded-app/../core-plugin-api/src/extensions/extensions.tsx","webpack://techdocs-cli-embedded-app/../core-plugin-api/src/extensions/useElementFilter.tsx","webpack://techdocs-cli-embedded-app/../core-plugin-api/src/plugin/Plugin.tsx","webpack://techdocs-cli-embedded-app/../errors/src/errors/assertion.ts","webpack://techdocs-cli-embedded-app/../errors/src/serialization/error.ts","webpack://techdocs-cli-embedded-app/../errors/src/errors/CustomErrorBase.ts","webpack://techdocs-cli-embedded-app/../errors/src/errors/common.ts","webpack://techdocs-cli-embedded-app/../errors/src/serialization/response.ts","webpack://techdocs-cli-embedded-app/../errors/src/errors/ResponseError.ts","webpack://techdocs-cli-embedded-app/../integration-react/src/api/ScmAuthApi.ts","webpack://techdocs-cli-embedded-app/../integration-react/src/api/ScmAuth.ts","webpack://techdocs-cli-embedded-app/../integration-react/src/api/ScmIntegrationsApi.ts","webpack://techdocs-cli-embedded-app/../integration-react/src/components/ScmIntegrationIcon/ScmIntegrationIcon.tsx","webpack://techdocs-cli-embedded-app/../integration/src/helpers.ts","webpack://techdocs-cli-embedded-app/../integration/src/awsS3/config.ts","webpack://techdocs-cli-embedded-app/../integration/src/awsS3/AwsS3Integration.ts","webpack://techdocs-cli-embedded-app/../integration/src/azure/AzureUrl.ts","webpack://techdocs-cli-embedded-app/../integration/src/azure/config.ts","webpack://techdocs-cli-embedded-app/../integration/src/azure/AzureIntegration.ts","webpack://techdocs-cli-embedded-app/../integration/src/azure/core.ts","webpack://techdocs-cli-embedded-app/../integration/src/bitbucket/config.ts","webpack://techdocs-cli-embedded-app/../integration/src/bitbucket/BitbucketIntegration.ts","webpack://techdocs-cli-embedded-app/../integration/src/bitbucket/core.ts","webpack://techdocs-cli-embedded-app/../integration/src/bitbucketCloud/config.ts","webpack://techdocs-cli-embedded-app/../integration/src/bitbucketCloud/BitbucketCloudIntegration.ts","webpack://techdocs-cli-embedded-app/../integration/src/bitbucketCloud/core.ts","webpack://techdocs-cli-embedded-app/../integration/src/bitbucketServer/config.ts","webpack://techdocs-cli-embedded-app/../integration/src/bitbucketServer/BitbucketServerIntegration.ts","webpack://techdocs-cli-embedded-app/../integration/src/bitbucketServer/core.ts","webpack://techdocs-cli-embedded-app/../integration/src/gerrit/config.ts","webpack://techdocs-cli-embedded-app/../integration/src/gerrit/core.ts","webpack://techdocs-cli-embedded-app/../integration/src/gerrit/GerritIntegration.ts","webpack://techdocs-cli-embedded-app/../integration/src/github/config.ts","webpack://techdocs-cli-embedded-app/../integration/src/github/core.ts","webpack://techdocs-cli-embedded-app/../integration/src/github/SingleInstanceGithubCredentialsProvider.ts","webpack://techdocs-cli-embedded-app/../integration/src/github/DefaultGithubCredentialsProvider.ts","webpack://techdocs-cli-embedded-app/../integration/src/github/GitHubIntegration.ts","webpack://techdocs-cli-embedded-app/../integration/src/gitlab/config.ts","webpack://techdocs-cli-embedded-app/../integration/src/gitlab/core.ts","webpack://techdocs-cli-embedded-app/../integration/src/gitlab/GitLabIntegration.ts","webpack://techdocs-cli-embedded-app/../integration/src/ScmIntegrations.ts","webpack://techdocs-cli-embedded-app/../../plugins/techdocs/src/api.ts","webpack://techdocs-cli-embedded-app/../core-app-api/src/apis/system/ApiAggregator.ts","webpack://techdocs-cli-embedded-app/../core-app-api/src/apis/system/ApiProvider.tsx","webpack://techdocs-cli-embedded-app/../core-app-api/src/apis/system/ApiResolver.ts","webpack://techdocs-cli-embedded-app/../core-app-api/src/apis/system/ApiFactoryRegistry.ts","webpack://techdocs-cli-embedded-app/../core-app-api/src/lib/loginPopup.ts","webpack://techdocs-cli-embedded-app/../core-app-api/src/lib/AuthConnector/DefaultAuthConnector.ts","webpack://techdocs-cli-embedded-app/../core-app-api/src/lib/AuthSessionManager/common.ts","webpack://techdocs-cli-embedded-app/../core-app-api/src/lib/subjects.ts","webpack://techdocs-cli-embedded-app/../core-app-api/src/lib/AuthSessionManager/SessionStateTracker.ts","webpack://techdocs-cli-embedded-app/../core-app-api/src/lib/AuthSessionManager/RefreshingAuthSessionManager.ts","webpack://techdocs-cli-embedded-app/../core-app-api/src/lib/AuthSessionManager/StaticAuthSessionManager.ts","webpack://techdocs-cli-embedded-app/../core-app-api/src/apis/implementations/auth/oauth2/OAuth2.ts","webpack://techdocs-cli-embedded-app/../core-app-api/src/apis/implementations/auth/github/GithubAuth.ts","webpack://techdocs-cli-embedded-app/../core-app-api/src/apis/implementations/auth/gitlab/GitlabAuth.ts","webpack://techdocs-cli-embedded-app/../core-app-api/src/apis/implementations/auth/google/GoogleAuth.ts","webpack://techdocs-cli-embedded-app/../core-app-api/src/apis/implementations/auth/okta/OktaAuth.ts","webpack://techdocs-cli-embedded-app/../core-app-api/src/apis/implementations/auth/saml/types.ts","webpack://techdocs-cli-embedded-app/../core-app-api/src/apis/implementations/auth/saml/SamlAuth.ts","webpack://techdocs-cli-embedded-app/../core-app-api/src/apis/implementations/auth/microsoft/MicrosoftAuth.ts","webpack://techdocs-cli-embedded-app/../core-app-api/src/apis/implementations/auth/onelogin/OneLoginAuth.ts","webpack://techdocs-cli-embedded-app/../core-app-api/src/apis/implementations/auth/bitbucket/BitbucketAuth.ts","webpack://techdocs-cli-embedded-app/../core-app-api/src/apis/implementations/auth/atlassian/AtlassianAuth.ts","webpack://techdocs-cli-embedded-app/../core-app-api/src/apis/implementations/AlertApi/AlertApiForwarder.ts","webpack://techdocs-cli-embedded-app/../core-app-api/src/apis/implementations/AnalyticsApi/NoOpAnalyticsApi.ts","webpack://techdocs-cli-embedded-app/../core-app-api/src/apis/implementations/AppThemeApi/AppThemeSelector.ts","webpack://techdocs-cli-embedded-app/../config/src/reader.ts","webpack://techdocs-cli-embedded-app/../core-app-api/src/apis/implementations/DiscoveryApi/UrlPatternDiscovery.ts","webpack://techdocs-cli-embedded-app/../core-app-api/src/apis/implementations/ErrorApi/ErrorAlerter.ts","webpack://techdocs-cli-embedded-app/../core-app-api/src/apis/implementations/ErrorApi/ErrorApiForwarder.ts","webpack://techdocs-cli-embedded-app/../core-app-api/src/apis/implementations/ErrorApi/UnhandledErrorForwarder.ts","webpack://techdocs-cli-embedded-app/../core-app-api/src/apis/implementations/FeatureFlagsApi/LocalStorageFeatureFlags.tsx","webpack://techdocs-cli-embedded-app/../core-app-api/src/apis/implementations/FetchApi/createFetchApi.ts","webpack://techdocs-cli-embedded-app/../core-app-api/src/apis/implementations/FetchApi/IdentityAuthInjectorFetchMiddleware.ts","webpack://techdocs-cli-embedded-app/../core-app-api/src/apis/implementations/FetchApi/PluginProtocolResolverFetchMiddleware.ts","webpack://techdocs-cli-embedded-app/../core-app-api/src/apis/implementations/FetchApi/FetchMiddlewares.ts","webpack://techdocs-cli-embedded-app/../core-app-api/src/apis/implementations/OAuthRequestApi/OAuthPendingRequests.ts","webpack://techdocs-cli-embedded-app/../core-app-api/src/apis/implementations/OAuthRequestApi/OAuthRequestManager.ts","webpack://techdocs-cli-embedded-app/../core-app-api/src/apis/implementations/StorageApi/WebStorage.ts","webpack://techdocs-cli-embedded-app/../core-app-api/src/extensions/traversal.ts","webpack://techdocs-cli-embedded-app/../core-app-api/src/plugins/collectors.ts","webpack://techdocs-cli-embedded-app/../core-app-api/src/routing/FeatureFlagged.tsx","webpack://techdocs-cli-embedded-app/../core-app-api/src/routing/collectors.tsx","webpack://techdocs-cli-embedded-app/../core-app-api/src/routing/types.ts","webpack://techdocs-cli-embedded-app/../core-app-api/src/routing/helpers.ts","webpack://techdocs-cli-embedded-app/../core-app-api/src/routing/RouteResolver.ts","webpack://techdocs-cli-embedded-app/../core-app-api/src/routing/RoutingProvider.tsx","webpack://techdocs-cli-embedded-app/../core-app-api/src/routing/RouteTracker.tsx","webpack://techdocs-cli-embedded-app/../core-app-api/src/routing/validation.ts","webpack://techdocs-cli-embedded-app/../core-app-api/src/app/AppContext.tsx","webpack://techdocs-cli-embedded-app/../core-app-api/src/apis/implementations/IdentityApi/AppIdentityProxy.ts","webpack://techdocs-cli-embedded-app/../core-app-api/src/app/AppThemeProvider.tsx","webpack://techdocs-cli-embedded-app/../core-app-api/src/app/defaultConfigLoader.ts","webpack://techdocs-cli-embedded-app/../core-app-api/src/apis/system/ApiRegistry.ts","webpack://techdocs-cli-embedded-app/../core-app-api/src/app/resolveRouteBindings.ts","webpack://techdocs-cli-embedded-app/../core-app-api/src/app/isReactRouterBeta.tsx","webpack://techdocs-cli-embedded-app/../core-app-api/src/app/AppManager.tsx","webpack://techdocs-cli-embedded-app/../core-app-api/src/app/createSpecializedApp.tsx","webpack://techdocs-cli-embedded-app/../core-app-api/src/routing/FlatRoutes.tsx","webpack://techdocs-cli-embedded-app/../app-defaults/src/defaults/apis.ts","webpack://techdocs-cli-embedded-app/../app-defaults/src/defaults/components.tsx","webpack://techdocs-cli-embedded-app/../app-defaults/src/defaults/icons.tsx","webpack://techdocs-cli-embedded-app/../theme/src/pageTheme.ts","webpack://techdocs-cli-embedded-app/../theme/src/baseTheme.ts","webpack://techdocs-cli-embedded-app/../theme/src/themes.ts","webpack://techdocs-cli-embedded-app/../app-defaults/src/defaults/themes.tsx","webpack://techdocs-cli-embedded-app/../app-defaults/src/createApp.tsx","webpack://techdocs-cli-embedded-app/../../plugins/catalog/src/apis/StarredEntitiesApi/migration.ts","webpack://techdocs-cli-embedded-app/../../plugins/catalog/src/apis/StarredEntitiesApi/DefaultStarredEntitiesApi.ts","webpack://techdocs-cli-embedded-app/../../plugins/catalog/src/components/CatalogSearchResultListItem/CatalogSearchResultListItem.tsx","webpack://techdocs-cli-embedded-app/../../plugins/catalog-common/src/permissions.ts","webpack://techdocs-cli-embedded-app/../../plugins/catalog/src/components/EntityContextMenu/UnregisterEntity.tsx","webpack://techdocs-cli-embedded-app/../../plugins/catalog/src/components/EntityContextMenu/EntityContextMenu.tsx","webpack://techdocs-cli-embedded-app/../../plugins/catalog/src/components/EntityLayout/EntityLayout.tsx","webpack://techdocs-cli-embedded-app/../../plugins/catalog/src/components/EntityOrphanWarning/DeleteEntityDialog.tsx","webpack://techdocs-cli-embedded-app/../../plugins/catalog/src/components/EntityOrphanWarning/EntityOrphanWarning.tsx","webpack://techdocs-cli-embedded-app/../../plugins/catalog/src/components/EntityProcessingErrorsPanel/EntityProcessingErrorsPanel.tsx","webpack://techdocs-cli-embedded-app/../../plugins/catalog/src/components/EntitySwitch/EntitySwitch.tsx","webpack://techdocs-cli-embedded-app/../../plugins/catalog/src/components/FilteredEntityLayout/index.ts","webpack://techdocs-cli-embedded-app/../../plugins/catalog/src/plugin.ts","webpack://techdocs-cli-embedded-app/./src/apis.ts","webpack://techdocs-cli-embedded-app/./src/config.ts","webpack://techdocs-cli-embedded-app/./src/components/Root/LogoFull.tsx","webpack://techdocs-cli-embedded-app/./src/components/Root/LogoIcon.tsx","webpack://techdocs-cli-embedded-app/./src/components/Root/Root.tsx","webpack://techdocs-cli-embedded-app/./src/components/TechDocsPage/TechDocsPage.tsx","webpack://techdocs-cli-embedded-app/./src/App.tsx","webpack://techdocs-cli-embedded-app/./src/index.tsx","webpack://techdocs-cli-embedded-app/../version-bridge/src/lib/globalObject.ts","webpack://techdocs-cli-embedded-app/../version-bridge/src/lib/VersionedContext.ts","webpack://techdocs-cli-embedded-app/../version-bridge/src/lib/VersionedValue.ts","webpack://techdocs-cli-embedded-app/../../plugins/catalog-react/src/api.ts","webpack://techdocs-cli-embedded-app/../../plugins/catalog-react/src/apis/StarredEntitiesApi/StarredEntitiesApi.ts","webpack://techdocs-cli-embedded-app/../../plugins/catalog-react/src/apis/StarredEntitiesApi/MockStarredEntitiesApi.ts","webpack://techdocs-cli-embedded-app/../../plugins/catalog-react/src/components/CatalogFilterLayout/CatalogFilterLayout.tsx","webpack://techdocs-cli-embedded-app/../../plugins/catalog-react/src/routes.ts","webpack://techdocs-cli-embedded-app/../../plugins/catalog-react/src/components/EntityRefLink/humanize.ts","webpack://techdocs-cli-embedded-app/../../plugins/catalog-react/src/components/EntityRefLink/EntityRefLink.tsx","webpack://techdocs-cli-embedded-app/../../plugins/catalog-react/src/components/EntityRefLink/FetchedEntityRefLinks.tsx","webpack://techdocs-cli-embedded-app/../../plugins/catalog-react/src/components/EntityRefLink/EntityRefLinks.tsx","webpack://techdocs-cli-embedded-app/../../plugins/catalog-react/src/utils/filters.ts","webpack://techdocs-cli-embedded-app/../../plugins/catalog-react/src/utils/getEntityRelations.ts","webpack://techdocs-cli-embedded-app/../../plugins/catalog-react/src/utils/getEntitySourceLocation.ts","webpack://techdocs-cli-embedded-app/../../plugins/catalog-react/src/utils/isOwnerOf.ts","webpack://techdocs-cli-embedded-app/../../plugins/catalog-react/src/filters.ts","webpack://techdocs-cli-embedded-app/../../plugins/catalog-react/src/hooks/useEntity.tsx","webpack://techdocs-cli-embedded-app/../../plugins/catalog-react/src/hooks/useEntityListProvider.tsx","webpack://techdocs-cli-embedded-app/../../plugins/catalog-react/src/hooks/useEntityTypeFilter.tsx","webpack://techdocs-cli-embedded-app/../../plugins/catalog-react/src/hooks/useRelatedEntities.ts","webpack://techdocs-cli-embedded-app/../../plugins/catalog-react/src/hooks/useStarredEntities.ts","webpack://techdocs-cli-embedded-app/../../plugins/catalog-react/src/hooks/useStarredEntity.ts","webpack://techdocs-cli-embedded-app/../../plugins/catalog-react/src/hooks/useEntityOwnership.ts","webpack://techdocs-cli-embedded-app/../../plugins/catalog-react/src/hooks/useEntityPermission.ts","webpack://techdocs-cli-embedded-app/../../plugins/catalog-react/src/components/EntityKindPicker/EntityKindPicker.tsx","webpack://techdocs-cli-embedded-app/../../plugins/catalog-react/src/components/EntityLifecyclePicker/EntityLifecyclePicker.tsx","webpack://techdocs-cli-embedded-app/../../plugins/catalog-react/src/components/EntityOwnerPicker/EntityOwnerPicker.tsx","webpack://techdocs-cli-embedded-app/../../plugins/catalog-react/src/components/EntitySearchBar/EntitySearchBar.tsx","webpack://techdocs-cli-embedded-app/../../plugins/catalog-react/src/components/EntityTable/columns.tsx","webpack://techdocs-cli-embedded-app/../../plugins/catalog-react/src/components/EntityTable/presets.tsx","webpack://techdocs-cli-embedded-app/../../plugins/catalog-react/src/components/EntityTable/EntityTable.tsx","webpack://techdocs-cli-embedded-app/../../plugins/catalog-react/src/components/EntityTagPicker/EntityTagPicker.tsx","webpack://techdocs-cli-embedded-app/../../plugins/catalog-react/src/components/EntityTypePicker/EntityTypePicker.tsx","webpack://techdocs-cli-embedded-app/../../plugins/catalog-react/src/components/FavoriteEntity/FavoriteEntity.tsx","webpack://techdocs-cli-embedded-app/../../plugins/catalog-react/src/components/InspectEntityDialog/components/EntityKindIcon.tsx","webpack://techdocs-cli-embedded-app/../../plugins/catalog-react/src/components/InspectEntityDialog/components/AncestryPage.tsx","webpack://techdocs-cli-embedded-app/../../plugins/catalog-react/src/components/InspectEntityDialog/components/common.tsx","webpack://techdocs-cli-embedded-app/../../plugins/catalog-react/src/components/InspectEntityDialog/components/ColocatedPage.tsx","webpack://techdocs-cli-embedded-app/../../plugins/catalog-react/src/components/InspectEntityDialog/components/util.ts","webpack://techdocs-cli-embedded-app/../../plugins/catalog-react/src/components/InspectEntityDialog/components/JsonPage.tsx","webpack://techdocs-cli-embedded-app/../../plugins/catalog-react/src/components/InspectEntityDialog/components/OverviewPage.tsx","webpack://techdocs-cli-embedded-app/../../plugins/catalog-react/src/components/InspectEntityDialog/components/YamlPage.tsx","webpack://techdocs-cli-embedded-app/../../plugins/catalog-react/src/components/InspectEntityDialog/InspectEntityDialog.tsx","webpack://techdocs-cli-embedded-app/../../plugins/catalog-react/src/components/UnregisterEntityDialog/useUnregisterEntityDialogState.ts","webpack://techdocs-cli-embedded-app/../../plugins/catalog-react/src/components/UnregisterEntityDialog/UnregisterEntityDialog.tsx","webpack://techdocs-cli-embedded-app/../../plugins/catalog-react/src/components/UserListPicker/UserListPicker.tsx","webpack://techdocs-cli-embedded-app/../../plugins/catalog-react/src/components/EntityProcessingStatusPicker/EntityProcessingStatusPicker.tsx","webpack://techdocs-cli-embedded-app/../../plugins/catalog-react/src/testUtils/providers.tsx","webpack://techdocs-cli-embedded-app/../../plugins/catalog/src/components/AboutCard/AboutField.tsx","webpack://techdocs-cli-embedded-app/../../plugins/catalog/src/components/AboutCard/AboutContent.tsx","webpack://techdocs-cli-embedded-app/../../plugins/catalog/src/components/AboutCard/AboutCard.tsx","webpack://techdocs-cli-embedded-app/../../plugins/catalog/src/components/CatalogKindHeader/CatalogKindHeader.tsx","webpack://techdocs-cli-embedded-app/../../plugins/catalog/src/components/CatalogTable/columns.tsx","webpack://techdocs-cli-embedded-app/../../plugins/catalog/src/components/CatalogTable/CatalogTable.tsx","webpack://techdocs-cli-embedded-app/../../plugins/catalog/src/components/EntityLinksCard/IconLink.tsx","webpack://techdocs-cli-embedded-app/../../plugins/catalog/src/components/EntityLinksCard/useDynamicColumns.tsx","webpack://techdocs-cli-embedded-app/../../plugins/catalog/src/components/EntityLinksCard/LinksGridList.tsx","webpack://techdocs-cli-embedded-app/../../plugins/catalog/src/routes.ts","webpack://techdocs-cli-embedded-app/../../plugins/permission-common/src/types/api.ts","webpack://techdocs-cli-embedded-app/../../plugins/permission-common/src/permissions/util.ts","webpack://techdocs-cli-embedded-app/../../plugins/permission-common/src/permissions/createPermission.ts","webpack://techdocs-cli-embedded-app/../../plugins/permission-common/src/PermissionClient.ts","webpack://techdocs-cli-embedded-app/../../plugins/permission-react/src/apis/PermissionApi.ts","webpack://techdocs-cli-embedded-app/../../plugins/permission-react/src/apis/IdentityPermissionApi.ts","webpack://techdocs-cli-embedded-app/../../plugins/permission-react/src/hooks/usePermission.ts","webpack://techdocs-cli-embedded-app/../../plugins/permission-react/src/components/PermissionedRoute.tsx","webpack://techdocs-cli-embedded-app/../../plugins/permission-react/src/components/RequirePermission.tsx","webpack://techdocs-cli-embedded-app/../../plugins/search-react/src/api.ts","webpack://techdocs-cli-embedded-app/../../plugins/search-react/src/components/HighlightedSearchResultText/HighlightedSearchResultText.tsx","webpack://techdocs-cli-embedded-app/../../plugins/search-react/src/context/SearchContext.tsx","webpack://techdocs-cli-embedded-app/../../plugins/search-react/src/components/SearchTracker/SearchTracker.tsx","webpack://techdocs-cli-embedded-app/../../plugins/search-react/src/components/SearchBar/SearchBar.tsx","webpack://techdocs-cli-embedded-app/../../plugins/search-react/src/components/SearchAutocomplete/SearchAutocomplete.tsx","webpack://techdocs-cli-embedded-app/../../plugins/search-react/src/components/SearchAutocomplete/SearchAutocompleteDefaultOption.tsx","webpack://techdocs-cli-embedded-app/../../plugins/search-react/src/components/SearchFilter/hooks.ts","webpack://techdocs-cli-embedded-app/../../plugins/search-react/src/components/SearchFilter/SearchFilter.Autocomplete.tsx","webpack://techdocs-cli-embedded-app/../../plugins/search-react/src/components/SearchFilter/SearchFilter.tsx","webpack://techdocs-cli-embedded-app/../../plugins/search-react/src/components/SearchResult/SearchResult.tsx","webpack://techdocs-cli-embedded-app/../../plugins/search-react/src/components/SearchResultPager/SearchResultPager.tsx","webpack://techdocs-cli-embedded-app/../../plugins/search-react/src/components/SearchPagination/SearchPagination.tsx","webpack://techdocs-cli-embedded-app/../../plugins/search-react/src/components/DefaultResultListItem/DefaultResultListItem.tsx","webpack://techdocs-cli-embedded-app/../../plugins/search-react/src/components/SearchResultList/SearchResultList.tsx","webpack://techdocs-cli-embedded-app/../../plugins/search-react/src/components/SearchResultGroup/SearchResultGroup.tsx","webpack://techdocs-cli-embedded-app/../../plugins/techdocs-react/src/addons.tsx","webpack://techdocs-cli-embedded-app/../../plugins/techdocs-react/src/api.ts","webpack://techdocs-cli-embedded-app/../../plugins/techdocs-react/src/helpers.ts","webpack://techdocs-cli-embedded-app/../../plugins/techdocs-react/src/context.tsx","webpack://techdocs-cli-embedded-app/../../plugins/techdocs-react/src/types.ts","webpack://techdocs-cli-embedded-app/../../plugins/techdocs-react/src/component.tsx","webpack://techdocs-cli-embedded-app/../../plugins/techdocs-react/src/hooks.ts","webpack://techdocs-cli-embedded-app/../../plugins/techdocs/src/EntityPageDocs.tsx","webpack://techdocs-cli-embedded-app/../../plugins/techdocs/src/Router.tsx","webpack://techdocs-cli-embedded-app/../../plugins/techdocs/src/client.ts","webpack://techdocs-cli-embedded-app/../../plugins/techdocs/src/helpers.ts","webpack://techdocs-cli-embedded-app/../../plugins/techdocs/src/home/components/DefaultTechDocsHome.tsx","webpack://techdocs-cli-embedded-app/../../plugins/techdocs/src/home/components/Grids/DocsCardGrid.tsx","webpack://techdocs-cli-embedded-app/../../plugins/techdocs/src/home/components/Grids/EntityListDocsGrid.tsx","webpack://techdocs-cli-embedded-app/../../plugins/techdocs/src/home/components/Tables/actions.tsx","webpack://techdocs-cli-embedded-app/../../plugins/techdocs/src/home/components/Tables/columns.tsx","webpack://techdocs-cli-embedded-app/../../plugins/techdocs/src/home/components/Tables/DocsTable.tsx","webpack://techdocs-cli-embedded-app/../../plugins/techdocs/src/home/components/Tables/EntityListDocsTable.tsx","webpack://techdocs-cli-embedded-app/../../plugins/techdocs/src/home/components/TechDocsIndexPage.tsx","webpack://techdocs-cli-embedded-app/../../plugins/techdocs/src/home/components/TechDocsPageWrapper.tsx","webpack://techdocs-cli-embedded-app/../../plugins/techdocs/src/home/components/TechDocsPicker.tsx","webpack://techdocs-cli-embedded-app/../../plugins/techdocs/src/plugin.ts","webpack://techdocs-cli-embedded-app/../../plugins/techdocs/src/reader/components/TechDocsReaderPage/TechDocsReaderPage.tsx","webpack://techdocs-cli-embedded-app/../../plugins/techdocs/src/reader/components/TechDocsBuildLogs.tsx","webpack://techdocs-cli-embedded-app/../../plugins/techdocs/src/reader/components/TechDocsNotFound.tsx","webpack://techdocs-cli-embedded-app/../../plugins/techdocs/src/reader/components/TechDocsStateIndicator.tsx","webpack://techdocs-cli-embedded-app/../../plugins/techdocs/src/reader/transformers/html/hooks/links.ts","webpack://techdocs-cli-embedded-app/../../plugins/techdocs/src/reader/transformers/html/hooks/iframes.ts","webpack://techdocs-cli-embedded-app/../../plugins/techdocs/src/reader/transformers/html/transformer.ts","webpack://techdocs-cli-embedded-app/../../plugins/techdocs/src/reader/transformers/styles/rules/variables.ts","webpack://techdocs-cli-embedded-app/../../plugins/techdocs/src/reader/transformers/styles/rules/reset.ts","webpack://techdocs-cli-embedded-app/../../plugins/techdocs/src/reader/transformers/styles/rules/layout.ts","webpack://techdocs-cli-embedded-app/../../plugins/techdocs/src/reader/transformers/styles/rules/typeset.ts","webpack://techdocs-cli-embedded-app/../../plugins/techdocs/src/reader/transformers/styles/rules/animations.ts","webpack://techdocs-cli-embedded-app/../../plugins/techdocs/src/reader/transformers/styles/rules/extensions.ts","webpack://techdocs-cli-embedded-app/../../plugins/techdocs/src/reader/transformers/styles/rules/rules.ts","webpack://techdocs-cli-embedded-app/../../plugins/techdocs/src/reader/transformers/styles/transformer.ts","webpack://techdocs-cli-embedded-app/../../plugins/techdocs/src/reader/transformers/addBaseUrl.ts","webpack://techdocs-cli-embedded-app/../../plugins/techdocs/src/reader/transformers/addGitFeedbackLink.ts","webpack://techdocs-cli-embedded-app/../../plugins/techdocs/src/reader/transformers/addSidebarToggle.ts","webpack://techdocs-cli-embedded-app/../../plugins/techdocs/src/reader/transformers/rewriteDocLinks.ts","webpack://techdocs-cli-embedded-app/../../plugins/techdocs/src/reader/transformers/addLinkClickListener.ts","webpack://techdocs-cli-embedded-app/../../plugins/techdocs/src/reader/transformers/copyToClipboard.tsx","webpack://techdocs-cli-embedded-app/../../plugins/techdocs/src/reader/transformers/removeMkdocsHeader.ts","webpack://techdocs-cli-embedded-app/../../plugins/techdocs/src/reader/transformers/simplifyMkdocsFooter.ts","webpack://techdocs-cli-embedded-app/../../plugins/techdocs/src/reader/transformers/onCssReady.ts","webpack://techdocs-cli-embedded-app/../../plugins/techdocs/src/reader/transformers/scrollIntoAnchor.ts","webpack://techdocs-cli-embedded-app/../../plugins/techdocs/src/reader/transformers/scrollIntoNavigation.ts","webpack://techdocs-cli-embedded-app/../../plugins/techdocs/src/reader/transformers/transformer.ts","webpack://techdocs-cli-embedded-app/../../plugins/techdocs/src/reader/components/TechDocsReaderPageContent/dom.tsx","webpack://techdocs-cli-embedded-app/../../plugins/techdocs/src/reader/components/TechDocsReaderPageContent/TechDocsReaderPageContentAddons.tsx","webpack://techdocs-cli-embedded-app/../../plugins/techdocs/src/reader/components/TechDocsReaderPageContent/TechDocsReaderPageContent.tsx","webpack://techdocs-cli-embedded-app/../../plugins/techdocs/src/reader/components/TechDocsReaderPageHeader/TechDocsReaderPageHeader.tsx","webpack://techdocs-cli-embedded-app/../../plugins/techdocs/src/reader/components/TechDocsReaderPageSubheader/TechDocsReaderPageSubheader.tsx","webpack://techdocs-cli-embedded-app/../../plugins/techdocs/src/reader/components/useReaderState.ts","webpack://techdocs-cli-embedded-app/../../plugins/techdocs/src/reader/components/TechDocsReaderProvider.tsx","webpack://techdocs-cli-embedded-app/../../plugins/techdocs/src/routes.ts","webpack://techdocs-cli-embedded-app/../../plugins/techdocs/src/search/components/TechDocsSearchResultListItem.tsx","webpack://techdocs-cli-embedded-app/../../plugins/techdocs/src/search/components/TechDocsSearch.tsx"],"names":["CATALOG_FILTER_EXISTS","Symbol","for","CatalogClient","getEntityAncestors","request","options","kind","namespace","name","parseEntityRef","entityRef","requestRequired","encodeURIComponent","getLocationById","id","requestOptional","getEntities","filter","fields","offset","limit","after","params","filterItem","flat","filterParts","key","value","Object","entries","v","push","length","join","map","undefined","query","entities","refCompare","a","b","metadata","aRef","stringifyEntityRef","bRef","items","sort","getEntityByRef","getEntityByName","compoundName","refreshEntity","response","fetchApi","fetch","discoveryApi","getBaseUrl","headers","token","Authorization","method","body","JSON","stringify","status","Error","text","getEntityFacets","facets","facet","addLocation","type","target","dryRun","location","exists","json","getLocationByRef","locationRef","r","data","find","l","stringifyLocationRef","removeLocationById","requestIgnored","removeEntityByUid","uid","validateEntity","entity","ok","valid","ResponseError","errors","path","url","constructor","crossFetch","DEFAULT_NAMESPACE","ANNOTATION_VIEW_URL","ANNOTATION_EDIT_URL","ANNOTATION_KUBERNETES_API_SERVER","ANNOTATION_KUBERNETES_API_SERVER_CA","ANNOTATION_KUBERNETES_AUTH_PROVIDER","DefaultNamespaceEntityPolicy","enforce","lodash","merge","CommonValidatorFunctions","isValidPrefixAndOrSuffix","separator","isValidPrefix","isValidSuffix","parts","split","isJsonSafe","parse","isValidDnsSubdomain","every","isValidDnsLabel","test","isValidTag","isValidUrl","URL","isValidString","trim","isNonEmptyString","compiledSchemaCache","Map","refDependencyCandidates","entityEnvelopeSchema","entitySchema","entityMetaSchema","commonSchema","throwAjvError","TypeError","error","instancePath","message","val","compileAjvSchema","schema","disableCache","cacheKey","cached","get","extraSchemas","getExtraSchemas","ajv","Ajv","allowUnionTypes","allErrors","validateSchema","addSchema","compiled","compile","set","seen","Set","$id","add","selected","Array","todo","current","pop","ref","getAllRefs","has","match","c","entityEnvelopeSchemaValidator","validate","entityKindSchemaValidator","softCandidates","e","includes","keyword","entitySchemaValidator","KubernetesValidatorFunctions","isValidApiVersion","n","isValidKind","isValidObjectName","isValidNamespace","isValidLabelKey","isValidLabelValue","isValidAnnotationKey","isValidAnnotationValue","defaultValidators","isValidEntityName","makeValidator","overrides","FieldFormatEntityPolicy","require","field","validator","isValid","expectation","optional","apiVersion","validators","k","labels","annotations","tags","i","links","title","icon","SchemaValidEntityPolicy","parseRefString","colonI","indexOf","slashI","slice","Math","max","getCompoundEntityRef","context","defaultKind","defaultNamespace","parsed","textual","toLocaleLowerCase","AllEntityPolicies","result","policy","policies","output","AnyEntityPolicy","EntityPolicies","allOf","oneOf","ajvCompiledJsonSchemaValidator","check","apiEntityV1alpha1Validator","componentEntityV1alpha1Validator","domainEntityV1alpha1Validator","groupEntityV1alpha1Validator","locationEntityV1alpha1Validator","RELATION_OWNED_BY","RELATION_OWNER_OF","RELATION_CONSUMES_API","RELATION_API_CONSUMED_BY","RELATION_PROVIDES_API","RELATION_API_PROVIDED_BY","RELATION_DEPENDS_ON","RELATION_DEPENDENCY_OF","RELATION_PARENT_OF","RELATION_CHILD_OF","RELATION_MEMBER_OF","RELATION_HAS_MEMBER","RELATION_PART_OF","RELATION_HAS_PART","resourceEntityV1alpha1Validator","systemEntityV1alpha1Validator","userEntityV1alpha1Validator","ANNOTATION_LOCATION","ANNOTATION_ORIGIN_LOCATION","ANNOTATION_SOURCE_LOCATION","parseLocationRef","splitIndex","substring","getEntitySourceLocation","AlertDisplay","props","messages","setMessages","useState","alertApi","useApi","alertApiRef","anchorOrigin","vertical","horizontal","useEffect","subscription","alert$","subscribe","msgs","concat","unsubscribe","firstMessage","handleClose","msg","Snackbar","open","Alert","action","IconButton","color","size","onClick","data-testid","CloseIcon","severity","span","toString","em","pluralize","useStyles","makeStyles","theme","createStyles","avatar","width","height","fontWeight","typography","fontWeightBold","letterSpacing","textTransform","Avatar","displayName","picture","customStyles","classes","styles","backgroundColor","stringToColor","MaterialAvatar","alt","src","className","style","extractInitials","visuallyHidden","clip","clipPath","overflow","position","whiteSpace","externalLink","isExternalUri","uri","useBaseUrl","configApiRef","getOptionalString","useBasePath","base","pathname","trimEnd","useResolvedPath","resolvedPath","String","basePath","external","startsWithBasePath","startsWith","getNodeText","node","children","Link","React","noTrack","analytics","useAnalytics","to","linkText","newWindow","exec","handleClick","event","captureEvent","attributes","MaterialLink","rel","href","classnames","component","RouterLink","LinkWrapper","Button","MaterialButton","CopyTextButton","tooltipDelay","tooltipText","ariaLabel","errorApi","errorApiRef","setOpen","copyToClipboard","useCopyToClipboard","post","handleCopyClick","stopPropagation","Tooltip","placement","leaveDelay","onClose","aria-label","CopyIcon","CodeSnippet","language","showLineNumbers","highlightedNumbers","customStyle","showCopyCodeButton","useTheme","mode","palette","dark","docco","highlightColor","div","LightAsync","wrapLines","lineNumberStyle","textVerySubtle","lineProps","lineNumber","top","right","CreateButton","isXSScreen","useMediaQuery","breakpoints","down","AddCircleOutline","variant","Direction","TOP_BOTTOM","BOTTOM_TOP","LEFT_RIGHT","RIGHT_LEFT","Alignment","UP_LEFT","UP_RIGHT","DOWN_LEFT","DOWN_RIGHT","Ranker","NETWORK_SIMPLEX","TIGHT_TREE","LONGEST_PATH","LabelPosition","LEFT","RIGHT","CENTER","fill","primary","light","stroke","contrastText","DefaultNode","setWidth","setHeight","idRef","renderedHeight","renderedWidth","getBBox","round","padding","paddedWidth","paddedHeight","g","rect","rx","y","x","textAnchor","alignmentBaseline","ARROW_MARKER_ID","NODE_TEST_ID","EDGE_TEST_ID","LABEL_TEST_ID","transition","transitions","duration","shortest","renderDefault","Node","render","setNode","nodeProps","nodeRef","transform","textContrast","DefaultLabel","edge","label","strokeWidth","textSubtle","Edge","setEdge","curve","points","labelProps","labelRef","createPath","d3Shape","d","finitePoints","point","isFinite","WORKSPACE_ID","DependencyGraph","graph","edges","nodes","renderNode","direction","align","nodeMargin","edgeMargin","rankMargin","paddingX","paddingY","acyclicer","ranker","labelPosition","labelOffset","edgeRanks","edgeWeight","renderLabel","defs","zoom","svgProps","containerWidth","setContainerWidth","containerHeight","setContainerHeight","dagre","graphWidth","setGraphWidth","graphHeight","setGraphHeight","graphNodes","setGraphNodes","graphEdges","setGraphEdges","maxWidth","maxHeight","containerRef","debounce","container","d3Selection","workspace","getElementById","enableZoom","call","d3Zoom","scaleExtent","on","min","attr","newContainerWidth","newContainerHeight","getBoundingClientRect","setNodesAndEdges","currentGraphNodes","currentGraphEdges","forEach","nodeId","some","removeNode","from","w","removeEdge","existingNode","labelpos","labeloffset","weight","minlen","updateGraph","newHeight","newWidth","leading","setGraph","rankdir","nodesep","edgesep","ranksep","marginx","marginy","cancel","svg","viewBox","marker","markerWidth","markerHeight","refX","refY","orient","markerUnits","root","spacing","marginBottom","marginTop","display","flexFlow","topPosition","zIndex","fontSize","content","flexWrap","alignItems","banner","link","info","warning","DismissableBanner","fixed","notificationsStore","storageApiRef","forBucket","rawDismissedBanners","snapshot","dismissedBanners","setDismissedBanners","observedItems","useObservable","observe$","currentValue","classNames","SnackbarContent","Close","generalImg","left","EmptyStateImage","missing","img","missingAnnotation","noInformation","createComponent","noBuild","background","default","imageContainer","EmptyState","description","Grid","justifyContent","item","xs","md","Typography","customImage","COMPONENT_YAML","code","borderRadius","margin","MissingAnnotationEmptyState","annotation","readMoreUrl","replace","getWarningTextColor","darken","lighten","getWarningBackgroundColor","useErrorOutlineStyles","marginRight","ErrorOutlineStyled","ErrorOutline","ExpandMoreIconStyled","ExpandMoreIcon","panel","verticalAlign","summary","flexDirection","summaryText","details","border","fontFamily","capitalize","s","charAt","toLocaleUpperCase","WarningPanel","defaultExpanded","subTitle","Accordion","role","AccordionSummary","expandIcon","AccordionDetails","overflowX","divider","ErrorList","stack","List","dense","ListItem","ListItemText","secondary","ErrorPanel","ResponseErrorPanel","cause","errorString","statusCode","requestString","messageString","stackString","jsonString","Divider","createRootElement","rootContainer","document","createElement","setAttribute","addRootElement","rootElem","insertBefore","lastElementChild","nextElementSibling","usePortal","rootElemRef","useRef","existingParent","querySelector","parentElem","appendChild","remove","childNodes","getRootElem","STATES_LOCAL_STORAGE_KEY","useCalloutStates","states","setStates","raw","localStorage","getItem","setState","useCallback","newStates","setItem","useCalloutHasBeenSeen","featureId","markSeen","useShowCallout","show","hide","opacity","featureWrapper","backdrop","bottom","dot","boxShadow","transformOrigin","animation","pulseCircle","FeatureCalloutCircular","portalElement","wrapperRef","setPlacement","update","wrapperBounds","longest","borderWidth","dotLeft","dotTop","dotSize","textWidth","textLeft","textTop","window","addEventListener","removeEventListener","useLayoutEffect","createPortal","ClickAwayListener","onClickAway","onKeyDown","tabIndex","paragraph","useIconStyles","justifyItems","gridGap","textAlign","disabled","cursor","main","IconLinkVertical","LinkIcon","underline","gridAutoFlow","gridAutoColumns","HeaderIconLinkRow","nav","index","generateGradientStops","themeType","luminance","fadeSize","fadePadding","scrollbarWidth","fade","pointerEvents","fadeLeft","fadeRight","fadeHidden","button","buttonLeft","buttonRight","useScrollDistance","scrollLeft","scrollRight","setScroll","el","handleUpdate","scrollWidth","offsetWidth","useSmoothScroll","speed","minDistance","scrollTarget","setScrollTarget","startTime","performance","now","requestAnimationFrame","frameTime","frameDuration","scrollDistance","abs","scrollAmount","sign","scrollBy","newScrollTarget","cancelAnimationFrame","HorizontalScrollGrid","scrollStep","scrollSpeed","minScrollDistance","otherProps","handleScrollClick","forwards","wrap","ChevronLeftIcon","ChevronRightIcon","alpha","fontStyle","beta","Lifecycle","shorthand","RealLogViewer","lazy","then","m","LogViewer","Progress","useApp","getComponents","Suspense","fallback","markdown","borderCollapse","wordBreak","lineHeight","borderBottom","paper","flatten","child","reduce","headingRenderer","level","slug","components","inline","h1","h2","h3","h4","h5","h6","MarkdownContent","dialect","linkTarget","transformLinkUri","transformImageUri","ReactMarkdown","remarkPlugins","gfm","useItemStyles","paddingLeft","LoginRequestListItem","busy","setBusy","setError","handleContinue","trigger","isError","IconComponent","provider","ListItemAvatar","dialog","paddingTop","minWidth","titleHeading","contentList","actionButtons","OAuthRequestDialog","_props","oauthRequestApi","oauthRequestApiRef","requests","useMemo","authRequest$","handleRejectAll","reject","Dialog","Boolean","fullWidth","aria-labelledby","DialogTitle","DialogContent","dividers","DialogActions","OverflowTooltip","hover","setHover","isMounted","useIsMounted","handleToggled","truncated","disableHoverListener","TextTruncate","line","onToggled","containerClassName","isVisible","setIsVisible","handle","setTimeout","clearTimeout","LinearProgress","boxTitle","arrow","BottomLink","Box","strong","ArrowIcon","SlackLink","slackChannel","ErrorBoundary","Component","componentDidCatch","errorInfo","console","state","noPadding","paddingBottom","header","headerTitle","headerSubheader","headerAvatar","headerAction","headerContent","subheader","CardActionsTopRight","withStyles","float","CardActions","VARIANT_STYLES","card","flex","fullHeight","gridItem","cardContent","InfoCard","deepLink","errorBoundaryProps","headerStyle","headerProps","actionsClassName","actions","cardClassName","actionsTopRight","titleTypographyProps","calculatedStyle","calculatedCardStyle","cardSubTitle","errProps","Card","CardHeader","CardContent","overlay","circle","colorUnknown","defaultGaugeProps","fractional","inverse","unit","getProgressColor","isNaN","actualMax","actualValue","Gauge","hoverRef","setHoverRef","getColor","asPercentage","asActual","isHovering","setIsHovering","handleMouseOver","handleMouseOut","Circle","strokeLinecap","percent","trailWidth","strokeColor","GaugeCard","progress","gaugeProps","LinearGauge","Line","SvgIcon","xmlns","BootstrapInput","input","create","InputBase","formControl","formLabel","chips","chip","checkbox","SelectComponent","multiple","placeholder","onChange","triggerReset","native","setValue","isOpen","handleChange","preventDefault","previous","HTMLElement","handleClickAway","handleDelete","selectedValue","newValue","FormControl","InputLabel","Select","displayEmpty","renderValue","Chip","clickable","onDelete","OpenedDropdown","ClosedDropdown","MenuProps","getContentAnchorEl","MenuItem","option","Checkbox","checked","noop","VerticalStepperContext","stepperLength","stepIndex","setStepIndex","stepHistory","setStepHistory","onStepChange","SimpleStepper","elevated","activeStep","steps","endStep","Children","isValidElement","end","Provider","count","MuiStepper","orientation","elevation","RestartBtn","NextBtn","last","BackBtn","SimpleStepperFooter","useContext","newIndex","callback","handleNext","nextStep","onNext","handleBack","onBack","handleRestart","onRestart","showBack","backText","showNext","nextText","canNext","showRestart","restartText","SimpleStepperStep","muiProps","MuiStep","StepLabel","StepContent","pending","running","aborted","StatusOK","aria-hidden","StatusWarning","StatusError","StatusPending","StatusRunning","StatusAborted","tableTitleCellStyles","paddingRight","tableContentCellStyles","listStyles","listStyle","listItemStyles","random","TitleCell","TableCell","ContentCell","MetadataTable","Table","TableBody","MetadataTableItem","rest","TableRow","colSpan","MetadataList","ul","MetadataListItem","li","listStyleType","nestedListStyle","StyledList","StyledNestedList","renderList","list","nested","values","toValue","renderMap","keys","fmtKey","titleFormat","startCase","Fragment","isArray","ItemValue","TableItem","mapToItems","StructuredMetadataTable","metadataItems","queryParams","qs","strictNullHandling","queryString","ignoreQueryPrefix","extractState","stateName","joinQueryString","useQueryParamState","debounceTime","searchParams","setSearchParams","useSearchParams","searchParamsString","queryParamState","setQueryParamState","newState","oldState","isEqual","useDebouncedEffect","DEFAULT_SUPPORT_CONFIG","useSupportConfig","config","useApiHolder","supportConfig","getOptionalConfig","itemConf","getString","getConfigArray","flatMap","getOptionalConfigArray","linkConf","useSystemIcon","Icon","getSystemIcon","MuiBrokenImageIcon","BrokenImageIcon","CatalogIcon","ChatIcon","DashboardIcon","DocsIcon","EmailIcon","GitHubIcon","GroupIcon","HelpIcon","UserIcon","WarningIcon","popoverList","SupportIcon","app","SupportLink","SupportListItem","ListItemIcon","prev","idx","br","SupportButton","popoverOpen","setPopoverOpen","anchorEl","setAnchorEl","isSmallScreen","onClickHandler","currentTarget","popoverCloseHandler","ml","startIcon","Popover","drawerWidthClosed","iconPadding","userBadgePadding","sidebarConfig","drawerWidthOpen","defaultOpenDelayMs","defaultCloseDelayMs","defaultFadeDuration","logoHeight","iconContainerWidth","iconSize","selectedIndicatorWidth","userBadgeDiameter","mobileSidebarHeight","makeSidebarConfig","customSidebarConfig","submenuConfig","makeSidebarSubmenuConfig","customSubmenuConfig","SIDEBAR_INTRO_LOCAL_STORAGE","SidebarConfigContext","createContext","SidebarItemWithSubmenuContext","isHoveredOn","setIsHoveredOn","LocalStorageKeys","SIDEBAR_PIN_STATE","LocalStorage","getSidebarPinState","setSidebarPinState","defaultSidebarPinStateContext","isPinned","toggleSidebarPinState","isMobile","LegacySidebarPinStateContext","VersionedSidebarPinStateContext","createVersionedContext","SidebarPinStateProvider","createVersionedValueMap","useSidebarPinState","versionedPinStateContext","legacyPinStateContext","pinStateContext","atVersion","isolation","up","outline","PageContext","contentRef","SidebarPage","setIsPinned","pageContext","noSsr","useContent","focusContent","focus","defaultSidebarOpenStateContext","LegacySidebarContext","VersionedSidebarContext","SidebarOpenStateProvider","useSidebarOpenState","versionedOpenStateContext","legacyOpenStateContext","openStateContext","flexGrow","navigation","selectedColor","borderTop","indicator","MobileSidebarGroup","useLocation","selectedMenuItemIndex","setSelectedMenuItemIndex","MobileSidebarContext","_","BottomNavigationAction","SidebarGroup","snackbar","overlayHeader","overlayHeaderClose","marginMobileSidebar","sortSidebarGroupsForPriority","orderBy","priority","Number","isInteger","sidebarGroupType","OverlayMenu","Drawer","anchor","ModalProps","BackdropProps","paperAnchorBottom","MobileSidebar","sidebarGroups","useElementFilter","elements","getElements","MenuIcon","shouldShowGroupChildren","BottomNavigation","drawer","appBar","msOverflowStyle","easing","sharp","flexShrink","drawerOpen","shorter","State","Closed","Idle","Open","DesktopSidebar","openDelayMs","closeDelayMs","disableExpandOnHover","hoverTimerRef","handleOpen","A11ySkipSidebar","onMouseEnter","onFocus","onMouseLeave","onBlur","Sidebar","sidebarOptions","submenuOptions","isLocationMatch","currentLocation","toLocation","toDecodedSearch","URLSearchParams","search","toQueryParameters","currentDecodedSearch","currentQueryParameters","isMatch","itemContainer","marginLeft","subtitle","dropdownArrow","dropdown","dropdownItem","textContent","SidebarSubmenuItem","dropdownItems","closeSubmenu","isActive","showDropDown","setShowDropDown","handleClickDropdown","resolvePath","enterDelay","enterNextDelay","onTouchStart","ArrowDropUpIcon","ArrowDropDownIcon","object","submenu","transitionDelay","SidebarSubmenu","isSubmenuOpen","setIsSubmenuOpen","iconContainer","arrow1","DoubleArrowLeft","ArrowBackIosIcon","DoubleArrowRight","ArrowForwardIosIcon","makeSidebarStyles","buttonItem","font","closed","highlightable","navItem","hoverBackground","highlighted","boxSizing","searchRoot","searchField","searchFieldHTMLInput","searchContainer","secondaryAction","closedItemIcon","submenuArrow","expandButton","arrows","borderLeft","useMemoStyles","useLocationMatch","active","_to","isButtonItem","sidebarSubmenuType","WorkaroundNavLink","activeStyle","caseSensitive","activeClassName","ariaCurrentProp","locationPathname","toPathname","ariaCurrent","aria-current","SidebarItemBase","forwardRef","hasNotifications","hasSubmenu","disableHighlight","navLinkProps","divStyle","displayItemIcon","ArrowRightIcon","itemIcon","Badge","overlap","invisible","openContent","childProps","SidebarItemWithSubmenu","handleMouseEnter","handleMouseLeave","arrowIcon","ArrowDropUp","ArrowDropDown","SidebarItem","SidebarSearchField","setInput","SearchIcon","onSearch","handleEnter","ev","handleInput","handleInputClick","handleItemClick","TextField","InputProps","disableUnderline","inputProps","SidebarSpace","styled","SidebarSpacer","SidebarDivider","styledScrollbar","overflowY","hint","SidebarScrollWrapper","scrollbarStyles","minHeight","SidebarExpandButton","introCard","introDismiss","introDismissLink","linkHover","introDismissText","introDismissIcon","IntroCard","SidebarIntroCard","onDismiss","collapsing","setCollapsing","startDismissing","Collapse","in","onExited","starredIntroText","recentlyViewedIntroText","SidebarIntro","defaultValue","starredItemsDismissed","recentlyViewedItemsDismissed","dismissedIntro","setDismissedIntro","useLocalStorageValue","dismissStarred","dismissRecentlyViewed","gridArea","stretch","Content","restProps","article","tabsWrapper","defaultTab","caption","tabRoot","HeaderTabs","tabs","selectedIndex","selectedTab","setSelectedTab","Tabs","selectionFollowsFocus","indicatorColor","textColor","scrollButtons","tab","TabUI","tabProps","useSelectedSubRoute","subRoutes","useParams","sortedRoutes","element","localeCompare","useRoutes","currentRoute","matchRoutes","matchedRoute","foundIndex","findIndex","t","route","RoutedTabs","routes","navigate","useNavigate","headerTabs","onTabChange","Helmet","Route","attachComponentData","createSubRoutesFromChildren","childrenProps","routeType","TabbedLayout","useSubvalueCellStyles","subvalue","SubvalueCell","useFilterStyles","grey","filters","Filters","onChangeFilters","selectedFilters","setSelectedFilters","reset","tableIcons","Add","AddBox","Check","Clear","Delete","DeleteOutline","DetailPanel","ChevronRight","Edit","Export","SaveAlt","Filter","FilterList","FirstPage","LastPage","NextPage","PreviousPage","ChevronLeft","ResetSearch","Search","SortArrow","ArrowUpward","ThirdStateCheck","Remove","ViewColumn","extractValueByField","f","StyledMTableHeader","A100","MTableHeader","StyledMTableToolbar","MTableToolbar","useTableStyles","convertColumns","columns","column","cellStyle","highlight","cellStyleFn","rowData","rowColumn","removeDefaultValues","defaultState","defaultInitialState","filtersOpen","TableToolbar","toolbarProps","toolbarRef","setSearch","hasFilters","selectedFiltersLength","toggleFilters","filtersClasses","onSearchChanged","searchText","initialState","emptyContent","onStateChange","tableClasses","calculatedInitialState","setFiltersOpen","setSelectedFiltersLength","tableData","setTableData","MTColumns","defaultOptions","getFieldByTitle","titleValue","selectedFiltersArray","newData","filterValue","fieldValue","constructFilters","filterConfig","dataValue","extractDistinctValues","distinctValues","addValue","constructSelect","Toolbar","hasNoRows","columnCount","Body","bodyProps","tbody","tr","td","MTableBody","MTable","Header","icons","localization","toolbar","searchPlaceholder","freeze","TabPanel","other","hidden","p","isNext","StyledIcon","disableRipple","disableFocusRipple","tabMarginLeft","isFirstNav","isFirstIndex","pxToRem","StyledTab","Tab","tabbar","flexContainer","StyledTabs","TabIndicatorProps","styledTabs","appbar","navIndex","setNavIndex","numberOfChunkedElement","setNumberOfChunkedElement","chunkedTabs","setChunkedTabs","wrapper","useWindowSize","navigateToPrevChunk","navigateToNextChunk","hasNextNavIndex","numberOfTabIcons","wrapperWidth","flattenIndex","newChunkedElementSize","floor","chunkArray","currentIndex","AppBar","NavigateBeforeIcon","NavigateNextIcon","lastNum","TrendLine","Sparklines","SparklinesLine","leftItemsBox","rightItemsBox","ContentHeaderTitle","ContentHeader","titleComponent","TitleComponent","renderedTitle","micDrop","MicDrop","MicDropSvgUrl","ErrorPage","statusMessage","additionalInfo","supportUrl","support","sm","ClickableText","textDecoration","StyledBox","Breadcrumbs","childrenArray","firstPage","secondPage","expandablePages","currentPage","hasHiddenBreadcrumbs","MaterialBreadcrumbs","clone","pageLink","shadows","backgroundImage","page","backgroundPosition","backgroundSize","fontColor","breadcrumb","breadcrumbType","breadcrumbTitle","TypeFragment","typeLink","pageTitle","TitleFragment","tooltip","FinalTitle","SubtitleFragment","pageTitleOverride","appTitle","documentTitle","titleTemplate","defaultTitle","ActionItem","secondaryLabel","HeaderActionMenu","actionItems","anchorElRef","MoreVert","actionItem","common","white","HeaderLabelContent","HeaderLabel","timeFormat","hour","minute","getTimes","configApi","Date","lang","navigator","clocks","clockConfigs","clock","timeZone","toLocaleString","warn","time","toLocaleTimeString","HomepageTimer","defaultTimes","setTimes","intervalId","setInterval","clearInterval","getPageTheme","themeId","ItemCardHeader","ItemCard","CardMedia","tag","gridTemplateColumns","gridAutoRows","ItemCardGrid","gridTemplateAreas","gridTemplateRows","Page","ThemeProvider","baseTheme","PageWithHeader","proxiedSessionSchema","z","providerInfo","catchall","profile","email","backstageIdentity","identity","userEntityRef","ownershipEntityRefs","DEFAULTS","defaultTokenExpiryMillis","tokenExpiryMarginMillis","tokenToExpiry","jwtToken","_header","rawPayload","_signature","payload","atob","exp","ProxiedSignInIdentity","start","getSessionAsync","getUserId","getSessionSync","getIdToken","getProfile","getProfileInfo","getBackstageIdentity","getCredentials","signOut","abortController","abort","session","promise","expiresAt","fetchSession","baseUrl","signal","credentials","fromResponse","AbortController","ProxiedSignInPage","discoveryApiRef","execute","useAsync","onSignInSuccess","useMountEffect","GridItem","GuestUserIdentity","parseJwtPayload","LegacyUserIdentity","userId","fromResult","sub","ent","UserIdentity","createGuest","fromLegacy","authApi","profilePromise","ex","commonProvider","apiRef","handleLogin","identityResponse","instantPopup","ForwardedError","loader","apis","guestProvider","ID_TOKEN_REGEX","useFormStyles","form","alignSelf","asInputRef","renderResult","inputRef","customProvider","register","handleSubmit","formState","useForm","handleResult","onSubmit","required","FormHelperText","autoComplete","idToken","isDirty","isEmpty","PROVIDER_STORAGE_KEY","signInProviders","guest","custom","validateIDs","providers","getSignInProviders","identityProviders","acc","useSignInProviders","apiHolder","loading","setLoading","handleWrappedResult","identityApi","IdentityApiSignOutProxy","removeItem","selectedProviderId","didCancel","catch","handleSignInSuccess","MultiSignInPage","providerElements","SingleSignInPage","auto","showLoginPage","setShowLoginPage","login","checkExisting","showPopup","err","SignInPage","useTabsStyles","BoldHeader","TabbedCard","tabsClasses","selectIndex","_ev","newSelectedIndex","selectedTabContent","useCardTabStyles","CardTab","AnalyticsReactContext","useAnalyticsContext","theContext","routeRef","pluginId","extension","theValue","AnalyticsContext","combinedValue","versionedCombinedValue","withAnalyticsContext","ComponentWithAnalyticsContext","versionedHolder","useVersionedContext","api","withApis","WrappedComponent","Hoc","impls","hasOwnProperty","ApiRefImpl","T","part","createApiRef","createApiFactory","factory","instance","deps","SessionState","SignedIn","SignedOut","googleAuthApiRef","githubAuthApiRef","oktaAuthApiRef","gitlabAuthApiRef","microsoftAuthApiRef","oneloginAuthApiRef","bitbucketAuthApiRef","atlassianAuthApiRef","analyticsApiRef","appThemeApiRef","FeatureFlagState","None","Active","featureFlagsApiRef","fetchApiRef","identityApiRef","Tracker","setContext","subject","analyticsApi","useAnalyticsApi","trackerRef","getTracker","tracker","contextKey","PluginProvider","plugin","usePluginOptions","getPluginOptions","versionedContext","appContext","globalStore","getOrCreateGlobalSingleton","WeakMap","componentDataKey","dataComponent","defineProperty","enumerable","configurable","writable","getComponentData","routeRefType","RouteRefImpl","createRouteRef","PARAM_PATTERN","SubRouteRefImpl","parent","createSubRouteRef","pathParams","endsWith","param","ExternalRouteRefImpl","createExternalRouteRef","useRouteRef","sourceLocation","resolver","routeFunc","resolve","isOptional","useRouteRefParams","_routeRef","PluginErrorBoundary","getDerivedStateFromError","ErrorBoundaryFallback","resetError","handleErrorReset","createRoutableExtension","mountPoint","createReactExtension","InnerComponent","RoutableExtensionWrapper","componentName","BootErrorPage","step","createComponentExtension","lazyLoader","sync","expose","Result","getId","selectChildren","rootNode","featureFlagsApi","selector","strictError","with","without","Collection","selectByComponentData","selection","withStrictError","findComponentData","filterFn","dependencies","PluginImpl","getApis","getFeatureFlags","featureFlags","externalRoutes","provide","__experimentalReconfigure","__experimentalConfigure","createPlugin","maybe","assertError","serializeError","serialized","serializeErrorInternal","includeStack","deserializeError","deserializeErrorInternal","stringifyError","str","CustomErrorBase","fullMessage","causeStr","captureStackTrace","InputError","AuthenticationError","NotAllowedError","NotFoundError","ConflictError","NotModifiedError","parseErrorResponseBody","statusText","scmAuthApiRef","ScmAuthMux","isUrlSupported","ScmAuth","createDefaultApiFactory","github","gitlab","azure","bitbucket","forGithub","forGitlab","forAzure","forBitbucket","forAuthApi","host","scopeMapping","githubAuthApi","repoWrite","gitlabAuthApi","microsoftAuthApi","bitbucketAuthApi","getAdditionalScopesForProvider","additionalScopes","customScopes","providerName","additionalScope","restOptions","scopes","uniqueScopes","getAccessToken","ScmIntegrationsApi","fromConfig","ScmIntegrations","scmIntegrationsApiRef","ScmIntegrationIcon","DefaultIcon","CodeIcon","isValidHost","basicIntegrations","integrations","getHost","byUrl","byHost","defaultScmResolveUrl","updated","filepath","parseGitUrl","repoRootPath","hash","AMAZON_AWS_HOST","readAwsS3IntegrationConfig","endpoint","s3ForcePathStyle","getOptionalBoolean","accessKeyId","secretAccessKey","roleArn","externalId","readAwsS3IntegrationConfigs","configs","AwsS3Integration","integrationConfig","resolveUrl","resolveEditUrl","VERSION_PREFIX_GIT_BRANCH","AzureUrl","fromRepoUrl","repoUrl","owner","project","repo","decodeURIComponent","version","origin","toRepoUrl","toFileUrl","toArchiveUrl","toCommitsUrl","getOwner","getProject","getRepo","getPath","getRef","AZURE_HOST","readAzureIntegrationConfig","readAzureIntegrationConfigs","AzureIntegration","azureUrl","newUrl","mockBaseUrl","updatedPath","getAzureFileFetchUrl","getAzureDownloadUrl","getAzureCommitsUrl","getAzureRequestOptions","additionalHeaders","buffer","Buffer","BITBUCKET_HOST","BITBUCKET_API_BASE_URL","readBitbucketIntegrationConfig","apiBaseUrl","username","appPassword","readBitbucketIntegrationConfigs","BitbucketIntegration","resolved","urlData","editUrl","getBitbucketDefaultBranch","repoName","resource","isHosted","branchUrl","getBitbucketRequestOptions","defaultBranch","mainbranch","displayId","getBitbucketDownloadUrl","protocol","branch","getBitbucketFileFetchUrl","filepathtype","pathWithoutSlash","BITBUCKET_CLOUD_HOST","BITBUCKET_CLOUD_API_BASE_URL","readBitbucketCloudIntegrationConfig","readBitbucketCloudIntegrationConfigs","BitbucketCloudIntegration","getBitbucketCloudDefaultBranch","getBitbucketCloudRequestOptions","getBitbucketCloudDownloadUrl","getBitbucketCloudFileFetchUrl","readBitbucketServerIntegrationConfig","password","readBitbucketServerIntegrationConfigs","BitbucketServerIntegration","getBitbucketServerDefaultBranch","getBitbucketServerRequestOptions","getBitbucketServerDownloadUrl","getBitbucketServerFileFetchUrl","readGerritIntegrationConfig","cloneUrl","gitilesBaseUrl","readGerritIntegrationConfigs","GERRIT_BODY_PREFIX","parseGerritGitilesUrl","projectEndIndex","trimStart","branchIndex","filePath","builldGerritGitilesUrl","getAuthenticationPrefix","getGerritBranchApiUrl","getGerritCloneRepoUrl","getGerritFileContentsApiUrl","getGerritProjectsApiUrl","getGerritRequestOptions","parseGerritJsonResponse","responseBody","GerritIntegration","GITHUB_HOST","GITHUB_API_BASE_URL","GITHUB_RAW_BASE_URL","readGitHubIntegrationConfig","rawBaseUrl","apps","appId","getNumber","clientId","clientSecret","webhookSecret","privateKey","allowedInstallationOwners","getOptionalStringArray","readGitHubIntegrationConfigs","getGitHubFileFetchUrl","chooseEndpoint","getGitHubRequestOptions","Accept","Cache","getOrCreateToken","supplier","existingInstallationData","tokenCache","isExpired","minus","minutes","appliesToRepo","accessToken","tokenData","repositories","date","DateTime","HEADERS","GithubAppManager","getInstallationCredentials","cache","installationId","suspended","getInstallationData","appClient","createInstallationAccessToken","installation_id","repositoryNames","repository_selection","installationClient","Octokit","auth","repos","paginate","listReposAccessibleToInstallation","repository","expires_at","getInstallations","listInstallations","installation","inst","account","suspended_by","notFoundError","baseAuthConfig","authStrategy","createAppAuth","GithubAppCredentialsMux","getAllInstallations","Promise","all","getAppToken","results","resultItem","notNotFoundError","ac","SingleInstanceGithubCredentialsProvider","opts","githubAppCredentialsMux","DefaultGithubCredentialsProvider","fromIntegrations","credentialsProviders","integration","credentialsProvider","GitHubIntegration","replaceGitHubUrlType","GITLAB_HOST","GITLAB_API_BASE_URL","readGitLabIntegrationConfig","readGitLabIntegrationConfigs","getGitLabIntegrationRelativePath","relativePath","getGitLabFileFetchUrl","projectID","getProjectId","buildProjectUrl","getGitLabRequestOptions","branchAndFilePath","repoIDLookup","error_description","GitLabIntegration","replaceGitLabUrlType","awsS3","bitbucketCloud","bitbucketServer","gerrit","byType","candidates","filteredCandidates","integrationsByType","techdocsStorageApiRef","techdocsApiRef","ApiAggregator","holder","holders","ApiContext","ApiProvider","parentHolder","propTypes","PropTypes","isRequired","ApiResolver","validateFactories","factories","heap","allDeps","shift","dep","load","impl","loadDeps","dependent","ScopePriority","static","ApiFactoryRegistry","scope","existing","tuple","getAllApis","refs","showLoginPopup","screen","popup","targetOrigin","messageListener","source","authResult","done","errMessage","defaultJoinScopes","DefaultAuthConnector","createSession","authRequester","refreshSession","res","buildUrl","authInfo","sessionTransform","removeSession","joinScopesFunc","popupUrl","buildQueryString","env","environment","joinScopes","createAuthRequester","onAuthRequest","hasScopes","searched","searchFor","SessionScopeHelper","sessionExistsAndHasScope","sessionScopes","getExtendedScope","newScope","defaultScopes","observable","PublishSubject","isClosed","next","subscribers","subscriber","terminatingError","complete","onError","onComplete","observer","ObservableImpl","delete","BehaviorSubject","SessionStateTracker","setIsSignedIn","isSignedIn","signedIn","sessionState$","RefreshingAuthSessionManager","getSession","helper","currentSession","sessionShouldRefreshFunc","refreshedSession","collapsedSessionRefresh","currentScopes","sessionScopesFunc","refreshedScopes","newSession","connector","stateTracker","refreshPromise","sessionShouldRefresh","StaticAuthSessionManager","setSession","DEFAULT_PROVIDER","OAuth2","scopeTransform","normalizeScopes","expiresInSeconds","sessionManager","getTime","signIn","normalizedScopes","scopeList","GithubAuth","GitlabAuth","SCOPE_PREFIX","GoogleAuth","OKTA_OIDC_SCOPES","OKTA_SCOPE_PREFIX","OktaAuth","samlSessionSchema","SamlAuth","DirectAuthConnector","authSessionStore","AuthSessionStore","manager","storageKey","MicrosoftAuth","OIDC_SCOPES","OneLoginAuth","BitbucketAuth","AtlassianAuth","AlertApiForwarder","alert","NoOpAnalyticsApi","_event","STORAGE_KEY","AppThemeSelector","createWithStorage","themes","initialThemeId","setActiveThemeId","activeThemeId$","getInstalledThemes","getActiveThemeId","activeThemeId","CONFIG_KEY_PART_PATTERN","isObject","typeOf","typeName","expected","convert","ConfigReader","fromConfigs","previousReader","filteredKeys","deprecatedKeys","reader","readValue","localKeys","fallbackKeys","getOptional","fullKey","cloneDeep","fallbackValue","process","mergeWith","into","getConfig","fallbackConfig","copy","readConfigValue","obj","getOptionalNumber","number","getBoolean","getStringArray","prefix","keyName","badKey","notifiedFilteredKeys","ERROR_PREFIX","UrlPatternDiscovery","pattern","urlStr","ErrorAlerter","error$","ErrorApiForwarder","UnhandledErrorForwarder","forward","errorContext","reason","validateFlagName","LocalStorageFeatureFlags","registerFlag","flag","registeredFeatureFlags","getRegisteredFlags","flags","save","clear","enabled","fromEntries","jsonStr","createFetchApi","baseImplementation","global","middleware","reverse","apply","IdentityAuthInjectorFetchMiddleware","matcher","buildMatcher","headerName","headerValue","init","Request","allowUrl","urlPrefixAllowlist","buildPrefixMatcher","prefixes","trimmedPrefixes","PluginProtocolResolverFetchMiddleware","hostname","authority","isUrl","FetchMiddlewares","resolvePluginProtocol","injectIdentityAuth","moreScopess","moreScopes","OAuthPendingRequests","getCurrentPending","OAuthRequestManager","handler","handlerCount","scopeRequest","newRequests","currentRequests","makeAuthRequest","buckets","WebStorage","presence","getKeyName","_key","bucketPath","notifyChanges","messageKey","traverseElementTree","collectors","queue","contexts","nextContexts","collector","visit","accumulator","discoverer","discoverers","createCollector","accumulatorFactory","childDiscoverer","routeElementDiscoverer","pluginCollector","FeatureFlagged","featureFlagApi","isEnabled","MATCH_ALL_ROUTE","routeRefs","stringifyNode","anyNode","collectSubTree","routingV2Collector","paths","parents","objects","ctx","isElementAncestor","pathProp","parentChildren","elementProp","newObj","gatherPath","gatherRouteRef","others","routingV1Collector","currentObj","currentParentRouteRef","sticky","currentCtxPath","routePath","featureFlagCollector","isRouteRef","isSubRouteRef","isExternalRouteRef","joinPaths","normalized","resolveTargetRef","anyRouteRef","routePaths","routeBindings","targetRef","subRoutePath","resolvedRoute","targetPath","resolveBasePath","routeParents","routeObjects","refDiffList","matchIndex","targetSearchRef","unshift","parentPath","diffPaths","RouteResolver","relativeSourceLocation","trimPath","appBasePath","generatePath","RoutingContext","RoutingProvider","versionedValue","getExtensionContext","matches","routeObject","TrackNavigation","RouteTracker","validateRouteParameters","notLeafRoutes","currentRouteRef","fullPath","j","validateRouteBindings","plugins","externalRouteRef","AppContext","AppContextProvider","mkError","thing","logDeprecation","AppIdentityProxy","setTarget","targetOptions","signOutTargetUrl","resolveTarget","waitForTarget","resolveTheme","shouldPreferDark","selectedTheme","darkTheme","lightTheme","useShouldPreferDarkTheme","mediaQuery","matchMedia","setPrefersDark","listener","addListener","removeListener","AppThemeProvider","appThemeApi","appTheme","defaultConfigLoader","runtimeConfigJson","appConfig","windowAppConfig","__APP_CONFIG__","ApiRegistryBuilder","build","ApiRegistry","builder","resolveRouteBindings","bindRoutes","bind","targetRoutes","externalRoute","isReactRouterBeta","createRoutesFromChildren","InternalAppContext","getBasePath","useConfigLoader","configLoader","hasConfig","noConfigNode","AppContextImpl","getPlugins","getSystemIcons","AppManager","getProvider","routesHaveBeenValidated","routing","collectedPlugins","verifyPlugins","getApiHolder","loadedConfig","hasConfigApi","getRouter","Router","RouterComponent","SignInPageComponent","SignInPageWrapper","setIdentityApi","appIdentityProxy","mountPath","Routes","apiFactoryRegistry","defaultApis","pluginIds","createSpecializedApp","warned","FlatRoutes","NotFoundErrorPage","isBeta","withNotFound","permissionApiRef","discovery","IdentityPermissionApi","OptionallyWrapInRouter","useInRouterContext","MemoryRouter","DefaultNotFoundPage","DefaultBootErrorPage","DefaultErrorBoundaryFallback","BrowserRouter","brokenImage","catalog","MuiMenuBookIcon","scaffolder","MuiCreateNewFolderIcon","techdocs","MuiSubjectIcon","MuiSearchIcon","chat","MuiChatIcon","dashboard","MuiDashboardIcon","docs","MuiDocsIcon","MuiEmailIcon","MuiGitHubIcon","group","MuiPeopleIcon","help","MuiHelpIcon","MuiExtensionIcon","MuiMemoryIcon","MuiApartmentIcon","MuiLocationOnIcon","MuiCategoryIcon","MuiPersonIcon","user","MuiWarningIcon","shapes","wave","wave2","colorVariants","darkGrey","marineBlue","veryBlue","rubyRed","toastyOrange","purpleSky","eveningSea","teal","pinkSea","greens","genPageTheme","colors","shape","gradient","pageTheme","home","documentation","tool","service","website","library","DEFAULT_HTML_FONT_SIZE","DEFAULT_FONT_FAMILY","createThemeOptions","htmlFontSize","defaultPageTheme","defaultPageThemes","MuiGrid","MuiSwitch","createThemeOverrides","MuiCssBaseline","html","MuiTableRow","head","MuiTableCell","sizeSmall","MuiTabs","MuiTab","textColorPrimary","MuiTableSortLabel","MuiListItemText","textOverflow","MuiButton","MuiChip","outlined","fontWeightMedium","labelSmall","deleteIcon","deleteIconSmall","MuiCard","MuiCardHeader","MuiCardContent","MuiCardActions","createTheme","themeOptions","createMuiTheme","bursts","slackChannelText","linear","errorBackground","warningBackground","infoBackground","errorText","infoText","warningText","gold","yellow","pinSidebarButton","LightIcon","CssBaseline","DarkIcon","createApp","performMigrationToTheNewBucket","storageApi","oldStarredEntities","targetEntities","isString","old","DefaultStarredEntitiesApi","toggleStarred","starredEntities","settingsStore","starredEntitie$","itemText","CatalogSearchResultListItem","rank","primaryTypographyProps","HighlightedSearchResultText","preTag","postTag","lifecycle","RESOURCE_TYPE_CATALOG_ENTITY","catalogEntityReadPermission","createPermission","resourceType","catalogEntityCreatePermission","catalogEntityDeletePermission","catalogEntityRefreshPermission","catalogLocationReadPermission","catalogLocationCreatePermission","catalogLocationDeletePermission","catalogPermissions","UnregisterEntity","unregisterEntityOptions","isUnregisterAllowed","onUnregisterEntity","isBoolean","disableUnregister","isDisabled","unregisterButton","CancelIcon","EntityContextMenu","UNSTABLE_extraContextMenuItems","UNSTABLE_contextMenuOptions","onInspectEntity","isAllowed","useEntityPermission","allowed","onOpen","clipboard","writeText","extraItems","aria-controls","aria-haspopup","aria-expanded","MenuList","BugReportIcon","FileCopyTwoToneIcon","dataKey","EntityLayoutTitle","FavoriteEntity","paramKind","paramNamespace","paramName","headerType","spec","EntityLabels","ownedByRelations","getEntityRelations","EntityRefLinks","entityRefs","EntityLayout","NotFoundComponent","entityRouteRef","useAsyncEntity","elementProps","if","confirmationDialogOpen","setConfirmationDialogOpen","inspectionDialogOpen","setInspectionDialogOpen","cleanUpAfterRemoval","UnregisterEntityDialog","onConfirm","InspectEntityDialog","DeleteEntityDialog","catalogApi","catalogApiRef","isOrphan","EntityOrphanWarning","catalogLink","rootRouteRef","useEntity","errorFilter","ENTITY_STATUS_CATALOG_PROCESSING_TYPE","getOwnAndAncestorsErrors","hasCatalogProcessingErrors","EntityProcessingErrorsPanel","mb","ancestorError","EntityRefLink","ENTITY_SWITCH_KEY","EntitySwitchCaseComponent","EntitySwitch","collection","condition","elementsChildren","AsyncEntitySwitch","promises","Case","FilteredEntityLayout","CatalogFilterLayout","FilterContainer","EntityListContainer","catalogPlugin","starredEntitiesApiRef","catalogIndex","catalogEntity","createComponentRouteRef","viewTechDoc","viewTechDocRouteRef","createButtonTitle","CatalogIndexPage","CatalogPage","CatalogEntityPage","EntityAboutCard","AboutCard","EntityLinksCard","EntityHasSystemsCard","HasSystemsCard","EntityHasComponentsCard","HasComponentsCard","EntityHasSubcomponentsCard","HasSubcomponentsCard","EntityHasResourcesCard","HasResourcesCard","EntityDependsOnComponentsCard","DependsOnComponentsCard","EntityDependencyOfComponentsCard","DependencyOfComponentsCard","EntityDependsOnResourcesCard","DependsOnResourcesCard","RelatedEntitiesCard","TechDocsDevStorageApi","getApiOrigin","getStorageUrl","getBuilder","getEntityDocs","_entityId","syncEntityDocs","oldBaseUrl","apiOrigin","TechDocsDevApi","getEntityMetadata","getTechDocsMetadata","site_name","site_description","PRODUCTION_CONFIG","backend","DEVELOPMENT_CONFIG","isProductionServe","defaultConfigs","isProduction","useSidebarLogoStyles","SidebarLogo","NavLink","LogoFull","LogoIcon","Root","LibraryBooks","headerIcon","contentToolbar","Themes","LIGHT","DARK","TechDocsThemeToggle","setTheme","handleSetTheme","prevTheme","newTheme","mr","DefaultTechDocsPage","TechDocsReaderPage","TechDocsReaderPageHeader","TechDocsReaderPageContent","withSearch","techDocsPage","AppProvider","AppRouter","ThemeToggleAddon","techdocsPlugin","createTechDocsAddonExtension","TechDocsAddonLocations","Navigate","TechDocsIndexPage","DefaultTechDocsHome","TechDocsAddons","ReactDOM","App","getGlobalObject","self","Function","globalObject","makeKey","createVersionedContextForTesting","versions","globalThis","MockStarredEntitiesApi","isMidSizeScreen","filterDrawerOpen","setFilterDrawerOpen","FilterListIcon","disableAutoFocus","keepMounted","lg","entityRouteParams","humanizeEntityRef","linkProps","entityRoute","routeParams","formattedEntityRefTitle","FetchedEntityRefLinks","getTitle","pureEntities","fetchEntities","reduceCatalogFilters","compoundFilter","getCatalogFilters","reduceEntityFilters","filterEntity","relationType","entityNames","relations","scmIntegrationsApi","sourceLocationRef","locationTargetUrl","integrationType","isOwnerOf","possibleOwners","owners","ownerItem","EntityKindFilter","toQueryValue","EntityTypeFilter","getTypes","EntityTagFilter","EntityTextFilter","words","toUpperArray","exactMatch","partialMatch","word","EntityOwnerFilter","o","EntityLifecycleFilter","UserListFilter","isOwnedEntity","isStarredEntity","EntityOrphanFilter","orphan","EntityErrorFilter","NewEntityContext","AsyncEntityProvider","refresh","EntityProvider","EntityListContext","EntityListProvider","useMountedState","requestedFilters","setRequestedFilters","queryParameters","outputState","setOutputState","appliedFilters","backendEntities","useAsyncFn","compacted","compact","entityFilter","backendFilter","previousBackendFilter","oldParams","newParams","addQueryPrefix","arrayFormat","history","replaceState","useDebounce","updateFilters","prevFilters","newFilters","useEntityList","useEntityTypeFilter","kindFilter","typeFilter","typeParameter","flattenedQueryTypes","selectedTypes","setSelectedTypes","availableTypes","setAvailableTypes","facetsRef","oldFacets","newTypes","sortBy","stillValidTypes","BATCH_SIZE","useRelatedEntities","relationFilter","filterByTypeLower","filterByKindLower","relationsByKindAndNamespace","groupBy","batchedRelationsByKindAndNamespace","rs","nameBatches","chunk","names","getEntityRef","entityOrRef","useStarredEntities","starredEntitiesApi","toggleStarredEntity","useStarredEntity","setIsStarredEntity","useEntityOwnership","myOwnerRefs","entityOwnerRefs","permission","loadingEntity","entityError","loadingPermission","permissionError","usePermission","resourceRef","useAvailableKinds","availableKinds","setAvailableKinds","newKinds","useEntityKindFilter","kindParameter","flattenedQueryKind","selectedKind","setSelectedKind","initialFilter","EntityKindPicker","pb","pt","CheckBoxOutlineBlankIcon","checkedIcon","CheckBoxIcon","EntityLifecyclePicker","lifecycles","lifecyclesParameter","queryParamLifecycles","selectedLifecycles","setSelectedLifecycles","availableLifecycles","Autocomplete","renderOption","FormControlLabel","control","popupIcon","renderInput","EntityOwnerPicker","ownersParameter","queryParamOwners","selectedOwners","setSelectedOwners","availableOwners","_theme","searchToolbar","EntitySearchBar","Input","startAdornment","InputAdornment","endAdornment","columnFactories","createEntityRefColumn","formatContent","customFilterAndSearch","customSort","entity1","entity2","createEntityRelationColumn","relation","getRelations","createOwnerColumn","createDomainColumn","createSystemColumn","createMetadataDescriptionColumn","createSpecLifecycleColumn","createSpecTypeColumn","systemEntityColumns","componentEntityColumns","empty","EntityTable","tableStyle","paging","actionsColumnIndex","draggable","EntityTagPicker","tagsParameter","availableTags","queryParamTags","selectedTags","setSelectedTags","showCounts","EntityTypePicker","YellowStar","Star","StarBorder","DEFAULT_ICON","WorkIcon","getKind","useIcon","actualKind","EntityKindIcon","getContrastText","useAncestry","catalogClient","currentRef","isRootNode","rootEntityRef","parentRef","parentEntityRefs","CustomNode","paddedIconWidth","displayTitle","AncestryPage","DialogContentText","gutterBottom","mt","DependencyGraphTypes","helpIcon","monospace","secondaryTypographyProps","ListSubheader","MuiListSubheader","Container","helpLink","findLink","KeyValueListItem","entry","indent","HelpOutlineIcon","useColocated","currentEntityRef","originLocation","colocatedEntities","colocated","EntityList","Contents","atLocation","atOrigin","ColocatedPage","sortKeys","JsonPage","OverviewPage","groupedRelations","etag","groupRelations","YamlPage","YAML","fullHeightDialog","borderRight","tabContents","pl","pr","a11yProps","activeTab","setActiveTab","PaperProps","useUnregisterEntityDialogState","isBootstrap","prerequisites","locationPromise","colocatedEntitiesPromise","locationAnnotationFilter","unregisterLocation","deleteEntity","advancedButton","showDelete","setShowDelete","onUnregister","listIcon","menuItem","groupWrapper","getFilterGroups","orgName","SettingsIcon","StarIcon","UserListPicker","availableFilters","userParameter","loadingBackendEntities","userAndGroupFilterIds","filterGroups","filterGroup","loadingEntityOwnership","ownedFilter","starredFilter","queryParamUserFilter","selectedUserFilter","setSelectedUserFilter","entitiesWithoutUserFilter","filterCounts","starred","owned","disablePadding","ContainerProps","ListItemSecondaryAction","EntityProcessingStatusPicker","selectedAdvancedItems","setSelectedAdvancedItems","orphanChange","errorChange","availableAdvancedItems","MockEntityListContextProvider","setFilters","defaultValues","resolvedValue","AboutField","gridSizes","childElements","getLocationTargetHref","entitySourceLocation","srcLocationUrl","AboutContent","isSystem","isResource","isComponent","isAPI","isTemplate","isLocation","isGroup","partOfSystemRelations","partOfComponentRelations","partOfDomainRelations","targets","LinksGridList","cols","gridItemCard","fullHeightCard","gridItemCardContent","fullHeightCardContent","viewTechdocLink","entityMetadataEditUrl","viewInSource","viewInTechDocs","cardClass","cardContentClass","entityLocation","allowRefresh","CachedIcon","EditIcon","CatalogKindHeader","allowedKinds","allKinds","queryParamKind","createNameColumn","createSpecTargetsColumn","createTagsColumn","createTitleColumn","searchable","createLabelColumn","specifiedLabelValue","CatalogTable","tableOptions","defaultColumns","createEntitySpecificColumns","showTypeColumn","titlePreamble","defaultActions","OpenInNew","isStarred","rows","ownedByRelationsTitle","partOfSystemRelationTitle","typeColumn","showPagination","isLoading","pageSize","loadingType","showEmptyDataSourceMessage","pageSizeOptions","svgIcon","IconLink","LanguageIcon","colDefaults","xl","useDynamicColumns","numOfCols","breakpoint","ImageList","rowHeight","ImageListItem","AuthorizeResult","DENY","ALLOW","CONDITIONAL","isPermission","comparedPermission","isResourcePermission","isCreatePermission","isReadPermission","isUpdatePermission","isDeletePermission","toPermissionEvaluator","permissionAuthorizer","authorize","authorizeConditional","parsedRequests","permissionCriteriaSchema","rule","or","anyOf","nonempty","not","authorizePermissionResponseSchema","queryPermissionResponseSchema","conditions","responseSchema","itemSchema","ids","refine","PermissionClient","makeRequest","queries","uuid","permissionApi","getAuthorizationHeader","responsesById","permissionClient","useSWR","args","PermissionedRoute","errorComponent","permissionResult","shownElement","RequirePermission","errorPage","searchApiRef","MockSearchApi","mockedResults","terms","RegExp","mark","SearchContext","useSearch","useSearchContextCheck","searchInitialState","term","types","pageLimit","pageCursor","useSearchContextValue","initialValue","searchApi","setTerm","setTypes","setPageLimit","setPageCursor","prevTerm","usePrevious","hasNextPage","nextPageCursor","hasPreviousPage","previousPageCursor","fetchNextPage","fetchPreviousPage","LocalSearchContext","searchTypes","SearchContextProvider","inheritParentContextIfAvailable","TrackSearch","withContext","SearchBarBase","onClear","clearButton","defaultPlaceholder","defaultInputProps","defaultEndAdornment","prevValue","handleKeyDown","handleClear","ClearButton","SearchBar","SearchAutocomplete","getOptionLabel","inputPlaceholder","inputDebounceTime","freeSolo","clearOnBlur","dataTestId","getInputValue","inputValue","InputLabelProps","CircularProgress","SearchAutocompleteDefaultOption","primaryText","primaryTextTypographyProps","secondaryText","secondaryTextTypographyProps","disableTextTypography","disableTypography","useAsyncFilterValues","fn","valuesMemo","definiteFn","possibleValue","useDefaultFilterValue","AutocompleteFilter","givenValues","valuesDebounceMs","filterSelectedOptions","limitTags","setInputValue","asyncValues","prevState","renderTags","tagValue","getTagProps","onInputChange","CheckboxFilter","FormLabel","SelectFilter","SearchFilter","Element","SearchResultContext","SearchResultApi","SearchResultState","SearchResultComponent","SearchResult","gap","SearchResultPager","endIcon","encodePageCursor","decodePageCursor","SearchPaginationBase","total","onCursorChange","onPageCursorChange","rowsPerPage","limitLabel","labelRowsPerPage","limitText","labelDisplayedRows","limitOptions","rowsPerPageOptions","onLimitChange","onPageLimitChange","handlePageChange","handleRowsPerPageChange","parseInt","TablePagination","onPageChange","onRowsPerPageChange","SearchPagination","DefaultResultListItemComponent","lineClamp","WebkitBoxOrient","WebkitLineClamp","HigherOrderDefaultResultListItem","SearchResultListLayout","resultItems","renderResultItem","DefaultResultListItem","noResultsComponent","SearchResultList","disableRenderingWithNoResults","listSubheader","listSubheaderName","listSubheaderChip","listSubheaderFilter","listSubheaderLink","listSubheaderLinkIcon","SearchResultGroupFilterFieldLayout","NullIcon","useSearchResultGroupTextFilterStyles","SearchResultGroupTextFilterField","contentEditable","suppressContentEditableWarning","useSearchResultGroupSelectFilterStyles","SearchResultGroupSelectFilterField","SearchResultGroupLayout","titleProps","filterOptions","renderFilterOption","filterOption","filterFields","renderFilterField","AddIcon","Menu","filterField","SearchResultGroup","TECHDOCS_ADDONS_KEY","TECHDOCS_ADDONS_WRAPPER_KEY","getDataKeyByName","TechDocsAddon","getTechDocsAddonByName","getAllTechDocsAddons","getAllTechDocsAddonsData","useTechDocsAddons","useOutlet","findAddonByData","nameKey","renderComponentByName","renderComponentsByLocation","toLowercaseEntityRefMaybe","areEntityRefsEqual","prevEntityRef","nextEntityRef","defaultTechDocsReaderPageValue","setTitle","setSubtitle","setShadowRoot","entityMetadata","TechDocsReaderPageContext","TechDocsReaderPageProvider","memo","techdocsApi","shadowRoot","prevProps","nextProps","useTechDocsReaderPage","Subheader","Settings","PrimarySidebar","SecondarySidebar","SHADOW_DOM_STYLE_LOAD_EVENT","useShadowDomStylesEvents","querySelectorAll","CustomEvent","dispatchEvent","handleLoad","useShadowDomStylesLoading","setProperty","TechDocsShadowDom","onAppend","jss","setJss","jssPreset","insertionPoint","shadowHost","attachShadow","replaceChildren","StylesProvider","sheetsManager","useShadowRoot","useShadowRootElements","selectors","nodeList","isValidSelection","newSelection","rangeCount","getRangeAt","useShadowRootSelection","wait","setSelection","handleSelectionChange","shadowDocument","getSelection","EntityPageDocs","TechDocsReaderPageSubheader","TECHDOCS_ANNOTATION","isTechDocsAvailable","EmbeddedDocsRouter","TechDocsClient","entityId","requestUrl","TechDocsStorageClient","errorMessage","logHandler","EventSourcePolyfill","withCredentials","onerror","close","newBaseUrl","toLowerMaybe","TechDocsPageWrapper","TechDocsPicker","EntityListDocsTable","DocsCardGrid","getRouteToReaderPageFor","rootDocsRouteRef","EntityListDocsGrid","actionFactories","createCopyDocsUrlAction","row","ShareIcon","docsUrl","createStarEntityAction","customTitle","createTypeColumn","DocsTable","documents","generatedSubtitle","TechDocsFilter","docRoot","entityContent","rootCatalogDocsRouteRef","TechdocsPage","EntityTechdocsContent","TechDocsCustomHome","TechDocsReaderLayout","withHeader","outlet","nestedChildren","onReady","techdocsMetadataValue","entityMetadataValue","useDrawerStyles","logs","TechDocsBuildLogsDrawerContent","buildLog","logText","TechDocsBuildLogs","TechDocsNotFound","techdocsBuilder","overflowWrap","TechDocsStateIndicator","StateAlert","contentReload","contentErrorMessage","syncErrorMessage","useTechDocsReader","MKDOCS_CSS","GOOGLE_FONTS","GSTATIC_FONTS","isLink","nodeName","isSafe","getAttribute","isMkdocsCss","isGoogleFonts","isGstaticFonts","removeUnsafeLinks","isIframe","hosts","removeUnsafeIframes","useSanitizerConfig","useSanitizerTransformer","dom","DOMPurify","innerHTML","ADD_TAGS","FORBID_TAGS","WHOLE_DOCUMENT","RETURN_DOM","success","SIDEBAR_WIDTH","sidebar","headings","heading","calculate","factor","disabledBackground","rules","variables","layout","typeset","animations","extensions","useSidebar","useRuleStyles","useStylesTransformer","getElementsByTagName","insertAdjacentHTML","isSvgNeedingInlining","attrName","attrVal","isSrcToSvg","isRelativeUrl","pointsToOurBackend","addBaseUrl","techdocsStorageApi","updateDom","attributeName","elem","hasAttribute","elemAttribute","svgContent","btoa","unescape","addGitFeedbackLink","sourceAnchor","sourceURL","issueTitle","issueDesc","gitUrl","gitInfo","repoPath","organization","feedbackLink","cloneNode","FeedbackOutlinedIcon","insertAdjacentElement","addSidebarToggle","mkdocsToggleSidebar","toggleSidebar","classList","prepend","rewriteDocLinks","normalizedWindowLocation","normalizeUrl","replaceWith","addLinkClickListener","CopyToClipboardTooltip","CopyToClipboardIcon","CopyToClipboardButton","codes","parentElement","ReactDom","removeMkdocsHeader","simplifyMkdocsFooter","onCssReady","onLoading","onLoaded","handleShadowDomStyleLoad","scrollIntoAnchor","scrollIntoView","scrollIntoNavigation","activeNavItems","activeNavItem","click","transformers","DOMParser","parseFromString","documentElement","transformer","MOBILE_MEDIA_QUERY","useTechDocsReaderDom","isMobileMedia","sanitizerTransformer","stylesTransformer","rawPage","setDom","isStyleLoading","updateSidebarPosition","pageTop","domTop","tabsHeight","updateFooterWidth","footer","preRender","rawContent","contentPath","postRender","transformedElement","modifierActive","ctrlKey","metaKey","parsedUrl","removeAttribute","shouldReplaceContent","preTransformedDomElement","scroll","postTransformedDomElement","TechDocsReaderPageContentAddons","addons","contentElement","primarySidebarElement","primarySidebarAddonLocation","secondarySidebarElement","secondarySidebarAddonLocation","Portal","locations","withTechDocsReaderProvider","entityMetadataLoading","handleAppend","newShadowRoot","TechDocsSearch","entityTitle","Reader","skeleton","Skeleton","metadataLoading","tabTitle","locationMetadata","docsRootLink","subheaderAddons","settingsAddons","calculateDisplayState","contentLoading","activeSyncState","reducer","syncError","contentError","log","useReaderState","dispatch","useReducer","retry","useAsyncRetry","entityDocs","reload","buildingTimeout","TechDocsReaderContext","TechDocsReaderProvider","TechDocsSearchResultListItem","asListItem","asLink","TextItem","resultTitle","resultName","ListItemWrapper","bar","isTechDocsSearchResult","TechDocsSearchBar","searchVal","setOptions","mounted","searchResults","handleSelection","Paper","blurOnSelect","noOptionsText"],"mappings":"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","file":"static/main.78e87b92.js","sourcesContent":["/*\n * Copyright 2021 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { CompoundEntityRef, Entity } from '@backstage/catalog-model';\nimport { SerializedError } from '@backstage/errors';\n\n/**\n * This symbol can be used in place of a value when passed to filters in e.g.\n * {@link CatalogClient.getEntities}, to signify that you want to filter on the\n * presence of that key no matter what its value is.\n *\n * @public\n */\nexport const CATALOG_FILTER_EXISTS = Symbol.for(\n  // Random UUID to ensure no collisions\n  'CATALOG_FILTER_EXISTS_0e15b590c0b343a2bae3e787e84c2111',\n);\n\n/**\n * The request type for {@link CatalogClient.getEntities}.\n *\n * @public\n */\nexport interface GetEntitiesRequest {\n  /**\n   * If given, return only entities that match the given patterns.\n   *\n   * @remarks\n   *\n   * If multiple filter sets are given as an array, then there is effectively an\n   * OR between each filter set.\n   *\n   * Within one filter set, there is effectively an AND between the various\n   * keys.\n   *\n   * Within one key, if there are more than one value, then there is effectively\n   * an OR between them.\n   *\n   * Example: For an input of\n   *\n   * ```\n   * [\n   *   { kind: ['API', 'Component'] },\n   *   { 'metadata.name': 'a', 'metadata.namespace': 'b' }\n   * ]\n   * ```\n   *\n   * This effectively means\n   *\n   * ```\n   * (kind = EITHER 'API' OR 'Component')\n   * OR\n   * (metadata.name = 'a' AND metadata.namespace = 'b' )\n   * ```\n   *\n   * Each key is a dot separated path in each object.\n   *\n   * As a value you can also pass in the symbol `CATALOG_FILTER_EXISTS`\n   * (exported from this package), which means that you assert on the existence\n   * of that key, no matter what its value is.\n   */\n  filter?:\n    | Record<string, string | symbol | (string | symbol)[]>[]\n    | Record<string, string | symbol | (string | symbol)[]>\n    | undefined;\n  /**\n   * If given, return only the parts of each entity that match those dot\n   * separated paths in each object.\n   *\n   * @remarks\n   *\n   * Example: For an input of `['kind', 'metadata.annotations']`, then response\n   * objects will be shaped like\n   *\n   * ```\n   * {\n   *   \"kind\": \"Component\",\n   *   \"metadata\": {\n   *     \"annotations\": {\n   *       \"foo\": \"bar\"\n   *     }\n   *   }\n   * }\n   * ```\n   */\n  fields?: string[] | undefined;\n  /**\n   * If given, skips over the first N items in the result set.\n   */\n  offset?: number;\n  /**\n   * If given, returns at most N items from the result set.\n   */\n  limit?: number;\n  /**\n   * If given, skips over all items before that cursor as returned by a previous\n   * request.\n   */\n  after?: string;\n}\n\n/**\n * The response type for {@link CatalogClient.getEntities}.\n *\n * @public\n */\nexport interface GetEntitiesResponse {\n  items: Entity[];\n}\n\n/**\n * The request type for {@link CatalogClient.getEntityAncestors}.\n *\n * @public\n */\nexport interface GetEntityAncestorsRequest {\n  entityRef: string;\n}\n\n/**\n * The response type for {@link CatalogClient.getEntityAncestors}.\n *\n * @public\n */\nexport interface GetEntityAncestorsResponse {\n  rootEntityRef: string;\n  items: Array<{\n    entity: Entity;\n    parentEntityRefs: string[];\n  }>;\n}\n\n/**\n * The request type for {@link CatalogClient.getEntityFacets}.\n *\n * @public\n */\nexport interface GetEntityFacetsRequest {\n  /**\n   * If given, return only entities that match the given patterns.\n   *\n   * @remarks\n   *\n   * If multiple filter sets are given as an array, then there is effectively an\n   * OR between each filter set.\n   *\n   * Within one filter set, there is effectively an AND between the various\n   * keys.\n   *\n   * Within one key, if there are more than one value, then there is effectively\n   * an OR between them.\n   *\n   * Example: For an input of\n   *\n   * ```\n   * [\n   *   { kind: ['API', 'Component'] },\n   *   { 'metadata.name': 'a', 'metadata.namespace': 'b' }\n   * ]\n   * ```\n   *\n   * This effectively means\n   *\n   * ```\n   * (kind = EITHER 'API' OR 'Component')\n   * OR\n   * (metadata.name = 'a' AND metadata.namespace = 'b' )\n   * ```\n   *\n   * Each key is a dot separated path in each object.\n   *\n   * As a value you can also pass in the symbol `CATALOG_FILTER_EXISTS`\n   * (exported from this package), which means that you assert on the existence\n   * of that key, no matter what its value is.\n   */\n  filter?:\n    | Record<string, string | symbol | (string | symbol)[]>[]\n    | Record<string, string | symbol | (string | symbol)[]>\n    | undefined;\n  /**\n   * Dot separated paths for the facets to extract from each entity.\n   *\n   * @remarks\n   *\n   * Example: For an input of `['kind', 'metadata.annotations.backstage.io/orphan']`, then the\n   * response will be shaped like\n   *\n   * ```\n   * {\n   *   \"facets\": {\n   *     \"kind\": [\n   *       { \"key\": \"Component\", \"count\": 22 },\n   *       { \"key\": \"API\", \"count\": 13 }\n   *     ],\n   *     \"metadata.annotations.backstage.io/orphan\": [\n   *       { \"key\": \"true\", \"count\": 2 }\n   *     ]\n   *   }\n   * }\n   * ```\n   */\n  facets: string[];\n}\n\n/**\n * The response type for {@link CatalogClient.getEntityFacets}.\n *\n * @public\n */\nexport interface GetEntityFacetsResponse {\n  /**\n   * The computed facets, one entry per facet in the request.\n   */\n  facets: Record<string, Array<{ value: string; count: number }>>;\n}\n\n/**\n * Options you can pass into a catalog request for additional information.\n *\n * @public\n */\nexport interface CatalogRequestOptions {\n  token?: string;\n}\n\n/**\n * Entity location for a specific entity.\n *\n * @public\n */\nexport type Location = {\n  id: string;\n  type: string;\n  target: string;\n};\n\n/**\n * The request type for {@link CatalogClient.addLocation}.\n *\n * @public\n */\nexport type AddLocationRequest = {\n  type?: string;\n  target: string;\n  dryRun?: boolean;\n};\n\n/**\n * The response type for {@link CatalogClient.addLocation}.\n *\n * @public\n */\nexport type AddLocationResponse = {\n  location: Location;\n  entities: Entity[];\n  // Only set in dryRun mode.\n  exists?: boolean;\n};\n\n/**\n * The response type for {@link CatalogClient.validateEntity}\n *\n * @public\n */\nexport type ValidateEntityResponse =\n  | { valid: true }\n  | { valid: false; errors: SerializedError[] };\n\n/**\n * A client for interacting with the Backstage software catalog through its API.\n *\n * @public\n */\nexport interface CatalogApi {\n  /**\n   * Lists catalog entities.\n   *\n   * @param request - Request parameters\n   * @param options - Additional options\n   */\n  getEntities(\n    request?: GetEntitiesRequest,\n    options?: CatalogRequestOptions,\n  ): Promise<GetEntitiesResponse>;\n\n  /**\n   * Gets entity ancestor information, i.e. the hierarchy of parent entities\n   * whose processing resulted in a given entity appearing in the catalog.\n   *\n   * @param request - Request parameters\n   * @param options - Additional options\n   */\n  getEntityAncestors(\n    request: GetEntityAncestorsRequest,\n    options?: CatalogRequestOptions,\n  ): Promise<GetEntityAncestorsResponse>;\n\n  /**\n   * Gets a single entity from the catalog by its ref (kind, namespace, name)\n   * triplet.\n   *\n   * @param entityRef - A complete entity ref, either on string or compound form\n   * @param options - Additional options\n   * @returns The matching entity, or undefined if there was no entity with that ref\n   */\n  getEntityByRef(\n    entityRef: string | CompoundEntityRef,\n    options?: CatalogRequestOptions,\n  ): Promise<Entity | undefined>;\n\n  /**\n   * Removes a single entity from the catalog by entity UID.\n   *\n   * @param uid - An entity UID\n   * @param options - Additional options\n   */\n  removeEntityByUid(\n    uid: string,\n    options?: CatalogRequestOptions,\n  ): Promise<void>;\n\n  /**\n   * Refreshes (marks for reprocessing) an entity in the catalog.\n   *\n   * @param entityRef - An entity ref on string form (e.g.\n   *        'component/default:my-component')\n   * @param options - Additional options\n   */\n  refreshEntity(\n    entityRef: string,\n    options?: CatalogRequestOptions,\n  ): Promise<void>;\n\n  /**\n   * Gets a summary of field facets of entities in the catalog.\n   *\n   * @param request - Request parameters\n   * @param options - Additional options\n   */\n  getEntityFacets(\n    request: GetEntityFacetsRequest,\n    options?: CatalogRequestOptions,\n  ): Promise<GetEntityFacetsResponse>;\n\n  // Locations\n\n  /**\n   * Gets a registered location by its ID.\n   *\n   * @param id - A location ID\n   * @param options - Additional options\n   */\n  getLocationById(\n    id: string,\n    options?: CatalogRequestOptions,\n  ): Promise<Location | undefined>;\n\n  /**\n   * Gets a registered location by its ref.\n   *\n   * @param locationRef - A location ref, e.g. \"url:https://github.com/...\"\n   * @param options - Additional options\n   */\n  getLocationByRef(\n    locationRef: string,\n    options?: CatalogRequestOptions,\n  ): Promise<Location | undefined>;\n\n  /**\n   * Registers a new location.\n   *\n   * @param location - Request parameters\n   * @param options - Additional options\n   */\n  addLocation(\n    location: AddLocationRequest,\n    options?: CatalogRequestOptions,\n  ): Promise<AddLocationResponse>;\n\n  /**\n   * Removes a registered Location by its ID.\n   *\n   * @param id - A location ID\n   * @param options - Additional options\n   */\n  removeLocationById(\n    id: string,\n    options?: CatalogRequestOptions,\n  ): Promise<void>;\n\n  /**\n   * Validate entity and its location.\n   *\n   * @param entity - Entity to validate\n   * @param locationRef - Location ref in format `url:http://example.com/file`\n   */\n  validateEntity(\n    entity: Entity,\n    locationRef: string,\n    options?: CatalogRequestOptions,\n  ): Promise<ValidateEntityResponse>;\n}\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  Entity,\n  CompoundEntityRef,\n  parseEntityRef,\n  stringifyEntityRef,\n  stringifyLocationRef,\n} from '@backstage/catalog-model';\nimport { ResponseError } from '@backstage/errors';\nimport crossFetch from 'cross-fetch';\nimport {\n  CATALOG_FILTER_EXISTS,\n  AddLocationRequest,\n  AddLocationResponse,\n  CatalogApi,\n  GetEntitiesRequest,\n  GetEntitiesResponse,\n  CatalogRequestOptions,\n  GetEntityAncestorsRequest,\n  GetEntityAncestorsResponse,\n  Location,\n  GetEntityFacetsRequest,\n  GetEntityFacetsResponse,\n  ValidateEntityResponse,\n} from './types/api';\nimport { DiscoveryApi } from './types/discovery';\nimport { FetchApi } from './types/fetch';\n\n/**\n * A frontend and backend compatible client for communicating with the Backstage\n * software catalog.\n *\n * @public\n */\nexport class CatalogClient implements CatalogApi {\n  private readonly discoveryApi: DiscoveryApi;\n  private readonly fetchApi: FetchApi;\n\n  constructor(options: {\n    discoveryApi: { getBaseUrl(pluginId: string): Promise<string> };\n    fetchApi?: { fetch: typeof fetch };\n  }) {\n    this.discoveryApi = options.discoveryApi;\n    this.fetchApi = options.fetchApi || { fetch: crossFetch };\n  }\n\n  /**\n   * {@inheritdoc CatalogApi.getEntityAncestors}\n   */\n  async getEntityAncestors(\n    request: GetEntityAncestorsRequest,\n    options?: CatalogRequestOptions,\n  ): Promise<GetEntityAncestorsResponse> {\n    const { kind, namespace, name } = parseEntityRef(request.entityRef);\n    return await this.requestRequired(\n      'GET',\n      `/entities/by-name/${encodeURIComponent(kind)}/${encodeURIComponent(\n        namespace,\n      )}/${encodeURIComponent(name)}/ancestry`,\n      options,\n    );\n  }\n\n  /**\n   * {@inheritdoc CatalogApi.getLocationById}\n   */\n  async getLocationById(\n    id: string,\n    options?: CatalogRequestOptions,\n  ): Promise<Location | undefined> {\n    return await this.requestOptional(\n      'GET',\n      `/locations/${encodeURIComponent(id)}`,\n      options,\n    );\n  }\n\n  /**\n   * {@inheritdoc CatalogApi.getEntities}\n   */\n  async getEntities(\n    request?: GetEntitiesRequest,\n    options?: CatalogRequestOptions,\n  ): Promise<GetEntitiesResponse> {\n    const { filter = [], fields = [], offset, limit, after } = request ?? {};\n    const params: string[] = [];\n\n    // filter param can occur multiple times, for example\n    // /api/catalog/entities?filter=metadata.name=wayback-search,kind=component&filter=metadata.name=www-artist,kind=component'\n    // the \"outer array\" defined by `filter` occurrences corresponds to \"anyOf\" filters\n    // the \"inner array\" defined within a `filter` param corresponds to \"allOf\" filters\n    for (const filterItem of [filter].flat()) {\n      const filterParts: string[] = [];\n      for (const [key, value] of Object.entries(filterItem)) {\n        for (const v of [value].flat()) {\n          if (v === CATALOG_FILTER_EXISTS) {\n            filterParts.push(encodeURIComponent(key));\n          } else if (typeof v === 'string') {\n            filterParts.push(\n              `${encodeURIComponent(key)}=${encodeURIComponent(v)}`,\n            );\n          }\n        }\n      }\n\n      if (filterParts.length) {\n        params.push(`filter=${filterParts.join(',')}`);\n      }\n    }\n\n    if (fields.length) {\n      params.push(`fields=${fields.map(encodeURIComponent).join(',')}`);\n    }\n\n    if (offset !== undefined) {\n      params.push(`offset=${offset}`);\n    }\n    if (limit !== undefined) {\n      params.push(`limit=${limit}`);\n    }\n    if (after !== undefined) {\n      params.push(`after=${encodeURIComponent(after)}`);\n    }\n\n    const query = params.length ? `?${params.join('&')}` : '';\n    const entities: Entity[] = await this.requestRequired(\n      'GET',\n      `/entities${query}`,\n      options,\n    );\n\n    const refCompare = (a: Entity, b: Entity) => {\n      // in case field filtering is used, these fields might not be part of the response\n      if (\n        a.metadata?.name === undefined ||\n        a.kind === undefined ||\n        b.metadata?.name === undefined ||\n        b.kind === undefined\n      ) {\n        return 0;\n      }\n\n      const aRef = stringifyEntityRef(a);\n      const bRef = stringifyEntityRef(b);\n      if (aRef < bRef) {\n        return -1;\n      }\n      if (aRef > bRef) {\n        return 1;\n      }\n      return 0;\n    };\n\n    return { items: entities.sort(refCompare) };\n  }\n\n  /**\n   * {@inheritdoc CatalogApi.getEntityByRef}\n   */\n  async getEntityByRef(\n    entityRef: string | CompoundEntityRef,\n    options?: CatalogRequestOptions,\n  ): Promise<Entity | undefined> {\n    const { kind, namespace, name } = parseEntityRef(entityRef);\n    return this.requestOptional(\n      'GET',\n      `/entities/by-name/${encodeURIComponent(kind)}/${encodeURIComponent(\n        namespace,\n      )}/${encodeURIComponent(name)}`,\n      options,\n    );\n  }\n\n  // NOTE(freben): When we deprecate getEntityByName from the interface, we may\n  // still want to leave this implementation in place for quite some time\n  // longer, to minimize the risk for breakages. Suggested date for removal:\n  // August 2022\n  /**\n   * @deprecated Use getEntityByRef instead\n   */\n  async getEntityByName(\n    compoundName: CompoundEntityRef,\n    options?: CatalogRequestOptions,\n  ): Promise<Entity | undefined> {\n    const { kind, namespace = 'default', name } = compoundName;\n    return this.requestOptional(\n      'GET',\n      `/entities/by-name/${encodeURIComponent(kind)}/${encodeURIComponent(\n        namespace,\n      )}/${encodeURIComponent(name)}`,\n      options,\n    );\n  }\n\n  /**\n   * {@inheritdoc CatalogApi.refreshEntity}\n   */\n  async refreshEntity(entityRef: string, options?: CatalogRequestOptions) {\n    const response = await this.fetchApi.fetch(\n      `${await this.discoveryApi.getBaseUrl('catalog')}/refresh`,\n      {\n        headers: {\n          'Content-Type': 'application/json',\n          ...(options?.token && { Authorization: `Bearer ${options?.token}` }),\n        },\n        method: 'POST',\n        body: JSON.stringify({ entityRef }),\n      },\n    );\n\n    if (response.status !== 200) {\n      throw new Error(await response.text());\n    }\n  }\n\n  /**\n   * {@inheritdoc CatalogApi.getEntityFacets}\n   */\n  async getEntityFacets(\n    request: GetEntityFacetsRequest,\n    options?: CatalogRequestOptions,\n  ): Promise<GetEntityFacetsResponse> {\n    const { filter = [], facets } = request;\n    const params: string[] = [];\n\n    // filter param can occur multiple times, for example\n    // /api/catalog/entities?filter=metadata.name=wayback-search,kind=component&filter=metadata.name=www-artist,kind=component'\n    // the \"outer array\" defined by `filter` occurrences corresponds to \"anyOf\" filters\n    // the \"inner array\" defined within a `filter` param corresponds to \"allOf\" filters\n    for (const filterItem of [filter].flat()) {\n      const filterParts: string[] = [];\n      for (const [key, value] of Object.entries(filterItem)) {\n        for (const v of [value].flat()) {\n          if (v === CATALOG_FILTER_EXISTS) {\n            filterParts.push(encodeURIComponent(key));\n          } else if (typeof v === 'string') {\n            filterParts.push(\n              `${encodeURIComponent(key)}=${encodeURIComponent(v)}`,\n            );\n          }\n        }\n      }\n\n      if (filterParts.length) {\n        params.push(`filter=${filterParts.join(',')}`);\n      }\n    }\n\n    for (const facet of facets) {\n      params.push(`facet=${encodeURIComponent(facet)}`);\n    }\n\n    const query = params.length ? `?${params.join('&')}` : '';\n    return await this.requestOptional('GET', `/entity-facets${query}`, options);\n  }\n\n  /**\n   * {@inheritdoc CatalogApi.addLocation}\n   */\n  async addLocation(\n    request: AddLocationRequest,\n    options?: CatalogRequestOptions,\n  ): Promise<AddLocationResponse> {\n    const { type = 'url', target, dryRun } = request;\n\n    const response = await this.fetchApi.fetch(\n      `${await this.discoveryApi.getBaseUrl('catalog')}/locations${\n        dryRun ? '?dryRun=true' : ''\n      }`,\n      {\n        headers: {\n          'Content-Type': 'application/json',\n          ...(options?.token && { Authorization: `Bearer ${options?.token}` }),\n        },\n        method: 'POST',\n        body: JSON.stringify({ type, target }),\n      },\n    );\n\n    if (response.status !== 201) {\n      throw new Error(await response.text());\n    }\n\n    const { location, entities, exists } = await response.json();\n\n    if (!location) {\n      throw new Error(`Location wasn't added: ${target}`);\n    }\n\n    return {\n      location,\n      entities,\n      exists,\n    };\n  }\n\n  /**\n   * {@inheritdoc CatalogApi.getLocationByRef}\n   */\n  async getLocationByRef(\n    locationRef: string,\n    options?: CatalogRequestOptions,\n  ): Promise<Location | undefined> {\n    const all: { data: Location }[] = await this.requestRequired(\n      'GET',\n      '/locations',\n      options,\n    );\n    return all\n      .map(r => r.data)\n      .find(l => locationRef === stringifyLocationRef(l));\n  }\n\n  /**\n   * {@inheritdoc CatalogApi.removeLocationById}\n   */\n  async removeLocationById(\n    id: string,\n    options?: CatalogRequestOptions,\n  ): Promise<void> {\n    await this.requestIgnored(\n      'DELETE',\n      `/locations/${encodeURIComponent(id)}`,\n      options,\n    );\n  }\n\n  /**\n   * {@inheritdoc CatalogApi.removeEntityByUid}\n   */\n  async removeEntityByUid(\n    uid: string,\n    options?: CatalogRequestOptions,\n  ): Promise<void> {\n    await this.requestIgnored(\n      'DELETE',\n      `/entities/by-uid/${encodeURIComponent(uid)}`,\n      options,\n    );\n  }\n\n  /**\n   * {@inheritdoc CatalogApi.validateEntity}\n   */\n  async validateEntity(\n    entity: Entity,\n    locationRef: string,\n    options?: CatalogRequestOptions,\n  ): Promise<ValidateEntityResponse> {\n    const response = await this.fetchApi.fetch(\n      `${await this.discoveryApi.getBaseUrl('catalog')}/validate-entity`,\n      {\n        headers: {\n          'Content-Type': 'application/json',\n          ...(options?.token && { Authorization: `Bearer ${options?.token}` }),\n        },\n        method: 'POST',\n        body: JSON.stringify({ entity, location: locationRef }),\n      },\n    );\n\n    if (response.ok) {\n      return {\n        valid: true,\n      };\n    }\n\n    if (response.status !== 400) {\n      throw await ResponseError.fromResponse(response);\n    }\n\n    const { errors = [] } = await response.json();\n\n    return {\n      valid: false,\n      errors,\n    };\n  }\n\n  //\n  // Private methods\n  //\n\n  private async requestIgnored(\n    method: string,\n    path: string,\n    options?: CatalogRequestOptions,\n  ): Promise<void> {\n    const url = `${await this.discoveryApi.getBaseUrl('catalog')}${path}`;\n    const headers: Record<string, string> = options?.token\n      ? { Authorization: `Bearer ${options.token}` }\n      : {};\n    const response = await this.fetchApi.fetch(url, { method, headers });\n\n    if (!response.ok) {\n      throw await ResponseError.fromResponse(response);\n    }\n  }\n\n  private async requestRequired(\n    method: string,\n    path: string,\n    options?: CatalogRequestOptions,\n  ): Promise<any> {\n    const url = `${await this.discoveryApi.getBaseUrl('catalog')}${path}`;\n    const headers: Record<string, string> = options?.token\n      ? { Authorization: `Bearer ${options.token}` }\n      : {};\n    const response = await this.fetchApi.fetch(url, { method, headers });\n\n    if (!response.ok) {\n      throw await ResponseError.fromResponse(response);\n    }\n\n    return await response.json();\n  }\n\n  private async requestOptional(\n    method: string,\n    path: string,\n    options?: CatalogRequestOptions,\n  ): Promise<any | undefined> {\n    const url = `${await this.discoveryApi.getBaseUrl('catalog')}${path}`;\n    const headers: Record<string, string> = options?.token\n      ? { Authorization: `Bearer ${options.token}` }\n      : {};\n    const response = await this.fetchApi.fetch(url, { method, headers });\n\n    if (!response.ok) {\n      if (response.status === 404) {\n        return undefined;\n      }\n      throw await ResponseError.fromResponse(response);\n    }\n\n    return await response.json();\n  }\n}\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/**\n * The namespace that entities without an explicit namespace fall into.\n *\n * @public\n */\nexport const DEFAULT_NAMESPACE = 'default';\n\n/**\n * Annotation for linking to entity page from catalog pages.\n *\n * @public\n */\nexport const ANNOTATION_VIEW_URL = 'backstage.io/view-url';\n\n/**\n * Annotation for linking to entity edit page from catalog pages.\n *\n * @public\n */\nexport const ANNOTATION_EDIT_URL = 'backstage.io/edit-url';\n\n/**\n * Annotation for specifying the API server of a Kubernetes cluster\n *\n * @public\n */\nexport const ANNOTATION_KUBERNETES_API_SERVER = 'kubernetes.io/api-server';\n\n/**\n * Annotation for specifying the Certificate Authority of an API server for a Kubernetes cluster\n *\n * @public\n */\nexport const ANNOTATION_KUBERNETES_API_SERVER_CA =\n  'kubernetes.io/api-server-certificate-authority';\n\n/**\n * Annotation for specifying the auth provider for a Kubernetes cluster\n *\n * @public\n */\nexport const ANNOTATION_KUBERNETES_AUTH_PROVIDER =\n  'kubernetes.io/auth-provider';\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport lodash from 'lodash';\nimport { EntityPolicy } from './types';\nimport { DEFAULT_NAMESPACE } from '../constants';\nimport { Entity } from '../Entity';\n\n/**\n * Sets a default namespace if none was set.\n *\n * @public\n */\nexport class DefaultNamespaceEntityPolicy implements EntityPolicy {\n  private readonly namespace: string;\n\n  constructor(namespace: string = DEFAULT_NAMESPACE) {\n    this.namespace = namespace;\n  }\n\n  async enforce(entity: Entity): Promise<Entity> {\n    if (entity.metadata.namespace) {\n      return entity;\n    }\n\n    return lodash.merge({ metadata: { namespace: this.namespace } }, entity);\n  }\n}\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport lodash from 'lodash';\n\n/**\n * Contains various helper validation and normalization functions that can be\n * composed to form a Validator.\n *\n * @public\n */\nexport class CommonValidatorFunctions {\n  /**\n   * Checks that the value is on the form `<suffix>` or `<prefix><separator><suffix>`, and validates\n   * those parts separately.\n   *\n   * @param value - The value to check\n   * @param separator - The separator between parts\n   * @param isValidPrefix - Checks that the part before the separator is valid, if present\n   * @param isValidSuffix - Checks that the part after the separator (or the entire value if there is no separator) is valid\n   */\n  static isValidPrefixAndOrSuffix(\n    value: unknown,\n    separator: string,\n    isValidPrefix: (value: string) => boolean,\n    isValidSuffix: (value: string) => boolean,\n  ): boolean {\n    if (typeof value !== 'string') {\n      return false;\n    }\n\n    const parts = value.split(separator);\n    if (parts.length === 1) {\n      return isValidSuffix(parts[0]);\n    } else if (parts.length === 2) {\n      return isValidPrefix(parts[0]) && isValidSuffix(parts[1]);\n    }\n\n    return false;\n  }\n\n  /**\n   * Checks that the value can be safely transferred as JSON.\n   *\n   * @param value - The value to check\n   */\n  static isJsonSafe(value: unknown): boolean {\n    try {\n      return lodash.isEqual(value, JSON.parse(JSON.stringify(value)));\n    } catch {\n      return false;\n    }\n  }\n\n  /**\n   * Checks that the value is a valid DNS subdomain name.\n   *\n   * @param value - The value to check\n   * @see https://tools.ietf.org/html/rfc1123\n   */\n  static isValidDnsSubdomain(value: unknown): boolean {\n    return (\n      typeof value === 'string' &&\n      value.length >= 1 &&\n      value.length <= 253 &&\n      value.split('.').every(CommonValidatorFunctions.isValidDnsLabel)\n    );\n  }\n\n  /**\n   * Checks that the value is a valid DNS label.\n   *\n   * @param value - The value to check\n   * @see https://tools.ietf.org/html/rfc1123\n   */\n  static isValidDnsLabel(value: unknown): boolean {\n    return (\n      typeof value === 'string' &&\n      value.length >= 1 &&\n      value.length <= 63 &&\n      /^[a-z0-9]+(\\-[a-z0-9]+)*$/.test(value)\n    );\n  }\n\n  /**\n   * Checks that the value is a valid tag.\n   *\n   * @deprecated This will be removed in a future release\n   * @param value - The value to check\n   */\n  static isValidTag(value: unknown): boolean {\n    return (\n      typeof value === 'string' &&\n      value.length >= 1 &&\n      value.length <= 63 &&\n      /^[a-z0-9+#]+(\\-[a-z0-9+#]+)*$/.test(value)\n    );\n  }\n\n  /**\n   * Checks that the value is a valid string URL.\n   *\n   * @param value - The value to check\n   */\n  static isValidUrl(value: unknown): boolean {\n    if (typeof value !== 'string') {\n      return false;\n    }\n\n    try {\n      // eslint-disable-next-line no-new\n      new URL(value);\n      return true;\n    } catch {\n      return false;\n    }\n  }\n\n  /**\n   * Checks that the value is a non empty string value.\n   *\n   * @deprecated use isNonEmptyString instead\n   * @param value - The value to check\n   */\n  static isValidString(value: unknown): boolean {\n    return typeof value === 'string' && value?.trim()?.length >= 1;\n  }\n\n  /**\n   * Checks that the value is a string value that's not empty.\n   *\n   * @param value - The value to check\n   */\n  static isNonEmptyString(value: unknown): value is string {\n    return typeof value === 'string' && value?.trim()?.length >= 1;\n  }\n}\n","/*\n * Copyright 2021 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport Ajv, { Schema, ValidateFunction } from 'ajv';\nimport entitySchema from '../schema/Entity.schema.json';\nimport entityEnvelopeSchema from '../schema/EntityEnvelope.schema.json';\nimport entityMetaSchema from '../schema/EntityMeta.schema.json';\nimport commonSchema from '../schema/shared/common.schema.json';\n\n// A local cache of compiled schemas, to avoid duplicate work.\n// The keys are JSON stringified versions of the schema\nconst compiledSchemaCache = new Map<string, ValidateFunction<unknown>>();\n\n// The core schemas that others can depend on\nconst refDependencyCandidates = [\n  entityEnvelopeSchema,\n  entitySchema,\n  entityMetaSchema,\n  commonSchema,\n];\n\nexport function throwAjvError(\n  errors: ValidateFunction<unknown>['errors'],\n): never {\n  if (!errors?.length) {\n    throw new TypeError('Unknown error');\n  }\n\n  const error = errors[0];\n  throw new TypeError(\n    `${error.instancePath || '<root>'} ${error.message}${\n      error.params\n        ? ` - ${Object.entries(error.params)\n            .map(([key, val]) => `${key}: ${val}`)\n            .join(', ')}`\n        : ''\n    }`,\n  );\n}\n\n// Compiles the given schema, and makes sure to also grab any core dependencies\n// that it depends on\nexport function compileAjvSchema(\n  schema: Schema,\n  options: { disableCache?: boolean } = {},\n): ValidateFunction<unknown> {\n  const disableCache = options?.disableCache ?? false;\n  const cacheKey = disableCache ? '' : JSON.stringify(schema);\n\n  if (!disableCache) {\n    const cached = compiledSchemaCache.get(cacheKey);\n    if (cached) {\n      return cached;\n    }\n  }\n\n  const extraSchemas = getExtraSchemas(schema);\n  const ajv = new Ajv({\n    allowUnionTypes: true,\n    allErrors: true,\n    validateSchema: true,\n  });\n  if (extraSchemas.length) {\n    ajv.addSchema(extraSchemas, undefined, undefined, true);\n  }\n  const compiled = ajv.compile(schema);\n\n  if (!disableCache) {\n    compiledSchemaCache.set(cacheKey, compiled);\n  }\n\n  return compiled;\n}\n\n// Find refs in the given schema and recursively in all known schemas it\n// targets, collecting that list of schemas as we go\nfunction getExtraSchemas(schema: Schema): Schema[] {\n  if (typeof schema !== 'object') {\n    return [];\n  }\n\n  const seen = new Set<string>();\n  if (schema.$id) {\n    seen.add(schema.$id);\n  }\n\n  const selected = new Array<Schema>();\n\n  const todo: Schema[] = [schema];\n  while (todo.length) {\n    const current = todo.pop()!;\n\n    for (const ref of getAllRefs(current)) {\n      if (!seen.has(ref)) {\n        seen.add(ref);\n\n        const match = refDependencyCandidates.find(c => c.$id === ref);\n        if (match) {\n          selected.push(match);\n          todo.push(match);\n        }\n      }\n    }\n  }\n\n  return selected;\n}\n\n// Naively step through the entire schema looking for \"$ref\": \"x\" pairs. The\n// resulting iterator may contain duplicates. Ignores fragments, i.e. for a ref\n// of \"a#b\", it will just yield \"a\".\nfunction* getAllRefs(schema: Schema): Iterable<string> {\n  const todo: any[] = [schema];\n  while (todo.length) {\n    const current = todo.pop()!;\n    if (typeof current === 'object' && current) {\n      for (const [key, value] of Object.entries(current)) {\n        if (key === '$ref' && typeof value === 'string') {\n          yield value.split('#')[0];\n        } else {\n          todo.push(value);\n        }\n      }\n    }\n  }\n}\n","/*\n * Copyright 2021 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { Schema } from 'ajv';\nimport { EntityEnvelope } from '../entity/EntityEnvelope';\nimport entityEnvelopeSchema from '../schema/EntityEnvelope.schema.json';\nimport { compileAjvSchema, throwAjvError } from './ajv';\n\n/**\n * Creates a validation function that takes some arbitrary data, and either\n * returns that data cast to an {@link EntityEnvelope} (or the given subtype)\n * if it matches that schema, or throws a {@link globals#TypeError} describing the\n * errors.\n *\n * @remarks\n *\n * Note that this validator is only meant for applying the base schema checks;\n * it does not take custom policies or additional processor based validation\n * into account.\n *\n * By default, the plain `EntityEnvelope` schema is used. If you pass in your\n * own, it may contain `$ref` references to the following, which are resolved\n * automatically for you:\n *\n * - {@link EntityEnvelope}\n * - {@link Entity}\n * - {@link EntityMeta}\n * - `common#<id>`\n *\n * See also {@link https://github.com/backstage/backstage/tree/master/packages/catalog-model/src/schema}\n *\n * @public\n *\n */\nexport function entityEnvelopeSchemaValidator<\n  T extends EntityEnvelope = EntityEnvelope,\n>(schema?: unknown): (data: unknown) => T {\n  const validate = compileAjvSchema(\n    schema ? (schema as Schema) : entityEnvelopeSchema,\n  );\n\n  return data => {\n    const result = validate(data);\n    if (result === true) {\n      return data as T;\n    }\n\n    throw throwAjvError(validate.errors);\n  };\n}\n","/*\n * Copyright 2021 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { Schema } from 'ajv';\nimport { Entity } from '../entity';\nimport { compileAjvSchema, throwAjvError } from './ajv';\n\n/**\n * Creates a validation function that takes some arbitrary data, and either\n * returns that data cast to a `T` if it matches that schema, or `false` if the\n * schema apiVersion/kind didn't apply to that data, or throws a\n * {@link globals#TypeError} describing actual errors.\n *\n * @remarks\n *\n * This validator is highly specialized, in that it has special treatment of\n * the `kind` and `apiVersion` root keys. This only works if your schema has\n * their rule set to `\"enum\"`:\n *\n * ```\n * \"apiVersion\": {\n *    \"enum\": [\"backstage.io/v1alpha1\", \"backstage.io/v1beta1\"]\n * },\n * \"kind\": {\n *   \"enum\": [\"Group\"]\n * },\n * ```\n *\n * In the above example, the created validator will return `false` if and only\n * if the kind and/or apiVersion mismatch.\n *\n * Note that this validator is only meant for applying the base schema checks;\n * it does not take custom policies or additional processor based validation\n * into account.\n *\n * The given schema may contain `$ref` references to the following, which are\n * resolved automatically for you:\n *\n * - {@link Entity}\n *\n * - {@link EntityEnvelope}\n *\n * - {@link EntityMeta}\n *\n * - `common#<id>`\n * @see {@link https://github.com/backstage/backstage/tree/master/packages/catalog-model/src/schema}\n *\n * @public\n */\nexport function entityKindSchemaValidator<T extends Entity>(\n  schema: unknown,\n): (data: unknown) => T | false {\n  const validate = compileAjvSchema(schema as Schema);\n\n  return data => {\n    const result = validate(data);\n    if (result === true) {\n      return data as T;\n    }\n\n    // Only in the case where kind and/or apiVersion have enum mismatches AND\n    // have NO other errors, we call it a soft error.\n    const softCandidates = validate.errors?.filter(e =>\n      ['/kind', '/apiVersion'].includes(e.instancePath),\n    );\n    if (\n      softCandidates?.length &&\n      softCandidates.every(e => e.keyword === 'enum')\n    ) {\n      return false;\n    }\n\n    throw throwAjvError(validate.errors);\n  };\n}\n","/*\n * Copyright 2021 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { Schema } from 'ajv';\nimport { Entity } from '../entity/Entity';\nimport entitySchema from '../schema/Entity.schema.json';\nimport { compileAjvSchema, throwAjvError } from './ajv';\n\n/**\n * Creates a validation function that takes some arbitrary data, and either\n * returns that data cast to an {@link Entity} (or the given subtype) if it\n * matches that schema, or throws a {@link globals#TypeError} describing the errors.\n *\n * @remarks\n *\n * Note that this validator is only meant for applying the base schema checks;\n * it does not take custom policies or additional processor based validation\n * into account.\n *\n * By default, the plain {@link Entity} schema is used. If you pass in your own, it\n * may contain `$ref` references to the following, which are resolved\n * automatically for you:\n *\n * - {@link Entity}\n * - {@link EntityEnvelope}\n * - {@link EntityMeta}\n * - `common#<id>`\n *\n * @public\n * @see {@link https://github.com/backstage/backstage/tree/master/packages/catalog-model/src/schema}\n */\nexport function entitySchemaValidator<T extends Entity = Entity>(\n  schema?: unknown,\n): (data: unknown) => T {\n  const validate = compileAjvSchema(schema ? (schema as Schema) : entitySchema);\n\n  return data => {\n    const result = validate(data);\n    if (result === true) {\n      return data as T;\n    }\n\n    throw throwAjvError(validate.errors);\n  };\n}\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { CommonValidatorFunctions } from './CommonValidatorFunctions';\n\n/**\n * Contains validation functions that match the Kubernetes spec, usable to\n * build a catalog that is compatible with those rule sets.\n *\n * @public\n * @see https://kubernetes.io/docs/concepts/overview/working-with-objects/names/\n * @see https://kubernetes.io/docs/concepts/overview/working-with-objects/labels/#syntax-and-character-set\n * @see https://kubernetes.io/docs/concepts/overview/working-with-objects/annotations/#syntax-and-character-set\n */\nexport class KubernetesValidatorFunctions {\n  static isValidApiVersion(value: unknown): boolean {\n    return CommonValidatorFunctions.isValidPrefixAndOrSuffix(\n      value,\n      '/',\n      CommonValidatorFunctions.isValidDnsSubdomain,\n      n => n.length >= 1 && n.length <= 63 && /^[a-z0-9A-Z]+$/.test(n),\n    );\n  }\n\n  static isValidKind(value: unknown): boolean {\n    return (\n      typeof value === 'string' &&\n      value.length >= 1 &&\n      value.length <= 63 &&\n      /^[a-zA-Z][a-z0-9A-Z]*$/.test(value)\n    );\n  }\n\n  static isValidObjectName(value: unknown): boolean {\n    return (\n      typeof value === 'string' &&\n      value.length >= 1 &&\n      value.length <= 63 &&\n      /^([A-Za-z0-9][-A-Za-z0-9_.]*)?[A-Za-z0-9]$/.test(value)\n    );\n  }\n\n  static isValidNamespace(value: unknown): boolean {\n    return CommonValidatorFunctions.isValidDnsLabel(value);\n  }\n\n  static isValidLabelKey(value: unknown): boolean {\n    return CommonValidatorFunctions.isValidPrefixAndOrSuffix(\n      value,\n      '/',\n      CommonValidatorFunctions.isValidDnsSubdomain,\n      KubernetesValidatorFunctions.isValidObjectName,\n    );\n  }\n\n  static isValidLabelValue(value: unknown): boolean {\n    return (\n      value === '' || KubernetesValidatorFunctions.isValidObjectName(value)\n    );\n  }\n\n  static isValidAnnotationKey(value: unknown): boolean {\n    return CommonValidatorFunctions.isValidPrefixAndOrSuffix(\n      value,\n      '/',\n      CommonValidatorFunctions.isValidDnsSubdomain,\n      KubernetesValidatorFunctions.isValidObjectName,\n    );\n  }\n\n  static isValidAnnotationValue(value: unknown): boolean {\n    return typeof value === 'string';\n  }\n}\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { KubernetesValidatorFunctions } from './KubernetesValidatorFunctions';\nimport { Validators } from './types';\n\nconst defaultValidators: Validators = {\n  isValidApiVersion: KubernetesValidatorFunctions.isValidApiVersion,\n  isValidKind: KubernetesValidatorFunctions.isValidKind,\n  isValidEntityName: KubernetesValidatorFunctions.isValidObjectName,\n  isValidNamespace: KubernetesValidatorFunctions.isValidNamespace,\n  isValidLabelKey: KubernetesValidatorFunctions.isValidLabelKey,\n  isValidLabelValue: KubernetesValidatorFunctions.isValidLabelValue,\n  isValidAnnotationKey: KubernetesValidatorFunctions.isValidAnnotationKey,\n  isValidAnnotationValue: KubernetesValidatorFunctions.isValidAnnotationValue,\n  isValidTag: (value: unknown): boolean => {\n    // NOTE(freben): This one is a bit of an oddball and doesn't fit well anywhere to delegate to, so it's just inlined for now.\n    return (\n      typeof value === 'string' &&\n      value.length >= 1 &&\n      value.length <= 63 &&\n      /^[a-z0-9:+#]+(\\-[a-z0-9:+#]+)*$/.test(value)\n    );\n  },\n};\n\n/**\n * Creates a {@link Validators} object from `overrides`, with default values taken from {@link KubernetesValidatorFunctions}\n *\n * @public\n */\nexport function makeValidator(overrides: Partial<Validators> = {}): Validators {\n  return {\n    ...defaultValidators,\n    ...overrides,\n  };\n}\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { EntityPolicy } from './types';\nimport {\n  CommonValidatorFunctions,\n  KubernetesValidatorFunctions,\n  makeValidator,\n  Validators,\n} from '../../validation';\nimport { Entity } from '../Entity';\n\n/**\n * Ensures that the format of individual fields of the entity envelope\n * is valid.\n *\n * @remarks\n *\n * This does not take into account machine generated fields such as uid and etag.\n *\n * @public\n */\nexport class FieldFormatEntityPolicy implements EntityPolicy {\n  private readonly validators: Validators;\n\n  constructor(validators: Validators = makeValidator()) {\n    this.validators = validators;\n  }\n\n  async enforce(entity: Entity): Promise<Entity> {\n    function require(\n      field: string,\n      value: any,\n      validator: (value: any) => boolean,\n    ) {\n      if (value === undefined || value === null) {\n        throw new Error(`${field} must have a value`);\n      }\n\n      let isValid: boolean;\n      try {\n        isValid = validator(value);\n      } catch (e) {\n        throw new Error(`${field} could not be validated, ${e}`);\n      }\n\n      if (!isValid) {\n        let expectation;\n        switch (\n          validator.name as\n            | keyof typeof KubernetesValidatorFunctions\n            | keyof typeof CommonValidatorFunctions\n        ) {\n          case 'isValidLabelValue':\n          case 'isValidObjectName':\n            expectation =\n              'a string that is sequences of [a-zA-Z0-9] separated by any of [-_.], at most 63 characters in total';\n            break;\n          case 'isValidLabelKey':\n          case 'isValidApiVersion':\n          case 'isValidAnnotationKey':\n            expectation = 'a valid prefix and/or suffix';\n            break;\n          case 'isValidNamespace':\n          case 'isValidDnsLabel':\n            expectation =\n              'a string that is sequences of [a-z0-9] separated by [-], at most 63 characters in total';\n            break;\n          case 'isValidTag':\n            expectation =\n              'a string that is sequences of [a-z0-9+#] separated by [-], at most 63 characters in total';\n            break;\n          case 'isValidAnnotationValue':\n            expectation = 'a string';\n            break;\n          case 'isValidKind':\n            expectation =\n              'a string that is a sequence of [a-zA-Z][a-z0-9A-Z], at most 63 characters in total';\n            break;\n          case 'isValidUrl':\n            expectation = 'a string that is a valid url';\n            break;\n          case 'isValidString':\n          case 'isNonEmptyString':\n            expectation = 'a non empty string';\n            break;\n          default:\n            expectation = undefined;\n            break;\n        }\n\n        // ensure that if there are other/future validators, the error message defaults to a general \"is not valid, visit link\"\n        const message = expectation\n          ? ` expected ${expectation} but found \"${value}\".`\n          : '';\n\n        throw new Error(\n          `\"${field}\" is not valid;${message} To learn more about catalog file format, visit: https://github.com/backstage/backstage/blob/master/docs/architecture-decisions/adr002-default-catalog-file-format.md`,\n        );\n      }\n    }\n\n    function optional(\n      field: string,\n      value: any,\n      validator: (value: any) => boolean,\n    ) {\n      return value === undefined || require(field, value, validator);\n    }\n\n    require('apiVersion', entity.apiVersion, this.validators.isValidApiVersion);\n    require('kind', entity.kind, this.validators.isValidKind);\n\n    require('metadata.name', entity.metadata.name, this.validators\n      .isValidEntityName);\n    optional(\n      'metadata.namespace',\n      entity.metadata.namespace,\n      this.validators.isValidNamespace,\n    );\n\n    for (const [k, v] of Object.entries(entity.metadata.labels ?? [])) {\n      require(`labels.${k}`, k, this.validators.isValidLabelKey);\n      require(`labels.${k}`, v, this.validators.isValidLabelValue);\n    }\n\n    for (const [k, v] of Object.entries(entity.metadata.annotations ?? [])) {\n      require(`annotations.${k}`, k, this.validators.isValidAnnotationKey);\n      require(`annotations.${k}`, v, this.validators.isValidAnnotationValue);\n    }\n\n    const tags = entity.metadata.tags ?? [];\n\n    for (let i = 0; i < tags.length; ++i) {\n      require(`tags.${i}`, tags[i], this.validators.isValidTag);\n    }\n\n    const links = entity.metadata.links ?? [];\n\n    for (let i = 0; i < links.length; ++i) {\n      require(`links.${i}.url`, links[i]\n        ?.url, CommonValidatorFunctions.isValidUrl);\n      optional(\n        `links.${i}.title`,\n        links[i]?.title,\n        CommonValidatorFunctions.isNonEmptyString,\n      );\n      optional(\n        `links.${i}.icon`,\n        links[i]?.icon,\n        KubernetesValidatorFunctions.isValidObjectName,\n      );\n    }\n\n    return entity;\n  }\n}\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport Ajv, { ValidateFunction } from 'ajv';\nimport entitySchema from '../../schema/Entity.schema.json';\nimport entityMetaSchema from '../../schema/EntityMeta.schema.json';\nimport commonSchema from '../../schema/shared/common.schema.json';\nimport { Entity } from '../Entity';\nimport { EntityPolicy } from './types';\n\n/**\n * Ensures that the entity spec is valid according to a schema.\n *\n * @remarks\n *\n * This should be the first policy in the list, to ensure that other downstream\n * policies can work with a structure that is at least valid in therms of the\n * typescript type.\n *\n * @public\n */\nexport class SchemaValidEntityPolicy implements EntityPolicy {\n  private validate: ValidateFunction<Entity> | undefined;\n\n  async enforce(entity: Entity): Promise<Entity> {\n    if (!this.validate) {\n      const ajv = new Ajv({ allowUnionTypes: true });\n      this.validate = ajv\n        .addSchema([commonSchema, entityMetaSchema], undefined, undefined, true)\n        .compile<Entity>(entitySchema);\n    }\n\n    const result = this.validate(entity);\n    if (result === true) {\n      return entity;\n    }\n\n    const [error] = this.validate.errors || [];\n    if (!error) {\n      throw new Error(`Malformed envelope, Unknown error`);\n    }\n\n    throw new Error(\n      `Malformed envelope, ${error.instancePath || '<root>'} ${error.message}`,\n    );\n  }\n}\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { DEFAULT_NAMESPACE } from './constants';\nimport { CompoundEntityRef } from '../types';\nimport { Entity } from './Entity';\n\nfunction parseRefString(ref: string): {\n  kind?: string;\n  namespace?: string;\n  name: string;\n} {\n  let colonI = ref.indexOf(':');\n  const slashI = ref.indexOf('/');\n\n  // If the / is ahead of the :, treat the rest as the name\n  if (slashI !== -1 && slashI < colonI) {\n    colonI = -1;\n  }\n\n  const kind = colonI === -1 ? undefined : ref.slice(0, colonI);\n  const namespace = slashI === -1 ? undefined : ref.slice(colonI + 1, slashI);\n  const name = ref.slice(Math.max(colonI + 1, slashI + 1));\n\n  if (kind === '' || namespace === '' || name === '') {\n    throw new TypeError(\n      `Entity reference \"${ref}\" was not on the form [<kind>:][<namespace>/]<name>`,\n    );\n  }\n\n  return { kind, namespace, name };\n}\n\n/**\n * Extracts the kind, namespace and name that form the compound entity ref\n * triplet of the given entity.\n *\n * @public\n * @param entity - An entity\n * @returns The compound entity ref\n */\nexport function getCompoundEntityRef(entity: Entity): CompoundEntityRef {\n  return {\n    kind: entity.kind,\n    namespace: entity.metadata.namespace || DEFAULT_NAMESPACE,\n    name: entity.metadata.name,\n  };\n}\n\n/**\n * Parses an entity reference, either on string or compound form, and returns\n * a structure with a name, and optional kind and namespace.\n *\n * @remarks\n *\n * The context object can contain default values for the kind and namespace,\n * that will be used if the input reference did not specify any.\n *\n * @public\n * @param ref - The reference to parse\n * @param context - The context of defaults that the parsing happens within\n * @returns The compound form of the reference\n */\nexport function parseEntityRef(\n  ref: string | { kind?: string; namespace?: string; name: string },\n  context?: {\n    /** The default kind, if none is given in the reference */\n    defaultKind?: string;\n    /** The default namespace, if none is given in the reference */\n    defaultNamespace?: string;\n  },\n): CompoundEntityRef {\n  if (!ref) {\n    throw new Error(`Entity reference must not be empty`);\n  }\n\n  const defaultKind = context?.defaultKind;\n  const defaultNamespace = context?.defaultNamespace || DEFAULT_NAMESPACE;\n\n  let kind: string | undefined;\n  let namespace: string | undefined;\n  let name: string | undefined;\n\n  if (typeof ref === 'string') {\n    const parsed = parseRefString(ref);\n    kind = parsed.kind ?? defaultKind;\n    namespace = parsed.namespace ?? defaultNamespace;\n    name = parsed.name;\n  } else {\n    kind = ref.kind ?? defaultKind;\n    namespace = ref.namespace ?? defaultNamespace;\n    name = ref.name;\n  }\n\n  if (!kind) {\n    const textual = JSON.stringify(ref);\n    throw new Error(\n      `Entity reference ${textual} had missing or empty kind (e.g. did not start with \"component:\" or similar)`,\n    );\n  } else if (!namespace) {\n    const textual = JSON.stringify(ref);\n    throw new Error(\n      `Entity reference ${textual} had missing or empty namespace`,\n    );\n  } else if (!name) {\n    const textual = JSON.stringify(ref);\n    throw new Error(`Entity reference ${textual} had missing or empty name`);\n  }\n\n  return { kind, namespace, name };\n}\n\n/**\n * Takes an entity or entity name/reference, and returns the string form of an\n * entity ref.\n *\n * @remarks\n *\n * This function creates a canonical and unique reference to the entity, converting\n * all parts of the name to lowercase and inserts the default namespace if needed.\n * It is typically not the best way to represent the entity reference to the user.\n *\n * @public\n * @param ref - The reference to serialize\n * @returns The same reference on either string or compound form\n */\nexport function stringifyEntityRef(\n  ref: Entity | { kind: string; namespace?: string; name: string },\n): string {\n  let kind;\n  let namespace;\n  let name;\n\n  if ('metadata' in ref) {\n    kind = ref.kind;\n    namespace = ref.metadata.namespace ?? DEFAULT_NAMESPACE;\n    name = ref.metadata.name;\n  } else {\n    kind = ref.kind;\n    namespace = ref.namespace ?? DEFAULT_NAMESPACE;\n    name = ref.name;\n  }\n\n  return `${kind.toLocaleLowerCase('en-US')}:${namespace.toLocaleLowerCase(\n    'en-US',\n  )}/${name.toLocaleLowerCase('en-US')}`;\n}\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { Entity, EntityPolicy } from './entity';\n\n// Helper that requires that all of a set of policies can be successfully\n// applied\nclass AllEntityPolicies implements EntityPolicy {\n  constructor(private readonly policies: EntityPolicy[]) {}\n\n  async enforce(entity: Entity): Promise<Entity> {\n    let result = entity;\n    for (const policy of this.policies) {\n      const output = await policy.enforce(result);\n      if (!output) {\n        throw new Error(\n          `Policy ${policy.constructor.name} did not return a result`,\n        );\n      }\n      result = output;\n    }\n    return result;\n  }\n}\n\n// Helper that requires that at least one of a set of policies can be\n// successfully applied\nclass AnyEntityPolicy implements EntityPolicy {\n  constructor(private readonly policies: EntityPolicy[]) {}\n\n  async enforce(entity: Entity): Promise<Entity> {\n    for (const policy of this.policies) {\n      const output = await policy.enforce(entity);\n      if (output) {\n        return output;\n      }\n    }\n    throw new Error(`The entity did not match any known policy`);\n  }\n}\n\n/**\n * Provides helpers for enforcing a set of {@link EntityPolicy} in an `and`/`or` expression.\n *\n * @public\n */\nexport const EntityPolicies = {\n  allOf(policies: EntityPolicy[]): EntityPolicy {\n    return new AllEntityPolicies(policies);\n  },\n  oneOf(policies: EntityPolicy[]): EntityPolicy {\n    return new AnyEntityPolicy(policies);\n  },\n};\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { entityKindSchemaValidator } from '../validation';\nimport { KindValidator } from './types';\n\n// TODO(freben): Left here as a compatibility helper. It would be nicer to\n// just export the inner validator directly. However, all of the already\n// exported kind validators have the `KindValidator` signature which is\n// different. So let's postpone that change until a later time.\nexport function ajvCompiledJsonSchemaValidator(schema: unknown): KindValidator {\n  let validator: undefined | ((data: unknown) => any);\n  return {\n    async check(data) {\n      if (!validator) {\n        validator = entityKindSchemaValidator(schema);\n      }\n      return validator(data) === data;\n    },\n  };\n}\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport type { Entity } from '../entity/Entity';\nimport schema from '../schema/kinds/API.v1alpha1.schema.json';\nimport { ajvCompiledJsonSchemaValidator } from './util';\n\n/**\n * Backstage API kind Entity. APIs describe the interfaces for Components to communicate.\n *\n * @remarks\n *\n * See {@link https://backstage.io/docs/features/software-catalog/system-model}\n *\n * @public\n */\nexport interface ApiEntityV1alpha1 extends Entity {\n  apiVersion: 'backstage.io/v1alpha1' | 'backstage.io/v1beta1';\n  kind: 'API';\n  spec: {\n    type: string;\n    lifecycle: string;\n    owner: string;\n    definition: string;\n    system?: string;\n  };\n}\n\n/**\n * {@link KindValidator} for {@link ApiEntityV1alpha1}.\n *\n * @public\n */\nexport const apiEntityV1alpha1Validator =\n  ajvCompiledJsonSchemaValidator(schema);\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport type { Entity } from '../entity/Entity';\nimport schema from '../schema/kinds/Component.v1alpha1.schema.json';\nimport { ajvCompiledJsonSchemaValidator } from './util';\n\n/**\n * Backstage catalog Component kind Entity. Represents a single, individual piece of software.\n *\n * @remarks\n *\n * See {@link https://backstage.io/docs/features/software-catalog/system-model}\n *\n * @public\n */\nexport interface ComponentEntityV1alpha1 extends Entity {\n  apiVersion: 'backstage.io/v1alpha1' | 'backstage.io/v1beta1';\n  kind: 'Component';\n  spec: {\n    type: string;\n    lifecycle: string;\n    owner: string;\n    subcomponentOf?: string;\n    providesApis?: string[];\n    consumesApis?: string[];\n    dependsOn?: string[];\n    system?: string;\n  };\n}\n\n/**\n * {@link KindValidator} for {@link ComponentEntityV1alpha1}.\n *\n * @public\n */\nexport const componentEntityV1alpha1Validator =\n  ajvCompiledJsonSchemaValidator(schema);\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport type { Entity } from '../entity/Entity';\nimport schema from '../schema/kinds/Domain.v1alpha1.schema.json';\nimport { ajvCompiledJsonSchemaValidator } from './util';\n\n/**\n * Backstage Domain kind Entity. Domains group Systems together.\n *\n * @remarks\n *\n * See {@link https://backstage.io/docs/features/software-catalog/system-model}\n *\n * @public\n */\nexport interface DomainEntityV1alpha1 extends Entity {\n  apiVersion: 'backstage.io/v1alpha1' | 'backstage.io/v1beta1';\n  kind: 'Domain';\n  spec: {\n    owner: string;\n  };\n}\n\n/**\n * {@link KindValidator} for {@link DomainEntityV1alpha1}.\n *\n * @public\n */\nexport const domainEntityV1alpha1Validator =\n  ajvCompiledJsonSchemaValidator(schema);\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport type { Entity } from '../entity/Entity';\nimport schema from '../schema/kinds/Group.v1alpha1.schema.json';\nimport { ajvCompiledJsonSchemaValidator } from './util';\n\n/**\n * Backstage catalog Group kind Entity.\n *\n * @public\n */\nexport interface GroupEntityV1alpha1 extends Entity {\n  apiVersion: 'backstage.io/v1alpha1' | 'backstage.io/v1beta1';\n  kind: 'Group';\n  spec: {\n    type: string;\n    profile?: {\n      displayName?: string;\n      email?: string;\n      picture?: string;\n    };\n    parent?: string;\n    children: string[];\n    members?: string[];\n  };\n}\n\n/**\n * {@link KindValidator} for {@link GroupEntityV1alpha1}.\n * @public\n */\nexport const groupEntityV1alpha1Validator =\n  ajvCompiledJsonSchemaValidator(schema);\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport type { Entity } from '../entity/Entity';\nimport schema from '../schema/kinds/Location.v1alpha1.schema.json';\nimport { ajvCompiledJsonSchemaValidator } from './util';\n\n/**\n * Backstage catalog Location kind Entity.\n *\n * @public\n */\nexport interface LocationEntityV1alpha1 extends Entity {\n  apiVersion: 'backstage.io/v1alpha1' | 'backstage.io/v1beta1';\n  kind: 'Location';\n  spec: {\n    type?: string;\n    target?: string;\n    targets?: string[];\n    presence?: 'required' | 'optional';\n  };\n}\n\n/**\n * {@link KindValidator} for {@link LocationEntityV1alpha1}.\n *\n * @public\n */\nexport const locationEntityV1alpha1Validator =\n  ajvCompiledJsonSchemaValidator(schema);\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/*\nNaming rules for relations in priority order:\n\n1. Use at most two words. One main verb and a specifier, e.g. \"ownerOf\"\n2. Reading out \"<source-kind> <type> <target-kind>\" should make sense in English.\n3. Maintain symmetry between pairs, e.g. \"ownedBy\" and \"ownerOf\" rather than \"owns\".\n*/\n\n/**\n * An ownership relation where the owner is usually an organizational\n * entity (user or group), and the other entity can be anything. Reversed\n * direction of {@link RELATION_OWNER_OF}.\n *\n * @public\n */\nexport const RELATION_OWNED_BY = 'ownedBy';\n\n/**\n * A relationship from an owner to the owned entity. Reversed direction of\n * {@link RELATION_OWNED_BY}.\n *\n * @public\n */\nexport const RELATION_OWNER_OF = 'ownerOf';\n\n/**\n * A relation with an API entity, typically from a component. Reversed direction of\n * {@link RELATION_API_CONSUMED_BY}.\n *\n * @public\n */\nexport const RELATION_CONSUMES_API = 'consumesApi';\n\n/**\n * A relation of an API being consumed, typically by a component. Reversed direction of\n * {@link RELATION_CONSUMES_API}.\n *\n * @public\n */\nexport const RELATION_API_CONSUMED_BY = 'apiConsumedBy';\n\n/**\n * A relation from an API provider entity (typically a component) to the API. Reversed direction of\n * {@link RELATION_API_PROVIDED_BY}.\n *\n * @public\n */\nexport const RELATION_PROVIDES_API = 'providesApi';\n\n/**\n * A relation from an API to its provider entity (typically a component). Reversed direction of\n * {@link RELATION_PROVIDES_API}.\n *\n * @public\n */\nexport const RELATION_API_PROVIDED_BY = 'apiProvidedBy';\n\n/**\n * A relation denoting a dependency on another entity. Reversed direction of\n * {@link RELATION_DEPENDENCY_OF}.\n *\n * @public\n */\nexport const RELATION_DEPENDS_ON = 'dependsOn';\n\n/**\n * A relation denoting a reverse dependency by another entity. Reversed direction of\n * {@link RELATION_DEPENDS_ON}.\n *\n * @public\n */\nexport const RELATION_DEPENDENCY_OF = 'dependencyOf';\n\n/**\n * A parent/child relation to build up a tree, used for example to describe\n * the organizational structure between groups. Reversed direction of\n * {@link RELATION_CHILD_OF}.\n *\n * @public\n */\nexport const RELATION_PARENT_OF = 'parentOf';\n\n/**\n * A relation from a child to a parent entity, used for example to describe\n * the organizational structure between groups. Reversed direction of\n * {@link RELATION_PARENT_OF}.\n *\n * @public\n */\nexport const RELATION_CHILD_OF = 'childOf';\n\n/**\n * A membership relation, typically for users in a group. Reversed direction of\n * {@link RELATION_HAS_MEMBER}.\n *\n * @public\n */\nexport const RELATION_MEMBER_OF = 'memberOf';\n\n/**\n * A relation from a group to its member, typcally a user in a group. Reversed direction of\n * {@link RELATION_MEMBER_OF}.\n *\n * @public\n */\nexport const RELATION_HAS_MEMBER = 'hasMember';\n\n/**\n * A part/whole relation, typically for components in a system and systems\n * in a domain. Reversed direction of {@link RELATION_HAS_PART}.\n *\n * @public\n */\nexport const RELATION_PART_OF = 'partOf';\n\n/**\n * A relation from a containing entity to a contained entity. Reversed direction of\n * {@link RELATION_PART_OF}.\n *\n * @public\n */\nexport const RELATION_HAS_PART = 'hasPart';\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport type { Entity } from '../entity/Entity';\nimport schema from '../schema/kinds/Resource.v1alpha1.schema.json';\nimport { ajvCompiledJsonSchemaValidator } from './util';\n\n/**\n * Backstage catalog Resource kind Entity. Represents infrastructure required to operate Components.\n *\n * @remarks\n *\n * See {@link https://backstage.io/docs/features/software-catalog/system-model}\n *\n * @public\n */\nexport interface ResourceEntityV1alpha1 extends Entity {\n  apiVersion: 'backstage.io/v1alpha1' | 'backstage.io/v1beta1';\n  kind: 'Resource';\n  spec: {\n    type: string;\n    owner: string;\n    dependsOn?: string[];\n    dependencyOf?: string[];\n    system?: string;\n  };\n}\n\n/**\n * {@link KindValidator} for {@link ResourceEntityV1alpha1}.\n *\n * @public\n */\nexport const resourceEntityV1alpha1Validator =\n  ajvCompiledJsonSchemaValidator(schema);\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport type { Entity } from '../entity/Entity';\nimport schema from '../schema/kinds/System.v1alpha1.schema.json';\nimport { ajvCompiledJsonSchemaValidator } from './util';\n\n/**\n * Backstage catalog System kind Entity. Systems group Comopnents, Resources and APIs together.\n *\n * @remarks\n *\n * See {@link https://backstage.io/docs/features/software-catalog/system-model}\n *\n * @public\n */\nexport interface SystemEntityV1alpha1 extends Entity {\n  apiVersion: 'backstage.io/v1alpha1' | 'backstage.io/v1beta1';\n  kind: 'System';\n  spec: {\n    owner: string;\n    domain?: string;\n  };\n}\n\n/**\n * {@link KindValidator} for {@link SystemEntityV1alpha1}.\n *\n * @public\n */\nexport const systemEntityV1alpha1Validator =\n  ajvCompiledJsonSchemaValidator(schema);\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport type { Entity } from '../entity/Entity';\nimport schema from '../schema/kinds/User.v1alpha1.schema.json';\nimport { ajvCompiledJsonSchemaValidator } from './util';\n\n/**\n * Backstage catalog User kind Entity.\n *\n * @public\n */\nexport interface UserEntityV1alpha1 extends Entity {\n  apiVersion: 'backstage.io/v1alpha1' | 'backstage.io/v1beta1';\n  kind: 'User';\n  spec: {\n    profile?: {\n      displayName?: string;\n      email?: string;\n      picture?: string;\n    };\n    memberOf?: string[];\n  };\n}\n\n/**\n * {@link KindValidator} for {@link UserEntityV1alpha1}.\n *\n * @public\n */\nexport const userEntityV1alpha1Validator =\n  ajvCompiledJsonSchemaValidator(schema);\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/**\n * Entity annotation containing the location from which the entity is sourced.\n *\n * @public\n */\nexport const ANNOTATION_LOCATION = 'backstage.io/managed-by-location';\n\n/**\n * Entity annotation containing the originally sourced location which ultimately\n * led to this entity being ingested.\n *\n * @public\n */\nexport const ANNOTATION_ORIGIN_LOCATION =\n  'backstage.io/managed-by-origin-location';\n\n/**\n * Entity annotation pointing to the source (e.g. source code repository root or\n * similar) for this entity.\n *\n * @public\n */\nexport const ANNOTATION_SOURCE_LOCATION = 'backstage.io/source-location';\n","/*\n * Copyright 2021 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { ANNOTATION_SOURCE_LOCATION } from '.';\nimport { Entity, stringifyEntityRef } from '../entity';\nimport { ANNOTATION_LOCATION } from './annotation';\n\n/**\n * Parses a string form location reference.\n *\n * @public\n * @param ref - A string-form location ref, e.g. `'url:https://host'`\n * @returns A location ref, e.g. `{ type: 'url', target: 'https://host' }`\n */\nexport function parseLocationRef(ref: string): {\n  type: string;\n  target: string;\n} {\n  if (typeof ref !== 'string') {\n    throw new TypeError(\n      `Unable to parse location ref '${ref}', unexpected argument ${typeof ref}`,\n    );\n  }\n\n  const splitIndex = ref.indexOf(':');\n  if (splitIndex < 0) {\n    throw new TypeError(\n      `Unable to parse location ref '${ref}', expected '<type>:<target>', e.g. 'url:https://host/path'`,\n    );\n  }\n\n  const type = ref.substring(0, splitIndex).trim();\n  const target = ref.substring(splitIndex + 1).trim();\n\n  if (!type || !target) {\n    throw new TypeError(\n      `Unable to parse location ref '${ref}', expected '<type>:<target>', e.g. 'url:https://host/path'`,\n    );\n  }\n\n  if (type === 'http' || type === 'https') {\n    throw new TypeError(\n      `Invalid location ref '${ref}', please prefix it with 'url:', e.g. 'url:${ref}'`,\n    );\n  }\n\n  return { type, target };\n}\n\n/**\n * Turns a location ref into its string form.\n *\n * @public\n * @param ref - A location ref, e.g. `{ type: 'url', target: 'https://host' }`\n * @returns A string-form location ref, e.g. `'url:https://host'`\n */\nexport function stringifyLocationRef(ref: {\n  type: string;\n  target: string;\n}): string {\n  const { type, target } = ref;\n\n  if (!type) {\n    throw new TypeError(`Unable to stringify location ref, empty type`);\n  } else if (!target) {\n    throw new TypeError(`Unable to stringify location ref, empty target`);\n  }\n\n  return `${type}:${target}`;\n}\n\n/**\n * Returns the source code location of the Entity, to the extent that one exists.\n *\n * @remarks\n *\n * If the returned location type is of type 'url', the target should be readable at least\n * using the UrlReader from `@backstage/backend-common`. If it is not of type 'url', the caller\n * needs to have explicit handling of each location type or signal that it is not supported.\n *\n * @public\n */\nexport function getEntitySourceLocation(entity: Entity): {\n  type: string;\n  target: string;\n} {\n  const locationRef =\n    entity.metadata?.annotations?.[ANNOTATION_SOURCE_LOCATION] ??\n    entity.metadata?.annotations?.[ANNOTATION_LOCATION];\n\n  if (!locationRef) {\n    throw new Error(\n      `Entity '${stringifyEntityRef(entity)}' is missing location`,\n    );\n  }\n\n  return parseLocationRef(locationRef);\n}\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React, { useEffect, useState } from 'react';\nimport Snackbar from '@material-ui/core/Snackbar';\nimport IconButton from '@material-ui/core/IconButton';\nimport CloseIcon from '@material-ui/icons/Close';\nimport { Alert } from '@material-ui/lab';\nimport { AlertMessage, useApi, alertApiRef } from '@backstage/core-plugin-api';\nimport pluralize from 'pluralize';\n\n/**\n * Displays alerts from {@link @backstage/core-plugin-api#AlertApi}\n *\n * @public\n * @remarks\n *\n * Shown as SnackBar at the center top of the page by default. Configurable with props.\n */\n\n// TODO: improve on this and promote to a shared component for use by all apps.\n\nexport type AlertDisplayProps = {\n  anchorOrigin?: {\n    vertical: 'top' | 'bottom';\n    horizontal: 'left' | 'center' | 'right';\n  };\n};\n\n/** @public */\nexport function AlertDisplay(props: AlertDisplayProps) {\n  const [messages, setMessages] = useState<Array<AlertMessage>>([]);\n  const alertApi = useApi(alertApiRef);\n\n  const { anchorOrigin = { vertical: 'top', horizontal: 'center' } } = props;\n\n  useEffect(() => {\n    const subscription = alertApi\n      .alert$()\n      .subscribe(message => setMessages(msgs => msgs.concat(message)));\n\n    return () => {\n      subscription.unsubscribe();\n    };\n  }, [alertApi]);\n\n  if (messages.length === 0) {\n    return null;\n  }\n\n  const [firstMessage] = messages;\n\n  const handleClose = () => {\n    setMessages(msgs => msgs.filter(msg => msg !== firstMessage));\n  };\n\n  return (\n    <Snackbar open anchorOrigin={anchorOrigin}>\n      <Alert\n        action={\n          <IconButton\n            color=\"inherit\"\n            size=\"small\"\n            onClick={handleClose}\n            data-testid=\"error-button-close\"\n          >\n            <CloseIcon />\n          </IconButton>\n        }\n        severity={firstMessage.severity}\n      >\n        <span>\n          {firstMessage.message.toString()}\n          {messages.length > 1 && (\n            <em>{` (${messages.length - 1} older ${pluralize(\n              'message',\n              messages.length - 1,\n            )})`}</em>\n          )}\n        </span>\n      </Alert>\n    </Snackbar>\n  );\n}\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport React, { CSSProperties } from 'react';\nimport { createStyles, makeStyles, Theme } from '@material-ui/core/styles';\nimport MaterialAvatar from '@material-ui/core/Avatar';\nimport { extractInitials, stringToColor } from './utils';\n\n/** @public */\nexport type AvatarClassKey = 'avatar';\n\nconst useStyles = makeStyles(\n  (theme: Theme) =>\n    createStyles({\n      avatar: {\n        width: '4rem',\n        height: '4rem',\n        color: '#fff',\n        fontWeight: theme.typography.fontWeightBold,\n        letterSpacing: '1px',\n        textTransform: 'uppercase',\n      },\n    }),\n  { name: 'BackstageAvatar' },\n);\n\n/**\n * Properties for {@link Avatar}.\n *\n * @public\n */\nexport interface AvatarProps {\n  /**\n   * A display name, which will be used to generate initials as a fallback in case a picture is not provided.\n   */\n  displayName?: string;\n  /**\n   * URL to avatar image source\n   */\n  picture?: string;\n  /**\n   * Custom styles applied to avatar\n   */\n  customStyles?: CSSProperties;\n}\n\n/**\n *  Component rendering an Avatar\n *\n * @public\n * @remarks\n *\n * Based on https://v4.mui.com/components/avatars/#avatar with some styling adjustment and two-letter initials\n */\nexport function Avatar(props: AvatarProps) {\n  const { displayName, picture, customStyles } = props;\n  const classes = useStyles();\n  let styles = { ...customStyles };\n  // We only calculate the background color if there's not an avatar\n  // picture. If there is a picture, it might have a transparent\n  // background and we don't know whether the calculated background\n  // color will clash.\n  if (!picture) {\n    styles = {\n      backgroundColor: stringToColor(displayName || ''),\n      ...customStyles,\n    };\n  }\n  return (\n    <MaterialAvatar\n      alt={displayName}\n      src={picture}\n      className={classes.avatar}\n      style={styles}\n    >\n      {displayName && extractInitials(displayName)}\n    </MaterialAvatar>\n  );\n}\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { configApiRef, useAnalytics, useApi } from '@backstage/core-plugin-api';\nimport classnames from 'classnames';\nimport MaterialLink, {\n  LinkProps as MaterialLinkProps,\n} from '@material-ui/core/Link';\nimport { makeStyles } from '@material-ui/core/styles';\nimport React, { ElementType } from 'react';\nimport {\n  Link as RouterLink,\n  LinkProps as RouterLinkProps,\n} from 'react-router-dom';\nimport { trimEnd } from 'lodash';\n\nconst useStyles = makeStyles(\n  {\n    visuallyHidden: {\n      clip: 'rect(0 0 0 0)',\n      clipPath: 'inset(50%)',\n      overflow: 'hidden',\n      position: 'absolute',\n      whiteSpace: 'nowrap',\n      height: 1,\n      width: 1,\n    },\n    externalLink: {\n      position: 'relative',\n    },\n  },\n  { name: 'Link' },\n);\n\nexport const isExternalUri = (uri: string) => /^([a-z+.-]+):/.test(uri);\n\nexport type LinkProps = Omit<MaterialLinkProps, 'to'> &\n  Omit<RouterLinkProps, 'to'> & {\n    to: string;\n    component?: ElementType<any>;\n    noTrack?: boolean;\n  };\n\n/**\n * Returns the app base url that could be empty if the Config API is not properly implemented.\n * The only cases there would be no Config API are in tests and in storybook stories, and in those cases, it's unlikely that callers would rely on this subpath behavior.\n */\nconst useBaseUrl = () => {\n  try {\n    const config = useApi(configApiRef);\n    return config.getOptionalString('app.baseUrl');\n  } catch {\n    return undefined;\n  }\n};\n\n/**\n * Get the app base path from the configured app baseUrl.\n * The returned path does not have a trailing slash.\n */\nconst useBasePath = () => {\n  // baseUrl can be specified as just a path\n  const base = 'http://dummy.dev';\n  const url = useBaseUrl() ?? '/';\n  const { pathname } = new URL(url, base);\n  return trimEnd(pathname, '/');\n};\n\nexport const useResolvedPath = (uri: LinkProps['to']) => {\n  let resolvedPath = String(uri);\n\n  const basePath = useBasePath();\n  const external = isExternalUri(resolvedPath);\n  const startsWithBasePath = resolvedPath.startsWith(basePath);\n\n  if (!external && !startsWithBasePath) {\n    resolvedPath = basePath.concat(resolvedPath);\n  }\n\n  return resolvedPath;\n};\n\n/**\n * Given a react node, try to retrieve its text content.\n */\nconst getNodeText = (node: React.ReactNode): string => {\n  // If the node is an array of children, recurse and join.\n  if (node instanceof Array) {\n    return node.map(getNodeText).join(' ').trim();\n  }\n\n  // If the node is a react element, recurse on its children.\n  if (typeof node === 'object' && node) {\n    return getNodeText((node as React.ReactElement)?.props?.children);\n  }\n\n  // Base case: the node is just text. Return it.\n  if (['string', 'number'].includes(typeof node)) {\n    return String(node);\n  }\n\n  // Base case: just return an empty string.\n  return '';\n};\n\n/**\n * Thin wrapper on top of material-ui's Link component, which...\n * - Makes the Link use react-router\n * - Captures Link clicks as analytics events.\n */\nexport const Link = React.forwardRef<any, LinkProps>(\n  ({ onClick, noTrack, ...props }, ref) => {\n    const classes = useStyles();\n    const analytics = useAnalytics();\n    const to = useResolvedPath(props.to);\n    const linkText = getNodeText(props.children) || to;\n    const external = isExternalUri(to);\n    const newWindow = external && !!/^https?:/.exec(to);\n\n    const handleClick = (event: React.MouseEvent<any, MouseEvent>) => {\n      onClick?.(event);\n      if (!noTrack) {\n        analytics.captureEvent('click', linkText, { attributes: { to } });\n      }\n    };\n\n    return external ? (\n      // External links\n      <MaterialLink\n        {...(newWindow ? { target: '_blank', rel: 'noopener' } : {})}\n        {...props}\n        ref={ref}\n        href={to}\n        onClick={handleClick}\n        className={classnames(classes.externalLink, props.className)}\n      >\n        {props.children}\n        <span className={classes.visuallyHidden}>, Opens in a new window</span>\n      </MaterialLink>\n    ) : (\n      // Interact with React Router for internal links\n      <MaterialLink\n        {...props}\n        ref={ref}\n        component={RouterLink}\n        to={to}\n        onClick={handleClick}\n      />\n    );\n  },\n) as (props: LinkProps) => JSX.Element;\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport MaterialButton, {\n  ButtonProps as MaterialButtonProps,\n} from '@material-ui/core/Button';\nimport React from 'react';\nimport { Link, LinkProps } from '../Link';\n\n/**\n * Properties for {@link Button}\n *\n * @public\n * @remarks\n *\n * See {@link https://v4.mui.com/api/button/#props | Material-UI Button Props} for all properties\n */\nexport type ButtonProps = MaterialButtonProps &\n  Omit<LinkProps, 'variant' | 'color'>;\n\n/**\n * This wrapper is here to reset the color of the Link and make typescript happy.\n */\nconst LinkWrapper = React.forwardRef<any, LinkProps>((props, ref) => (\n  <Link ref={ref} {...props} color=\"initial\" />\n));\n\n/**\n * Thin wrapper on top of material-ui's {@link https://v4.mui.com/components/buttons/ | Button} component\n *\n * @public\n * @remarks\n *\n * Makes the Button to utilize react-router\n */\nexport const Button = React.forwardRef<any, ButtonProps>((props, ref) => (\n  <MaterialButton ref={ref} component={LinkWrapper} {...props} />\n)) as (props: ButtonProps) => JSX.Element;\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { errorApiRef, useApi } from '@backstage/core-plugin-api';\nimport IconButton from '@material-ui/core/IconButton';\nimport Tooltip from '@material-ui/core/Tooltip';\nimport CopyIcon from '@material-ui/icons/FileCopy';\nimport React, { MouseEventHandler, useEffect, useState } from 'react';\nimport useCopyToClipboard from 'react-use/lib/useCopyToClipboard';\n\n/**\n * Properties for {@link CopyTextButton}\n *\n * @public\n */\nexport interface CopyTextButtonProps {\n  /**\n   * The text to be copied\n   */\n  text: string;\n  /**\n   * Number of milliseconds that the tooltip is shown\n   *\n   * @remarks\n   *\n   * Default: 1000\n   */\n  tooltipDelay?: number;\n  /**\n   * Text to show in the tooltip when user has clicked the button\n   *\n   * @remarks\n   *\n   * Default: \"Text copied to clipboard\"\n   */\n  tooltipText?: string;\n\n  /**\n   * Text to use as aria-label prop on the button\n   *\n   * @remarks\n   *\n   * Default: \"Copy text\"\n   */\n  'aria-label'?: string;\n}\n\n/**\n * Copy text button with visual feedback\n *\n * @public\n * @remarks\n *\n * Visual feedback takes form of:\n *  - a hover color\n *  - click ripple\n *  - Tooltip shown when user has clicked\n *\n * @example\n *\n * ```\n * <CopyTextButton\n *   text=\"My text that I want to be copied to the clipboard\"\n *   arial-label=\"Accessible label for this button\" />\n * ```\n */\nexport function CopyTextButton(props: CopyTextButtonProps) {\n  const {\n    text,\n    tooltipDelay = 1000,\n    tooltipText = 'Text copied to clipboard',\n    'aria-label': ariaLabel = 'Copy text',\n  } = props;\n  const errorApi = useApi(errorApiRef);\n  const [open, setOpen] = useState(false);\n  const [{ error }, copyToClipboard] = useCopyToClipboard();\n\n  useEffect(() => {\n    if (error) {\n      errorApi.post(error);\n    }\n  }, [error, errorApi]);\n\n  const handleCopyClick: MouseEventHandler = e => {\n    e.stopPropagation();\n    setOpen(true);\n    copyToClipboard(text);\n  };\n\n  return (\n    <>\n      <Tooltip\n        id=\"copy-test-tooltip\"\n        title={tooltipText}\n        placement=\"top\"\n        leaveDelay={tooltipDelay}\n        onClose={() => setOpen(false)}\n        open={open}\n      >\n        <IconButton onClick={handleCopyClick} aria-label={ariaLabel}>\n          <CopyIcon />\n        </IconButton>\n      </Tooltip>\n    </>\n  );\n}\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React from 'react';\nimport { useTheme } from '@material-ui/core/styles';\nimport { BackstageTheme } from '@backstage/theme';\nimport { CopyTextButton } from '../CopyTextButton';\nimport type {} from 'react-syntax-highlighter';\nimport { default as LightAsync } from 'react-syntax-highlighter/dist/esm/light-async';\nimport dark from 'react-syntax-highlighter/dist/esm/styles/hljs/dark';\nimport docco from 'react-syntax-highlighter/dist/esm/styles/hljs/docco';\n\n/**\n * Properties for {@link CodeSnippet}\n *\n * @public\n */\nexport interface CodeSnippetProps {\n  /**\n   * Code Snippet text\n   */\n  text: string;\n  /**\n   * Language used by {@link CodeSnippetProps.text}\n   */\n  language: string;\n  /**\n   * Whether to show line number\n   *\n   * @remarks\n   *\n   * Default: false\n   */\n  showLineNumbers?: boolean;\n  /**\n   * Whether to show button to copy code snippet\n   *\n   * @remarks\n   *\n   * Default: false\n   */\n  showCopyCodeButton?: boolean;\n  /**\n   * Array of line numbers to highlight\n   */\n  highlightedNumbers?: number[];\n  /**\n   * Custom styles applied to code\n   *\n   * @remarks\n   *\n   * Passed to {@link https://react-syntax-highlighter.github.io/react-syntax-highlighter/ | react-syntax-highlighter}\n   */\n  customStyle?: any;\n}\n\n/**\n * Thin wrapper on top of {@link https://react-syntax-highlighter.github.io/react-syntax-highlighter/ | react-syntax-highlighter}\n * providing consistent theming and copy code button\n *\n * @public\n */\nexport function CodeSnippet(props: CodeSnippetProps) {\n  const {\n    text,\n    language,\n    showLineNumbers = false,\n    highlightedNumbers,\n    customStyle,\n    showCopyCodeButton = false,\n  } = props;\n  const theme = useTheme<BackstageTheme>();\n  const mode = theme.palette.type === 'dark' ? dark : docco;\n  const highlightColor = theme.palette.type === 'dark' ? '#256bf3' : '#e6ffed';\n\n  return (\n    <div style={{ position: 'relative' }}>\n      <LightAsync\n        customStyle={customStyle}\n        language={language}\n        style={mode}\n        showLineNumbers={showLineNumbers}\n        wrapLines\n        lineNumberStyle={{ color: theme.palette.textVerySubtle }}\n        lineProps={(lineNumber: number) =>\n          highlightedNumbers?.includes(lineNumber)\n            ? {\n                style: {\n                  backgroundColor: highlightColor,\n                },\n              }\n            : {}\n        }\n      >\n        {text}\n      </LightAsync>\n      {showCopyCodeButton && (\n        <div style={{ position: 'absolute', top: 0, right: 0 }}>\n          <CopyTextButton text={text} />\n        </div>\n      )}\n    </div>\n  );\n}\n","/*\n * Copyright 2021 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { BackstageTheme } from '@backstage/theme';\nimport Button from '@material-ui/core/Button';\nimport IconButton from '@material-ui/core/IconButton';\nimport useMediaQuery from '@material-ui/core/useMediaQuery';\nimport React from 'react';\nimport { Link as RouterLink, LinkProps } from 'react-router-dom';\nimport AddCircleOutline from '@material-ui/icons/AddCircleOutline';\n\n/**\n * Properties for {@link CreateButton}\n *\n * @public\n */\nexport type CreateButtonProps = {\n  title: string;\n} & Partial<Pick<LinkProps, 'to'>>;\n\n/**\n * Responsive Button giving consistent UX for creation of different things\n *\n * @public\n */\nexport function CreateButton(props: CreateButtonProps) {\n  const { title, to } = props;\n  const isXSScreen = useMediaQuery<BackstageTheme>(theme =>\n    theme.breakpoints.down('xs'),\n  );\n\n  if (!to) {\n    return null;\n  }\n\n  return isXSScreen ? (\n    <IconButton\n      component={RouterLink}\n      color=\"primary\"\n      title={title}\n      size=\"small\"\n      to={to}\n    >\n      <AddCircleOutline />\n    </IconButton>\n  ) : (\n    <Button component={RouterLink} variant=\"contained\" color=\"primary\" to={to}>\n      {title}\n    </Button>\n  );\n}\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/**\n * Types used to customize and provide data to {@link DependencyGraph}\n *\n * @packageDocumentation\n */\n\nimport React from 'react';\n\n/**\n * Edge of {@link DependencyGraph}\n *\n * @public\n */\nexport type DependencyEdge<T = {}> = T & {\n  /**\n   * ID of {@link DependencyNode} from where the Edge start\n   */\n  from: string;\n  /**\n   * ID of {@link DependencyNode} to where the Edge goes to\n   */\n  to: string;\n  /**\n   * Label assigned and rendered with the Edge\n   */\n  label?: string;\n};\n\n/**\n * Properties of {@link DependencyGraphTypes.RenderLabelFunction} for {@link DependencyGraphTypes.DependencyEdge}\n */\nexport type RenderLabelProps<T = unknown> = { edge: DependencyEdge<T> };\n\n/**\n * Custom React component for edge labels\n */\nexport type RenderLabelFunction<T = {}> = (\n  props: RenderLabelProps<T>,\n) => React.ReactNode;\n\n/**\n * Node of {@link DependencyGraph}\n *\n * @public\n */\nexport type DependencyNode<T = {}> = T & {\n  id: string;\n};\n\n/**\n * Properties of {@link DependencyGraphTypes.RenderNodeFunction} for {@link DependencyGraphTypes.DependencyNode}\n */\nexport type RenderNodeProps<T = unknown> = { node: DependencyNode<T> };\n\n/**\n * Custom React component for graph {@link DependencyGraphTypes.DependencyNode}\n */\nexport type RenderNodeFunction<T = {}> = (\n  props: RenderNodeProps<T>,\n) => React.ReactNode;\n\n/**\n * Graph direction\n *\n * @public\n */\nexport enum Direction {\n  /**\n   * Top to Bottom\n   */\n  TOP_BOTTOM = 'TB',\n  /**\n   * Bottom to Top\n   */\n  BOTTOM_TOP = 'BT',\n  /**\n   * Left to Right\n   */\n  LEFT_RIGHT = 'LR',\n  /**\n   * Right to Left\n   */\n  RIGHT_LEFT = 'RL',\n}\n\n/**\n * Node alignment\n *\n * @public\n */\nexport enum Alignment {\n  /**\n   * Up Left\n   */\n  UP_LEFT = 'UL',\n  /**\n   * Up Right\n   */\n  UP_RIGHT = 'UR',\n  /**\n   * Down Left\n   */\n  DOWN_LEFT = 'DL',\n  /**\n   * Down Right\n   */\n  DOWN_RIGHT = 'DR',\n}\n\n/**\n * Algorithm used to rand nodes in graph\n */\nexport enum Ranker {\n  /**\n   * {@link https://en.wikipedia.org/wiki/Network_simplex_algorithm | Network Simplex} algorithm\n   */\n  NETWORK_SIMPLEX = 'network-simplex',\n  /**\n   * Tight Tree algorithm\n   */\n  TIGHT_TREE = 'tight-tree',\n  /**\n   * Longest path algorithm\n   *\n   * @remarks\n   *\n   * Simplest and fastest\n   */\n  LONGEST_PATH = 'longest-path',\n}\n\n/**\n * Position of label in relation to the edge\n *\n * @public\n */\nexport enum LabelPosition {\n  LEFT = 'l',\n  RIGHT = 'r',\n  CENTER = 'c',\n}\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React from 'react';\nimport { makeStyles } from '@material-ui/core/styles';\nimport { BackstageTheme } from '@backstage/theme';\nimport { RenderNodeProps } from './types';\n\n/** @public */\nexport type DependencyGraphDefaultNodeClassKey = 'node' | 'text';\n\nconst useStyles = makeStyles(\n  (theme: BackstageTheme) => ({\n    node: {\n      fill: theme.palette.primary.light,\n      stroke: theme.palette.primary.light,\n    },\n    text: {\n      fill: theme.palette.primary.contrastText,\n    },\n  }),\n  { name: 'BackstageDependencyGraphDefaultNode' },\n);\n\n/** @public */\nexport function DefaultNode({ node: { id } }: RenderNodeProps) {\n  const classes = useStyles();\n  const [width, setWidth] = React.useState(0);\n  const [height, setHeight] = React.useState(0);\n  const idRef = React.useRef<SVGTextElement | null>(null);\n\n  React.useLayoutEffect(() => {\n    // set the width to the length of the ID\n    if (idRef.current) {\n      let { height: renderedHeight, width: renderedWidth } =\n        idRef.current.getBBox();\n      renderedHeight = Math.round(renderedHeight);\n      renderedWidth = Math.round(renderedWidth);\n\n      if (renderedHeight !== height || renderedWidth !== width) {\n        setWidth(renderedWidth);\n        setHeight(renderedHeight);\n      }\n    }\n  }, [width, height]);\n\n  const padding = 10;\n  const paddedWidth = width + padding * 2;\n  const paddedHeight = height + padding * 2;\n\n  return (\n    <g>\n      <rect\n        className={classes.node}\n        width={paddedWidth}\n        height={paddedHeight}\n        rx={10}\n      />\n      <text\n        ref={idRef}\n        className={classes.text}\n        y={paddedHeight / 2}\n        x={paddedWidth / 2}\n        textAnchor=\"middle\"\n        alignmentBaseline=\"middle\"\n      >\n        {id}\n      </text>\n    </g>\n  );\n}\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nexport const ARROW_MARKER_ID = 'arrow-marker';\n\nexport const NODE_TEST_ID = 'node';\nexport const EDGE_TEST_ID = 'edge';\nexport const LABEL_TEST_ID = 'label';\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React from 'react';\nimport makeStyles from '@material-ui/core/styles/makeStyles';\nimport { DefaultNode } from './DefaultNode';\nimport { RenderNodeFunction, RenderNodeProps, DependencyNode } from './types';\nimport { NODE_TEST_ID } from './constants';\nimport dagre from 'dagre';\n\n/** @public */\nexport type DependencyGraphNodeClassKey = 'node';\n\nconst useStyles = makeStyles(\n  theme => ({\n    node: {\n      transition: `${theme.transitions.duration.shortest}ms`,\n    },\n  }),\n  { name: 'BackstageDependencyGraphNode' },\n);\n\nexport type GraphNode<T> = dagre.Node<DependencyNode<T>>;\n\nexport type NodeComponentProps<T> = {\n  node: GraphNode<T>;\n  render?: RenderNodeFunction<T>;\n  setNode: dagre.graphlib.Graph['setNode'];\n};\n\nconst renderDefault = (props: RenderNodeProps) => <DefaultNode {...props} />;\n\nexport function Node<T>({\n  render = renderDefault,\n  setNode,\n  node,\n}: NodeComponentProps<T>) {\n  const { width, height, x = 0, y = 0 } = node;\n  const nodeProps: DependencyNode<T> = node;\n  const classes = useStyles();\n  const nodeRef = React.useRef<SVGGElement | null>(null);\n\n  React.useLayoutEffect(() => {\n    // set the node width to the actual rendered width to properly layout graph\n    if (nodeRef.current) {\n      let { height: renderedHeight, width: renderedWidth } =\n        nodeRef.current.getBBox();\n      renderedHeight = Math.round(renderedHeight);\n      renderedWidth = Math.round(renderedWidth);\n\n      if (renderedHeight !== height || renderedWidth !== width) {\n        setNode(node.id, {\n          ...node,\n          height: renderedHeight,\n          width: renderedWidth,\n        });\n      }\n    }\n  }, [node, width, height, setNode]);\n\n  return (\n    <g\n      ref={nodeRef}\n      data-testid={NODE_TEST_ID}\n      className={classes.node}\n      transform={`translate(${x - width / 2},${y - height / 2})`}\n    >\n      {render({ node: nodeProps })}\n    </g>\n  );\n}\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React from 'react';\nimport makeStyles from '@material-ui/core/styles/makeStyles';\nimport { BackstageTheme } from '@backstage/theme';\nimport { RenderLabelProps } from './types';\n\n/** @public */\nexport type DependencyGraphDefaultLabelClassKey = 'text';\n\nconst useStyles = makeStyles(\n  (theme: BackstageTheme) => ({\n    text: {\n      fill: theme.palette.textContrast,\n    },\n  }),\n  { name: 'BackstageDependencyGraphDefaultLabel' },\n);\n\n/** @public */\nexport function DefaultLabel({ edge: { label } }: RenderLabelProps) {\n  const classes = useStyles();\n  return (\n    <text className={classes.text} textAnchor=\"middle\">\n      {label}\n    </text>\n  );\n}\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React from 'react';\nimport * as d3Shape from 'd3-shape';\nimport isFinite from 'lodash/isFinite';\nimport makeStyles from '@material-ui/core/styles/makeStyles';\nimport { BackstageTheme } from '@backstage/theme';\nimport {\n  RenderLabelProps,\n  RenderLabelFunction,\n  DependencyEdge,\n  LabelPosition,\n} from './types';\nimport { EDGE_TEST_ID, LABEL_TEST_ID } from './constants';\nimport { DefaultLabel } from './DefaultLabel';\nimport dagre from 'dagre';\n\n/* Based on: https://github.com/dagrejs/dagre/wiki#configuring-the-layout  */\nexport type EdgeProperties = {\n  label?: string;\n  width?: number;\n  height?: number;\n  labeloffset?: number;\n  labelpos?: LabelPosition;\n  minlen?: number;\n  weight?: number;\n};\nexport type GraphEdge<T> = DependencyEdge<T> & dagre.GraphEdge & EdgeProperties;\n\n/** @public */\nexport type DependencyGraphEdgeClassKey = 'path' | 'label';\n\nconst useStyles = makeStyles(\n  (theme: BackstageTheme) => ({\n    path: {\n      strokeWidth: 1,\n      stroke: theme.palette.textSubtle,\n      fill: 'none',\n      transition: `${theme.transitions.duration.shortest}ms`,\n    },\n    label: {\n      transition: `${theme.transitions.duration.shortest}ms`,\n    },\n  }),\n  { name: 'BackstageDependencyGraphEdge' },\n);\n\ntype EdgePoint = dagre.GraphEdge['points'][0];\n\n/** @public */\nexport type EdgeComponentProps<T = unknown> = {\n  id: dagre.Edge;\n  edge: GraphEdge<T>;\n  render?: RenderLabelFunction<T>;\n  setEdge: (\n    id: dagre.Edge,\n    edge: DependencyEdge<T>,\n  ) => dagre.graphlib.Graph<{}>;\n  curve: 'curveStepBefore' | 'curveMonotoneX';\n};\n\nconst renderDefault = (props: RenderLabelProps<unknown>) => (\n  <DefaultLabel {...props} />\n);\n\nexport function Edge<EdgeData>({\n  render = renderDefault,\n  setEdge,\n  id,\n  edge,\n  curve,\n}: EdgeComponentProps<EdgeData>) {\n  const { x = 0, y = 0, width, height, points } = edge;\n  const labelProps: DependencyEdge<EdgeData> = edge;\n  const classes = useStyles();\n\n  const labelRef = React.useRef<SVGGElement>(null);\n\n  React.useLayoutEffect(() => {\n    // set the label width to the actual rendered width to properly layout graph\n    if (labelRef.current) {\n      let { height: renderedHeight, width: renderedWidth } =\n        labelRef.current.getBBox();\n      renderedHeight = Math.round(renderedHeight);\n      renderedWidth = Math.round(renderedWidth);\n\n      if (renderedHeight !== height || renderedWidth !== width) {\n        setEdge(id, {\n          ...edge,\n          height: renderedHeight,\n          width: renderedWidth,\n        });\n      }\n    }\n  }, [edge, height, width, setEdge, id]);\n\n  let path: string = '';\n\n  const createPath = React.useMemo(\n    () =>\n      d3Shape\n        .line<EdgePoint>()\n        .x(d => d.x)\n        .y(d => d.y)\n        .curve(d3Shape[curve]),\n    [curve],\n  );\n\n  if (points) {\n    const finitePoints = points.filter(\n      (point: EdgePoint) => isFinite(point.x) && isFinite(point.y),\n    );\n    path = createPath(finitePoints) || '';\n  }\n\n  return (\n    <>\n      {path && (\n        <path data-testid={EDGE_TEST_ID} className={classes.path} d={path} />\n      )}\n      {labelProps.label ? (\n        <g\n          ref={labelRef}\n          data-testid={LABEL_TEST_ID}\n          className={classes.label}\n          transform={`translate(${x},${y})`}\n        >\n          {render({ edge: labelProps })}\n        </g>\n      ) : null}\n    </>\n  );\n}\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React from 'react';\nimport * as d3Zoom from 'd3-zoom';\nimport * as d3Selection from 'd3-selection';\nimport useTheme from '@material-ui/core/styles/useTheme';\nimport dagre from 'dagre';\nimport debounce from 'lodash/debounce';\nimport { BackstageTheme } from '@backstage/theme';\nimport {\n  DependencyEdge,\n  DependencyNode,\n  Direction,\n  Alignment,\n  Ranker,\n  RenderNodeFunction,\n  RenderLabelFunction,\n  LabelPosition,\n} from './types';\nimport { Node } from './Node';\nimport { Edge, GraphEdge } from './Edge';\nimport { ARROW_MARKER_ID } from './constants';\n\n/**\n * Properties of {@link DependencyGraph}\n *\n * @public\n * @remarks\n * `<NodeData>` and `<EdgeData>` are useful when rendering custom or edge labels\n */\nexport interface DependencyGraphProps<NodeData, EdgeData>\n  extends React.SVGProps<SVGSVGElement> {\n  /**\n   * Edges of graph\n   */\n  edges: DependencyEdge<EdgeData>[];\n  /**\n   * Nodes of Graph\n   */\n  nodes: DependencyNode<NodeData>[];\n  /**\n   * Graph {@link DependencyGraphTypes.Direction | direction}\n   *\n   * @remarks\n   *\n   * Default: `DependencyGraphTypes.Direction.TOP_BOTTOM`\n   */\n  direction?: Direction;\n  /**\n   * Node {@link DependencyGraphTypes.Alignment | alignment}\n   */\n  align?: Alignment;\n  /**\n   * Margin between nodes on each rank\n   *\n   * @remarks\n   *\n   * Default: 50\n   */\n  nodeMargin?: number;\n  /**\n   * Margin between edges\n   *\n   * @remarks\n   *\n   * Default: 10\n   */\n  edgeMargin?: number;\n  /**\n   * Margin between each rank\n   *\n   * @remarks\n   *\n   * Default: 50\n   */\n  rankMargin?: number;\n  /**\n   * Margin on left and right of whole graph\n   *\n   * @remarks\n   *\n   * Default: 0\n   */\n  paddingX?: number;\n  /**\n   * Margin on top and bottom of whole graph\n   *\n   * @remarks\n   *\n   * Default: 0\n   */\n  paddingY?: number;\n  /**\n   * Heuristic used to find set of edges that will make graph acyclic\n   */\n  acyclicer?: 'greedy';\n  /**\n   * {@link DependencyGraphTypes.Ranker | Algorithm} used to rank nodes\n   *\n   * @remarks\n   *\n   * Default: `DependencyGraphTypes.Ranker.NETWORK_SIMPLEX`\n   */\n  ranker?: Ranker;\n  /**\n   * {@link DependencyGraphTypes.LabelPosition | Position} of label in relation to edge\n   *\n   * @remarks\n   *\n   * Default: `DependencyGraphTypes.LabelPosition.RIGHT`\n   */\n  labelPosition?: LabelPosition;\n  /**\n   * How much to move label away from edge\n   *\n   * @remarks\n   *\n   * Applies only when {@link DependencyGraphProps.labelPosition} is `DependencyGraphTypes.LabelPosition.LEFT` or\n   * `DependencyGraphTypes.LabelPosition.RIGHT`\n   */\n  labelOffset?: number;\n  /**\n   * Minimum number of ranks to keep between connected nodes\n   */\n  edgeRanks?: number;\n  /**\n   * Weight applied to edges in graph\n   */\n  edgeWeight?: number;\n  /**\n   * Custom node rendering component\n   */\n  renderNode?: RenderNodeFunction<NodeData>;\n  /**\n   * Custom label rendering component\n   */\n  renderLabel?: RenderLabelFunction<EdgeData>;\n  /**\n   * {@link https://developer.mozilla.org/en-US/docs/Web/SVG/Element/defs | Defs} shared by rendered SVG to be used by\n   * {@link DependencyGraphProps.renderNode} and/or {@link DependencyGraphProps.renderLabel}\n   */\n  defs?: SVGDefsElement | SVGDefsElement[];\n  /**\n   * Controls zoom behavior of graph\n   *\n   * @remarks\n   *\n   * Default: `enabled`\n   */\n  zoom?: 'enabled' | 'disabled' | 'enable-on-click';\n  /**\n   * A factory for curve generators addressing both lines and areas.\n   *\n   * @remarks\n   *\n   * Default: 'curveMonotoneX'\n   */\n  curve?: 'curveStepBefore' | 'curveMonotoneX';\n}\n\nconst WORKSPACE_ID = 'workspace';\n\n/**\n * Graph component used to visualize relations between entities\n *\n * @public\n */\nexport function DependencyGraph<NodeData, EdgeData>(\n  props: DependencyGraphProps<NodeData, EdgeData>,\n) {\n  const {\n    edges,\n    nodes,\n    renderNode,\n    direction = Direction.TOP_BOTTOM,\n    align,\n    nodeMargin = 50,\n    edgeMargin = 10,\n    rankMargin = 50,\n    paddingX = 0,\n    paddingY = 0,\n    acyclicer,\n    ranker = Ranker.NETWORK_SIMPLEX,\n    labelPosition = LabelPosition.RIGHT,\n    labelOffset = 10,\n    edgeRanks = 1,\n    edgeWeight = 1,\n    renderLabel,\n    defs,\n    zoom = 'enabled',\n    curve = 'curveMonotoneX',\n    ...svgProps\n  } = props;\n  const theme: BackstageTheme = useTheme();\n  const [containerWidth, setContainerWidth] = React.useState<number>(100);\n  const [containerHeight, setContainerHeight] = React.useState<number>(100);\n\n  const graph = React.useRef<dagre.graphlib.Graph<DependencyNode<NodeData>>>(\n    new dagre.graphlib.Graph(),\n  );\n  const [graphWidth, setGraphWidth] = React.useState<number>(\n    graph.current.graph()?.width || 0,\n  );\n  const [graphHeight, setGraphHeight] = React.useState<number>(\n    graph.current.graph()?.height || 0,\n  );\n  const [graphNodes, setGraphNodes] = React.useState<string[]>([]);\n  const [graphEdges, setGraphEdges] = React.useState<dagre.Edge[]>([]);\n\n  const maxWidth = Math.max(graphWidth, containerWidth);\n  const maxHeight = Math.max(graphHeight, containerHeight);\n\n  const containerRef = React.useMemo(\n    () =>\n      debounce((node: SVGSVGElement) => {\n        if (!node) {\n          return;\n        }\n        // Set up zooming + panning\n        const container = d3Selection.select<SVGSVGElement, null>(node);\n        const workspace = d3Selection.select(node.getElementById(WORKSPACE_ID));\n\n        function enableZoom() {\n          container.call(\n            d3Zoom\n              .zoom<SVGSVGElement, null>()\n              .scaleExtent([1, 10])\n              .on('zoom', event => {\n                event.transform.x = Math.min(\n                  0,\n                  Math.max(\n                    event.transform.x,\n                    maxWidth - maxWidth * event.transform.k,\n                  ),\n                );\n                event.transform.y = Math.min(\n                  0,\n                  Math.max(\n                    event.transform.y,\n                    maxHeight - maxHeight * event.transform.k,\n                  ),\n                );\n                workspace.attr('transform', event.transform);\n              }),\n          );\n        }\n\n        if (zoom === 'enabled') {\n          enableZoom();\n        } else if (zoom === 'enable-on-click') {\n          container.on('click', () => enableZoom());\n        }\n\n        const { width: newContainerWidth, height: newContainerHeight } =\n          node.getBoundingClientRect();\n        if (containerWidth !== newContainerWidth) {\n          setContainerWidth(newContainerWidth);\n        }\n        if (containerHeight !== newContainerHeight) {\n          setContainerHeight(newContainerHeight);\n        }\n      }, 100),\n    [containerHeight, containerWidth, maxWidth, maxHeight, zoom],\n  );\n\n  const setNodesAndEdges = React.useCallback(() => {\n    // Cleaning up lingering nodes and edges\n    const currentGraphNodes = graph.current.nodes();\n    const currentGraphEdges = graph.current.edges();\n\n    currentGraphNodes.forEach(nodeId => {\n      const remainingNode = nodes.some(node => node.id === nodeId);\n      if (!remainingNode) {\n        graph.current.removeNode(nodeId);\n      }\n    });\n\n    currentGraphEdges.forEach(e => {\n      const remainingEdge = edges.some(\n        edge => edge.from === e.v && edge.to === e.w,\n      );\n      if (!remainingEdge) {\n        graph.current.removeEdge(e.v, e.w);\n      }\n    });\n\n    // Adding/updating nodes and edges\n    nodes.forEach(node => {\n      const existingNode = graph.current\n        .nodes()\n        .find(nodeId => node.id === nodeId);\n\n      if (existingNode && graph.current.node(existingNode)) {\n        const { width, height, x, y } = graph.current.node(existingNode);\n        graph.current.setNode(existingNode, { ...node, width, height, x, y });\n      } else {\n        graph.current.setNode(node.id, { ...node, width: 0, height: 0 });\n      }\n    });\n\n    edges.forEach(e => {\n      graph.current.setEdge(e.from, e.to, {\n        ...e,\n        label: e.label,\n        width: 0,\n        height: 0,\n        labelpos: labelPosition,\n        labeloffset: labelOffset,\n        weight: edgeWeight,\n        minlen: edgeRanks,\n      });\n    });\n  }, [edges, nodes, labelPosition, labelOffset, edgeWeight, edgeRanks]);\n\n  const updateGraph = React.useMemo(\n    () =>\n      debounce(\n        () => {\n          dagre.layout(graph.current);\n          const { height, width } = graph.current.graph();\n          const newHeight = Math.max(0, height || 0);\n          const newWidth = Math.max(0, width || 0);\n          setGraphWidth(newWidth);\n          setGraphHeight(newHeight);\n\n          setGraphNodes(graph.current.nodes());\n          setGraphEdges(graph.current.edges());\n        },\n        250,\n        { leading: true },\n      ),\n    [],\n  );\n\n  React.useEffect(() => {\n    graph.current.setGraph({\n      rankdir: direction,\n      align,\n      nodesep: nodeMargin,\n      edgesep: edgeMargin,\n      ranksep: rankMargin,\n      marginx: paddingX,\n      marginy: paddingY,\n      acyclicer,\n      ranker,\n    });\n\n    setNodesAndEdges();\n    updateGraph();\n\n    return updateGraph.cancel;\n  }, [\n    acyclicer,\n    align,\n    direction,\n    edgeMargin,\n    paddingX,\n    paddingY,\n    nodeMargin,\n    rankMargin,\n    ranker,\n    setNodesAndEdges,\n    updateGraph,\n  ]);\n\n  function setNode(id: string, node: DependencyNode<NodeData>) {\n    graph.current.setNode(id, node);\n    updateGraph();\n    return graph.current;\n  }\n\n  function setEdge(id: dagre.Edge, edge: DependencyEdge<EdgeData>) {\n    graph.current.setEdge(id, edge);\n    updateGraph();\n    return graph.current;\n  }\n\n  return (\n    <svg\n      ref={containerRef}\n      {...svgProps}\n      width=\"100%\"\n      height={maxHeight}\n      viewBox={`0 0 ${maxWidth} ${maxHeight}`}\n    >\n      <defs>\n        <marker\n          id={ARROW_MARKER_ID}\n          viewBox=\"0 0 24 24\"\n          markerWidth=\"14\"\n          markerHeight=\"14\"\n          refX=\"16\"\n          refY=\"12\"\n          orient=\"auto\"\n          markerUnits=\"strokeWidth\"\n        >\n          <path\n            fill={theme.palette.textSubtle}\n            d=\"M8.59 16.59L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.41z\"\n          />\n        </marker>\n        {defs}\n      </defs>\n      <g id={WORKSPACE_ID}>\n        <svg\n          width={graphWidth}\n          height={graphHeight}\n          y={maxHeight / 2 - graphHeight / 2}\n          x={maxWidth / 2 - graphWidth / 2}\n          viewBox={`0 0 ${graphWidth} ${graphHeight}`}\n        >\n          {graphEdges.map(e => {\n            const edge = graph.current.edge(e) as GraphEdge<EdgeData>;\n            if (!edge) return null;\n            return (\n              <Edge\n                key={`${e.v}-${e.w}`}\n                id={e}\n                setEdge={setEdge}\n                render={renderLabel}\n                edge={edge}\n                curve={curve}\n              />\n            );\n          })}\n          {graphNodes.map((id: string) => {\n            const node = graph.current.node(id);\n            if (!node) return null;\n            return (\n              <Node\n                key={id}\n                setNode={setNode}\n                render={renderNode}\n                node={node}\n              />\n            );\n          })}\n        </svg>\n      </g>\n    </svg>\n  );\n}\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React, { ReactNode, useState, useEffect } from 'react';\nimport { useApi, storageApiRef } from '@backstage/core-plugin-api';\nimport useObservable from 'react-use/lib/useObservable';\nimport classNames from 'classnames';\nimport { makeStyles } from '@material-ui/core/styles';\nimport { BackstageTheme } from '@backstage/theme';\nimport Snackbar from '@material-ui/core/Snackbar';\nimport SnackbarContent from '@material-ui/core/SnackbarContent';\nimport IconButton from '@material-ui/core/IconButton';\nimport Close from '@material-ui/icons/Close';\n\n/** @public */\nexport type DismissableBannerClassKey =\n  | 'root'\n  | 'topPosition'\n  | 'icon'\n  | 'content'\n  | 'message'\n  | 'info'\n  | 'error';\n\n/**\n * @public\n * @deprecated This type contained a typo, please use DismissableBannerClassKey instead\n */\nexport type DismissbleBannerClassKey = DismissableBannerClassKey;\n\nconst useStyles = makeStyles(\n  (theme: BackstageTheme) => ({\n    root: {\n      padding: theme.spacing(0),\n      marginBottom: theme.spacing(0),\n      marginTop: theme.spacing(0),\n      display: 'flex',\n      flexFlow: 'row nowrap',\n    },\n    // showing on top\n    topPosition: {\n      position: 'relative',\n      marginBottom: theme.spacing(6),\n      marginTop: -theme.spacing(3),\n      zIndex: 'unset',\n    },\n    icon: {\n      fontSize: 20,\n    },\n    content: {\n      width: '100%',\n      maxWidth: 'inherit',\n      flexWrap: 'nowrap',\n    },\n    message: {\n      display: 'flex',\n      alignItems: 'center',\n      color: theme.palette.banner.text,\n      '& a': {\n        color: theme.palette.banner.link,\n      },\n    },\n    info: {\n      backgroundColor: theme.palette.banner.info,\n    },\n    error: {\n      backgroundColor: theme.palette.banner.error,\n    },\n    warning: {\n      backgroundColor:\n        theme.palette.banner.warning ?? theme.palette.banner.error,\n    },\n  }),\n  { name: 'BackstageDismissableBanner' },\n);\n\nexport type Props = {\n  variant: 'info' | 'error' | 'warning';\n  message: ReactNode;\n  id: string;\n  fixed?: boolean;\n};\n\n/** @public */\nexport const DismissableBanner = (props: Props) => {\n  const { variant, message, id, fixed = false } = props;\n  const classes = useStyles();\n  const storageApi = useApi(storageApiRef);\n  const notificationsStore = storageApi.forBucket('notifications');\n  const rawDismissedBanners =\n    notificationsStore.snapshot<string[]>('dismissedBanners').value ?? [];\n\n  const [dismissedBanners, setDismissedBanners] = useState(\n    new Set(rawDismissedBanners),\n  );\n\n  const observedItems = useObservable(\n    notificationsStore.observe$<string[]>('dismissedBanners'),\n  );\n\n  useEffect(() => {\n    if (observedItems?.value) {\n      const currentValue = observedItems?.value ?? [];\n      setDismissedBanners(new Set(currentValue));\n    }\n  }, [observedItems?.value]);\n\n  const handleClick = () => {\n    notificationsStore.set('dismissedBanners', [...dismissedBanners, id]);\n  };\n\n  return (\n    <Snackbar\n      anchorOrigin={\n        fixed\n          ? { vertical: 'bottom', horizontal: 'center' }\n          : { vertical: 'top', horizontal: 'center' }\n      }\n      open={!dismissedBanners.has(id)}\n      classes={{\n        root: classNames(classes.root, !fixed && classes.topPosition),\n      }}\n    >\n      <SnackbarContent\n        classes={{\n          root: classNames(classes.content, classes[variant]),\n          message: classes.message,\n        }}\n        message={message}\n        action={[\n          <IconButton\n            key=\"dismiss\"\n            title=\"Permanently dismiss this message\"\n            color=\"inherit\"\n            onClick={handleClick}\n          >\n            <Close className={classes.icon} />\n          </IconButton>,\n        ]}\n      />\n    </Snackbar>\n  );\n};\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React from 'react';\nimport missingAnnotation from './assets/missingAnnotation.svg';\nimport noInformation from './assets/noInformation.svg';\nimport createComponent from './assets/createComponent.svg';\nimport noBuild from './assets/noBuild.svg';\nimport { makeStyles } from '@material-ui/core/styles';\n\ntype Props = {\n  missing: 'field' | 'info' | 'content' | 'data';\n};\n\n/** @public */\nexport type EmptyStateImageClassKey = 'generalImg';\n\nconst useStyles = makeStyles(\n  {\n    generalImg: {\n      width: '95%',\n      zIndex: 2,\n      position: 'relative',\n      left: '50%',\n      top: '50%',\n      transform: 'translate(-50%, 15%)',\n    },\n  },\n  { name: 'BackstageEmptyStateImage' },\n);\n\n/** @public */\nexport const EmptyStateImage = ({ missing }: Props) => {\n  const classes = useStyles();\n  switch (missing) {\n    case 'field':\n      return (\n        <img\n          src={missingAnnotation}\n          className={classes.generalImg}\n          alt=\"annotation is missing\"\n        />\n      );\n    case 'info':\n      return (\n        <img\n          src={noInformation}\n          alt=\"no Information\"\n          className={classes.generalImg}\n        />\n      );\n    case 'content':\n      return (\n        <img\n          src={createComponent}\n          alt=\"create Component\"\n          className={classes.generalImg}\n        />\n      );\n    case 'data':\n      return (\n        <img src={noBuild} alt=\"no Build\" className={classes.generalImg} />\n      );\n    default:\n      return null;\n  }\n};\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport Grid from '@material-ui/core/Grid';\nimport { makeStyles } from '@material-ui/core/styles';\nimport Typography from '@material-ui/core/Typography';\nimport React from 'react';\nimport { EmptyStateImage } from './EmptyStateImage';\n\n/** @public */\nexport type EmptyStateClassKey = 'root' | 'action' | 'imageContainer';\n\nconst useStyles = makeStyles(\n  theme => ({\n    root: {\n      backgroundColor: theme.palette.background.default,\n      padding: theme.spacing(2, 0, 0, 0),\n    },\n    action: {\n      marginTop: theme.spacing(2),\n    },\n    imageContainer: {\n      position: 'relative',\n    },\n  }),\n  { name: 'BackstageEmptyState' },\n);\n\ntype Props = {\n  title: string;\n  description?: string | JSX.Element;\n  missing: 'field' | 'info' | 'content' | 'data' | { customImage: JSX.Element };\n  action?: JSX.Element;\n};\n\n/**\n * Various placeholder views for empty state pages\n *\n * @public\n *\n */\nexport function EmptyState(props: Props) {\n  const { title, description, missing, action } = props;\n  const classes = useStyles();\n  return (\n    <Grid\n      container\n      direction=\"row\"\n      justifyContent=\"space-around\"\n      alignItems=\"flex-start\"\n      className={classes.root}\n      spacing={2}\n    >\n      <Grid item xs={12} md={6}>\n        <Grid container direction=\"column\">\n          <Grid item xs>\n            <Typography variant=\"h5\">{title}</Typography>\n          </Grid>\n          <Grid item xs>\n            <Typography variant=\"body1\">{description}</Typography>\n          </Grid>\n          <Grid item xs className={classes.action}>\n            {action}\n          </Grid>\n        </Grid>\n      </Grid>\n      <Grid item xs={12} md={6} className={classes.imageContainer}>\n        {typeof missing === 'string' ? (\n          <EmptyStateImage missing={missing} />\n        ) : (\n          missing.customImage\n        )}\n      </Grid>\n    </Grid>\n  );\n}\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React from 'react';\nimport { makeStyles } from '@material-ui/core/styles';\nimport Button from '@material-ui/core/Button';\nimport Typography from '@material-ui/core/Typography';\nimport { BackstageTheme } from '@backstage/theme';\nimport { Link } from '../Link';\nimport { EmptyState } from './EmptyState';\nimport { CodeSnippet } from '../CodeSnippet';\n\nconst COMPONENT_YAML = `apiVersion: backstage.io/v1alpha1\nkind: Component\nmetadata:\n  name: example\n  description: example.com\n  annotations:\n    ANNOTATION: value\nspec:\n  type: website\n  lifecycle: production\n  owner: user:guest`;\n\ntype Props = {\n  annotation: string;\n  readMoreUrl?: string;\n};\n\nexport type MissingAnnotationEmptyStateClassKey = 'code';\n\nconst useStyles = makeStyles<BackstageTheme>(\n  theme => ({\n    code: {\n      borderRadius: 6,\n      margin: `${theme.spacing(2)}px 0px`,\n      background: theme.palette.type === 'dark' ? '#444' : '#fff',\n    },\n  }),\n  { name: 'BackstageMissingAnnotationEmptyState' },\n);\n\nexport function MissingAnnotationEmptyState(props: Props) {\n  const { annotation, readMoreUrl } = props;\n  const url =\n    readMoreUrl ||\n    'https://backstage.io/docs/features/software-catalog/well-known-annotations';\n  const classes = useStyles();\n  const description = (\n    <>\n      The <code>{annotation}</code> annotation is missing. You need to add the\n      annotation to your component if you want to enable this tool.\n    </>\n  );\n  return (\n    <EmptyState\n      missing=\"field\"\n      title=\"Missing Annotation\"\n      description={description}\n      action={\n        <>\n          <Typography variant=\"body1\">\n            Add the annotation to your component YAML as shown in the\n            highlighted example below:\n          </Typography>\n          <div className={classes.code}>\n            <CodeSnippet\n              text={COMPONENT_YAML.replace('ANNOTATION', annotation)}\n              language=\"yaml\"\n              showLineNumbers\n              highlightedNumbers={[6, 7]}\n              customStyle={{ background: 'inherit', fontSize: '115%' }}\n            />\n          </div>\n          <Button color=\"primary\" component={Link} to={url}>\n            Read more\n          </Button>\n        </>\n      }\n    />\n  );\n}\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport { BackstageTheme } from '@backstage/theme';\nimport { makeStyles, darken, lighten } from '@material-ui/core/styles';\nimport Accordion from '@material-ui/core/Accordion';\nimport AccordionSummary from '@material-ui/core/AccordionSummary';\nimport AccordionDetails from '@material-ui/core/AccordionDetails';\nimport Grid from '@material-ui/core/Grid';\nimport Typography from '@material-ui/core/Typography';\nimport ErrorOutline from '@material-ui/icons/ErrorOutline';\nimport ExpandMoreIcon from '@material-ui/icons/ExpandMore';\nimport React from 'react';\n\nconst getWarningTextColor = (\n  severity: NonNullable<WarningProps['severity']>,\n  theme: BackstageTheme,\n) => {\n  const getColor = theme.palette.type === 'light' ? darken : lighten;\n  return getColor(theme.palette[severity].light, 0.6);\n};\n\nconst getWarningBackgroundColor = (\n  severity: NonNullable<WarningProps['severity']>,\n  theme: BackstageTheme,\n) => {\n  const getBackgroundColor = theme.palette.type === 'light' ? lighten : darken;\n  return getBackgroundColor(theme.palette[severity].light, 0.9);\n};\n\nconst useErrorOutlineStyles = makeStyles<BackstageTheme>(theme => ({\n  root: {\n    marginRight: theme.spacing(1),\n    fill: ({ severity }: WarningProps) =>\n      getWarningTextColor(\n        severity as NonNullable<WarningProps['severity']>,\n        theme,\n      ),\n  },\n}));\n\nconst ErrorOutlineStyled = ({ severity }: Pick<WarningProps, 'severity'>) => {\n  const classes = useErrorOutlineStyles({ severity });\n  return <ErrorOutline classes={classes} />;\n};\nconst ExpandMoreIconStyled = ({ severity }: Pick<WarningProps, 'severity'>) => {\n  const classes = useErrorOutlineStyles({ severity });\n  return <ExpandMoreIcon classes={classes} />;\n};\n\nexport type WarningPanelClassKey =\n  | 'panel'\n  | 'summary'\n  | 'summaryText'\n  | 'message'\n  | 'details';\n\nconst useStyles = makeStyles<BackstageTheme>(\n  theme => ({\n    panel: {\n      backgroundColor: ({ severity }: WarningProps) =>\n        getWarningBackgroundColor(\n          severity as NonNullable<WarningProps['severity']>,\n          theme,\n        ),\n      color: ({ severity }: WarningProps) =>\n        getWarningTextColor(\n          severity as NonNullable<WarningProps['severity']>,\n          theme,\n        ),\n      verticalAlign: 'middle',\n    },\n    summary: {\n      display: 'flex',\n      flexDirection: 'row',\n    },\n    summaryText: {\n      color: ({ severity }: WarningProps) =>\n        getWarningTextColor(\n          severity as NonNullable<WarningProps['severity']>,\n          theme,\n        ),\n      fontWeight: 'bold',\n    },\n    message: {\n      width: '100%',\n      display: 'block',\n      color: ({ severity }: WarningProps) =>\n        getWarningTextColor(\n          severity as NonNullable<WarningProps['severity']>,\n          theme,\n        ),\n      backgroundColor: ({ severity }: WarningProps) =>\n        getWarningBackgroundColor(\n          severity as NonNullable<WarningProps['severity']>,\n          theme,\n        ),\n    },\n    details: {\n      width: '100%',\n      display: 'block',\n      color: theme.palette.textContrast,\n      backgroundColor: theme.palette.background.default,\n      border: `1px solid ${theme.palette.border}`,\n      padding: theme.spacing(2.0),\n      fontFamily: 'sans-serif',\n    },\n  }),\n  { name: 'BackstageWarningPanel' },\n);\n\nexport type WarningProps = {\n  title?: string;\n  severity?: 'warning' | 'error' | 'info';\n  message?: React.ReactNode;\n  defaultExpanded?: boolean;\n  children?: React.ReactNode;\n};\n\nconst capitalize = (s: string) => {\n  return s.charAt(0).toLocaleUpperCase('en-US') + s.slice(1);\n};\n\n/**\n * Show a user friendly error message to a user similar to\n * ErrorPanel except that the warning panel only shows the warning message to\n * the user.\n *\n * @param severity - Ability to change the severity of the alert. Default value\n *        \"warning\"\n * @param title - A title for the warning. If not supplied, \"Warning\" will be\n *        used.\n * @param message - Optional more detailed user-friendly message elaborating on\n *        the cause of the error.\n * @param children - Objects to provide context, such as a stack trace or detailed\n *        error reporting. Will be available inside an unfolded accordion.\n */\nexport function WarningPanel(props: WarningProps) {\n  const {\n    severity = 'warning',\n    title,\n    message,\n    children,\n    defaultExpanded,\n  } = props;\n  const classes = useStyles({ severity });\n\n  // If no severity or title provided, the heading will read simply \"Warning\"\n  const subTitle = capitalize(severity) + (title ? `: ${title}` : '');\n\n  return (\n    <Accordion\n      defaultExpanded={defaultExpanded ?? false}\n      className={classes.panel}\n      role=\"alert\"\n    >\n      <AccordionSummary\n        expandIcon={<ExpandMoreIconStyled severity={severity} />}\n        className={classes.summary}\n      >\n        <ErrorOutlineStyled severity={severity} />\n        <Typography className={classes.summaryText} variant=\"subtitle1\">\n          {subTitle}\n        </Typography>\n      </AccordionSummary>\n      {(message || children) && (\n        <AccordionDetails>\n          <Grid container>\n            {message && (\n              <Grid item xs={12}>\n                <Typography className={classes.message} variant=\"body1\">\n                  {message}\n                </Typography>\n              </Grid>\n            )}\n            {children && (\n              <Grid item xs={12} className={classes.details}>\n                {children}\n              </Grid>\n            )}\n          </Grid>\n        </AccordionDetails>\n      )}\n    </Accordion>\n  );\n}\n","/*\n * Copyright 2021 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { makeStyles } from '@material-ui/core/styles';\nimport List from '@material-ui/core/List';\nimport ListItem from '@material-ui/core/ListItem';\nimport ListItemText from '@material-ui/core/ListItemText';\nimport React, { PropsWithChildren } from 'react';\nimport { CopyTextButton } from '../CopyTextButton';\nimport { WarningPanel } from '../WarningPanel';\n\n/** @public */\nexport type ErrorPanelClassKey = 'text' | 'divider';\n\nconst useStyles = makeStyles(\n  theme => ({\n    text: {\n      fontFamily: 'monospace',\n      whiteSpace: 'pre',\n      overflowX: 'auto',\n      marginRight: theme.spacing(2),\n    },\n    divider: {\n      margin: theme.spacing(2),\n    },\n  }),\n  { name: 'BackstageErrorPanel' },\n);\n\ntype ErrorListProps = {\n  error: string;\n  message: string;\n  request?: string;\n  stack?: string;\n  json?: string;\n};\n\nconst ErrorList = ({\n  error,\n  message,\n  stack,\n  children,\n}: PropsWithChildren<ErrorListProps>) => {\n  const classes = useStyles();\n\n  return (\n    <List dense>\n      <ListItem alignItems=\"flex-start\">\n        <ListItemText\n          classes={{ secondary: classes.text }}\n          primary=\"Error\"\n          secondary={error}\n        />\n        <CopyTextButton text={error} />\n      </ListItem>\n\n      <ListItem alignItems=\"flex-start\">\n        <ListItemText\n          classes={{ secondary: classes.text }}\n          primary=\"Message\"\n          secondary={message}\n        />\n        <CopyTextButton text={message} />\n      </ListItem>\n\n      {stack && (\n        <ListItem alignItems=\"flex-start\">\n          <ListItemText\n            classes={{ secondary: classes.text }}\n            primary=\"Stack Trace\"\n            secondary={stack}\n          />\n          <CopyTextButton text={stack} />\n        </ListItem>\n      )}\n\n      {children}\n    </List>\n  );\n};\n\n/** @public */\nexport type ErrorPanelProps = {\n  error: Error;\n  defaultExpanded?: boolean;\n  title?: string;\n};\n\n/**\n * Renders a warning panel as the effect of an error.\n *\n * @public\n */\nexport function ErrorPanel(props: PropsWithChildren<ErrorPanelProps>) {\n  const { title, error, defaultExpanded, children } = props;\n  return (\n    <WarningPanel\n      severity=\"error\"\n      title={title ?? error.message}\n      defaultExpanded={defaultExpanded}\n    >\n      <ErrorList\n        error={error.name}\n        message={error.message}\n        stack={error.stack}\n        children={children}\n      />\n    </WarningPanel>\n  );\n}\n","/*\n * Copyright 2021 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { ResponseError } from '@backstage/errors';\nimport { makeStyles } from '@material-ui/core/styles';\nimport Divider from '@material-ui/core/Divider';\nimport ListItem from '@material-ui/core/ListItem';\nimport ListItemText from '@material-ui/core/ListItemText';\nimport React from 'react';\nimport { CodeSnippet } from '../CodeSnippet';\nimport { CopyTextButton } from '../CopyTextButton';\nimport { ErrorPanel, ErrorPanelProps } from '../ErrorPanel';\n\nexport type ResponseErrorPanelClassKey = 'text' | 'divider';\n\nconst useStyles = makeStyles(\n  theme => ({\n    text: {\n      fontFamily: 'monospace',\n      whiteSpace: 'pre',\n      overflowX: 'auto',\n      marginRight: theme.spacing(2),\n    },\n    divider: {\n      margin: theme.spacing(2),\n    },\n  }),\n  { name: 'BackstageResponseErrorPanel' },\n);\n\n/**\n * Renders a warning panel as the effect of a failed server request.\n *\n * @remarks\n * Has special treatment for ResponseError errors, to display rich\n * server-provided information about what happened.\n */\nexport function ResponseErrorPanel(props: ErrorPanelProps) {\n  const { title, error, defaultExpanded } = props;\n  const classes = useStyles();\n\n  if (error.name !== 'ResponseError') {\n    return (\n      <ErrorPanel\n        title={title ?? error.message}\n        defaultExpanded={defaultExpanded}\n        error={error}\n      />\n    );\n  }\n\n  const { body, cause } = error as ResponseError;\n  const { request, response } = body;\n\n  const errorString = `${response.statusCode}: ${cause.name}`;\n  const requestString = request && `${request.method} ${request.url}`;\n  const messageString = cause.message.replace(/\\\\n/g, '\\n');\n  const stackString = cause.stack?.replace(/\\\\n/g, '\\n');\n  const jsonString = JSON.stringify(body, undefined, 2);\n\n  return (\n    <ErrorPanel\n      title={title ?? error.message}\n      defaultExpanded={defaultExpanded}\n      error={{ name: errorString, message: messageString, stack: stackString }}\n    >\n      {requestString && (\n        <ListItem alignItems=\"flex-start\">\n          <ListItemText\n            classes={{ secondary: classes.text }}\n            primary=\"Request\"\n            secondary={request ? `${requestString}` : undefined}\n          />\n          <CopyTextButton text={requestString} />\n        </ListItem>\n      )}\n      <>\n        <Divider component=\"li\" className={classes.divider} />\n        <ListItem alignItems=\"flex-start\">\n          <ListItemText\n            classes={{ secondary: classes.text }}\n            primary=\"Full Error as JSON\"\n          />\n        </ListItem>\n        <CodeSnippet language=\"json\" text={jsonString} showCopyCodeButton />\n      </>\n    </ErrorPanel>\n  );\n}\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport { useRef, useEffect } from 'react';\n\n/**\n * Creates DOM element to be used as React root.\n */\nfunction createRootElement(id: string): Element {\n  const rootContainer = document.createElement('div');\n  rootContainer.setAttribute('id', id);\n  return rootContainer;\n}\n\n/**\n * Appends element as last child of body.\n */\nfunction addRootElement(rootElem: Element): void {\n  document.body.insertBefore(\n    rootElem,\n    document.body.lastElementChild!.nextElementSibling,\n  );\n}\n\n/**\n * Hook to create a React Portal.\n *\n * Automatically handles creating and tearing-down the root elements (no SRR\n * makes this trivial), so there is no need to ensure the parent target already\n * exists.\n *\n * @example\n * const target = usePortal(id, [id]);\n * return createPortal(children, target);\n *\n * @param id - The id of the target container, e.g 'modal' or 'spotlight'\n * @returns The DOM node to use as the Portal target.\n */\nexport function usePortal(id: string): HTMLElement {\n  const rootElemRef = useRef<HTMLElement | null>(null);\n\n  useEffect(\n    function setupElement() {\n      // Look for existing target dom element to append to\n      const existingParent = document.querySelector(`#${id}`);\n      // Parent is either a new root or the existing dom element\n      const parentElem = existingParent || createRootElement(id);\n\n      // If there is no existing DOM element, add a new one.\n      if (!existingParent) {\n        addRootElement(parentElem);\n      }\n\n      // Add the detached element to the parent\n      parentElem.appendChild(rootElemRef.current!);\n\n      return function removeElement() {\n        rootElemRef.current!.remove();\n        if (parentElem.childNodes.length === -1) {\n          parentElem.remove();\n        }\n      };\n    },\n    [id],\n  );\n\n  /**\n   * It's important we evaluate this lazily:\n   * - We need first render to contain the DOM element, so it shouldn't happen\n   *   in useEffect. We would normally put this in the constructor().\n   * - We can't do 'const rootElemRef = useRef(document.createElement('div))',\n   *   since this will run every single render (that's a lot).\n   * - We want the ref to consistently point to the same DOM element and only\n   *   ever run once.\n   * @link https://reactjs.org/docs/hooks-faq.html#how-to-create-expensive-objects-lazily\n   */\n  function getRootElem() {\n    if (!rootElemRef.current) {\n      rootElemRef.current = document.createElement('div');\n    }\n    return rootElemRef.current;\n  }\n\n  return getRootElem();\n}\n\nexport default usePortal;\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { useCallback, useState } from 'react';\n\nconst STATES_LOCAL_STORAGE_KEY = 'core.calloutSeen';\n\nfunction useCalloutStates(): {\n  states: Record<string, boolean>;\n  setState: (key: string, value: boolean) => void;\n} {\n  const [states, setStates] = useState<Record<string, boolean>>(() => {\n    const raw = localStorage.getItem(STATES_LOCAL_STORAGE_KEY);\n    return raw ? JSON.parse(raw) : {};\n  });\n\n  const setState = useCallback((key: string, value: boolean) => {\n    const raw = localStorage.getItem(STATES_LOCAL_STORAGE_KEY);\n    const oldStates = raw ? JSON.parse(raw) : {};\n    const newStates = { ...oldStates, [key]: value };\n    setStates(newStates);\n    localStorage.setItem(STATES_LOCAL_STORAGE_KEY, JSON.stringify(newStates));\n  }, []);\n\n  return { states, setState };\n}\n\nfunction useCalloutHasBeenSeen(featureId: string): {\n  seen: boolean | undefined;\n  markSeen: () => void;\n} {\n  const { states, setState } = useCalloutStates();\n\n  const markSeen = useCallback(() => {\n    setState(featureId, true);\n  }, [setState, featureId]);\n\n  return { seen: states[featureId] === true, markSeen };\n}\n\nexport function useShowCallout(featureId: string): {\n  show: boolean;\n  hide: () => void;\n} {\n  const { seen, markSeen } = useCalloutHasBeenSeen(featureId);\n  return { show: seen === false, hide: markSeen };\n}\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport ClickAwayListener from '@material-ui/core/ClickAwayListener';\nimport { makeStyles } from '@material-ui/core/styles';\nimport Typography from '@material-ui/core/Typography';\nimport React, {\n  PropsWithChildren,\n  useCallback,\n  useEffect,\n  useLayoutEffect,\n  useRef,\n  useState,\n} from 'react';\nimport { createPortal } from 'react-dom';\nimport { usePortal } from './lib/usePortal';\nimport { useShowCallout } from './lib/useShowCallout';\n\n/** @public */\nexport type FeatureCalloutCircleClassKey =\n  | '@keyframes pulsateSlightly'\n  | '@keyframes pulsateAndFade'\n  | 'featureWrapper'\n  | 'backdrop'\n  | 'dot'\n  | 'pulseCircle'\n  | 'text';\n\nconst useStyles = makeStyles(\n  {\n    '@keyframes pulsateSlightly': {\n      '0%': { transform: 'scale(1.0)' },\n      '100%': { transform: 'scale(1.1)' },\n    },\n    '@keyframes pulsateAndFade': {\n      '0%': { transform: 'scale(1.0)', opacity: 0.9 },\n      '100%': { transform: 'scale(1.5)', opacity: 0 },\n    },\n    featureWrapper: {\n      position: 'relative',\n    },\n    backdrop: {\n      zIndex: 2000,\n      position: 'fixed',\n      overflow: 'hidden',\n      left: 0,\n      right: 0,\n      top: 0,\n      bottom: 0,\n    },\n    dot: {\n      position: 'absolute',\n      backgroundColor: 'transparent',\n      borderRadius: '100%',\n      border: '1px solid rgba(103, 146, 180, 0.98)',\n      boxShadow: '0px 0px 0px 20000px rgba(0, 0, 0, 0.5)',\n      zIndex: 2001,\n      transformOrigin: 'center center',\n      animation:\n        '$pulsateSlightly 1744ms 1.2s cubic-bezier(0.4, 0, 0.2, 1) alternate infinite',\n    },\n    pulseCircle: {\n      width: '100%',\n      height: '100%',\n      backgroundColor: 'transparent',\n      borderRadius: '100%',\n      border: '2px solid white',\n      zIndex: 2001,\n      transformOrigin: 'center center',\n      animation:\n        '$pulsateAndFade 872ms 1.2s cubic-bezier(0.4, 0, 0.2, 1) infinite',\n    },\n    text: {\n      position: 'absolute',\n      color: 'white',\n      zIndex: 2003,\n    },\n  },\n  { name: 'BackstageFeatureCalloutCircular' },\n);\n\nexport type Props = {\n  featureId: string;\n  title: string;\n  description: string;\n};\n\ntype Placement = {\n  dotLeft: number;\n  dotTop: number;\n  dotSize: number;\n  borderWidth: number;\n  textLeft: number;\n  textTop: number;\n  textWidth: number;\n};\n\n/**\n * One-time, round 'telescope' animation showing new feature.\n *\n * @public\n *\n */\nexport function FeatureCalloutCircular(props: PropsWithChildren<Props>) {\n  const { featureId, title, description, children } = props;\n  const { show, hide } = useShowCallout(featureId);\n  const portalElement = usePortal('core.callout');\n  const wrapperRef = useRef<HTMLDivElement>(null);\n  const [placement, setPlacement] = useState<Placement | undefined>();\n  const classes = useStyles();\n\n  const update = useCallback(() => {\n    if (wrapperRef.current) {\n      const wrapperBounds = wrapperRef.current.getBoundingClientRect();\n      const longest = Math.max(wrapperBounds.width, wrapperBounds.height);\n\n      const borderWidth = 800;\n      const dotLeft =\n        wrapperBounds.x - (longest - wrapperBounds.width) / 2 - borderWidth;\n      const dotTop =\n        wrapperBounds.y - (longest - wrapperBounds.height) / 2 - borderWidth;\n      const dotSize = longest + 2 * borderWidth;\n\n      const textWidth = 450;\n      const textLeft = wrapperBounds.x + wrapperBounds.width / 2 - textWidth;\n      const textTop =\n        wrapperBounds.y - (longest - wrapperBounds.height) / 2 + longest + 20;\n\n      setPlacement({\n        dotLeft,\n        dotTop,\n        dotSize,\n        borderWidth,\n        textTop,\n        textLeft,\n        textWidth,\n      });\n    }\n  }, []);\n\n  useEffect(() => {\n    window.addEventListener('resize', update);\n    window.addEventListener('scroll', update);\n    return () => {\n      window.removeEventListener('resize', update);\n      window.removeEventListener('scroll', update);\n    };\n  }, [update]);\n\n  useLayoutEffect(update, [wrapperRef.current, update]);\n\n  if (!show) {\n    return <>{children}</>;\n  }\n\n  return (\n    <>\n      <div className={classes.featureWrapper} ref={wrapperRef}>\n        {children}\n      </div>\n      {createPortal(\n        <div className={classes.backdrop}>\n          <ClickAwayListener onClickAway={hide}>\n            <>\n              <div\n                className={classes.dot}\n                data-testid=\"dot\"\n                style={{\n                  left: placement?.dotLeft,\n                  top: placement?.dotTop,\n                  width: placement?.dotSize,\n                  height: placement?.dotSize,\n                  borderWidth: placement?.borderWidth,\n                }}\n                onClick={hide}\n                onKeyDown={hide}\n                role=\"button\"\n                tabIndex={0}\n              >\n                <div className={classes.pulseCircle} />\n              </div>\n              <div\n                className={classes.text}\n                data-testid=\"text\"\n                style={{\n                  left: placement?.textLeft,\n                  top: placement?.textTop,\n                  width: placement?.textWidth,\n                }}\n              >\n                <Typography variant=\"h2\" paragraph>\n                  {title}\n                </Typography>\n                <Typography>{description}</Typography>\n              </div>\n            </>\n          </ClickAwayListener>\n        </div>,\n        portalElement,\n      )}\n    </>\n  );\n}\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport React from 'react';\nimport classnames from 'classnames';\nimport { makeStyles } from '@material-ui/core/styles';\nimport Link from '@material-ui/core/Link';\nimport LinkIcon from '@material-ui/icons/Link';\nimport { Link as RouterLink } from '../Link';\n\nexport type IconLinkVerticalProps = {\n  color?: 'primary' | 'secondary';\n  disabled?: boolean;\n  href?: string;\n  icon?: React.ReactNode;\n  label: string;\n  onClick?: React.MouseEventHandler<HTMLAnchorElement>;\n  title?: string;\n};\n\n/** @public */\nexport type IconLinkVerticalClassKey =\n  | 'link'\n  | 'disabled'\n  | 'primary'\n  | 'secondary'\n  | 'label';\n\nconst useIconStyles = makeStyles(\n  theme => ({\n    link: {\n      display: 'grid',\n      justifyItems: 'center',\n      gridGap: 4,\n      textAlign: 'center',\n    },\n    disabled: {\n      color: theme.palette.text.secondary,\n      cursor: 'default',\n    },\n    primary: {\n      color: theme.palette.primary.main,\n    },\n    secondary: {\n      color: theme.palette.secondary.main,\n    },\n    label: {\n      fontSize: '0.7rem',\n      textTransform: 'uppercase',\n      fontWeight: 600,\n      letterSpacing: 1.2,\n    },\n  }),\n  { name: 'BackstageIconLinkVertical' },\n);\n\n/** @public */\nexport function IconLinkVertical({\n  color = 'primary',\n  disabled = false,\n  href = '#',\n  icon = <LinkIcon />,\n  label,\n  onClick,\n  title,\n}: IconLinkVerticalProps) {\n  const classes = useIconStyles();\n\n  if (disabled) {\n    return (\n      <Link\n        title={title}\n        className={classnames(classes.link, classes.disabled)}\n        underline=\"none\"\n      >\n        {icon}\n        <span className={classes.label}>{label}</span>\n      </Link>\n    );\n  }\n\n  return (\n    <Link\n      title={title}\n      className={classnames(classes.link, classes[color])}\n      to={href}\n      component={RouterLink}\n      onClick={onClick}\n    >\n      {icon}\n      <span className={classes.label}>{label}</span>\n    </Link>\n  );\n}\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport { makeStyles } from '@material-ui/core/styles';\nimport React from 'react';\nimport { IconLinkVertical, IconLinkVerticalProps } from './IconLinkVertical';\n\n/** @public */\nexport type HeaderIconLinkRowClassKey = 'links';\n\nconst useStyles = makeStyles(\n  theme => ({\n    links: {\n      margin: theme.spacing(2, 0),\n      display: 'grid',\n      gridAutoFlow: 'column',\n      gridAutoColumns: 'min-content',\n      gridGap: theme.spacing(3),\n    },\n  }),\n  { name: 'BackstageHeaderIconLinkRow' },\n);\n\ntype Props = {\n  links: IconLinkVerticalProps[];\n};\n\n/**\n * HTML nav tag with links mapped inside\n *\n * @public\n *\n */\nexport function HeaderIconLinkRow(props: Props) {\n  const { links } = props;\n  const classes = useStyles();\n  return (\n    <nav className={classes.links}>\n      {links.map((link, index) => (\n        <IconLinkVertical key={index + 1} {...link} />\n      ))}\n    </nav>\n  );\n}\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport Grid from '@material-ui/core/Grid';\nimport IconButton from '@material-ui/core/IconButton';\nimport { makeStyles, Theme } from '@material-ui/core/styles';\nimport ChevronLeftIcon from '@material-ui/icons/ChevronLeft';\nimport ChevronRightIcon from '@material-ui/icons/ChevronRight';\nimport classNames from 'classnames';\nimport React, { PropsWithChildren } from 'react';\n\nconst generateGradientStops = (themeType: 'dark' | 'light') => {\n  // 97% corresponds to the theme.palette.background.default for the light theme\n  // 16% for the dark theme\n  const luminance = themeType === 'dark' ? '16%' : '97%';\n  // Generated with https://larsenwork.com/easing-gradients/\n  return `\n    hsl(0, 0%, ${luminance}) 0%,\n    hsla(0, 0%, ${luminance}, 0.987) 8.1%,\n    hsla(0, 0%, ${luminance}, 0.951) 15.5%,\n    hsla(0, 0%, ${luminance}, 0.896) 22.5%,\n    hsla(0, 0%, ${luminance}, 0.825) 29%,\n    hsla(0, 0%, ${luminance}, 0.741) 35.3%,\n    hsla(0, 0%, ${luminance}, 0.648) 41.2%,\n    hsla(0, 0%, ${luminance}, 0.55) 47.1%,\n    hsla(0, 0%, ${luminance}, 0.45) 52.9%,\n    hsla(0, 0%, ${luminance}, 0.352) 58.8%,\n    hsla(0, 0%, ${luminance}, 0.259) 64.7%,\n    hsla(0, 0%, ${luminance}, 0.175) 71%,\n    hsla(0, 0%, ${luminance}, 0.104) 77.5%,\n    hsla(0, 0%, ${luminance}, 0.049) 84.5%,\n    hsla(0, 0%, ${luminance}, 0.013) 91.9%,\n    hsla(0, 0%, ${luminance}, 0) 100%\n  `;\n};\n\nconst fadeSize = 100;\nconst fadePadding = 10;\n\ntype Props = {\n  scrollStep?: number;\n  scrollSpeed?: number; // lower is faster\n  minScrollDistance?: number; // limits how small steps the scroll can take in px\n};\n\n/** @public */\nexport type HorizontalScrollGridClassKey =\n  | 'root'\n  | 'container'\n  | 'fade'\n  | 'fadeLeft'\n  | 'fadeRight'\n  | 'fadeHidden'\n  | 'button'\n  | 'buttonLeft'\n  | 'buttonRight';\n\nconst useStyles = makeStyles<Theme>(\n  theme => ({\n    root: {\n      position: 'relative',\n      display: 'flex',\n      flexFlow: 'row nowrap',\n      alignItems: 'center',\n    },\n    container: {\n      overflow: 'auto',\n      scrollbarWidth: 0 as any, // hide in FF\n      '&::-webkit-scrollbar': {\n        display: 'none', // hide in Chrome\n      },\n    },\n    fade: {\n      position: 'absolute',\n      width: fadeSize,\n      height: `calc(100% + ${fadePadding}px)`,\n      transition: 'opacity 300ms',\n      pointerEvents: 'none',\n    },\n    fadeLeft: {\n      left: -fadePadding,\n      background: `linear-gradient(90deg, ${generateGradientStops(\n        theme.palette.type,\n      )})`,\n    },\n    fadeRight: {\n      right: -fadePadding,\n      background: `linear-gradient(270deg, ${generateGradientStops(\n        theme.palette.type,\n      )})`,\n    },\n    fadeHidden: {\n      opacity: 0,\n    },\n    button: {\n      position: 'absolute',\n    },\n    buttonLeft: {\n      left: -theme.spacing(2),\n    },\n    buttonRight: {\n      right: -theme.spacing(2),\n    },\n  }),\n  { name: 'BackstageHorizontalScrollGrid' },\n);\n\n// Returns scroll distance from left and right\nfunction useScrollDistance(\n  ref: React.MutableRefObject<HTMLElement | undefined>,\n): [number, number] {\n  const [[scrollLeft, scrollRight], setScroll] = React.useState<\n    [number, number]\n  >([0, 0]);\n\n  React.useLayoutEffect(() => {\n    const el = ref.current;\n    if (!el) {\n      setScroll([0, 0]);\n      return;\n    }\n\n    const handleUpdate = () => {\n      const left = el.scrollLeft;\n      const right = el.scrollWidth - el.offsetWidth - el.scrollLeft;\n      setScroll([left, right]);\n    };\n\n    handleUpdate();\n\n    el.addEventListener('scroll', handleUpdate);\n    window.addEventListener('resize', handleUpdate);\n    // TODO(freben): Remove this eslint exception later\n    // It's here because @types/react-router-dom v5 pulls in @types/react that have the wrong signature\n    // eslint-disable-next-line consistent-return\n    return () => {\n      el.removeEventListener('scroll', handleUpdate);\n      window.removeEventListener('resize', handleUpdate);\n    };\n  }, [ref]);\n\n  return [scrollLeft, scrollRight];\n}\n\n// Used to animate scrolling. Returns a single setScrollTarger function, when called with e.g. 200,\n// the element pointer to by the ref will be scrolled 200px forwards over time.\nfunction useSmoothScroll(\n  ref: React.MutableRefObject<HTMLElement | undefined>,\n  speed: number,\n  minDistance: number,\n) {\n  const [scrollTarget, setScrollTarget] = React.useState<number>(0);\n\n  React.useLayoutEffect(() => {\n    if (scrollTarget === 0) {\n      return;\n    }\n\n    const startTime = performance.now();\n    const id = requestAnimationFrame(frameTime => {\n      if (!ref.current) {\n        return;\n      }\n      const frameDuration = frameTime - startTime;\n      const scrollDistance = (Math.abs(scrollTarget) * frameDuration) / speed;\n      const cappedScrollDistance = Math.max(minDistance, scrollDistance);\n      const scrollAmount = cappedScrollDistance * Math.sign(scrollTarget);\n\n      ref.current.scrollBy({ left: scrollAmount });\n\n      const newScrollTarget = scrollTarget - scrollAmount;\n      if (Math.sign(scrollTarget) !== Math.sign(newScrollTarget)) {\n        setScrollTarget(0);\n      } else {\n        setScrollTarget(newScrollTarget);\n      }\n    });\n\n    // TODO(freben): Remove this eslint exception later\n    // It's here because @types/react-router-dom v5 pulls in @types/react that have the wrong signature\n    // eslint-disable-next-line consistent-return\n    return () => cancelAnimationFrame(id);\n  }, [ref, scrollTarget, speed, minDistance]);\n\n  return setScrollTarget;\n}\n\n/**\n * Horizontal scrollable component with arrows to navigate\n *\n * @public\n *\n */\nexport function HorizontalScrollGrid(props: PropsWithChildren<Props>) {\n  const {\n    scrollStep = 100,\n    scrollSpeed = 50,\n    minScrollDistance = 5,\n    children,\n    ...otherProps\n  } = props;\n  const classes = useStyles(props);\n  const ref = React.useRef<HTMLElement>();\n\n  const [scrollLeft, scrollRight] = useScrollDistance(ref);\n  const setScrollTarget = useSmoothScroll(ref, scrollSpeed, minScrollDistance);\n\n  const handleScrollClick = (forwards: boolean) => {\n    const el = ref.current;\n    if (!el) {\n      return;\n    }\n    setScrollTarget(forwards ? scrollStep : -scrollStep);\n  };\n\n  return (\n    <div {...otherProps} className={classes.root}>\n      <Grid\n        container\n        direction=\"row\"\n        wrap=\"nowrap\"\n        className={classes.container}\n        ref={ref as any}\n      >\n        {children}\n      </Grid>\n      <div\n        className={classNames(classes.fade, classes.fadeLeft, {\n          [classes.fadeHidden]: scrollLeft === 0,\n        })}\n      />\n      <div\n        className={classNames(classes.fade, classes.fadeRight, {\n          [classes.fadeHidden]: scrollRight === 0,\n        })}\n      />\n      {scrollLeft > 0 && (\n        <IconButton\n          title=\"Scroll Left\"\n          onClick={() => handleScrollClick(false)}\n          className={classNames(classes.button, classes.buttonLeft, {})}\n        >\n          <ChevronLeftIcon />\n        </IconButton>\n      )}\n      {scrollRight > 0 && (\n        <IconButton\n          title=\"Scroll Right\"\n          onClick={() => handleScrollClick(true)}\n          className={classNames(classes.button, classes.buttonRight, {})}\n        >\n          <ChevronRightIcon />\n        </IconButton>\n      )}\n    </div>\n  );\n}\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React from 'react';\nimport CSS from 'csstype';\nimport { makeStyles } from '@material-ui/core/styles';\n\ntype Props = CSS.Properties & {\n  shorthand?: boolean;\n  alpha?: boolean;\n};\n\nexport type LifecycleClassKey = 'alpha' | 'beta';\n\nconst useStyles = makeStyles(\n  {\n    alpha: {\n      color: '#ffffff',\n      fontFamily: 'serif',\n      fontWeight: 'normal',\n      fontStyle: 'italic',\n    },\n    beta: {\n      color: '#4d65cc',\n      fontFamily: 'serif',\n      fontWeight: 'normal',\n      fontStyle: 'italic',\n    },\n  },\n  { name: 'BackstageLifecycle' },\n);\n\nexport function Lifecycle(props: Props) {\n  const classes = useStyles(props);\n  const { shorthand, alpha } = props;\n  return shorthand ? (\n    <span\n      className={classes[alpha ? 'alpha' : 'beta']}\n      style={{ fontSize: '120%' }}\n    >\n      {alpha ? <>&alpha;</> : <>&beta;</>}\n    </span>\n  ) : (\n    <span className={classes[alpha ? 'alpha' : 'beta']}>\n      {alpha ? 'Alpha' : 'Beta'}\n    </span>\n  );\n}\n","/*\n * Copyright 2021 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React, { lazy, Suspense } from 'react';\nimport { useApp } from '@backstage/core-plugin-api';\n\nconst RealLogViewer = lazy(() =>\n  import('./RealLogViewer').then(m => ({ default: m.RealLogViewer })),\n);\n\n/**\n * The properties for the LogViewer component.\n *\n * @public\n */\nexport interface LogViewerProps {\n  /**\n   * The text of the logs to display.\n   *\n   * The LogViewer component is optimized for appending content at the end of the text.\n   */\n  text: string;\n  /**\n   * Styling overrides for classes within the LogViewer component.\n   */\n  classes?: {\n    root?: string;\n  };\n}\n\n/**\n * A component that displays logs in a scrollable text area.\n *\n * @remarks\n * The LogViewer has support for search and filtering, as well as displaying\n * text content with ANSI color escape codes.\n *\n * Since the LogViewer uses windowing to avoid rendering all contents at once, the\n * log is sized automatically to fill the available vertical space. This means\n * it may often be needed to wrap the LogViewer in a container that provides it\n * with a fixed amount of space.\n *\n * @public\n */\nexport function LogViewer(props: LogViewerProps) {\n  const { Progress } = useApp().getComponents();\n  return (\n    <Suspense fallback={<Progress />}>\n      <RealLogViewer {...props} />\n    </Suspense>\n  );\n}\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { makeStyles } from '@material-ui/core/styles';\nimport ReactMarkdown, { Options } from 'react-markdown';\nimport gfm from 'remark-gfm';\nimport React from 'react';\nimport { BackstageTheme } from '@backstage/theme';\nimport { CodeSnippet } from '../CodeSnippet';\nimport { HeadingProps } from 'react-markdown/lib/ast-to-react';\n\nexport type MarkdownContentClassKey = 'markdown';\n\nconst useStyles = makeStyles<BackstageTheme>(\n  theme => ({\n    markdown: {\n      '& table': {\n        borderCollapse: 'collapse',\n        border: `1px solid ${theme.palette.border}`,\n      },\n      '& th, & td': {\n        border: `1px solid ${theme.palette.border}`,\n        padding: theme.spacing(1),\n      },\n      '& td': {\n        wordBreak: 'break-word',\n        overflow: 'hidden',\n        verticalAlign: 'middle',\n        lineHeight: '1',\n        margin: 0,\n        padding: theme.spacing(3, 2, 3, 2.5),\n        borderBottom: 0,\n      },\n      '& th': {\n        backgroundColor: theme.palette.background.paper,\n      },\n      '& tr': {\n        backgroundColor: theme.palette.background.paper,\n      },\n      '& tr:nth-child(odd)': {\n        backgroundColor: theme.palette.background.default,\n      },\n\n      '& a': {\n        color: theme.palette.link,\n      },\n      '& img': {\n        maxWidth: '100%',\n      },\n    },\n  }),\n  { name: 'BackstageMarkdownContent' },\n);\n\ntype Props = {\n  content: string;\n  dialect?: 'gfm' | 'common-mark';\n  linkTarget?: Options['linkTarget'];\n  transformLinkUri?: (href: string) => string;\n  transformImageUri?: (href: string) => string;\n  className?: string;\n};\n\nconst flatten = (text: string, child: any): string => {\n  if (!child) return text;\n\n  return typeof child === 'string'\n    ? text + child\n    : React.Children.toArray(child.props.children).reduce(flatten, text);\n};\n\nconst headingRenderer = ({ level, children }: HeadingProps) => {\n  const childrenArray = React.Children.toArray(children);\n  const text = childrenArray.reduce(flatten, '');\n  const slug = text.toLocaleLowerCase('en-US').replace(/\\W/g, '-');\n  return React.createElement(`h${level}`, { id: slug }, children);\n};\n\nconst components: Options['components'] = {\n  code: ({ inline, className, children, ...props }) => {\n    const text = String(children).replace(/\\n+$/, '');\n    const match = /language-(\\w+)/.exec(className || '');\n    return !inline && match ? (\n      <CodeSnippet language={match[1]} text={text} />\n    ) : (\n      <code className={className} {...props}>\n        {children}\n      </code>\n    );\n  },\n  h1: headingRenderer,\n  h2: headingRenderer,\n  h3: headingRenderer,\n  h4: headingRenderer,\n  h5: headingRenderer,\n  h6: headingRenderer,\n};\n\n/**\n * Renders markdown with the default dialect {@link https://github.github.com/gfm/ | gfm - GitHub flavored Markdown} to backstage theme styled HTML.\n *\n * @remarks\n * If you just want to render to plain {@link https://commonmark.org/ | CommonMark}, set the dialect to `'common-mark'`\n */\nexport function MarkdownContent(props: Props) {\n  const {\n    content,\n    dialect = 'gfm',\n    linkTarget,\n    transformLinkUri,\n    transformImageUri,\n    className,\n  } = props;\n  const classes = useStyles();\n  return (\n    <ReactMarkdown\n      remarkPlugins={dialect === 'gfm' ? [gfm] : []}\n      className={`${classes.markdown} ${className}`}\n      children={content}\n      components={components}\n      linkTarget={linkTarget}\n      transformLinkUri={transformLinkUri}\n      transformImageUri={transformImageUri}\n    />\n  );\n}\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { makeStyles, Theme } from '@material-ui/core/styles';\nimport ListItem from '@material-ui/core/ListItem';\nimport ListItemAvatar from '@material-ui/core/ListItemAvatar';\nimport ListItemText from '@material-ui/core/ListItemText';\nimport Typography from '@material-ui/core/Typography';\nimport Button from '@material-ui/core/Button';\nimport React, { useState } from 'react';\nimport { isError } from '@backstage/errors';\nimport { PendingOAuthRequest } from '@backstage/core-plugin-api';\n\nexport type LoginRequestListItemClassKey = 'root';\n\nconst useItemStyles = makeStyles<Theme>(\n  theme => ({\n    root: {\n      paddingLeft: theme.spacing(3),\n    },\n  }),\n  { name: 'BackstageLoginRequestListItem' },\n);\n\ntype RowProps = {\n  request: PendingOAuthRequest;\n  busy: boolean;\n  setBusy: (busy: boolean) => void;\n};\n\nconst LoginRequestListItem = ({ request, busy, setBusy }: RowProps) => {\n  const classes = useItemStyles();\n  const [error, setError] = useState<string>();\n\n  const handleContinue = async () => {\n    setBusy(true);\n    try {\n      await request.trigger();\n    } catch (e) {\n      setError(isError(e) ? e.message : 'An unspecified error occurred');\n    } finally {\n      setBusy(false);\n    }\n  };\n\n  const IconComponent = request.provider.icon;\n\n  return (\n    <ListItem disabled={busy} classes={{ root: classes.root }}>\n      <ListItemAvatar>\n        <IconComponent fontSize=\"large\" />\n      </ListItemAvatar>\n      <ListItemText\n        primary={request.provider.title}\n        secondary={error && <Typography color=\"error\">{error}</Typography>}\n      />\n      <Button color=\"primary\" variant=\"contained\" onClick={handleContinue}>\n        Log in\n      </Button>\n    </ListItem>\n  );\n};\n\nexport default LoginRequestListItem;\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { makeStyles, Theme } from '@material-ui/core/styles';\nimport Dialog from '@material-ui/core/Dialog';\nimport DialogActions from '@material-ui/core/DialogActions';\nimport DialogContent from '@material-ui/core/DialogContent';\nimport DialogTitle from '@material-ui/core/DialogTitle';\nimport List from '@material-ui/core/List';\nimport Button from '@material-ui/core/Button';\nimport React, { useMemo, useState } from 'react';\nimport useObservable from 'react-use/lib/useObservable';\nimport LoginRequestListItem from './LoginRequestListItem';\nimport { useApi, oauthRequestApiRef } from '@backstage/core-plugin-api';\nimport Typography from '@material-ui/core/Typography';\n\nexport type OAuthRequestDialogClassKey =\n  | 'dialog'\n  | 'title'\n  | 'contentList'\n  | 'actionButtons';\n\nconst useStyles = makeStyles<Theme>(\n  theme => ({\n    dialog: {\n      paddingTop: theme.spacing(1),\n    },\n    title: {\n      minWidth: 0,\n    },\n    titleHeading: {\n      fontSize: theme.typography.h6.fontSize,\n    },\n    contentList: {\n      padding: 0,\n    },\n    actionButtons: {\n      padding: theme.spacing(2, 0),\n    },\n  }),\n  { name: 'OAuthRequestDialog' },\n);\n\nexport function OAuthRequestDialog(_props: {}) {\n  const classes = useStyles();\n  const [busy, setBusy] = useState(false);\n  const oauthRequestApi = useApi(oauthRequestApiRef);\n  const requests = useObservable(\n    useMemo(() => oauthRequestApi.authRequest$(), [oauthRequestApi]),\n    [],\n  );\n\n  const handleRejectAll = () => {\n    requests.forEach(request => request.reject());\n  };\n\n  return (\n    <Dialog\n      open={Boolean(requests.length)}\n      fullWidth\n      maxWidth=\"xs\"\n      classes={{ paper: classes.dialog }}\n      aria-labelledby=\"oauth-req-dialog-title\"\n    >\n      <main>\n        <DialogTitle\n          classes={{ root: classes.title }}\n          id=\"oauth-req-dialog-title\"\n        >\n          <Typography className={classes.titleHeading} variant=\"h1\">\n            Login Required\n          </Typography>\n        </DialogTitle>\n\n        <DialogContent dividers classes={{ root: classes.contentList }}>\n          <List>\n            {requests.map(request => (\n              <LoginRequestListItem\n                key={request.provider.title}\n                request={request}\n                busy={busy}\n                setBusy={setBusy}\n              />\n            ))}\n          </List>\n        </DialogContent>\n      </main>\n\n      <DialogActions classes={{ root: classes.actionButtons }}>\n        <Button onClick={handleRejectAll}>Reject All</Button>\n      </DialogActions>\n    </Dialog>\n  );\n}\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { makeStyles } from '@material-ui/core/styles';\nimport Tooltip, { TooltipProps } from '@material-ui/core/Tooltip';\nimport React, { useState } from 'react';\nimport TextTruncate, { TextTruncateProps } from 'react-text-truncate';\nimport { useIsMounted } from '@react-hookz/web';\n\ntype Props = {\n  text: TextTruncateProps['text'];\n  line?: TextTruncateProps['line'];\n  element?: TextTruncateProps['element'];\n  title?: TooltipProps['title'];\n  placement?: TooltipProps['placement'];\n};\n\nexport type OverflowTooltipClassKey = 'container';\n\nconst useStyles = makeStyles(\n  {\n    container: {\n      overflow: 'visible !important',\n    },\n  },\n  { name: 'BackstageOverflowTooltip' },\n);\n\nexport function OverflowTooltip(props: Props) {\n  const [hover, setHover] = useState(false);\n  const isMounted = useIsMounted();\n  const classes = useStyles();\n\n  const handleToggled = (truncated: boolean) => {\n    if (isMounted()) {\n      setHover(truncated);\n    }\n  };\n\n  return (\n    <Tooltip\n      title={props.title ?? (props.text || '')}\n      placement={props.placement}\n      disableHoverListener={!hover}\n    >\n      <TextTruncate\n        text={props.text}\n        line={props.line}\n        onToggled={handleToggled}\n        containerClassName={classes.container}\n      />\n    </Tooltip>\n  );\n}\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React, { useState, useEffect, PropsWithChildren } from 'react';\nimport LinearProgress, {\n  LinearProgressProps,\n} from '@material-ui/core/LinearProgress';\n\nexport function Progress(props: PropsWithChildren<LinearProgressProps>) {\n  const [isVisible, setIsVisible] = useState(false);\n\n  useEffect(() => {\n    const handle = setTimeout(() => setIsVisible(true), 250);\n    return () => clearTimeout(handle);\n  }, []);\n\n  return isVisible ? (\n    <LinearProgress {...props} data-testid=\"progress\" />\n  ) : (\n    <div style={{ display: 'none' }} />\n  );\n}\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { BackstageTheme } from '@backstage/theme';\nimport Box from '@material-ui/core/Box';\nimport Divider from '@material-ui/core/Divider';\nimport { makeStyles } from '@material-ui/core/styles';\nimport Typography from '@material-ui/core/Typography';\nimport ArrowIcon from '@material-ui/icons/ArrowForward';\nimport React from 'react';\nimport { Link } from '../../components/Link';\n\n/** @public */\nexport type BottomLinkClassKey = 'root' | 'boxTitle' | 'arrow';\n\nconst useStyles = makeStyles<BackstageTheme>(\n  theme => ({\n    root: {\n      maxWidth: 'fit-content',\n      padding: theme.spacing(2, 2, 2, 2.5),\n    },\n    boxTitle: {\n      margin: 0,\n      color: theme.palette.textSubtle,\n    },\n    arrow: {\n      color: theme.palette.textSubtle,\n    },\n  }),\n  { name: 'BackstageBottomLink' },\n);\n\n/** @public */\nexport type BottomLinkProps = {\n  link: string;\n  title: string;\n  onClick?: (event: React.MouseEvent<HTMLAnchorElement>) => void;\n};\n\n/**\n * Footer with link used in  {@link InfoCard } and {@link TabbedCard}\n *\n * @public\n *\n */\nexport function BottomLink(props: BottomLinkProps) {\n  const { link, title, onClick } = props;\n  const classes = useStyles();\n\n  return (\n    <div>\n      <Divider />\n      <Link to={link} onClick={onClick} underline=\"none\">\n        <Box display=\"flex\" alignItems=\"center\" className={classes.root}>\n          <Box className={classes.boxTitle} fontWeight=\"fontWeightBold\" m={1}>\n            <Typography>\n              <strong>{title}</strong>\n            </Typography>\n          </Box>\n          <ArrowIcon className={classes.arrow} />\n        </Box>\n      </Link>\n    </div>\n  );\n}\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React, { ComponentClass, Component, ErrorInfo } from 'react';\nimport { Button } from '../../components/Button';\nimport { ErrorPanel } from '../../components/ErrorPanel';\n\ntype SlackChannel = {\n  name: string;\n  href?: string;\n};\n\n/** @public */\nexport type ErrorBoundaryProps = {\n  slackChannel?: string | SlackChannel;\n  onError?: (error: Error, errorInfo: string) => null;\n};\n\ntype State = {\n  error?: Error;\n  errorInfo?: ErrorInfo;\n};\n\nconst SlackLink = (props: { slackChannel?: string | SlackChannel }) => {\n  const { slackChannel } = props;\n\n  if (!slackChannel) {\n    return null;\n  } else if (typeof slackChannel === 'string') {\n    return <>Please contact {slackChannel} for help.</>;\n  } else if (!slackChannel.href) {\n    return <>Please contact {slackChannel.name} for help.</>;\n  }\n\n  return (\n    <Button to={slackChannel.href} variant=\"contained\">\n      {slackChannel.name}\n    </Button>\n  );\n};\n\n/** @public */\nexport const ErrorBoundary: ComponentClass<\n  ErrorBoundaryProps,\n  State\n> = class ErrorBoundary extends Component<ErrorBoundaryProps, State> {\n  constructor(props: ErrorBoundaryProps) {\n    super(props);\n    this.state = {\n      error: undefined,\n      errorInfo: undefined,\n    };\n  }\n\n  componentDidCatch(error: Error, errorInfo: ErrorInfo) {\n    // eslint-disable-next-line no-console\n    console.error(`ErrorBoundary, error: ${error}, info: ${errorInfo}`);\n    this.setState({ error, errorInfo });\n  }\n\n  render() {\n    const { slackChannel, children } = this.props;\n    const { error } = this.state;\n\n    if (!error) {\n      return children;\n    }\n\n    return (\n      <ErrorPanel title=\"Something Went Wrong\" error={error}>\n        <SlackLink slackChannel={slackChannel} />\n      </ErrorPanel>\n    );\n  }\n};\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport Card from '@material-ui/core/Card';\nimport CardActions from '@material-ui/core/CardActions';\nimport CardContent from '@material-ui/core/CardContent';\nimport CardHeader, { CardHeaderProps } from '@material-ui/core/CardHeader';\nimport Divider from '@material-ui/core/Divider';\nimport { makeStyles, withStyles } from '@material-ui/core/styles';\nimport classNames from 'classnames';\nimport React, { ReactNode } from 'react';\nimport { BottomLink, BottomLinkProps } from '../BottomLink';\nimport { ErrorBoundary, ErrorBoundaryProps } from '../ErrorBoundary';\n\n/** @public */\nexport type InfoCardClassKey =\n  | 'noPadding'\n  | 'header'\n  | 'headerTitle'\n  | 'headerSubheader'\n  | 'headerAvatar'\n  | 'headerAction'\n  | 'headerContent';\n\nconst useStyles = makeStyles(\n  theme => ({\n    noPadding: {\n      padding: 0,\n      '&:last-child': {\n        paddingBottom: 0,\n      },\n    },\n    header: {\n      padding: theme.spacing(2, 2, 2, 2.5),\n    },\n    headerTitle: {\n      fontWeight: 700,\n    },\n    headerSubheader: {\n      paddingTop: theme.spacing(1),\n    },\n    headerAvatar: {},\n    headerAction: {},\n    headerContent: {},\n    subheader: {\n      display: 'flex',\n    },\n  }),\n  { name: 'BackstageInfoCard' },\n);\n\n/** @public */\nexport type CardActionsTopRightClassKey = 'root';\n\nconst CardActionsTopRight = withStyles(\n  theme => ({\n    root: {\n      display: 'inline-block',\n      padding: theme.spacing(8, 8, 0, 0),\n      float: 'right',\n    },\n  }),\n  { name: 'BackstageInfoCardCardActionsTopRight' },\n)(CardActions);\n\nconst VARIANT_STYLES = {\n  card: {\n    flex: {\n      display: 'flex',\n      flexDirection: 'column',\n    },\n    fullHeight: {\n      display: 'flex',\n      flexDirection: 'column',\n      height: '100%',\n    },\n    gridItem: {\n      display: 'flex',\n      flexDirection: 'column',\n      height: 'calc(100% - 10px)', // for pages without content header\n      marginBottom: '10px',\n    },\n  },\n  cardContent: {\n    fullHeight: {\n      flex: 1,\n    },\n    gridItem: {\n      flex: 1,\n    },\n  },\n};\n\n/** @public */\nexport type InfoCardVariants = 'flex' | 'fullHeight' | 'gridItem';\n\n/**\n * InfoCard is used to display a paper-styled block on the screen, similar to a panel.\n *\n * You can custom style an InfoCard with the 'className' (outer container) and 'cardClassName' (inner container)\n * props. This is typically used with the material-ui makeStyles mechanism.\n *\n * The InfoCard serves as an error boundary. As a result, if you provide an 'errorBoundaryProps' property this\n * specifies the extra information to display in the error component that is displayed if an error occurs\n * in any descendent components.\n *\n * By default the InfoCard has no custom layout of its children, but is treated as a block element. A\n * couple common variants are provided and can be specified via the variant property:\n *\n * When the InfoCard is displayed as a grid item within a grid, you may want items to have the same height for all items.\n * Set to the 'gridItem' variant to display the InfoCard with full height suitable for Grid:\n *\n * `<InfoCard variant=\"gridItem\">...</InfoCard>`\n */\nexport type Props = {\n  title?: ReactNode;\n  subheader?: ReactNode;\n  divider?: boolean;\n  deepLink?: BottomLinkProps;\n  /** @deprecated Use errorBoundaryProps instead */\n  slackChannel?: string;\n  errorBoundaryProps?: ErrorBoundaryProps;\n  variant?: InfoCardVariants;\n  children?: ReactNode;\n  headerStyle?: object;\n  headerProps?: CardHeaderProps;\n  icon?: ReactNode;\n  action?: ReactNode;\n  actionsClassName?: string;\n  actions?: ReactNode;\n  cardClassName?: string;\n  actionsTopRight?: ReactNode;\n  className?: string;\n  noPadding?: boolean;\n  titleTypographyProps?: object;\n};\n\n/**\n * Material-ui card with header , content and actions footer\n *\n * @public\n *\n */\nexport function InfoCard(props: Props): JSX.Element {\n  const {\n    title,\n    subheader,\n    divider = true,\n    deepLink,\n    slackChannel,\n    errorBoundaryProps,\n    variant,\n    children,\n    headerStyle,\n    headerProps,\n    icon,\n    action,\n    actionsClassName,\n    actions,\n    cardClassName,\n    actionsTopRight,\n    className,\n    noPadding,\n    titleTypographyProps,\n  } = props;\n  const classes = useStyles();\n  /**\n   * If variant is specified, we build up styles for that particular variant for both\n   * the Card and the CardContent (since these need to be synced)\n   */\n  let calculatedStyle = {};\n  let calculatedCardStyle = {};\n  if (variant) {\n    const variants = variant.split(/[\\s]+/g);\n    variants.forEach(name => {\n      calculatedStyle = {\n        ...calculatedStyle,\n        ...VARIANT_STYLES.card[name as keyof typeof VARIANT_STYLES['card']],\n      };\n      calculatedCardStyle = {\n        ...calculatedCardStyle,\n        ...VARIANT_STYLES.cardContent[\n          name as keyof typeof VARIANT_STYLES['cardContent']\n        ],\n      };\n    });\n  }\n\n  const cardSubTitle = () => {\n    return (\n      <div className={classes.headerSubheader}>\n        {subheader && <div className={classes.subheader}>{subheader}</div>}\n        {icon}\n      </div>\n    );\n  };\n\n  const errProps: ErrorBoundaryProps =\n    errorBoundaryProps || (slackChannel ? { slackChannel } : {});\n\n  return (\n    <Card style={calculatedStyle} className={className}>\n      <ErrorBoundary {...errProps}>\n        {title && (\n          <CardHeader\n            classes={{\n              root: classes.header,\n              title: classes.headerTitle,\n              subheader: classes.headerSubheader,\n              avatar: classes.headerAvatar,\n              action: classes.headerAction,\n              content: classes.headerContent,\n            }}\n            title={title}\n            subheader={cardSubTitle()}\n            action={action}\n            style={{ ...headerStyle }}\n            titleTypographyProps={titleTypographyProps}\n            {...headerProps}\n          />\n        )}\n        {actionsTopRight && (\n          <CardActionsTopRight>{actionsTopRight}</CardActionsTopRight>\n        )}\n        {divider && <Divider />}\n        <CardContent\n          className={classNames(cardClassName, {\n            [classes.noPadding]: noPadding,\n          })}\n          style={calculatedCardStyle}\n        >\n          {children}\n        </CardContent>\n        {actions && (\n          <CardActions className={actionsClassName}>{actions}</CardActions>\n        )}\n        {deepLink && <BottomLink {...deepLink} />}\n      </ErrorBoundary>\n    </Card>\n  );\n}\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { BackstagePalette, BackstageTheme } from '@backstage/theme';\nimport { makeStyles, useTheme } from '@material-ui/core/styles';\nimport { Circle } from 'rc-progress';\nimport React, { ReactNode, useEffect, useState } from 'react';\n\n/** @public */\nexport type GaugeClassKey =\n  | 'root'\n  | 'overlay'\n  | 'description'\n  | 'circle'\n  | 'colorUnknown';\n\nconst useStyles = makeStyles<BackstageTheme>(\n  theme => ({\n    root: {\n      position: 'relative',\n      lineHeight: 0,\n    },\n    overlay: {\n      position: 'absolute',\n      top: '50%',\n      left: '50%',\n      transform: 'translate(-50%, -60%)',\n      fontSize: 45,\n      fontWeight: 'bold',\n      color: theme.palette.textContrast,\n    },\n    description: {\n      fontSize: '100%',\n      top: '50%',\n      left: '50%',\n      transform: 'translate(-50%, -50%)',\n      position: 'absolute',\n      wordBreak: 'break-all',\n      display: 'inline-block',\n    },\n    circle: {\n      width: '80%',\n      transform: 'translate(10%, 0)',\n    },\n    colorUnknown: {},\n  }),\n  { name: 'BackstageGauge' },\n);\n\n/** @public */\nexport type GaugeProps = {\n  value: number;\n  fractional?: boolean;\n  inverse?: boolean;\n  unit?: string;\n  max?: number;\n  description?: ReactNode;\n  getColor?: GaugePropsGetColor;\n};\n\n/** @public */\nexport type GaugePropsGetColorOptions = {\n  palette: BackstagePalette;\n  value: number;\n  inverse?: boolean;\n  max?: number;\n};\n\n/** @public */\nexport type GaugePropsGetColor = (args: GaugePropsGetColorOptions) => string;\n\nconst defaultGaugeProps = {\n  fractional: true,\n  inverse: false,\n  unit: '%',\n  max: 100,\n};\n\nexport const getProgressColor: GaugePropsGetColor = ({\n  palette,\n  value,\n  inverse,\n  max,\n}) => {\n  if (isNaN(value)) {\n    return '#ddd';\n  }\n\n  const actualMax = max ? max : defaultGaugeProps.max;\n  const actualValue = inverse ? actualMax - value : value;\n\n  if (actualValue < actualMax / 3) {\n    return palette.status.error;\n  } else if (actualValue < actualMax * (2 / 3)) {\n    return palette.status.warning;\n  }\n\n  return palette.status.ok;\n};\n\n/**\n * Circular Progress Bar\n *\n * @public\n *\n */\n\nexport function Gauge(props: GaugeProps) {\n  const [hoverRef, setHoverRef] = useState<HTMLDivElement | null>(null);\n  const { getColor = getProgressColor } = props;\n  const classes = useStyles(props);\n  const { palette } = useTheme<BackstageTheme>();\n  const { value, fractional, inverse, unit, max, description } = {\n    ...defaultGaugeProps,\n    ...props,\n  };\n\n  const asPercentage = fractional ? Math.round(value * max) : value;\n  const asActual = max !== 100 ? Math.round(value) : asPercentage;\n\n  const [isHovering, setIsHovering] = useState(false);\n\n  useEffect(() => {\n    const node = hoverRef;\n    const handleMouseOver = () => setIsHovering(true);\n    const handleMouseOut = () => setIsHovering(false);\n    if (node && description) {\n      node.addEventListener('mouseenter', handleMouseOver);\n      node.addEventListener('mouseleave', handleMouseOut);\n\n      return () => {\n        node.removeEventListener('mouseenter', handleMouseOver);\n        node.removeEventListener('mouseleave', handleMouseOut);\n      };\n    }\n    return () => {\n      setIsHovering(false);\n    };\n  }, [description, hoverRef]);\n\n  return (\n    <div ref={setHoverRef} className={classes.root}>\n      <Circle\n        strokeLinecap=\"butt\"\n        percent={asPercentage}\n        strokeWidth={12}\n        trailWidth={12}\n        strokeColor={getColor({ palette, value: asActual, inverse, max })}\n        className={classes.circle}\n      />\n      {description && isHovering ? (\n        <div className={classes.description}>{description}</div>\n      ) : (\n        <div className={classes.overlay}>\n          {isNaN(value) ? 'N/A' : `${asActual}${unit}`}\n        </div>\n      )}\n    </div>\n  );\n}\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { makeStyles } from '@material-ui/core/styles';\nimport React, { ReactNode } from 'react';\nimport { BottomLinkProps } from '../../layout/BottomLink';\nimport { InfoCard, InfoCardVariants } from '../../layout/InfoCard';\nimport { Gauge, GaugePropsGetColor } from './Gauge';\n\ntype Props = {\n  title: string;\n  subheader?: string;\n  variant?: InfoCardVariants;\n  /** Progress in % specified as decimal, e.g. \"0.23\" */\n  progress: number;\n  description?: ReactNode;\n  icon?: ReactNode;\n  inverse?: boolean;\n  deepLink?: BottomLinkProps;\n  getColor?: GaugePropsGetColor;\n};\n\n/** @public */\nexport type GaugeCardClassKey = 'root';\n\nconst useStyles = makeStyles(\n  {\n    root: {\n      height: '100%',\n      width: 250,\n    },\n  },\n  { name: 'BackstageGaugeCard' },\n);\n\n/**\n * {@link Gauge} with header, subheader and footer\n *\n * @public\n *\n */\nexport function GaugeCard(props: Props) {\n  const classes = useStyles(props);\n  const {\n    title,\n    subheader,\n    progress,\n    inverse,\n    deepLink,\n    description,\n    icon,\n    variant,\n    getColor,\n  } = props;\n\n  const gaugeProps = {\n    inverse,\n    description,\n    getColor,\n    value: progress,\n  };\n\n  return (\n    <div className={classes.root}>\n      <InfoCard\n        title={title}\n        subheader={subheader}\n        deepLink={deepLink}\n        variant={variant}\n        icon={icon}\n      >\n        <Gauge {...gaugeProps} />\n      </InfoCard>\n    </div>\n  );\n}\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React from 'react';\nimport { useTheme } from '@material-ui/core/styles';\nimport Tooltip from '@material-ui/core/Tooltip';\nimport { Line } from 'rc-progress';\nimport { BackstageTheme } from '@backstage/theme';\nimport { getProgressColor, GaugePropsGetColor } from './Gauge';\n\ntype Props = {\n  /**\n   * Progress value between 0.0 - 1.0.\n   */\n  value: number;\n  getColor?: GaugePropsGetColor;\n};\n\nexport function LinearGauge(props: Props) {\n  const { value, getColor = getProgressColor } = props;\n  const { palette } = useTheme<BackstageTheme>();\n  if (isNaN(value)) {\n    return null;\n  }\n  let percent = Math.round(value * 100 * 100) / 100;\n  if (percent > 100) {\n    percent = 100;\n  }\n  const strokeColor = getColor({\n    palette,\n    value: percent,\n    inverse: false,\n    max: 100,\n  });\n  return (\n    <Tooltip title={`${percent}%`}>\n      <span>\n        <Line\n          percent={percent}\n          strokeWidth={4}\n          trailWidth={4}\n          strokeColor={strokeColor}\n        />\n      </span>\n    </Tooltip>\n  );\n}\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport React from 'react';\nimport { makeStyles, createStyles } from '@material-ui/core/styles';\nimport SvgIcon from '@material-ui/core/SvgIcon';\n\n/** @public */\nexport type ClosedDropdownClassKey = 'icon';\n\nconst useStyles = makeStyles(\n  () =>\n    createStyles({\n      icon: {\n        position: 'absolute',\n        right: '4px',\n        pointerEvents: 'none',\n      },\n    }),\n  { name: 'BackstageClosedDropdown' },\n);\n\nconst ClosedDropdown = () => {\n  const classes = useStyles();\n  return (\n    <SvgIcon\n      className={classes.icon}\n      fill=\"none\"\n      xmlns=\"http://www.w3.org/2000/svg\"\n    >\n      <path\n        d=\"M7.5 8L6 9.5L12.0703 15.5703L18.1406 9.5L16.6406 8L12.0703 12.5703L7.5 8Z\"\n        fill=\"#616161\"\n      />\n    </SvgIcon>\n  );\n};\n\nexport default ClosedDropdown;\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport React from 'react';\nimport { makeStyles, createStyles } from '@material-ui/core/styles';\nimport SvgIcon from '@material-ui/core/SvgIcon';\n\nexport type OpenedDropdownClassKey = 'icon';\n\nconst useStyles = makeStyles(\n  () =>\n    createStyles({\n      icon: {\n        position: 'absolute',\n        right: '4px',\n        pointerEvents: 'none',\n      },\n    }),\n  { name: 'BackstageOpenedDropdown' },\n);\n\nconst OpenedDropdown = () => {\n  const classes = useStyles();\n  return (\n    <SvgIcon\n      className={classes.icon}\n      fill=\"none\"\n      xmlns=\"http://www.w3.org/2000/svg\"\n    >\n      <path\n        d=\"M16.5 16L18 14.5L11.9297 8.42969L5.85938 14.5L7.35938 16L11.9297 11.4297L16.5 16Z\"\n        fill=\"#616161\"\n      />\n    </SvgIcon>\n  );\n};\n\nexport default OpenedDropdown;\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport Checkbox from '@material-ui/core/Checkbox';\nimport Chip from '@material-ui/core/Chip';\nimport ClickAwayListener from '@material-ui/core/ClickAwayListener';\nimport FormControl from '@material-ui/core/FormControl';\nimport InputBase from '@material-ui/core/InputBase';\nimport InputLabel from '@material-ui/core/InputLabel';\nimport MenuItem from '@material-ui/core/MenuItem';\nimport Select from '@material-ui/core/Select';\nimport {\n  createStyles,\n  makeStyles,\n  Theme,\n  withStyles,\n} from '@material-ui/core/styles';\nimport Typography from '@material-ui/core/Typography';\nimport React, { useEffect, useState } from 'react';\nimport ClosedDropdown from './static/ClosedDropdown';\nimport OpenedDropdown from './static/OpenedDropdown';\n\n/** @public */\nexport type SelectInputBaseClassKey = 'root' | 'input';\n\nconst BootstrapInput = withStyles(\n  (theme: Theme) =>\n    createStyles({\n      root: {\n        'label + &': {\n          marginTop: theme.spacing(3),\n        },\n      },\n      input: {\n        borderRadius: 4,\n        position: 'relative',\n        backgroundColor: theme.palette.background.paper,\n        border: '1px solid #ced4da',\n        fontSize: 16,\n        padding: '10px 26px 10px 12px',\n        transition: theme.transitions.create(['border-color', 'box-shadow']),\n        fontFamily: 'Helvetica Neue',\n        '&:focus': {\n          background: theme.palette.background.paper,\n          borderRadius: 4,\n        },\n      },\n    }),\n  { name: 'BackstageSelectInputBase' },\n)(InputBase);\n\n/** @public */\nexport type SelectClassKey =\n  | 'formControl'\n  | 'label'\n  | 'chips'\n  | 'chip'\n  | 'checkbox'\n  | 'root';\n\nconst useStyles = makeStyles(\n  (theme: Theme) =>\n    createStyles({\n      formControl: {\n        margin: `${theme.spacing(1)} 0px`,\n        maxWidth: 300,\n      },\n      label: {\n        transform: 'initial',\n        fontWeight: 'bold',\n        fontSize: 14,\n        fontFamily: theme.typography.fontFamily,\n        color: theme.palette.text.primary,\n        '&.Mui-focused': {\n          color: theme.palette.text.primary,\n        },\n      },\n      formLabel: {\n        transform: 'initial',\n        fontWeight: 'bold',\n        fontSize: 14,\n        fontFamily: theme.typography.fontFamily,\n        color: theme.palette.text.primary,\n        '&.Mui-focused': {\n          color: theme.palette.text.primary,\n        },\n      },\n      chips: {\n        display: 'flex',\n        flexWrap: 'wrap',\n      },\n      chip: {\n        margin: 2,\n      },\n      checkbox: {},\n\n      root: {\n        display: 'flex',\n        flexDirection: 'column',\n      },\n    }),\n  { name: 'BackstageSelect' },\n);\n\n/** @public */\nexport type SelectItem = {\n  label: string;\n  value: string | number;\n};\n\n/** @public */\nexport type SelectedItems = string | string[] | number | number[];\n\nexport type SelectProps = {\n  multiple?: boolean;\n  items: SelectItem[];\n  label: string;\n  placeholder?: string;\n  selected?: SelectedItems;\n  onChange: (arg: SelectedItems) => void;\n  triggerReset?: boolean;\n  native?: boolean;\n  disabled?: boolean;\n  margin?: 'dense' | 'none';\n};\n\n/** @public */\nexport function SelectComponent(props: SelectProps) {\n  const {\n    multiple,\n    items,\n    label,\n    placeholder,\n    selected,\n    onChange,\n    triggerReset,\n    native = false,\n    disabled = false,\n    margin,\n  } = props;\n  const classes = useStyles();\n  const [value, setValue] = useState<SelectedItems>(\n    selected || (multiple ? [] : ''),\n  );\n  const [isOpen, setOpen] = useState(false);\n\n  useEffect(() => {\n    setValue(multiple ? [] : '');\n  }, [triggerReset, multiple]);\n\n  useEffect(() => {\n    if (selected !== undefined) {\n      setValue(selected);\n    }\n  }, [selected]);\n\n  const handleChange = (event: React.ChangeEvent<{ value: unknown }>) => {\n    setValue(event.target.value as SelectedItems);\n    onChange(event.target.value as SelectedItems);\n  };\n\n  const handleClick = (event: React.ChangeEvent<any>) => {\n    if (disabled) {\n      event.preventDefault();\n      return;\n    }\n    setOpen(previous => {\n      if (multiple && !(event.target instanceof HTMLElement)) {\n        return true;\n      }\n      return !previous;\n    });\n  };\n\n  const handleClickAway = () => {\n    setOpen(false);\n  };\n\n  const handleDelete = (selectedValue: string | number) => () => {\n    const newValue = (value as any[]).filter(chip => chip !== selectedValue);\n    setValue(newValue);\n    onChange(newValue);\n  };\n\n  return (\n    <div className={classes.root}>\n      <ClickAwayListener onClickAway={handleClickAway}>\n        <FormControl className={classes.formControl}>\n          <InputLabel className={classes.formLabel}>{label}</InputLabel>\n          <Select\n            aria-label={label}\n            value={value}\n            native={native}\n            disabled={disabled}\n            data-testid=\"select\"\n            displayEmpty\n            multiple={multiple}\n            margin={margin}\n            onChange={handleChange}\n            onClick={handleClick}\n            open={isOpen}\n            input={<BootstrapInput />}\n            label={label}\n            tabIndex={0}\n            renderValue={s =>\n              multiple && (value as any[]).length !== 0 ? (\n                <div className={classes.chips}>\n                  {(s as string[]).map(selectedValue => (\n                    <Chip\n                      key={items.find(el => el.value === selectedValue)?.value}\n                      label={\n                        items.find(el => el.value === selectedValue)?.label\n                      }\n                      clickable\n                      onDelete={handleDelete(selectedValue)}\n                      className={classes.chip}\n                    />\n                  ))}\n                </div>\n              ) : (\n                <Typography>\n                  {(value as any[]).length === 0\n                    ? placeholder || ''\n                    : items.find(el => el.value === s)?.label}\n                </Typography>\n              )\n            }\n            IconComponent={() =>\n              !isOpen ? <ClosedDropdown /> : <OpenedDropdown />\n            }\n            MenuProps={{\n              anchorOrigin: {\n                vertical: 'bottom',\n                horizontal: 'left',\n              },\n              transformOrigin: {\n                vertical: 'top',\n                horizontal: 'left',\n              },\n              getContentAnchorEl: null,\n            }}\n          >\n            {placeholder && !multiple && (\n              <MenuItem value={[]}>{placeholder}</MenuItem>\n            )}\n            {native\n              ? items &&\n                items.map(item => (\n                  <option value={item.value} key={item.value}>\n                    {item.label}\n                  </option>\n                ))\n              : items &&\n                items.map(item => (\n                  <MenuItem key={item.value} value={item.value}>\n                    {multiple && (\n                      <Checkbox\n                        color=\"primary\"\n                        checked={(value as any[]).includes(item.value) || false}\n                        className={classes.checkbox}\n                      />\n                    )}\n                    {item.label}\n                  </MenuItem>\n                ))}\n          </Select>\n        </FormControl>\n      </ClickAwayListener>\n    </div>\n  );\n}\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport React, {\n  Children,\n  isValidElement,\n  useState,\n  useEffect,\n  PropsWithChildren,\n} from 'react';\nimport MuiStepper from '@material-ui/core/Stepper';\n\ntype InternalState = {\n  stepperLength: number;\n  stepIndex: number;\n  setStepIndex: any;\n  stepHistory: number[];\n  setStepHistory: any;\n  onStepChange?: (prevIndex: number, nextIndex: number) => void;\n};\n\nconst noop = () => {};\nexport const VerticalStepperContext = React.createContext<InternalState>({\n  stepperLength: 0,\n  stepIndex: 0,\n  setStepIndex: noop,\n  stepHistory: [],\n  setStepHistory: noop,\n  onStepChange: noop,\n});\n\nexport interface StepperProps {\n  elevated?: boolean;\n  onStepChange?: (prevIndex: number, nextIndex: number) => void;\n  activeStep?: number;\n}\n\nexport function SimpleStepper(props: PropsWithChildren<StepperProps>) {\n  const { children, elevated, onStepChange, activeStep = 0 } = props;\n  const [stepIndex, setStepIndex] = useState<number>(activeStep);\n  const [stepHistory, setStepHistory] = useState<number[]>([0]);\n\n  useEffect(() => {\n    setStepIndex(activeStep);\n  }, [activeStep]);\n\n  const steps: React.ReactNode[] = [];\n  let endStep;\n  Children.forEach(children, child => {\n    if (isValidElement(child)) {\n      if (child.props.end) {\n        endStep = child;\n      } else {\n        steps.push(child);\n      }\n    }\n  });\n\n  return (\n    <>\n      <VerticalStepperContext.Provider\n        value={{\n          stepIndex,\n          setStepIndex,\n          stepHistory,\n          setStepHistory,\n          onStepChange,\n          stepperLength: Children.count(children),\n        }}\n      >\n        <MuiStepper\n          activeStep={stepIndex}\n          orientation=\"vertical\"\n          elevation={elevated ? 2 : 0}\n        >\n          {steps}\n        </MuiStepper>\n      </VerticalStepperContext.Provider>\n      {stepIndex >= Children.count(children) - 1 && endStep}\n    </>\n  );\n}\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport React, { useContext, ReactNode, PropsWithChildren } from 'react';\nimport { makeStyles } from '@material-ui/core/styles';\nimport Button from '@material-ui/core/Button';\nimport { StepActions } from './types';\nimport { VerticalStepperContext } from './SimpleStepper';\n\nexport type SimpleStepperFooterClassKey = 'root';\n\nconst useStyles = makeStyles(\n  theme => ({\n    root: {\n      marginTop: theme.spacing(3),\n      '& button': {\n        marginRight: theme.spacing(1),\n      },\n    },\n  }),\n  { name: 'BackstageSimpleStepperFooter' },\n);\n\ninterface CommonBtnProps {\n  text?: string;\n  handleClick?: () => void;\n  stepIndex: number;\n}\ninterface RestartBtnProps extends CommonBtnProps {}\n\ninterface NextBtnProps extends CommonBtnProps {\n  disabled?: boolean;\n  last?: boolean;\n  stepIndex: number;\n}\ninterface BackBtnProps extends CommonBtnProps {\n  disabled?: boolean;\n  stepIndex: number;\n}\nexport const RestartBtn = ({ text, handleClick }: RestartBtnProps) => (\n  <Button onClick={handleClick}>{text || 'Reset'}</Button>\n);\n\nconst NextBtn = ({\n  text,\n  handleClick,\n  disabled,\n  last,\n  stepIndex,\n}: NextBtnProps) => (\n  <Button\n    variant=\"contained\"\n    color=\"primary\"\n    disabled={disabled}\n    data-testid={`nextButton-${stepIndex}`}\n    onClick={handleClick}\n  >\n    {text || (last ? 'Finish' : 'Next')}\n  </Button>\n);\n\nconst BackBtn = ({ text, handleClick, disabled, stepIndex }: BackBtnProps) => (\n  <Button\n    onClick={handleClick}\n    data-testid={`backButton-${stepIndex}`}\n    disabled={disabled}\n  >\n    {text || 'Back'}\n  </Button>\n);\n\nexport type SimpleStepperFooterProps = {\n  actions?: StepActions;\n  children?: ReactNode;\n};\n\nexport const SimpleStepperFooter = ({\n  actions = {},\n  children,\n}: PropsWithChildren<SimpleStepperFooterProps>) => {\n  const classes = useStyles();\n  const {\n    stepperLength,\n    stepIndex,\n    setStepIndex,\n    stepHistory,\n    setStepHistory,\n    onStepChange,\n  } = useContext(VerticalStepperContext);\n\n  const onChange = (newIndex: number, callback?: () => void) => {\n    if (callback) {\n      callback();\n    }\n    if (onStepChange) {\n      onStepChange(stepIndex, newIndex);\n    }\n\n    setStepIndex(newIndex);\n  };\n\n  const handleNext = () => {\n    const newIndex = actions.nextStep\n      ? actions.nextStep(stepIndex, stepperLength - 1)\n      : stepIndex + 1;\n    onChange(newIndex, actions.onNext);\n    setStepHistory([...stepHistory, newIndex]);\n  };\n  const handleBack = () => {\n    stepHistory.pop();\n    onChange(stepHistory[stepHistory.length - 1], actions.onBack);\n    setStepHistory([...stepHistory]);\n  };\n  const handleRestart = () => {\n    onChange(0, actions.onRestart);\n    setStepHistory([0]);\n  };\n\n  return (\n    <div className={classes.root}>\n      {[undefined, true].includes(actions.showBack) && stepIndex !== 0 && (\n        <BackBtn\n          text={actions.backText}\n          handleClick={handleBack}\n          disabled={stepIndex === 0}\n          stepIndex={stepIndex}\n        />\n      )}\n      {[undefined, true].includes(actions.showNext) && (\n        <NextBtn\n          text={actions.nextText}\n          handleClick={handleNext}\n          disabled={\n            (!!stepperLength && stepIndex >= stepperLength) ||\n            (!!actions.canNext && !actions.canNext())\n          }\n          stepIndex={stepIndex}\n        />\n      )}\n      {actions.showRestart && stepIndex !== 0 && (\n        <RestartBtn\n          text={actions.restartText}\n          handleClick={handleRestart}\n          stepIndex={stepIndex}\n        />\n      )}\n      {children}\n    </div>\n  );\n};\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport React, { PropsWithChildren } from 'react';\nimport { makeStyles } from '@material-ui/core/styles';\nimport MuiStep from '@material-ui/core/Step';\nimport StepContent from '@material-ui/core/StepContent';\nimport StepLabel from '@material-ui/core/StepLabel';\nimport Typography from '@material-ui/core/Typography';\nimport { SimpleStepperFooter } from './SimpleStepperFooter';\nimport { StepProps } from './types';\n\nexport type SimpleStepperStepClassKey = 'end';\n\nconst useStyles = makeStyles(\n  theme => ({\n    end: {\n      padding: theme.spacing(3),\n    },\n  }),\n  { name: 'SimpleStepperStep' },\n);\n\nexport function SimpleStepperStep(props: PropsWithChildren<StepProps>) {\n  const { title, children, end, actions, ...muiProps } = props;\n  const classes = useStyles();\n\n  // The end step is not a part of the stepper\n  // It simply is the final screen with an option to have buttons such as reset or back\n  return end ? (\n    <div className={classes.end}>\n      <Typography variant=\"h6\">{title}</Typography>\n      {children}\n      <SimpleStepperFooter actions={{ ...(actions || {}), showNext: false }} />\n    </div>\n  ) : (\n    <MuiStep {...muiProps}>\n      <StepLabel>\n        <Typography variant=\"h6\">{title}</Typography>\n      </StepLabel>\n      <StepContent>\n        {children}\n        <SimpleStepperFooter actions={actions} />\n      </StepContent>\n    </MuiStep>\n  );\n}\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { makeStyles } from '@material-ui/core/styles';\nimport { BackstageTheme } from '@backstage/theme';\nimport classNames from 'classnames';\nimport React, { PropsWithChildren } from 'react';\n\nexport type StatusClassKey =\n  | 'status'\n  | 'ok'\n  | 'warning'\n  | 'error'\n  | 'pending'\n  | 'running'\n  | 'aborted';\n\nconst useStyles = makeStyles<BackstageTheme>(\n  theme => ({\n    status: {\n      fontWeight: 500,\n      '&::before': {\n        width: '0.7em',\n        height: '0.7em',\n        display: 'inline-block',\n        marginRight: 8,\n        borderRadius: '50%',\n        content: '\"\"',\n      },\n    },\n    ok: {\n      '&::before': {\n        backgroundColor: theme.palette.status.ok,\n      },\n    },\n    warning: {\n      '&::before': {\n        backgroundColor: theme.palette.status.warning,\n      },\n    },\n    error: {\n      '&::before': {\n        backgroundColor: theme.palette.status.error,\n      },\n    },\n    pending: {\n      '&::before': {\n        backgroundColor: theme.palette.status.pending,\n      },\n    },\n    running: {\n      '&::before': {\n        backgroundColor: theme.palette.status.running,\n      },\n    },\n    aborted: {\n      '&::before': {\n        backgroundColor: theme.palette.status.aborted,\n      },\n    },\n  }),\n  { name: 'BackstageStatus' },\n);\n\nexport function StatusOK(props: PropsWithChildren<{}>) {\n  const classes = useStyles(props);\n  return (\n    <span\n      className={classNames(classes.status, classes.ok)}\n      aria-label=\"Status ok\"\n      aria-hidden=\"true\"\n      {...props}\n    />\n  );\n}\n\nexport function StatusWarning(props: PropsWithChildren<{}>) {\n  const classes = useStyles(props);\n  return (\n    <span\n      className={classNames(classes.status, classes.warning)}\n      aria-label=\"Status warning\"\n      aria-hidden=\"true\"\n      {...props}\n    />\n  );\n}\n\nexport function StatusError(props: PropsWithChildren<{}>) {\n  const classes = useStyles(props);\n  return (\n    <span\n      className={classNames(classes.status, classes.error)}\n      aria-label=\"Status error\"\n      aria-hidden=\"true\"\n      {...props}\n    />\n  );\n}\n\nexport function StatusPending(props: PropsWithChildren<{}>) {\n  const classes = useStyles(props);\n  return (\n    <span\n      className={classNames(classes.status, classes.pending)}\n      aria-label=\"Status pending\"\n      aria-hidden=\"true\"\n      {...props}\n    />\n  );\n}\n\nexport function StatusRunning(props: PropsWithChildren<{}>) {\n  const classes = useStyles(props);\n  return (\n    <span\n      className={classNames(classes.status, classes.running)}\n      aria-label=\"Status running\"\n      aria-hidden=\"true\"\n      {...props}\n    />\n  );\n}\n\nexport function StatusAborted(props: PropsWithChildren<{}>) {\n  const classes = useStyles(props);\n  return (\n    <span\n      className={classNames(classes.status, classes.aborted)}\n      aria-label=\"Status aborted\"\n      aria-hidden=\"true\"\n      {...props}\n    />\n  );\n}\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React from 'react';\nimport {\n  withStyles,\n  createStyles,\n  WithStyles,\n  Theme,\n} from '@material-ui/core/styles';\nimport Table from '@material-ui/core/Table';\nimport TableBody from '@material-ui/core/TableBody';\nimport TableCell from '@material-ui/core/TableCell';\nimport TableRow from '@material-ui/core/TableRow';\n\nexport type MetadataTableTitleCellClassKey = 'root';\n\nconst tableTitleCellStyles = (theme: Theme) =>\n  createStyles({\n    root: {\n      fontWeight: 'bolder',\n      whiteSpace: 'nowrap',\n      paddingRight: theme.spacing(4),\n      border: '0',\n      verticalAlign: 'top',\n    },\n  });\n\nexport type MetadataTableCellClassKey = 'root';\n\nconst tableContentCellStyles = {\n  root: {\n    border: '0',\n    verticalAlign: 'top',\n  },\n};\n\nexport type MetadataTableListClassKey = 'root';\n\nconst listStyles = (theme: Theme) =>\n  createStyles({\n    root: {\n      listStyle: 'none',\n      margin: theme.spacing(0, 0, -1, 0),\n      padding: '0',\n    },\n  });\n\nexport type MetadataTableListItemClassKey = 'root' | 'random';\n\nconst listItemStyles = (theme: Theme) =>\n  createStyles({\n    root: {\n      padding: theme.spacing(0, 0, 1, 0),\n    },\n    random: {},\n  });\n\nconst TitleCell = withStyles(tableTitleCellStyles, {\n  name: 'BackstageMetadataTableTitleCell',\n})(TableCell);\nconst ContentCell = withStyles(tableContentCellStyles, {\n  name: 'BackstageMetadataTableCell',\n})(TableCell);\n\nexport const MetadataTable = ({\n  dense,\n  children,\n}: {\n  dense?: boolean;\n  children: React.ReactNode;\n}) => (\n  <Table size={dense ? 'small' : 'medium'}>\n    <TableBody>{children}</TableBody>\n  </Table>\n);\n\nexport const MetadataTableItem = ({\n  title,\n  children,\n  ...rest\n}: {\n  title: string;\n  children: React.ReactNode;\n}) => (\n  <TableRow>\n    {title && <TitleCell>{title}</TitleCell>}\n    <ContentCell colSpan={title ? 1 : 2} {...rest}>\n      {children}\n    </ContentCell>\n  </TableRow>\n);\n\ninterface StyleProps extends WithStyles {\n  children?: React.ReactNode;\n}\n\nexport const MetadataList = withStyles(listStyles, {\n  name: 'BackstageMetadataTableList',\n})(({ classes, children }: StyleProps) => (\n  <ul className={classes.root}>{children}</ul>\n));\n\nexport const MetadataListItem = withStyles(listItemStyles, {\n  name: 'BackstageMetadataTableListItem',\n})(({ classes, children }: StyleProps) => (\n  <li className={classes.root}>{children}</li>\n));\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React, { Fragment, ReactElement } from 'react';\nimport {\n  withStyles,\n  createStyles,\n  WithStyles,\n  Theme,\n} from '@material-ui/core/styles';\nimport startCase from 'lodash/startCase';\n\nimport {\n  MetadataTable,\n  MetadataTableItem,\n  MetadataList,\n  MetadataListItem,\n} from './MetadataTable';\n\nexport type StructuredMetadataTableListClassKey = 'root';\n\nconst listStyle = createStyles({\n  root: {\n    margin: '0 0',\n    listStyleType: 'none',\n  },\n});\n\nexport type StructuredMetadataTableNestedListClassKey = 'root';\n\nconst nestedListStyle = (theme: Theme) =>\n  createStyles({\n    root: {\n      ...listStyle.root,\n      paddingLeft: theme.spacing(1),\n    },\n  });\n\ninterface StyleProps extends WithStyles {\n  children?: React.ReactNode;\n}\n// Sub Components\nconst StyledList = withStyles(listStyle, {\n  name: 'BackstageStructuredMetadataTableList',\n})(({ classes, children }: StyleProps) => (\n  <MetadataList classes={classes}>{children}</MetadataList>\n));\nconst StyledNestedList = withStyles(nestedListStyle, {\n  name: 'BackstageStructuredMetadataTableNestedList',\n})(({ classes, children }: StyleProps) => (\n  <MetadataList classes={classes}>{children}</MetadataList>\n));\n\nfunction renderList(list: Array<any>, nested?: boolean) {\n  const values = list.map((item: any, index: number) => (\n    <MetadataListItem key={index}>{toValue(item)}</MetadataListItem>\n  ));\n  return nested ? (\n    <StyledNestedList>{values}</StyledNestedList>\n  ) : (\n    <StyledList>{values}</StyledList>\n  );\n}\n\nfunction renderMap(\n  map: { [key: string]: any },\n  nested?: boolean,\n  options?: any,\n) {\n  const values = Object.keys(map).map(key => {\n    const value = toValue(map[key], true);\n    const fmtKey =\n      options && options.titleFormat\n        ? options.titleFormat(key)\n        : startCase(key);\n    return (\n      <MetadataListItem key={key}>\n        {`${fmtKey}: `}\n        {value}\n      </MetadataListItem>\n    );\n  });\n\n  return nested ? (\n    <StyledNestedList>{values}</StyledNestedList>\n  ) : (\n    <StyledList>{values}</StyledList>\n  );\n}\n\nfunction toValue(\n  value: ReactElement | object | Array<any> | boolean,\n  options?: any,\n  nested?: boolean,\n) {\n  if (React.isValidElement(value)) {\n    return <Fragment>{value}</Fragment>;\n  }\n\n  if (typeof value === 'object' && !Array.isArray(value)) {\n    return renderMap(value, options, nested);\n  }\n\n  if (Array.isArray(value)) {\n    return renderList(value, nested);\n  }\n\n  if (typeof value === 'boolean') {\n    return <Fragment>{value ? '✅' : '❌'}</Fragment>;\n  }\n\n  return <Fragment>{value}</Fragment>;\n}\nconst ItemValue = ({ value, options }: { value: any; options: any }) => (\n  <Fragment>{toValue(value, options)}</Fragment>\n);\n\nconst TableItem = ({\n  title,\n  value,\n  options,\n}: {\n  title: string;\n  value: any;\n  options: any;\n}) => {\n  return (\n    <MetadataTableItem\n      title={\n        options && options.titleFormat\n          ? options.titleFormat(title)\n          : startCase(title)\n      }\n    >\n      <ItemValue value={value} options={options} />\n    </MetadataTableItem>\n  );\n};\n\nfunction mapToItems(info: { [key: string]: string }, options: any) {\n  return Object.keys(info).map(key => (\n    <TableItem key={key} title={key} value={info[key]} options={options} />\n  ));\n}\n\ntype Props = {\n  metadata: { [key: string]: any };\n  dense?: boolean;\n  options?: any;\n};\n\nexport function StructuredMetadataTable(props: Props) {\n  const { metadata, dense = true, options } = props;\n  const metadataItems = mapToItems(metadata, options || {});\n  return <MetadataTable dense={dense}>{metadataItems}</MetadataTable>;\n}\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { isEqual } from 'lodash';\nimport qs from 'qs';\nimport { useEffect, useState } from 'react';\nimport { useSearchParams } from 'react-router-dom';\nimport { useDebouncedEffect } from '@react-hookz/web';\n\nfunction stringify(queryParams: any): string {\n  // Even though these setting don't look nice (e.g. escaped brackets), we should keep\n  // them this way. The current syntax handles all cases, including variable types with\n  // arrays or strings.\n  return qs.stringify(queryParams, {\n    strictNullHandling: true,\n  });\n}\n\nfunction parse(queryString: string): any {\n  return qs.parse(queryString, {\n    ignoreQueryPrefix: true,\n    strictNullHandling: true,\n  });\n}\n\nfunction extractState(queryString: string, stateName: string): any | undefined {\n  const queryParams = parse(queryString);\n\n  return queryParams[stateName];\n}\n\nfunction joinQueryString(\n  queryString: string,\n  stateName: string,\n  state: any,\n): string {\n  const queryParams = {\n    ...parse(queryString),\n    [stateName]: state,\n  };\n  return stringify(queryParams);\n}\n\ntype SetQueryParams<T> = (params: T) => void;\n\nexport function useQueryParamState<T>(\n  stateName: string,\n  /** @deprecated Don't configure a custom debouceTime */\n  debounceTime: number = 250,\n): [T | undefined, SetQueryParams<T>] {\n  const [searchParams, setSearchParams] = useSearchParams();\n  const searchParamsString = searchParams.toString();\n  const [queryParamState, setQueryParamState] = useState<T>(\n    extractState(searchParamsString, stateName),\n  );\n\n  useEffect(() => {\n    const newState = extractState(searchParamsString, stateName);\n\n    setQueryParamState(oldState =>\n      isEqual(newState, oldState) ? oldState : newState,\n    );\n  }, [searchParamsString, setQueryParamState, stateName]);\n\n  useDebouncedEffect(\n    () => {\n      const queryString = joinQueryString(\n        searchParamsString,\n        stateName,\n        queryParamState,\n      );\n\n      if (searchParamsString !== queryString) {\n        setSearchParams(queryString, { replace: true });\n      }\n    },\n    [setSearchParams, queryParamState, searchParamsString, stateName],\n    debounceTime,\n  );\n\n  return [queryParamState, setQueryParamState];\n}\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { useApiHolder, configApiRef } from '@backstage/core-plugin-api';\n\nexport type SupportItemLink = {\n  url: string;\n  title: string;\n};\n\nexport type SupportItem = {\n  title: string;\n  icon?: string;\n  links: SupportItemLink[];\n};\n\nexport type SupportConfig = {\n  url: string;\n  items: SupportItem[];\n};\n\nconst DEFAULT_SUPPORT_CONFIG: SupportConfig = {\n  url: 'https://github.com/backstage/backstage/issues',\n  items: [\n    {\n      title: 'Support Not Configured',\n      icon: 'warning',\n      links: [\n        {\n          // TODO: Update to dedicated support page on backstage.io/docs\n          title: 'Add `app.support` config key',\n          url: 'https://github.com/backstage/backstage/blob/master/app-config.yaml',\n        },\n      ],\n    },\n  ],\n};\n\nexport function useSupportConfig(): SupportConfig {\n  const apiHolder = useApiHolder();\n  const config = apiHolder.get(configApiRef);\n  const supportConfig = config?.getOptionalConfig('app.support');\n\n  if (!supportConfig) {\n    return DEFAULT_SUPPORT_CONFIG;\n  }\n\n  return {\n    url: supportConfig.getString('url'),\n    items: supportConfig.getConfigArray('items').flatMap(itemConf => ({\n      title: itemConf.getString('title'),\n      icon: itemConf.getOptionalString('icon'),\n      links: (itemConf.getOptionalConfigArray('links') ?? []).flatMap(\n        linkConf => ({\n          url: linkConf.getString('url'),\n          title: linkConf.getString('title'),\n        }),\n      ),\n    })),\n  };\n}\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { IconComponent, useApp } from '@backstage/core-plugin-api';\nimport MuiBrokenImageIcon from '@material-ui/icons/BrokenImage';\nimport React, { ComponentProps } from 'react';\n\ntype IconComponentProps = ComponentProps<IconComponent>;\n\nfunction useSystemIcon(key: string, props: IconComponentProps) {\n  const app = useApp();\n  const Icon = app.getSystemIcon(key);\n  return Icon ? <Icon {...props} /> : <MuiBrokenImageIcon {...props} />;\n}\n\n// Should match the list of overridable system icon keys in @backstage/core-app-api\n/**\n * Broken Image Icon\n *\n * @public\n *\n */\nexport function BrokenImageIcon(props: IconComponentProps) {\n  return useSystemIcon('brokenImage', props);\n}\n/** @public */\nexport function CatalogIcon(props: IconComponentProps) {\n  return useSystemIcon('catalog', props);\n}\n/** @public */\nexport function ChatIcon(props: IconComponentProps) {\n  return useSystemIcon('chat', props);\n}\n/** @public */\nexport function DashboardIcon(props: IconComponentProps) {\n  return useSystemIcon('dashboard', props);\n}\n/** @public */\nexport function DocsIcon(props: IconComponentProps) {\n  return useSystemIcon('docs', props);\n}\n/** @public */\nexport function EmailIcon(props: IconComponentProps) {\n  return useSystemIcon('email', props);\n}\n/** @public */\nexport function GitHubIcon(props: IconComponentProps) {\n  return useSystemIcon('github', props);\n}\n/** @public */\nexport function GroupIcon(props: IconComponentProps) {\n  return useSystemIcon('group', props);\n}\n/** @public */\nexport function HelpIcon(props: IconComponentProps) {\n  return useSystemIcon('help', props);\n}\n/** @public */\nexport function UserIcon(props: IconComponentProps) {\n  return useSystemIcon('user', props);\n}\n/** @public */\nexport function WarningIcon(props: IconComponentProps) {\n  return useSystemIcon('warning', props);\n}\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { useApp } from '@backstage/core-plugin-api';\nimport { BackstageTheme } from '@backstage/theme';\nimport { makeStyles } from '@material-ui/core/styles';\nimport useMediaQuery from '@material-ui/core/useMediaQuery';\nimport Box from '@material-ui/core/Box';\nimport Button from '@material-ui/core/Button';\nimport DialogActions from '@material-ui/core/DialogActions';\nimport IconButton from '@material-ui/core/IconButton';\nimport List from '@material-ui/core/List';\nimport ListItem from '@material-ui/core/ListItem';\nimport ListItemIcon from '@material-ui/core/ListItemIcon';\nimport ListItemText from '@material-ui/core/ListItemText';\nimport Popover from '@material-ui/core/Popover';\nimport Typography from '@material-ui/core/Typography';\nimport React, { MouseEventHandler, useState } from 'react';\nimport { SupportItem, SupportItemLink, useSupportConfig } from '../../hooks';\nimport { HelpIcon } from '../../icons';\nimport { Link } from '../Link';\n\ntype SupportButtonProps = {\n  title?: string;\n  children?: React.ReactNode;\n};\n\nexport type SupportButtonClassKey = 'popoverList';\n\nconst useStyles = makeStyles(\n  {\n    popoverList: {\n      minWidth: 260,\n      maxWidth: 400,\n    },\n  },\n  { name: 'BackstageSupportButton' },\n);\n\nconst SupportIcon = ({ icon }: { icon: string | undefined }) => {\n  const app = useApp();\n  const Icon = icon ? app.getSystemIcon(icon) ?? HelpIcon : HelpIcon;\n  return <Icon />;\n};\n\nconst SupportLink = ({ link }: { link: SupportItemLink }) => (\n  <Link to={link.url}>{link.title ?? link.url}</Link>\n);\n\nconst SupportListItem = ({ item }: { item: SupportItem }) => {\n  return (\n    <ListItem>\n      <ListItemIcon>\n        <SupportIcon icon={item.icon} />\n      </ListItemIcon>\n      <ListItemText\n        primary={item.title}\n        secondary={item.links?.reduce<React.ReactNodeArray>(\n          (prev, link, idx) => [\n            ...prev,\n            idx > 0 && <br key={idx} />,\n            <SupportLink link={link} key={link.url} />,\n          ],\n          [],\n        )}\n      />\n    </ListItem>\n  );\n};\n\nexport function SupportButton(props: SupportButtonProps) {\n  const { title, children } = props;\n  const { items } = useSupportConfig();\n\n  const [popoverOpen, setPopoverOpen] = useState(false);\n  const [anchorEl, setAnchorEl] = useState<Element | null>(null);\n  const classes = useStyles();\n  const isSmallScreen = useMediaQuery<BackstageTheme>(theme =>\n    theme.breakpoints.down('sm'),\n  );\n\n  const onClickHandler: MouseEventHandler = event => {\n    setAnchorEl(event.currentTarget);\n    setPopoverOpen(true);\n  };\n\n  const popoverCloseHandler = () => {\n    setPopoverOpen(false);\n  };\n\n  return (\n    <>\n      <Box display=\"flex\" ml={1}>\n        {isSmallScreen ? (\n          <IconButton\n            color=\"primary\"\n            size=\"small\"\n            onClick={onClickHandler}\n            data-testid=\"support-button\"\n          >\n            <HelpIcon />\n          </IconButton>\n        ) : (\n          <Button\n            data-testid=\"support-button\"\n            aria-label=\"support\"\n            color=\"primary\"\n            onClick={onClickHandler}\n            startIcon={<HelpIcon />}\n          >\n            Support\n          </Button>\n        )}\n      </Box>\n      <Popover\n        data-testid=\"support-button-popover\"\n        open={popoverOpen}\n        anchorEl={anchorEl}\n        anchorOrigin={{\n          vertical: 'bottom',\n          horizontal: 'right',\n        }}\n        transformOrigin={{\n          vertical: 'top',\n          horizontal: 'right',\n        }}\n        onClose={popoverCloseHandler}\n      >\n        <List className={classes.popoverList}>\n          {title && (\n            <ListItem alignItems=\"flex-start\">\n              <Typography variant=\"subtitle1\">{title}</Typography>\n            </ListItem>\n          )}\n          {React.Children.map(children, (child, i) => (\n            <ListItem alignItems=\"flex-start\" key={`child-${i}`}>\n              {child}\n            </ListItem>\n          ))}\n          {items &&\n            items.map((item, i) => (\n              <SupportListItem item={item} key={`item-${i}`} />\n            ))}\n        </List>\n        <DialogActions>\n          <Button color=\"primary\" onClick={popoverCloseHandler}>\n            Close\n          </Button>\n        </DialogActions>\n      </Popover>\n    </>\n  );\n}\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { createContext, Dispatch, SetStateAction } from 'react';\n\nconst drawerWidthClosed = 72;\nconst iconPadding = 24;\nconst userBadgePadding = 18;\n\n/** @public */\nexport type SidebarOptions = {\n  drawerWidthClosed?: number;\n  drawerWidthOpen?: number;\n};\n\n/** @public */\nexport type SubmenuOptions = {\n  drawerWidthClosed?: number;\n  drawerWidthOpen?: number;\n};\n\n/** @internal **/\nexport type SidebarConfig = {\n  drawerWidthClosed: number;\n  drawerWidthOpen: number;\n  defaultOpenDelayMs: number;\n  defaultCloseDelayMs: number;\n  defaultFadeDuration: number;\n  logoHeight: number;\n  iconContainerWidth: number;\n  iconSize: number;\n  iconPadding: number;\n  selectedIndicatorWidth: number;\n  userBadgePadding: number;\n  userBadgeDiameter: number;\n  mobileSidebarHeight: number;\n};\n\nexport const sidebarConfig = {\n  drawerWidthClosed,\n  drawerWidthOpen: 224,\n  // As per NN/g's guidance on timing for exposing hidden content\n  // See https://www.nngroup.com/articles/timing-exposing-content/\n  defaultOpenDelayMs: 100,\n  defaultCloseDelayMs: 0,\n  defaultFadeDuration: 200,\n  logoHeight: 32,\n  iconContainerWidth: drawerWidthClosed,\n  iconSize: drawerWidthClosed - iconPadding * 2,\n  iconPadding,\n  selectedIndicatorWidth: 3,\n  userBadgePadding,\n  userBadgeDiameter: drawerWidthClosed - userBadgePadding * 2,\n  mobileSidebarHeight: 56,\n};\n\nexport const makeSidebarConfig = (\n  customSidebarConfig: Partial<SidebarOptions>,\n) => ({\n  ...sidebarConfig,\n  ...customSidebarConfig,\n  iconContainerWidth: sidebarConfig.drawerWidthClosed,\n  iconSize: sidebarConfig.drawerWidthClosed - sidebarConfig.iconPadding * 2,\n  userBadgeDiameter:\n    sidebarConfig.drawerWidthClosed - sidebarConfig.userBadgePadding * 2,\n});\n\n/** @internal **/\nexport type SubmenuConfig = {\n  drawerWidthClosed: number;\n  drawerWidthOpen: number;\n  defaultOpenDelayMs: number;\n};\n\nexport const submenuConfig = {\n  drawerWidthClosed: 0,\n  drawerWidthOpen: 202,\n  defaultOpenDelayMs: sidebarConfig.defaultOpenDelayMs + 200,\n};\n\nexport const makeSidebarSubmenuConfig = (\n  customSubmenuConfig: Partial<SubmenuOptions>,\n) => ({\n  ...submenuConfig,\n  ...customSubmenuConfig,\n});\n\nexport const SIDEBAR_INTRO_LOCAL_STORAGE =\n  '@backstage/core/sidebar-intro-dismissed';\n\nexport type SidebarConfigContextType = {\n  sidebarConfig: SidebarConfig;\n  submenuConfig: SubmenuConfig;\n};\n\nexport const SidebarConfigContext = createContext<SidebarConfigContextType>({\n  sidebarConfig,\n  submenuConfig,\n});\n\nexport type SidebarItemWithSubmenuContextType = {\n  isHoveredOn: boolean;\n  setIsHoveredOn: Dispatch<SetStateAction<boolean>>;\n};\n\nexport const SidebarItemWithSubmenuContext =\n  createContext<SidebarItemWithSubmenuContextType>({\n    isHoveredOn: false,\n    setIsHoveredOn: () => {},\n  });\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nenum LocalStorageKeys {\n  SIDEBAR_PIN_STATE = 'sidebarPinState',\n}\n\nexport const LocalStorage = {\n  getSidebarPinState(): boolean {\n    let value;\n    try {\n      value = JSON.parse(\n        window.localStorage.getItem(LocalStorageKeys.SIDEBAR_PIN_STATE) ||\n          'true',\n      );\n    } catch {\n      return true;\n    }\n    return !!value;\n  },\n  setSidebarPinState(state: boolean) {\n    return window.localStorage.setItem(\n      LocalStorageKeys.SIDEBAR_PIN_STATE,\n      JSON.stringify(state),\n    );\n  },\n};\n","/*\n * Copyright 2022 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  createVersionedContext,\n  createVersionedValueMap,\n} from '@backstage/version-bridge';\nimport React, { createContext, ReactNode, useContext } from 'react';\n\n/**\n * Type of `SidebarPinStateContext`\n *\n * @public\n * @deprecated Use `SidebarPinState` instead.\n */\nexport type SidebarPinStateContextType = {\n  isPinned: boolean;\n  toggleSidebarPinState: () => any;\n  isMobile?: boolean;\n};\n\n/**\n * The pin state of the sidebar.\n *\n * @public\n */\nexport type SidebarPinState = {\n  /**\n   * Whether or not the sidebar is pinned to the `open` state. When `isPinned`\n   * is `false`, the sidebar opens and closes on hover. When `true`, the\n   * sidebar is permanently opened, regardless of user interaction.\n   */\n  isPinned: boolean;\n\n  /**\n   * A function to toggle the pin state of the sidebar.\n   */\n  toggleSidebarPinState: () => any;\n\n  /**\n   * Whether or not the sidebar is or should be rendered in a mobile-optimized\n   * way.\n   */\n  isMobile?: boolean;\n};\n\nconst defaultSidebarPinStateContext = {\n  isPinned: true,\n  toggleSidebarPinState: () => {},\n  isMobile: false,\n};\n\n/**\n * Contains the state on how the `Sidebar` is rendered\n *\n * @public @deprecated\n * Use `<SidebarPinStateContextProvider>` + `useSidebarPinState()` instead.\n */\nexport const LegacySidebarPinStateContext =\n  createContext<SidebarPinStateContextType>(defaultSidebarPinStateContext);\n\nconst VersionedSidebarPinStateContext = createVersionedContext<{\n  1: SidebarPinState;\n}>('sidebar-pin-state-context');\n\n/**\n * Provides state for how the `Sidebar` is rendered\n *\n * @public\n */\nexport function SidebarPinStateProvider(props: {\n  children: ReactNode;\n  value: SidebarPinStateContextType;\n}) {\n  const { children, value } = props;\n  return (\n    <LegacySidebarPinStateContext.Provider value={value}>\n      <VersionedSidebarPinStateContext.Provider\n        value={createVersionedValueMap({ 1: value })}\n      >\n        {children}\n      </VersionedSidebarPinStateContext.Provider>\n    </LegacySidebarPinStateContext.Provider>\n  );\n}\n\n/**\n * Hook to read and update sidebar pin state, which controls whether or not the\n * sidebar is pinned open.\n *\n * @public\n */\nexport const useSidebarPinState = (): SidebarPinState => {\n  const versionedPinStateContext = useContext(VersionedSidebarPinStateContext);\n  const legacyPinStateContext = useContext(LegacySidebarPinStateContext);\n\n  // Invoked from outside a SidebarPinStateProvider: check for the legacy\n  // context's value, but otherwise return the default.\n  if (versionedPinStateContext === undefined) {\n    return legacyPinStateContext || defaultSidebarPinStateContext;\n  }\n\n  const pinStateContext = versionedPinStateContext.atVersion(1);\n  if (pinStateContext === undefined) {\n    throw new Error('No context found for version 1.');\n  }\n\n  return pinStateContext;\n};\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { makeStyles } from '@material-ui/core/styles';\n\nimport React, {\n  createContext,\n  useCallback,\n  useContext,\n  useEffect,\n  useMemo,\n  useRef,\n  useState,\n} from 'react';\nimport { SidebarConfigContext, SidebarConfig } from './config';\nimport { BackstageTheme } from '@backstage/theme';\nimport { LocalStorage } from './localStorage';\nimport useMediaQuery from '@material-ui/core/useMediaQuery';\nimport { SidebarPinStateProvider } from './SidebarPinStateContext';\n\nexport type SidebarPageClassKey = 'root';\n\nconst useStyles = makeStyles<\n  BackstageTheme,\n  { sidebarConfig: SidebarConfig; isPinned: boolean }\n>(\n  theme => ({\n    root: {\n      width: '100%',\n      transition: 'padding-left 0.1s ease-out',\n      isolation: 'isolate',\n      [theme.breakpoints.up('sm')]: {\n        paddingLeft: props =>\n          props.isPinned\n            ? props.sidebarConfig.drawerWidthOpen\n            : props.sidebarConfig.drawerWidthClosed,\n      },\n      [theme.breakpoints.down('xs')]: {\n        paddingBottom: props => props.sidebarConfig.mobileSidebarHeight,\n      },\n    },\n    content: {\n      zIndex: 0,\n      isolation: 'isolate',\n      '&:focus': {\n        outline: 0,\n      },\n    },\n  }),\n  { name: 'BackstageSidebarPage' },\n);\n\n/**\n * Props for SidebarPage\n *\n * @public\n */\nexport type SidebarPageProps = {\n  children?: React.ReactNode;\n};\n\ntype PageContextType = {\n  content: {\n    contentRef?: React.MutableRefObject<HTMLElement | null>;\n  };\n};\n\nconst PageContext = createContext<PageContextType>({\n  content: {\n    contentRef: undefined,\n  },\n});\nexport function SidebarPage(props: SidebarPageProps) {\n  const [isPinned, setIsPinned] = useState(() =>\n    LocalStorage.getSidebarPinState(),\n  );\n  const { sidebarConfig } = useContext(SidebarConfigContext);\n\n  const contentRef = useRef(null);\n\n  const pageContext = useMemo(\n    () => ({\n      content: {\n        contentRef,\n      },\n    }),\n    [contentRef],\n  );\n\n  useEffect(() => {\n    LocalStorage.setSidebarPinState(isPinned);\n  }, [isPinned]);\n\n  const isMobile = useMediaQuery<BackstageTheme>(\n    theme => theme.breakpoints.down('xs'),\n    { noSsr: true },\n  );\n\n  const toggleSidebarPinState = () => setIsPinned(!isPinned);\n\n  const classes = useStyles({ isPinned, sidebarConfig });\n\n  return (\n    <SidebarPinStateProvider\n      value={{\n        isPinned,\n        toggleSidebarPinState,\n        isMobile,\n      }}\n    >\n      <PageContext.Provider value={pageContext}>\n        <div className={classes.root}>{props.children}</div>\n      </PageContext.Provider>\n    </SidebarPinStateProvider>\n  );\n}\n\n/**\n * This hook provides a react ref to the main content.\n * Allows to set an element as the main content and focus on that component.\n *\n * *Note: If `contentRef` is not set `focusContent` is noop. `Content` component sets this ref automatically*\n *\n * @public\n * @example\n * Focus current content\n * ```tsx\n *  const { focusContent} = useContent();\n * ...\n *  <Button onClick={focusContent}>\n *     focus main content\n *  </Button>\n * ```\n * @example\n * Set the reference to an Html element\n * ```\n *  const { contentRef } = useContent();\n * ...\n *  <article ref={contentRef} tabIndex={-1}>Main Content</article>\n * ```\n */\nexport function useContent() {\n  const { content } = useContext(PageContext);\n\n  const focusContent = useCallback(() => {\n    content?.contentRef?.current?.focus();\n  }, [content]);\n\n  return { focusContent, contentRef: content?.contentRef };\n}\n","/*\n * Copyright 2022 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React, { createContext, ReactNode, useContext } from 'react';\nimport {\n  createVersionedContext,\n  createVersionedValueMap,\n} from '@backstage/version-bridge';\n\n/**\n * Types for the `SidebarContext`\n *\n * @public @deprecated\n * Use `SidebarOpenState` instead.\n */\nexport type SidebarContextType = {\n  isOpen: boolean;\n  setOpen: (open: boolean) => void;\n};\n\n/**\n * The open state of the sidebar.\n *\n * @public\n */\nexport type SidebarOpenState = {\n  /**\n   * Whether or not the sidebar is open and full-width. When `false`, the\n   * sidebar is \"closed\" and typically only shows icons with no text.\n   */\n  isOpen: boolean;\n\n  /**\n   * A function to set whether or not the sidebar is open. Pass `true` to open\n   * the sidebar. Pass `false` to close it.\n   */\n  setOpen: (open: boolean) => void;\n};\n\nconst defaultSidebarOpenStateContext = {\n  isOpen: false,\n  setOpen: () => {},\n};\n\n/**\n * Context whether the `Sidebar` is open\n *\n * @public @deprecated\n * Use `<SidebarOpenStateProvider>` + `useSidebarOpenState()` instead.\n */\nexport const LegacySidebarContext = createContext<SidebarContextType>(\n  defaultSidebarOpenStateContext,\n);\n\nconst VersionedSidebarContext = createVersionedContext<{\n  1: SidebarOpenState;\n}>('sidebar-open-state-context');\n\n/**\n * Provides context for reading and updating sidebar state.\n *\n * @public\n */\nexport function SidebarOpenStateProvider(props: {\n  children: ReactNode;\n  value: SidebarOpenState;\n}) {\n  const { children, value } = props;\n  return (\n    <LegacySidebarContext.Provider value={value}>\n      <VersionedSidebarContext.Provider\n        value={createVersionedValueMap({ 1: value })}\n      >\n        {children}\n      </VersionedSidebarContext.Provider>\n    </LegacySidebarContext.Provider>\n  );\n}\n\n/**\n * Hook to read and update the sidebar's open state, which controls whether or\n * not the sidebar is open and full-width, or closed and only displaying icons.\n *\n * @public\n */\nexport const useSidebarOpenState = (): SidebarOpenState => {\n  const versionedOpenStateContext = useContext(VersionedSidebarContext);\n  const legacyOpenStateContext = useContext(LegacySidebarContext);\n\n  // Invoked from outside a SidebarOpenStateProvider: check for the legacy\n  // context's value, but otherwise return the default.\n  if (versionedOpenStateContext === undefined) {\n    return legacyOpenStateContext || defaultSidebarOpenStateContext;\n  }\n\n  const openStateContext = versionedOpenStateContext.atVersion(1);\n  if (openStateContext === undefined) {\n    throw new Error('No context found for version 1.');\n  }\n\n  return openStateContext;\n};\n","/* eslint-disable @typescript-eslint/no-shadow */\n/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { BackstageTheme } from '@backstage/theme';\nimport BottomNavigationAction, {\n  BottomNavigationActionProps,\n} from '@material-ui/core/BottomNavigationAction';\nimport { makeStyles } from '@material-ui/core/styles';\nimport React, { useContext } from 'react';\nimport { useLocation } from 'react-router-dom';\nimport { useSidebarPinState } from '.';\nimport { Link } from '../../components';\nimport { SidebarConfigContext, SidebarConfig } from './config';\nimport { MobileSidebarContext } from './MobileSidebar';\n\n/**\n * Props for the `SidebarGroup`\n *\n * @public\n */\nexport interface SidebarGroupProps extends BottomNavigationActionProps {\n  /**\n   * If the `SidebarGroup` should be a `Link`, `to` should be a pathname to that location\n   */\n  to?: string;\n  /**\n   * If the `SidebarGroup`s should be in a different order than in the normal `Sidebar`, you can provide\n   * each `SidebarGroup` it's own priority to reorder them.\n   */\n  priority?: number;\n  /**\n   * React children\n   */\n  children?: React.ReactNode;\n}\n\nconst useStyles = makeStyles<BackstageTheme, { sidebarConfig: SidebarConfig }>(\n  theme => ({\n    root: {\n      flexGrow: 0,\n      margin: theme.spacing(0, 2),\n      color: theme.palette.navigation.color,\n    },\n\n    selected: props => ({\n      color: `${theme.palette.navigation.selectedColor}!important`,\n      borderTop: `solid ${props.sidebarConfig.selectedIndicatorWidth}px ${theme.palette.navigation.indicator}`,\n      marginTop: '-1px',\n    }),\n\n    label: {\n      display: 'none',\n    },\n  }),\n);\n\n/**\n * Returns a MUI `BottomNavigationAction`, which is aware of the current location & the selected item in the `BottomNavigation`,\n * such that it will highlight a `MobileSidebarGroup` either on location change or if the selected item changes.\n *\n * @param props `to`: pathname of link; `value`: index of the selected item\n * @internal\n */\nconst MobileSidebarGroup = (props: SidebarGroupProps) => {\n  const { to, label, icon, value } = props;\n  const { sidebarConfig } = useContext(SidebarConfigContext);\n  const classes = useStyles({ sidebarConfig });\n  const location = useLocation();\n  const { selectedMenuItemIndex, setSelectedMenuItemIndex } =\n    useContext(MobileSidebarContext);\n\n  const onChange = (_: React.ChangeEvent<{}>, value: number) => {\n    if (value === selectedMenuItemIndex) {\n      setSelectedMenuItemIndex(-1);\n    } else {\n      setSelectedMenuItemIndex(value);\n    }\n  };\n\n  const selected =\n    (value === selectedMenuItemIndex && selectedMenuItemIndex >= 0) ||\n    (!(value === selectedMenuItemIndex) &&\n      !(selectedMenuItemIndex >= 0) &&\n      to === location.pathname);\n\n  return (\n    // Material UI issue: https://github.com/mui-org/material-ui/issues/27820\n    <BottomNavigationAction\n      label={label}\n      icon={icon}\n      component={Link as any}\n      to={(to ? to : location.pathname) as any}\n      onChange={onChange}\n      value={value}\n      selected={selected}\n      classes={classes}\n    />\n  );\n};\n\n/**\n * Groups items of the `Sidebar` together.\n *\n * @remarks\n * On bigger screens, this won't have any effect at the moment.\n * On small screens, it will add an action to the bottom navigation - either triggering an overlay menu or acting as a link\n *\n * @public\n */\nexport const SidebarGroup = (props: SidebarGroupProps) => {\n  const { children, to, label, icon, value } = props;\n  const { isMobile } = useSidebarPinState();\n\n  return isMobile ? (\n    <MobileSidebarGroup to={to} label={label} icon={icon} value={value} />\n  ) : (\n    <>{children}</>\n  );\n};\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { useElementFilter } from '@backstage/core-plugin-api';\nimport { BackstageTheme } from '@backstage/theme';\nimport BottomNavigation from '@material-ui/core/BottomNavigation';\nimport Box from '@material-ui/core/Box';\nimport IconButton from '@material-ui/core/IconButton';\nimport { makeStyles } from '@material-ui/core/styles';\nimport Drawer from '@material-ui/core/Drawer';\nimport Typography from '@material-ui/core/Typography';\nimport CloseIcon from '@material-ui/icons/Close';\nimport MenuIcon from '@material-ui/icons/Menu';\nimport { orderBy } from 'lodash';\nimport React, { createContext, useEffect, useState, useContext } from 'react';\nimport { useLocation } from 'react-router';\nimport { SidebarOpenStateProvider } from './SidebarOpenStateContext';\nimport { SidebarGroup } from './SidebarGroup';\nimport { SidebarConfigContext, SidebarConfig } from './config';\n\n/**\n * Type of `MobileSidebarContext`\n *\n * @internal\n */\nexport type MobileSidebarContextType = {\n  selectedMenuItemIndex: number;\n  setSelectedMenuItemIndex: React.Dispatch<React.SetStateAction<number>>;\n};\n\n/**\n * Props of MobileSidebar\n *\n * @public\n */\nexport type MobileSidebarProps = {\n  children?: React.ReactNode;\n};\n\n/**\n * @internal\n */\ntype OverlayMenuProps = {\n  label?: string;\n  onClose: () => void;\n  open: boolean;\n  children?: React.ReactNode;\n};\n\nconst useStyles = makeStyles<BackstageTheme, { sidebarConfig: SidebarConfig }>(\n  theme => ({\n    root: {\n      position: 'fixed',\n      backgroundColor: theme.palette.navigation.background,\n      color: theme.palette.navigation.color,\n      bottom: 0,\n      left: 0,\n      right: 0,\n      zIndex: theme.zIndex.snackbar,\n      // SidebarDivider color\n      borderTop: '1px solid #383838',\n    },\n\n    overlay: props => ({\n      background: theme.palette.navigation.background,\n      width: '100%',\n      bottom: `${props.sidebarConfig.mobileSidebarHeight}px`,\n      height: `calc(100% - ${props.sidebarConfig.mobileSidebarHeight}px)`,\n      flex: '0 1 auto',\n      overflow: 'auto',\n    }),\n\n    overlayHeader: {\n      display: 'flex',\n      color: theme.palette.text.primary,\n      alignItems: 'center',\n      justifyContent: 'space-between',\n      padding: theme.spacing(2, 3),\n    },\n\n    overlayHeaderClose: {\n      color: theme.palette.text.primary,\n    },\n\n    marginMobileSidebar: props => ({\n      marginBottom: `${props.sidebarConfig.mobileSidebarHeight}px`,\n    }),\n  }),\n);\n\nconst sortSidebarGroupsForPriority = (children: React.ReactElement[]) =>\n  orderBy(\n    children,\n    ({ props: { priority } }) => (Number.isInteger(priority) ? priority : -1),\n    'desc',\n  );\n\nconst sidebarGroupType = React.createElement(SidebarGroup).type;\n\nconst OverlayMenu = ({\n  children,\n  label = 'Menu',\n  open,\n  onClose,\n}: OverlayMenuProps) => {\n  const { sidebarConfig } = useContext(SidebarConfigContext);\n  const classes = useStyles({ sidebarConfig });\n\n  return (\n    <Drawer\n      anchor=\"bottom\"\n      open={open}\n      onClose={onClose}\n      ModalProps={{\n        BackdropProps: { classes: { root: classes.marginMobileSidebar } },\n      }}\n      classes={{\n        root: classes.marginMobileSidebar,\n        paperAnchorBottom: classes.overlay,\n      }}\n    >\n      <Box className={classes.overlayHeader}>\n        <Typography variant=\"h3\">{label}</Typography>\n        <IconButton\n          onClick={onClose}\n          classes={{ root: classes.overlayHeaderClose }}\n        >\n          <CloseIcon />\n        </IconButton>\n      </Box>\n      <Box component=\"nav\">{children}</Box>\n    </Drawer>\n  );\n};\n\n/**\n * Context on which `SidebarGroup` is currently selected\n *\n * @internal\n */\nexport const MobileSidebarContext = createContext<MobileSidebarContextType>({\n  selectedMenuItemIndex: -1,\n  setSelectedMenuItemIndex: () => {},\n});\n\n/**\n * A navigation component for mobile screens, which sticks to the bottom.\n *\n * @remarks\n * It alternates the normal sidebar by grouping the `SidebarItems` based on provided `SidebarGroup`s\n * either rendering them as a link or an overlay menu.\n * If no `SidebarGroup`s are provided the sidebar content is wrapped in an default overlay menu.\n *\n * @public\n */\nexport const MobileSidebar = (props: MobileSidebarProps) => {\n  const { sidebarConfig } = useContext(SidebarConfigContext);\n  const { children } = props;\n  const classes = useStyles({ sidebarConfig });\n  const location = useLocation();\n  const [selectedMenuItemIndex, setSelectedMenuItemIndex] =\n    useState<number>(-1);\n\n  useEffect(() => {\n    setSelectedMenuItemIndex(-1);\n  }, [location.pathname]);\n\n  // Filter children for SidebarGroups\n  //\n  // Directly comparing child.type with SidebarSubmenu will not work with in\n  // combination with react-hot-loader\n  //\n  // https://github.com/gaearon/react-hot-loader/issues/304#issuecomment-456569720\n  let sidebarGroups = useElementFilter(children, elements =>\n    elements.getElements().filter(child => child.type === sidebarGroupType),\n  );\n\n  if (!children) {\n    // If Sidebar has no children the MobileSidebar won't be rendered\n    return null;\n  } else if (!sidebarGroups.length) {\n    // If Sidebar has no SidebarGroup as a children a default\n    // SidebarGroup with the complete Sidebar content will be created\n    sidebarGroups.push(\n      <SidebarGroup key=\"default_menu\" icon={<MenuIcon />}>\n        {children}\n      </SidebarGroup>,\n    );\n  } else {\n    // Sort SidebarGroups for the given Priority\n    sidebarGroups = sortSidebarGroupsForPriority(sidebarGroups);\n  }\n\n  const shouldShowGroupChildren =\n    selectedMenuItemIndex >= 0 &&\n    !sidebarGroups[selectedMenuItemIndex].props.to;\n\n  return (\n    <SidebarOpenStateProvider value={{ isOpen: true, setOpen: () => {} }}>\n      <MobileSidebarContext.Provider\n        value={{ selectedMenuItemIndex, setSelectedMenuItemIndex }}\n      >\n        <OverlayMenu\n          label={\n            sidebarGroups[selectedMenuItemIndex] &&\n            (sidebarGroups[selectedMenuItemIndex]!.props.label as string)\n          }\n          open={shouldShowGroupChildren}\n          onClose={() => setSelectedMenuItemIndex(-1)}\n        >\n          {sidebarGroups[selectedMenuItemIndex] &&\n            (sidebarGroups[selectedMenuItemIndex].props\n              .children as React.ReactChildren)}\n        </OverlayMenu>\n        <BottomNavigation\n          className={classes.root}\n          data-testid=\"mobile-sidebar-root\"\n          component=\"nav\"\n        >\n          {sidebarGroups}\n        </BottomNavigation>\n      </MobileSidebarContext.Provider>\n    </SidebarOpenStateProvider>\n  );\n};\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { makeStyles } from '@material-ui/core/styles';\nimport useMediaQuery from '@material-ui/core/useMediaQuery';\nimport classnames from 'classnames';\n\nimport React, { useState, useContext, useRef } from 'react';\nimport Button from '@material-ui/core/Button';\n\nimport {\n  makeSidebarConfig,\n  makeSidebarSubmenuConfig,\n  SidebarConfig,\n  SidebarConfigContext,\n  SubmenuConfig,\n  SidebarOptions,\n  SubmenuOptions,\n} from './config';\nimport { BackstageTheme } from '@backstage/theme';\nimport { useContent } from './Page';\nimport { SidebarOpenStateProvider } from './SidebarOpenStateContext';\nimport { useSidebarPinState } from './SidebarPinStateContext';\nimport { MobileSidebar } from './MobileSidebar';\n\n/** @public */\nexport type SidebarClassKey = 'drawer' | 'drawerOpen';\nconst useStyles = makeStyles<BackstageTheme, { sidebarConfig: SidebarConfig }>(\n  theme => ({\n    drawer: props => ({\n      display: 'flex',\n      flexFlow: 'column nowrap',\n      alignItems: 'flex-start',\n      position: 'fixed',\n      left: 0,\n      top: 0,\n      bottom: 0,\n      zIndex: theme.zIndex.appBar,\n      background: theme.palette.navigation.background,\n      overflowX: 'hidden',\n      msOverflowStyle: 'none',\n      scrollbarWidth: 'none',\n      width: props.sidebarConfig.drawerWidthClosed,\n      transition: theme.transitions.create('width', {\n        easing: theme.transitions.easing.sharp,\n        duration: theme.transitions.duration.shortest,\n      }),\n      '& > *': {\n        flexShrink: 0,\n      },\n      '&::-webkit-scrollbar': {\n        display: 'none',\n      },\n    }),\n    drawerOpen: props => ({\n      width: props.sidebarConfig.drawerWidthOpen,\n      transition: theme.transitions.create('width', {\n        easing: theme.transitions.easing.sharp,\n        duration: theme.transitions.duration.shorter,\n      }),\n    }),\n    visuallyHidden: {\n      top: 0,\n      position: 'absolute',\n      zIndex: 1000,\n      transform: 'translateY(-200%)',\n      '&:focus': {\n        transform: 'translateY(5px)',\n      },\n    },\n  }),\n  { name: 'BackstageSidebar' },\n);\n\nenum State {\n  Closed,\n  Idle,\n  Open,\n}\n\n/** @public */\nexport type SidebarProps = {\n  openDelayMs?: number;\n  closeDelayMs?: number;\n  sidebarOptions?: SidebarOptions;\n  submenuOptions?: SubmenuOptions;\n  disableExpandOnHover?: boolean;\n  children?: React.ReactNode;\n};\n\nexport type DesktopSidebarProps = {\n  openDelayMs?: number;\n  closeDelayMs?: number;\n  disableExpandOnHover?: boolean;\n  children?: React.ReactNode;\n};\n\n/**\n * Places the Sidebar & wraps the children providing context weather the `Sidebar` is open or not.\n *\n * Handles & delays hover events for expanding the `Sidebar`\n *\n * @param props `disableExpandOnHover` disables the default hover behaviour;\n * `openDelayMs` & `closeDelayMs` set delay until sidebar will open/close on hover\n * @returns\n * @internal\n */\nconst DesktopSidebar = (props: DesktopSidebarProps) => {\n  const { sidebarConfig } = useContext(SidebarConfigContext);\n  const {\n    openDelayMs = sidebarConfig.defaultOpenDelayMs,\n    closeDelayMs = sidebarConfig.defaultCloseDelayMs,\n    disableExpandOnHover,\n    children,\n  } = props;\n\n  const classes = useStyles({ sidebarConfig });\n  const isSmallScreen = useMediaQuery<BackstageTheme>(\n    theme => theme.breakpoints.down('md'),\n    { noSsr: true },\n  );\n  const [state, setState] = useState(State.Closed);\n  const hoverTimerRef = useRef<number>();\n  const { isPinned, toggleSidebarPinState } = useSidebarPinState();\n\n  const handleOpen = () => {\n    if (isPinned || disableExpandOnHover) {\n      return;\n    }\n    if (hoverTimerRef.current) {\n      clearTimeout(hoverTimerRef.current);\n      hoverTimerRef.current = undefined;\n    }\n    if (state !== State.Open && !isSmallScreen) {\n      hoverTimerRef.current = window.setTimeout(() => {\n        hoverTimerRef.current = undefined;\n        setState(State.Open);\n      }, openDelayMs);\n\n      setState(State.Idle);\n    }\n  };\n\n  const handleClose = () => {\n    if (isPinned || disableExpandOnHover) {\n      return;\n    }\n    if (hoverTimerRef.current) {\n      clearTimeout(hoverTimerRef.current);\n      hoverTimerRef.current = undefined;\n    }\n    if (state === State.Idle) {\n      setState(State.Closed);\n    } else if (state === State.Open) {\n      hoverTimerRef.current = window.setTimeout(() => {\n        hoverTimerRef.current = undefined;\n        setState(State.Closed);\n      }, closeDelayMs);\n    }\n  };\n\n  const isOpen = (state === State.Open && !isSmallScreen) || isPinned;\n\n  /**\n   * Close/Open Sidebar directily without delays. Also toggles `SidebarPinState` to avoid hidden content behind Sidebar.\n   */\n  const setOpen = (open: boolean) => {\n    if (open) {\n      setState(State.Open);\n      toggleSidebarPinState();\n    } else {\n      setState(State.Closed);\n      toggleSidebarPinState();\n    }\n  };\n\n  return (\n    <nav style={{}} aria-label=\"sidebar nav\">\n      <A11ySkipSidebar />\n      <SidebarOpenStateProvider value={{ isOpen, setOpen }}>\n        <div\n          className={classes.root}\n          data-testid=\"sidebar-root\"\n          onMouseEnter={disableExpandOnHover ? () => {} : handleOpen}\n          onFocus={disableExpandOnHover ? () => {} : handleOpen}\n          onMouseLeave={disableExpandOnHover ? () => {} : handleClose}\n          onBlur={disableExpandOnHover ? () => {} : handleClose}\n        >\n          <div\n            className={classnames(classes.drawer, {\n              [classes.drawerOpen]: isOpen,\n            })}\n          >\n            {children}\n          </div>\n        </div>\n      </SidebarOpenStateProvider>\n    </nav>\n  );\n};\n\n/**\n * Passing children into the desktop or mobile sidebar depending on the context\n *\n * @public\n */\nexport const Sidebar = (props: SidebarProps) => {\n  const sidebarConfig: SidebarConfig = makeSidebarConfig(\n    props.sidebarOptions ?? {},\n  );\n  const submenuConfig: SubmenuConfig = makeSidebarSubmenuConfig(\n    props.submenuOptions ?? {},\n  );\n  const { children, disableExpandOnHover, openDelayMs, closeDelayMs } = props;\n  const { isMobile } = useSidebarPinState();\n\n  return isMobile ? (\n    <MobileSidebar>{children}</MobileSidebar>\n  ) : (\n    <SidebarConfigContext.Provider value={{ sidebarConfig, submenuConfig }}>\n      <DesktopSidebar\n        openDelayMs={openDelayMs}\n        closeDelayMs={closeDelayMs}\n        disableExpandOnHover={disableExpandOnHover}\n      >\n        {children}\n      </DesktopSidebar>\n    </SidebarConfigContext.Provider>\n  );\n};\n\nfunction A11ySkipSidebar() {\n  const { sidebarConfig } = useContext(SidebarConfigContext);\n  const { focusContent, contentRef } = useContent();\n  const classes = useStyles({ sidebarConfig });\n\n  if (!contentRef?.current) {\n    return null;\n  }\n  return (\n    <Button\n      onClick={focusContent}\n      variant=\"contained\"\n      className={classnames(classes.visuallyHidden)}\n    >\n      Skip to content\n    </Button>\n  );\n}\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { Location, Path } from 'history';\nimport { isEqual, isMatch } from 'lodash';\nimport qs from 'qs';\n\nexport function isLocationMatch(currentLocation: Location, toLocation: Path) {\n  const toDecodedSearch = new URLSearchParams(toLocation.search).toString();\n  const toQueryParameters = qs.parse(toDecodedSearch);\n\n  const currentDecodedSearch = new URLSearchParams(\n    currentLocation.search,\n  ).toString();\n  const currentQueryParameters = qs.parse(currentDecodedSearch);\n\n  const matching =\n    isEqual(toLocation.pathname, currentLocation.pathname) &&\n    isMatch(currentQueryParameters, toQueryParameters);\n\n  return matching;\n}\n","/*\n * Copyright 2021 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport React, { useContext, useState } from 'react';\nimport { resolvePath, useLocation, useResolvedPath } from 'react-router-dom';\nimport { makeStyles } from '@material-ui/core/styles';\nimport Tooltip from '@material-ui/core/Tooltip';\nimport Typography from '@material-ui/core/Typography';\nimport { Link } from '../../components/Link';\nimport { IconComponent } from '@backstage/core-plugin-api';\nimport classnames from 'classnames';\nimport { BackstageTheme } from '@backstage/theme';\nimport ArrowDropDownIcon from '@material-ui/icons/ArrowDropDown';\nimport ArrowDropUpIcon from '@material-ui/icons/ArrowDropUp';\nimport { SidebarItemWithSubmenuContext } from './config';\nimport { isLocationMatch } from './utils';\n\nconst useStyles = makeStyles<BackstageTheme>(\n  theme => ({\n    item: {\n      height: 48,\n      width: '100%',\n      '&:hover': {\n        background: '#6f6f6f',\n        color: theme.palette.navigation.selectedColor,\n      },\n      display: 'flex',\n      alignItems: 'center',\n      color: theme.palette.navigation.color,\n      padding: 20,\n      cursor: 'pointer',\n      position: 'relative',\n      background: 'none',\n      border: 'none',\n    },\n    itemContainer: {\n      width: '100%',\n    },\n    selected: {\n      background: '#6f6f6f',\n      color: '#FFF',\n    },\n    label: {\n      margin: 14,\n      marginLeft: 7,\n      fontSize: 14,\n      whiteSpace: 'nowrap',\n      overflow: 'hidden',\n      'text-overflow': 'ellipsis',\n      lineHeight: 1,\n    },\n    subtitle: {\n      fontSize: 10,\n      whiteSpace: 'nowrap',\n      overflow: 'hidden',\n      'text-overflow': 'ellipsis',\n    },\n    dropdownArrow: {\n      position: 'absolute',\n      right: 21,\n    },\n    dropdown: {\n      display: 'flex',\n      flexDirection: 'column',\n      alignItems: 'end',\n    },\n    dropdownItem: {\n      width: '100%',\n      padding: '10px 0 10px 0',\n      '&:hover': {\n        background: '#6f6f6f',\n        color: theme.palette.navigation.selectedColor,\n      },\n    },\n    textContent: {\n      color: theme.palette.navigation.color,\n      paddingLeft: theme.spacing(4),\n      paddingRight: theme.spacing(1),\n      fontSize: '14px',\n      whiteSpace: 'nowrap',\n      overflow: 'hidden',\n      'text-overflow': 'ellipsis',\n    },\n  }),\n  { name: 'BackstageSidebarSubmenuItem' },\n);\n\n/**\n * Clickable item displayed when submenu item is clicked.\n * title: Text content of item\n * to: Path to navigate to when item is clicked\n *\n * @public\n */\nexport type SidebarSubmenuItemDropdownItem = {\n  title: string;\n  to: string;\n};\n/**\n * Holds submenu item content.\n *\n * @remarks\n * title: Text content of submenu item\n * subtitle: A subtitle displayed under the main title\n * to: Path to navigate to when item is clicked\n * icon: Icon displayed on the left of text content\n * dropdownItems: Optional array of dropdown items displayed when submenu item is clicked.\n *\n * @public\n */\nexport type SidebarSubmenuItemProps = {\n  title: string;\n  subtitle?: string;\n  to?: string;\n  icon?: IconComponent;\n  dropdownItems?: SidebarSubmenuItemDropdownItem[];\n};\n\n/**\n * Item used inside a submenu within the sidebar.\n *\n * @public\n */\nexport const SidebarSubmenuItem = (props: SidebarSubmenuItemProps) => {\n  const { title, subtitle, to, icon: Icon, dropdownItems } = props;\n  const classes = useStyles();\n  const { setIsHoveredOn } = useContext(SidebarItemWithSubmenuContext);\n  const closeSubmenu = () => {\n    setIsHoveredOn(false);\n  };\n  const toLocation = useResolvedPath(to ?? '');\n  const currentLocation = useLocation();\n  let isActive = isLocationMatch(currentLocation, toLocation);\n\n  const [showDropDown, setShowDropDown] = useState(false);\n  const handleClickDropdown = () => {\n    setShowDropDown(!showDropDown);\n  };\n  if (dropdownItems !== undefined) {\n    dropdownItems.some(item => {\n      const resolvedPath = resolvePath(item.to);\n      isActive = isLocationMatch(currentLocation, resolvedPath);\n      return isActive;\n    });\n    return (\n      <div className={classes.itemContainer}>\n        <Tooltip title={title} enterDelay={500} enterNextDelay={500}>\n          <button\n            onClick={handleClickDropdown}\n            onTouchStart={e => e.stopPropagation()}\n            className={classnames(\n              classes.item,\n              isActive ? classes.selected : undefined,\n            )}\n          >\n            {Icon && <Icon fontSize=\"small\" />}\n            <Typography variant=\"subtitle1\" className={classes.label}>\n              {title}\n              <br />\n              {subtitle && (\n                <Typography variant=\"caption\" className={classes.subtitle}>\n                  {subtitle}\n                </Typography>\n              )}\n            </Typography>\n            {showDropDown ? (\n              <ArrowDropUpIcon className={classes.dropdownArrow} />\n            ) : (\n              <ArrowDropDownIcon className={classes.dropdownArrow} />\n            )}\n          </button>\n        </Tooltip>\n        {dropdownItems && showDropDown && (\n          <div className={classes.dropdown}>\n            {dropdownItems.map((object, key) => (\n              <Tooltip\n                key={key}\n                title={object.title}\n                enterDelay={500}\n                enterNextDelay={500}\n              >\n                <Link\n                  to={object.to}\n                  underline=\"none\"\n                  className={classes.dropdownItem}\n                  onClick={closeSubmenu}\n                  onTouchStart={e => e.stopPropagation()}\n                >\n                  <Typography className={classes.textContent}>\n                    {object.title}\n                  </Typography>\n                </Link>\n              </Tooltip>\n            ))}\n          </div>\n        )}\n      </div>\n    );\n  }\n\n  return (\n    <div className={classes.itemContainer}>\n      <Tooltip title={title} enterDelay={500} enterNextDelay={500}>\n        <Link\n          to={to!}\n          underline=\"none\"\n          className={classnames(\n            classes.item,\n            isActive ? classes.selected : undefined,\n          )}\n          onClick={closeSubmenu}\n          onTouchStart={e => e.stopPropagation()}\n        >\n          {Icon && <Icon fontSize=\"small\" />}\n          <Typography variant=\"subtitle1\" className={classes.label}>\n            {title}\n            <br />\n            {subtitle && (\n              <Typography variant=\"caption\" className={classes.subtitle}>\n                {subtitle}\n              </Typography>\n            )}\n          </Typography>\n        </Link>\n      </Tooltip>\n    </div>\n  );\n};\n","/*\n * Copyright 2021 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport { makeStyles } from '@material-ui/core/styles';\nimport Typography from '@material-ui/core/Typography';\nimport classnames from 'classnames';\nimport React, { ReactNode, useContext, useEffect, useState } from 'react';\nimport {\n  SidebarItemWithSubmenuContext,\n  SidebarConfigContext,\n  SubmenuConfig,\n} from './config';\nimport { useSidebarOpenState } from './SidebarOpenStateContext';\nimport { BackstageTheme } from '@backstage/theme';\n\nconst useStyles = makeStyles<\n  BackstageTheme,\n  { submenuConfig: SubmenuConfig; left: number }\n>(\n  theme => ({\n    root: {\n      zIndex: 1000,\n      position: 'relative',\n      overflow: 'visible',\n      width: theme.spacing(7) + 1,\n    },\n    drawer: props => ({\n      display: 'flex',\n      flexFlow: 'column nowrap',\n      alignItems: 'flex-start',\n      position: 'fixed',\n      [theme.breakpoints.up('sm')]: {\n        marginLeft: props.left,\n        transition: theme.transitions.create('margin-left', {\n          easing: theme.transitions.easing.sharp,\n          duration: theme.transitions.duration.shortest,\n        }),\n      },\n      top: 0,\n      bottom: 0,\n      padding: 0,\n      background: theme.palette.navigation.submenu?.background ?? '#404040',\n      overflowX: 'hidden',\n      msOverflowStyle: 'none',\n      scrollbarWidth: 'none',\n      cursor: 'default',\n      width: props.submenuConfig.drawerWidthClosed,\n      transitionDelay: `${props.submenuConfig.defaultOpenDelayMs}ms`,\n      '& > *': {\n        flexShrink: 0,\n      },\n      '&::-webkit-scrollbar': {\n        display: 'none',\n      },\n    }),\n    drawerOpen: props => ({\n      width: props.submenuConfig.drawerWidthOpen,\n      [theme.breakpoints.down('xs')]: {\n        width: '100%',\n        position: 'relative',\n        paddingLeft: theme.spacing(3),\n        left: 0,\n        top: 0,\n      },\n    }),\n    title: {\n      fontSize: 24,\n      fontWeight: 500,\n      color: '#FFF',\n      padding: 20,\n      [theme.breakpoints.down('xs')]: {\n        display: 'none',\n      },\n    },\n  }),\n  { name: 'BackstageSidebarSubmenu' },\n);\n\n/**\n * Holds a title for text Header of a sidebar submenu and children\n * components to be rendered inside SidebarSubmenu\n *\n * @public\n */\nexport type SidebarSubmenuProps = {\n  title?: string;\n  children: ReactNode;\n};\n\n/**\n * Used inside SidebarItem to display an expandable Submenu\n *\n * @public\n */\nexport const SidebarSubmenu = (props: SidebarSubmenuProps) => {\n  const { isOpen } = useSidebarOpenState();\n  const { sidebarConfig, submenuConfig } = useContext(SidebarConfigContext);\n  const left = isOpen\n    ? sidebarConfig.drawerWidthOpen\n    : sidebarConfig.drawerWidthClosed;\n  const classes = useStyles({ left, submenuConfig });\n\n  const { isHoveredOn } = useContext(SidebarItemWithSubmenuContext);\n  const [isSubmenuOpen, setIsSubmenuOpen] = useState(false);\n\n  useEffect(() => {\n    setIsSubmenuOpen(isHoveredOn);\n  }, [isHoveredOn]);\n\n  return (\n    <div\n      className={classnames(classes.drawer, {\n        [classes.drawerOpen]: isSubmenuOpen,\n      })}\n    >\n      <Typography variant=\"h5\" className={classes.title}>\n        {props.title}\n      </Typography>\n      {props.children}\n    </div>\n  );\n};\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React from 'react';\nimport { makeStyles } from '@material-ui/core/styles';\nimport ArrowBackIosIcon from '@material-ui/icons/ArrowBackIos';\n\nconst useStyles = makeStyles({\n  iconContainer: {\n    display: 'flex',\n    position: 'relative',\n    width: '100%',\n  },\n  arrow1: {\n    right: '6px',\n    position: 'absolute',\n  },\n});\n\nconst DoubleArrowLeft = () => {\n  const classes = useStyles();\n\n  return (\n    <div className={classes.iconContainer}>\n      <div className={classes.arrow1}>\n        <ArrowBackIosIcon style={{ fontSize: '12px' }} />\n      </div>\n      <div>\n        <ArrowBackIosIcon style={{ fontSize: '12px' }} />\n      </div>\n    </div>\n  );\n};\n\nexport default DoubleArrowLeft;\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React from 'react';\nimport { makeStyles } from '@material-ui/core/styles';\nimport ArrowForwardIosIcon from '@material-ui/icons/ArrowForwardIos';\n\nconst useStyles = makeStyles({\n  iconContainer: {\n    display: 'flex',\n    position: 'relative',\n    width: '100%',\n  },\n  arrow1: {\n    right: '6px',\n    position: 'absolute',\n  },\n});\n\nconst DoubleArrowRight = () => {\n  const classes = useStyles();\n\n  return (\n    <div className={classes.iconContainer}>\n      <div className={classes.arrow1}>\n        <ArrowForwardIosIcon style={{ fontSize: '12px' }} />\n      </div>\n      <div>\n        <ArrowForwardIosIcon style={{ fontSize: '12px' }} />\n      </div>\n    </div>\n  );\n};\n\nexport default DoubleArrowRight;\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { IconComponent, useElementFilter } from '@backstage/core-plugin-api';\nimport { BackstageTheme } from '@backstage/theme';\nimport { makeStyles, styled, Theme } from '@material-ui/core/styles';\nimport useMediaQuery from '@material-ui/core/useMediaQuery';\nimport Badge from '@material-ui/core/Badge';\nimport TextField from '@material-ui/core/TextField';\nimport Typography from '@material-ui/core/Typography';\nimport {\n  CreateCSSProperties,\n  StyledComponentProps,\n} from '@material-ui/core/styles/withStyles';\nimport ArrowRightIcon from '@material-ui/icons/ArrowRight';\nimport SearchIcon from '@material-ui/icons/Search';\nimport ArrowDropUp from '@material-ui/icons/ArrowDropUp';\nimport ArrowDropDown from '@material-ui/icons/ArrowDropDown';\nimport classnames from 'classnames';\nimport React, {\n  ComponentProps,\n  ComponentType,\n  CSSProperties,\n  forwardRef,\n  KeyboardEventHandler,\n  ReactNode,\n  useContext,\n  useMemo,\n  useState,\n} from 'react';\nimport {\n  Link,\n  NavLinkProps,\n  resolvePath,\n  useLocation,\n  useResolvedPath,\n} from 'react-router-dom';\nimport {\n  SidebarConfigContext,\n  SidebarItemWithSubmenuContext,\n  SidebarConfig,\n} from './config';\nimport {\n  SidebarSubmenuItemProps,\n  SidebarSubmenuProps,\n  SidebarSubmenu,\n} from '.';\nimport DoubleArrowLeft from './icons/DoubleArrowLeft';\nimport DoubleArrowRight from './icons/DoubleArrowRight';\nimport { isLocationMatch } from './utils';\nimport { Location } from 'history';\nimport { useSidebarOpenState } from './SidebarOpenStateContext';\n\n/** @public */\nexport type SidebarItemClassKey =\n  | 'root'\n  | 'buttonItem'\n  | 'closed'\n  | 'open'\n  | 'highlightable'\n  | 'highlighted'\n  | 'label'\n  | 'iconContainer'\n  | 'searchRoot'\n  | 'searchField'\n  | 'searchFieldHTMLInput'\n  | 'searchContainer'\n  | 'secondaryAction'\n  | 'closedItemIcon'\n  | 'submenuArrow'\n  | 'expandButton'\n  | 'arrows'\n  | 'selected';\n\nconst makeSidebarStyles = (sidebarConfig: SidebarConfig) =>\n  makeStyles<BackstageTheme>(\n    theme => ({\n      root: {\n        color: theme.palette.navigation.color,\n        display: 'flex',\n        flexFlow: 'row nowrap',\n        alignItems: 'center',\n        height: 48,\n        cursor: 'pointer',\n      },\n      buttonItem: {\n        background: 'none',\n        border: 'none',\n        width: '100%',\n        margin: 0,\n        padding: 0,\n        textAlign: 'inherit',\n        font: 'inherit',\n      },\n      closed: {\n        width: sidebarConfig.drawerWidthClosed,\n        justifyContent: 'center',\n      },\n      open: {\n        [theme.breakpoints.up('sm')]: {\n          width: sidebarConfig.drawerWidthOpen,\n        },\n      },\n      highlightable: {\n        '&:hover': {\n          background:\n            theme.palette.navigation.navItem?.hoverBackground ?? '#404040',\n        },\n      },\n      highlighted: {\n        background:\n          theme.palette.navigation.navItem?.hoverBackground ?? '#404040',\n      },\n      label: {\n        // XXX (@koroeskohr): I can't seem to achieve the desired font-weight from the designs\n        fontWeight: 'bold',\n        whiteSpace: 'nowrap',\n        lineHeight: 'auto',\n        flex: '3 1 auto',\n        width: '110px',\n        overflow: 'hidden',\n        'text-overflow': 'ellipsis',\n      },\n      iconContainer: {\n        boxSizing: 'border-box',\n        height: '100%',\n        width: sidebarConfig.iconContainerWidth,\n        marginRight: -theme.spacing(2),\n        display: 'flex',\n        alignItems: 'center',\n        justifyContent: 'center',\n      },\n      searchRoot: {\n        marginBottom: 12,\n      },\n      searchField: {\n        color: '#b5b5b5',\n        fontWeight: 'bold',\n        fontSize: theme.typography.fontSize,\n      },\n      searchFieldHTMLInput: {\n        padding: theme.spacing(2, 0, 2),\n      },\n      searchContainer: {\n        width: sidebarConfig.drawerWidthOpen - sidebarConfig.iconContainerWidth,\n      },\n      secondaryAction: {\n        width: theme.spacing(6),\n        textAlign: 'center',\n        marginRight: theme.spacing(1),\n      },\n      closedItemIcon: {\n        width: '100%',\n        justifyContent: 'center',\n      },\n      submenuArrow: {\n        display: 'flex',\n      },\n      expandButton: {\n        background: 'none',\n        border: 'none',\n        color: theme.palette.navigation.color,\n        width: '100%',\n        cursor: 'pointer',\n        position: 'relative',\n        height: 48,\n      },\n      arrows: {\n        position: 'absolute',\n        right: 10,\n      },\n      selected: {\n        '&$root': {\n          borderLeft: `solid ${sidebarConfig.selectedIndicatorWidth}px ${theme.palette.navigation.indicator}`,\n          color: theme.palette.navigation.selectedColor,\n        },\n        '&$closed': {\n          width: sidebarConfig.drawerWidthClosed,\n        },\n        '& $closedItemIcon': {\n          paddingRight: sidebarConfig.selectedIndicatorWidth,\n        },\n        '& $iconContainer': {\n          marginLeft: -sidebarConfig.selectedIndicatorWidth,\n        },\n      },\n    }),\n    { name: 'BackstageSidebarItem' },\n  );\n\n// This is a workaround for this issue https://github.com/mui/material-ui/issues/15511\n// The styling of the `selected` elements doesn't work as expected when using a prop callback.\n// Don't use this pattern unless needed\nfunction useMemoStyles(sidebarConfig: SidebarConfig) {\n  const useStyles = useMemo(\n    () => makeSidebarStyles(sidebarConfig),\n    [sidebarConfig],\n  );\n  return useStyles();\n}\n\n/**\n * Evaluates the routes of the SubmenuItems & nested DropdownItems.\n * The reeveluation is only triggered, if the `locationPathname` changes, as `useElementFilter` uses memorization.\n *\n * @param submenu SidebarSubmenu component\n * @param location Location\n * @returns boolean\n */\nconst useLocationMatch = (\n  submenu: React.ReactElement<SidebarSubmenuProps>,\n  location: Location,\n): boolean =>\n  useElementFilter(\n    submenu.props.children,\n    elements => {\n      let active = false;\n      elements\n        .getElements()\n        .forEach(\n          ({\n            props: { to, dropdownItems },\n          }: {\n            props: Partial<SidebarSubmenuItemProps>;\n          }) => {\n            if (!active) {\n              if (dropdownItems?.length) {\n                dropdownItems.forEach(\n                  ({ to: _to }) =>\n                    (active =\n                      active || isLocationMatch(location, resolvePath(_to))),\n                );\n                return;\n              }\n              if (to) {\n                active = isLocationMatch(location, resolvePath(to));\n              }\n            }\n          },\n        );\n      return active;\n    },\n    [location.pathname],\n  );\n\ntype SidebarItemBaseProps = {\n  icon: IconComponent;\n  text?: string;\n  hasNotifications?: boolean;\n  hasSubmenu?: boolean;\n  disableHighlight?: boolean;\n  className?: string;\n};\n\ntype SidebarItemButtonProps = SidebarItemBaseProps & {\n  onClick: (ev: React.MouseEvent) => void;\n  children?: ReactNode;\n};\n\ntype SidebarItemLinkProps = SidebarItemBaseProps & {\n  to: string;\n  onClick?: (ev: React.MouseEvent) => void;\n} & NavLinkProps;\n\ntype SidebarItemWithSubmenuProps = SidebarItemBaseProps & {\n  to?: string;\n  onClick?: (ev: React.MouseEvent) => void;\n  children: ReactNode;\n};\n\n/**\n * SidebarItem with 'to' property will be a clickable link.\n * SidebarItem with 'onClick' property and without 'to' property will be a clickable button.\n * SidebarItem which wraps a SidebarSubmenu will be a clickable button which opens a submenu.\n */\ntype SidebarItemProps =\n  | SidebarItemLinkProps\n  | SidebarItemButtonProps\n  | SidebarItemWithSubmenuProps;\n\nfunction isButtonItem(\n  props: SidebarItemProps,\n): props is SidebarItemButtonProps {\n  return (props as SidebarItemLinkProps).to === undefined;\n}\n\nconst sidebarSubmenuType = React.createElement(SidebarSubmenu).type;\n\n// TODO(Rugvip): Remove this once NavLink is updated in react-router-dom.\n//               This is needed because react-router doesn't handle the path comparison\n//               properly yet, matching for example /foobar with /foo.\nexport const WorkaroundNavLink = React.forwardRef<\n  HTMLAnchorElement,\n  NavLinkProps & { activeStyle?: CSSProperties; activeClassName?: string }\n>(function WorkaroundNavLinkWithRef(\n  {\n    to,\n    end,\n    style,\n    className,\n    activeStyle,\n    caseSensitive,\n    activeClassName = 'active',\n    'aria-current': ariaCurrentProp = 'page',\n    ...rest\n  },\n  ref,\n) {\n  let { pathname: locationPathname } = useLocation();\n  let { pathname: toPathname } = useResolvedPath(to);\n\n  if (!caseSensitive) {\n    locationPathname = locationPathname.toLocaleLowerCase('en-US');\n    toPathname = toPathname.toLocaleLowerCase('en-US');\n  }\n\n  let isActive = locationPathname === toPathname;\n  if (!isActive && !end) {\n    // This is the behavior that is different from the original NavLink\n    isActive = locationPathname.startsWith(`${toPathname}/`);\n  }\n\n  const ariaCurrent = isActive ? ariaCurrentProp : undefined;\n\n  return (\n    <Link\n      {...rest}\n      to={to}\n      ref={ref}\n      aria-current={ariaCurrent}\n      style={{ ...style, ...(isActive ? activeStyle : undefined) }}\n      className={classnames([\n        className,\n        isActive ? activeClassName : undefined,\n      ])}\n    />\n  );\n});\n\n/**\n * Common component used by SidebarItem & SidebarItemWithSubmenu\n */\nconst SidebarItemBase = forwardRef<any, SidebarItemProps>((props, ref) => {\n  const {\n    icon: Icon,\n    text,\n    hasNotifications = false,\n    hasSubmenu = false,\n    disableHighlight = false,\n    onClick,\n    children,\n    className,\n    ...navLinkProps\n  } = props;\n  const { sidebarConfig } = useContext(SidebarConfigContext);\n  const classes = useMemoStyles(sidebarConfig);\n  // XXX (@koroeskohr): unsure this is optimal. But I just really didn't want to have the item component\n  // depend on the current location, and at least have it being optionally forced to selected.\n  // Still waiting on a Q answered to fine tune the implementation\n  const { isOpen } = useSidebarOpenState();\n\n  const divStyle =\n    !isOpen && hasSubmenu ? { display: 'flex', marginLeft: '24px' } : {};\n\n  const displayItemIcon = (\n    <div style={divStyle}>\n      <Icon fontSize=\"small\" />\n      {!isOpen && hasSubmenu ? <ArrowRightIcon /> : <></>}\n    </div>\n  );\n\n  const itemIcon = (\n    <Badge\n      color=\"secondary\"\n      variant=\"dot\"\n      overlap=\"circular\"\n      invisible={!hasNotifications}\n      className={classnames({ [classes.closedItemIcon]: !isOpen })}\n    >\n      {displayItemIcon}\n    </Badge>\n  );\n\n  const openContent = (\n    <>\n      <div data-testid=\"login-button\" className={classes.iconContainer}>\n        {itemIcon}\n      </div>\n      {text && (\n        <Typography variant=\"subtitle2\" className={classes.label}>\n          {text}\n        </Typography>\n      )}\n      <div className={classes.secondaryAction}>{children}</div>\n    </>\n  );\n\n  const content = isOpen ? openContent : itemIcon;\n\n  const childProps = {\n    onClick,\n    className: classnames(\n      className,\n      classes.root,\n      isOpen ? classes.open : classes.closed,\n      isButtonItem(props) && classes.buttonItem,\n      { [classes.highlightable]: !disableHighlight },\n    ),\n  };\n\n  if (isButtonItem(props)) {\n    return (\n      <button aria-label={text} {...childProps} ref={ref}>\n        {content}\n      </button>\n    );\n  }\n\n  return (\n    <WorkaroundNavLink\n      {...childProps}\n      activeClassName={classes.selected}\n      to={props.to ? props.to : ''}\n      ref={ref}\n      aria-label={text ? text : props.to}\n      {...navLinkProps}\n    >\n      {content}\n    </WorkaroundNavLink>\n  );\n});\n\nconst SidebarItemWithSubmenu = ({\n  children,\n  ...props\n}: SidebarItemBaseProps & {\n  children: React.ReactElement<SidebarSubmenuProps>;\n}) => {\n  const { sidebarConfig } = useContext(SidebarConfigContext);\n  const classes = useMemoStyles(sidebarConfig);\n  const [isHoveredOn, setIsHoveredOn] = useState(false);\n  const location = useLocation();\n  const isActive = useLocationMatch(children, location);\n  const isSmallScreen = useMediaQuery<BackstageTheme>((theme: BackstageTheme) =>\n    theme.breakpoints.down('sm'),\n  );\n\n  const handleMouseEnter = () => {\n    setIsHoveredOn(true);\n  };\n  const handleMouseLeave = () => {\n    setIsHoveredOn(false);\n  };\n\n  const arrowIcon = () => {\n    if (isSmallScreen) {\n      return isHoveredOn ? (\n        <ArrowDropUp fontSize=\"small\" className={classes.submenuArrow} />\n      ) : (\n        <ArrowDropDown fontSize=\"small\" className={classes.submenuArrow} />\n      );\n    }\n    return (\n      !isHoveredOn && (\n        <ArrowRightIcon fontSize=\"small\" className={classes.submenuArrow} />\n      )\n    );\n  };\n\n  return (\n    <SidebarItemWithSubmenuContext.Provider\n      value={{\n        isHoveredOn,\n        setIsHoveredOn,\n      }}\n    >\n      <div\n        data-testid=\"item-with-submenu\"\n        onMouseLeave={handleMouseLeave}\n        onTouchStart={isHoveredOn ? handleMouseLeave : handleMouseEnter}\n        onMouseEnter={handleMouseEnter}\n        className={classnames(isHoveredOn && classes.highlighted)}\n      >\n        <SidebarItemBase\n          hasSubmenu\n          className={isActive ? classes.selected : ''}\n          {...props}\n        >\n          {arrowIcon()}\n        </SidebarItemBase>\n        {isHoveredOn && children}\n      </div>\n    </SidebarItemWithSubmenuContext.Provider>\n  );\n};\n\n/**\n * Creates a `SidebarItem`\n *\n * @remarks\n * If children contain a `SidebarSubmenu` component the `SidebarItem` will have a expandable submenu\n */\nexport const SidebarItem = forwardRef<any, SidebarItemProps>((props, ref) => {\n  // Filter children for SidebarSubmenu components\n  const [submenu] = useElementFilter(props.children, elements =>\n    // Directly comparing child.type with SidebarSubmenu will not work with in\n    // combination with react-hot-loader\n    //\n    // https://github.com/gaearon/react-hot-loader/issues/304#issuecomment-456569720\n    elements.getElements().filter(child => child.type === sidebarSubmenuType),\n  );\n\n  if (submenu) {\n    return (\n      <SidebarItemWithSubmenu {...props}>\n        {submenu as React.ReactElement<SidebarSubmenuProps>}\n      </SidebarItemWithSubmenu>\n    );\n  }\n\n  return <SidebarItemBase {...props} ref={ref} />;\n}) as (props: SidebarItemProps) => JSX.Element;\n\ntype SidebarSearchFieldProps = {\n  onSearch: (input: string) => void;\n  to?: string;\n  icon?: IconComponent;\n};\n\nexport function SidebarSearchField(props: SidebarSearchFieldProps) {\n  const { sidebarConfig } = useContext(SidebarConfigContext);\n  const [input, setInput] = useState('');\n  const classes = useMemoStyles(sidebarConfig);\n  const Icon = props.icon ? props.icon : SearchIcon;\n\n  const search = () => {\n    props.onSearch(input);\n    setInput('');\n  };\n\n  const handleEnter: KeyboardEventHandler = ev => {\n    if (ev.key === 'Enter') {\n      ev.preventDefault();\n      search();\n    }\n  };\n\n  const handleInput = (ev: React.ChangeEvent<HTMLInputElement>) => {\n    setInput(ev.target.value);\n  };\n\n  const handleInputClick = (ev: React.MouseEvent<HTMLInputElement>) => {\n    // Clicking into the search fields shouldn't navigate to the search page\n    ev.preventDefault();\n    ev.stopPropagation();\n  };\n\n  const handleItemClick = (ev: React.MouseEvent) => {\n    // Clicking on the search icon while should execute a query with the current field content\n    search();\n    ev.preventDefault();\n  };\n\n  return (\n    <div className={classes.searchRoot}>\n      <SidebarItem\n        icon={Icon}\n        to={props.to}\n        onClick={handleItemClick}\n        disableHighlight\n      >\n        <TextField\n          placeholder=\"Search\"\n          value={input}\n          onClick={handleInputClick}\n          onChange={handleInput}\n          onKeyDown={handleEnter}\n          className={classes.searchContainer}\n          InputProps={{\n            disableUnderline: true,\n            className: classes.searchField,\n          }}\n          inputProps={{\n            className: classes.searchFieldHTMLInput,\n          }}\n        />\n      </SidebarItem>\n    </div>\n  );\n}\n\nexport type SidebarSpaceClassKey = 'root';\n\nexport const SidebarSpace = styled('div')(\n  {\n    flex: 1,\n  },\n  { name: 'BackstageSidebarSpace' },\n) as ComponentType<ComponentProps<'div'> & StyledComponentProps<'root'>>;\n\nexport type SidebarSpacerClassKey = 'root';\n\nexport const SidebarSpacer = styled('div')(\n  {\n    height: 8,\n  },\n  { name: 'BackstageSidebarSpacer' },\n) as ComponentType<ComponentProps<'div'> & StyledComponentProps<'root'>>;\n\nexport type SidebarDividerClassKey = 'root';\n\nexport const SidebarDivider = styled('hr')(\n  {\n    height: 1,\n    width: '100%',\n    background: '#383838',\n    border: 'none',\n    margin: '12px 0px',\n  },\n  { name: 'BackstageSidebarDivider' },\n) as ComponentType<ComponentProps<'hr'> & StyledComponentProps<'root'>>;\n\nconst styledScrollbar = (theme: Theme): CreateCSSProperties => ({\n  overflowY: 'auto',\n  '&::-webkit-scrollbar': {\n    backgroundColor: theme.palette.background.default,\n    width: '5px',\n    borderRadius: '5px',\n  },\n  '&::-webkit-scrollbar-thumb': {\n    backgroundColor: theme.palette.text.hint,\n    borderRadius: '5px',\n  },\n});\n\nexport const SidebarScrollWrapper = styled('div')(({ theme }) => {\n  const scrollbarStyles = styledScrollbar(theme);\n  return {\n    flex: '0 1 auto',\n    overflowX: 'hidden',\n    // 5px space to the right of the scrollbar\n    width: 'calc(100% - 5px)',\n    // Display at least one item in the container\n    // Question: Can this be a config/theme variable - if so, which? :/\n    minHeight: '48px',\n    overflowY: 'hidden',\n    '@media (hover: none)': scrollbarStyles,\n    '&:hover': scrollbarStyles,\n  };\n}) as ComponentType<ComponentProps<'div'> & StyledComponentProps<'root'>>;\n\n/**\n * A button which allows you to expand the sidebar when clicked.\n *\n * @remarks\n * Use optionally to replace sidebar's expand-on-hover feature with expand-on-click.\n *\n * If you are using this you might want to set the `disableExpandOnHover` of the `Sidebar` to `true`.\n *\n * @public\n */\nexport const SidebarExpandButton = () => {\n  const { sidebarConfig } = useContext(SidebarConfigContext);\n  const classes = useMemoStyles(sidebarConfig);\n  const { isOpen, setOpen } = useSidebarOpenState();\n  const isSmallScreen = useMediaQuery<BackstageTheme>(\n    theme => theme.breakpoints.down('md'),\n    { noSsr: true },\n  );\n\n  if (isSmallScreen) {\n    return null;\n  }\n\n  const handleClick = () => {\n    setOpen(!isOpen);\n  };\n\n  return (\n    <button\n      onClick={handleClick}\n      className={classes.expandButton}\n      aria-label=\"Expand Sidebar\"\n      data-testid=\"sidebar-expand-button\"\n    >\n      <div className={classes.arrows}>\n        {isOpen ? <DoubleArrowLeft /> : <DoubleArrowRight />}\n      </div>\n    </button>\n  );\n};\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { BackstageTheme } from '@backstage/theme';\nimport Collapse from '@material-ui/core/Collapse';\nimport Link from '@material-ui/core/Link';\nimport { makeStyles } from '@material-ui/core/styles';\nimport Typography from '@material-ui/core/Typography';\nimport CloseIcon from '@material-ui/icons/Close';\nimport React, { useContext, useState } from 'react';\nimport { useLocalStorageValue } from '@react-hookz/web';\nimport {\n  SidebarConfigContext,\n  SidebarConfig,\n  SIDEBAR_INTRO_LOCAL_STORAGE,\n} from './config';\nimport { SidebarDivider } from './Items';\nimport { useSidebarOpenState } from './SidebarOpenStateContext';\n\n/** @public */\nexport type SidebarIntroClassKey =\n  | 'introCard'\n  | 'introDismiss'\n  | 'introDismissLink'\n  | 'introDismissText'\n  | 'introDismissIcon';\n\nconst useStyles = makeStyles<BackstageTheme, { sidebarConfig: SidebarConfig }>(\n  theme => ({\n    introCard: props => ({\n      color: '#b5b5b5',\n      // XXX (@koroeskohr): should I be using a Mui theme variable?\n      fontSize: 12,\n      width: props.sidebarConfig.drawerWidthOpen,\n      marginTop: 18,\n      marginBottom: 12,\n      paddingLeft: props.sidebarConfig.iconPadding,\n      paddingRight: props.sidebarConfig.iconPadding,\n    }),\n    introDismiss: {\n      display: 'flex',\n      justifyContent: 'flex-end',\n      alignItems: 'center',\n      marginTop: 12,\n    },\n    introDismissLink: {\n      color: '#dddddd',\n      display: 'flex',\n      alignItems: 'center',\n      marginBottom: 4,\n      '&:hover': {\n        color: theme.palette.linkHover,\n        transition: theme.transitions.create('color', {\n          easing: theme.transitions.easing.sharp,\n          duration: theme.transitions.duration.shortest,\n        }),\n      },\n    },\n    introDismissText: {\n      fontSize: '0.7rem',\n      fontWeight: 'bold',\n      textTransform: 'uppercase',\n      letterSpacing: 1,\n    },\n    introDismissIcon: {\n      width: 18,\n      height: 18,\n      marginRight: 12,\n    },\n  }),\n  { name: 'BackstageSidebarIntro' },\n);\n\ntype IntroCardProps = {\n  text: string;\n  onClose: () => void;\n};\n\n/**\n * Closable card with information from Navigation Sidebar\n *\n * @public\n *\n */\n\nexport function IntroCard(props: IntroCardProps) {\n  const { sidebarConfig } = useContext(SidebarConfigContext);\n  const classes = useStyles({ sidebarConfig });\n  const { text, onClose } = props;\n  const handleClose = () => onClose();\n\n  return (\n    <div className={classes.introCard}>\n      <Typography variant=\"subtitle2\">{text}</Typography>\n      <div className={classes.introDismiss}>\n        <Link\n          component=\"button\"\n          onClick={handleClose}\n          underline=\"none\"\n          className={classes.introDismissLink}\n        >\n          <CloseIcon className={classes.introDismissIcon} />\n          <Typography component=\"span\" className={classes.introDismissText}>\n            Dismiss\n          </Typography>\n        </Link>\n      </div>\n    </div>\n  );\n}\n\ntype SidebarIntroLocalStorage = {\n  starredItemsDismissed: boolean;\n  recentlyViewedItemsDismissed: boolean;\n};\n\ntype SidebarIntroCardProps = {\n  text: string;\n  onDismiss: () => void;\n};\n\nconst SidebarIntroCard = (props: SidebarIntroCardProps) => {\n  const { text, onDismiss } = props;\n  const [collapsing, setCollapsing] = useState(false);\n  const startDismissing = () => {\n    setCollapsing(true);\n  };\n  return (\n    <Collapse in={!collapsing} onExited={onDismiss}>\n      <IntroCard text={text} onClose={startDismissing} />\n    </Collapse>\n  );\n};\n\nconst starredIntroText = `Fun fact! As you explore all the awesome plugins in Backstage, you can actually pin them to this side nav.\nKeep an eye out for the little star icon (⭐) next to the plugin name and give it a click!`;\nconst recentlyViewedIntroText =\n  'And your recently viewed plugins will pop up here!';\n\nexport function SidebarIntro(_props: {}) {\n  const { isOpen } = useSidebarOpenState();\n  const defaultValue = {\n    starredItemsDismissed: false,\n    recentlyViewedItemsDismissed: false,\n  };\n  const [dismissedIntro, setDismissedIntro] =\n    useLocalStorageValue<SidebarIntroLocalStorage>(SIDEBAR_INTRO_LOCAL_STORAGE);\n\n  const { starredItemsDismissed, recentlyViewedItemsDismissed } =\n    dismissedIntro ?? {};\n\n  const dismissStarred = () => {\n    setDismissedIntro(state => ({\n      ...defaultValue,\n      ...state,\n      starredItemsDismissed: true,\n    }));\n  };\n  const dismissRecentlyViewed = () => {\n    setDismissedIntro(state => ({\n      ...defaultValue,\n      ...state,\n      recentlyViewedItemsDismissed: true,\n    }));\n  };\n\n  if (!isOpen) {\n    return null;\n  }\n\n  return (\n    <>\n      {!starredItemsDismissed && (\n        <>\n          <SidebarIntroCard\n            text={starredIntroText}\n            onDismiss={dismissStarred}\n          />\n          <SidebarDivider />\n        </>\n      )}\n      {!recentlyViewedItemsDismissed && (\n        <SidebarIntroCard\n          text={recentlyViewedIntroText}\n          onDismiss={dismissRecentlyViewed}\n        />\n      )}\n    </>\n  );\n}\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { makeStyles, Theme } from '@material-ui/core/styles';\nimport classNames from 'classnames';\nimport React, { PropsWithChildren } from 'react';\nimport { useContent } from '../Sidebar';\n\n/** @public */\nexport type BackstageContentClassKey = 'root' | 'stretch' | 'noPadding';\n\nconst useStyles = makeStyles(\n  (theme: Theme) => ({\n    root: {\n      gridArea: 'pageContent',\n      minWidth: 0,\n      paddingTop: theme.spacing(3),\n      paddingBottom: theme.spacing(3),\n      paddingLeft: theme.spacing(2),\n      paddingRight: theme.spacing(2),\n      [theme.breakpoints.up('sm')]: {\n        paddingLeft: theme.spacing(3),\n        paddingRight: theme.spacing(3),\n      },\n    },\n    stretch: {\n      display: 'flex',\n      flexDirection: 'column',\n      flexGrow: 1,\n    },\n    noPadding: {\n      padding: 0,\n    },\n  }),\n  { name: 'BackstageContent' },\n);\n\ntype Props = {\n  stretch?: boolean;\n  noPadding?: boolean;\n  className?: string;\n};\n\n/**\n * The main content part inside a {@link Page}.\n *\n * @public\n *\n */\n\nexport function Content(props: PropsWithChildren<Props>) {\n  const { className, stretch, noPadding, children, ...restProps } = props;\n\n  const { contentRef } = useContent();\n\n  const classes = useStyles();\n  return (\n    <article\n      ref={contentRef}\n      tabIndex={-1}\n      {...restProps}\n      className={classNames(classes.root, className, {\n        [classes.stretch]: stretch,\n        [classes.noPadding]: noPadding,\n      })}\n    >\n      {children}\n    </article>\n  );\n}\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n// TODO(blam): Remove this implementation when the Tabs are ready\n// This is just a temporary solution to implementing tabs for now\n\nimport { makeStyles } from '@material-ui/core/styles';\nimport TabUI, { TabProps } from '@material-ui/core/Tab';\nimport Tabs from '@material-ui/core/Tabs';\nimport React, { useCallback, useEffect, useState } from 'react';\n\n/** @public */\nexport type HeaderTabsClassKey =\n  | 'tabsWrapper'\n  | 'defaultTab'\n  | 'selected'\n  | 'tabRoot';\n\nconst useStyles = makeStyles(\n  theme => ({\n    tabsWrapper: {\n      gridArea: 'pageSubheader',\n      backgroundColor: theme.palette.background.paper,\n      paddingLeft: theme.spacing(3),\n      minWidth: 0,\n    },\n    defaultTab: {\n      padding: theme.spacing(3, 3),\n      ...theme.typography.caption,\n      textTransform: 'uppercase',\n      fontWeight: 'bold',\n      color: theme.palette.text.secondary,\n    },\n    selected: {\n      color: theme.palette.text.primary,\n    },\n    tabRoot: {\n      '&:hover': {\n        backgroundColor: theme.palette.background.default,\n        color: theme.palette.text.primary,\n      },\n    },\n  }),\n  { name: 'BackstageHeaderTabs' },\n);\n\nexport type Tab = {\n  id: string;\n  label: string;\n  tabProps?: TabProps<React.ElementType, { component?: React.ElementType }>;\n};\n\ntype HeaderTabsProps = {\n  tabs: Tab[];\n  onChange?: (index: number) => void;\n  selectedIndex?: number;\n};\n\n/**\n * Horizontal Tabs component\n *\n * @public\n *\n */\nexport function HeaderTabs(props: HeaderTabsProps) {\n  const { tabs, onChange, selectedIndex } = props;\n  const [selectedTab, setSelectedTab] = useState<number>(selectedIndex ?? 0);\n  const styles = useStyles();\n\n  const handleChange = useCallback(\n    (_: React.ChangeEvent<{}>, index: number) => {\n      if (selectedIndex === undefined) {\n        setSelectedTab(index);\n      }\n      if (onChange && selectedIndex !== index) onChange(index);\n    },\n    [selectedIndex, onChange],\n  );\n\n  useEffect(() => {\n    if (selectedIndex !== undefined) {\n      setSelectedTab(selectedIndex);\n    }\n  }, [selectedIndex]);\n\n  return (\n    <div className={styles.tabsWrapper}>\n      <Tabs\n        selectionFollowsFocus\n        indicatorColor=\"primary\"\n        textColor=\"inherit\"\n        variant=\"scrollable\"\n        scrollButtons=\"auto\"\n        aria-label=\"scrollable auto tabs example\"\n        onChange={handleChange}\n        value={selectedTab}\n      >\n        {tabs.map((tab, index) => (\n          <TabUI\n            {...tab.tabProps}\n            data-testid={`header-tab-${index}`}\n            label={tab.label}\n            key={tab.id}\n            value={index}\n            className={styles.defaultTab}\n            classes={{ selected: styles.selected, root: styles.tabRoot }}\n          />\n        ))}\n      </Tabs>\n    </div>\n  );\n}\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport React, { useMemo } from 'react';\nimport { Helmet } from 'react-helmet';\nimport { matchRoutes, useNavigate, useParams, useRoutes } from 'react-router';\nimport { Content } from '../../layout/Content';\nimport { HeaderTabs } from '../../layout/HeaderTabs';\nimport { SubRoute } from './types';\n\nexport function useSelectedSubRoute(subRoutes: SubRoute[]): {\n  index: number;\n  route: SubRoute;\n  element: JSX.Element;\n} {\n  const params = useParams();\n\n  const routes = subRoutes.map(({ path, children }) => ({\n    caseSensitive: false,\n    path: `${path}/*`,\n    element: children,\n  }));\n\n  // TODO: remove once react-router updated\n  const sortedRoutes = routes.sort((a, b) =>\n    // remove \"/*\" symbols from path end before comparing\n    b.path.replace(/\\/\\*$/, '').localeCompare(a.path.replace(/\\/\\*$/, '')),\n  );\n\n  const element = useRoutes(sortedRoutes) ?? subRoutes[0].children;\n\n  // TODO(Rugvip): Once we only support v6 stable we can always prefix\n  // This avoids having a double / prefix for react-router v6 beta, which in turn breaks\n  // the tab highlighting when using relative paths for the tabs.\n  let currentRoute = params['*'] ?? '';\n  if (!currentRoute.startsWith('/')) {\n    currentRoute = `/${currentRoute}`;\n  }\n\n  const [matchedRoute] = matchRoutes(sortedRoutes, currentRoute) ?? [];\n  const foundIndex = matchedRoute\n    ? subRoutes.findIndex(t => `${t.path}/*` === matchedRoute.route.path)\n    : 0;\n\n  return {\n    index: foundIndex === -1 ? 0 : foundIndex,\n    element,\n    route: subRoutes[foundIndex] ?? subRoutes[0],\n  };\n}\n\nexport function RoutedTabs(props: { routes: SubRoute[] }) {\n  const { routes } = props;\n  const navigate = useNavigate();\n  const { index, route, element } = useSelectedSubRoute(routes);\n  const headerTabs = useMemo(\n    () =>\n      routes.map(t => ({\n        id: t.path,\n        label: t.title,\n        tabProps: t.tabProps,\n      })),\n    [routes],\n  );\n\n  const onTabChange = (tabIndex: number) => {\n    let { path } = routes[tabIndex];\n    // Remove trailing /*\n    path = path.replace(/\\/\\*$/, '');\n    // And remove leading / for relative navigation\n    path = path.replace(/^\\//, '');\n    // Note! route resolves relative to the position in the React tree,\n    // not relative to current location\n    navigate(path);\n  };\n  return (\n    <>\n      <HeaderTabs\n        tabs={headerTabs}\n        selectedIndex={index}\n        onChange={onTabChange}\n      />\n      <Content>\n        <Helmet title={route.title} />\n        {element}\n      </Content>\n    </>\n  );\n}\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { attachComponentData } from '@backstage/core-plugin-api';\nimport React, {\n  Children,\n  Fragment,\n  isValidElement,\n  PropsWithChildren,\n  ReactNode,\n} from 'react';\nimport { RoutedTabs } from './RoutedTabs';\nimport { TabProps } from '@material-ui/core/Tab';\n\ntype SubRoute = {\n  path: string;\n  title: string;\n  children: JSX.Element;\n  tabProps?: TabProps<React.ElementType, { component?: React.ElementType }>;\n};\n\nconst Route: (props: SubRoute) => null = () => null;\n\n// This causes all mount points that are discovered within this route to use the path of the route itself\nattachComponentData(Route, 'core.gatherMountPoints', true);\n\nexport function createSubRoutesFromChildren(\n  childrenProps: ReactNode,\n): SubRoute[] {\n  // Directly comparing child.type with Route will not work with in\n  // combination with react-hot-loader in storybook\n  // https://github.com/gaearon/react-hot-loader/issues/304\n  const routeType = (\n    <Route path=\"\" title=\"\">\n      <div />\n    </Route>\n  ).type;\n\n  return Children.toArray(childrenProps).flatMap(child => {\n    if (!isValidElement(child)) {\n      return [];\n    }\n\n    if (child.type === Fragment) {\n      return createSubRoutesFromChildren(child.props.children);\n    }\n\n    if (child.type !== routeType) {\n      throw new Error('Child of TabbedLayout must be an TabbedLayout.Route');\n    }\n\n    const { path, title, children, tabProps } = child.props;\n    return [{ path, title, children, tabProps }];\n  });\n}\n\n/**\n * TabbedLayout is a compound component, which allows you to define a layout for\n * pages using a sub-navigation mechanism.\n *\n * @remarks\n * Consists of two parts: TabbedLayout and TabbedLayout.Route\n *\n * @example\n * ```jsx\n * <TabbedLayout>\n *   <TabbedLayout.Route path=\"/example\" title=\"Example tab\">\n *     <div>This is rendered under /example/anything-here route</div>\n *   </TabbedLayout.Route>\n * </TabbedLayout>\n * ```\n */\nexport function TabbedLayout(props: PropsWithChildren<{}>) {\n  const routes = createSubRoutesFromChildren(props.children);\n\n  return <RoutedTabs routes={routes} />;\n}\n\nTabbedLayout.Route = Route;\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React from 'react';\nimport { BackstageTheme } from '@backstage/theme';\nimport { makeStyles } from '@material-ui/core/styles';\n\nexport type SubvalueCellClassKey = 'value' | 'subvalue';\n\nconst useSubvalueCellStyles = makeStyles<BackstageTheme>(\n  theme => ({\n    value: {\n      marginBottom: '6px',\n    },\n    subvalue: {\n      color: theme.palette.textSubtle,\n      fontWeight: 'normal',\n    },\n  }),\n  { name: 'BackstageSubvalueCell' },\n);\n\ntype SubvalueCellProps = {\n  value: React.ReactNode;\n  subvalue: React.ReactNode;\n};\n\nexport function SubvalueCell(props: SubvalueCellProps) {\n  const { value, subvalue } = props;\n  const classes = useSubvalueCellStyles();\n\n  return (\n    <>\n      <div className={classes.value}>{value}</div>\n      <div className={classes.subvalue}>{subvalue}</div>\n    </>\n  );\n}\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React, { useEffect, useState } from 'react';\nimport { BackstageTheme } from '@backstage/theme';\nimport { makeStyles } from '@material-ui/core/styles';\nimport Button from '@material-ui/core/Button';\nimport { Select } from '../Select';\nimport { SelectProps } from '../Select/Select';\n\nexport type TableFiltersClassKey = 'root' | 'value' | 'heder' | 'filters';\n\nconst useFilterStyles = makeStyles<BackstageTheme>(\n  theme => ({\n    root: {\n      height: '100%',\n      width: '315px',\n      display: 'flex',\n      flexDirection: 'column',\n      marginRight: theme.spacing(3),\n    },\n    value: {\n      fontWeight: 'bold',\n      fontSize: 18,\n    },\n    header: {\n      display: 'flex',\n      alignItems: 'center',\n      height: '60px',\n      justifyContent: 'space-between',\n      borderBottom: `1px solid ${theme.palette.grey[500]}`,\n    },\n    filters: {\n      display: 'flex',\n      flexDirection: 'column',\n      '& > *': {\n        marginTop: theme.spacing(2),\n      },\n    },\n  }),\n  { name: 'BackstageTableFilters' },\n);\n\nexport type Without<T, K> = Pick<T, Exclude<keyof T, K>>;\n\nexport type Filter = {\n  type: 'select' | 'multiple-select';\n  element: Without<SelectProps, 'onChange'>;\n};\n\nexport type SelectedFilters = {\n  [key: string]: string | string[];\n};\n\ntype Props = {\n  filters: Filter[];\n  selectedFilters?: SelectedFilters;\n  onChangeFilters: (arg: any) => any;\n};\n\nexport const Filters = (props: Props) => {\n  const classes = useFilterStyles();\n\n  const { onChangeFilters } = props;\n\n  const [selectedFilters, setSelectedFilters] = useState<SelectedFilters>({\n    ...props.selectedFilters,\n  });\n  const [reset, triggerReset] = useState(false);\n\n  // Trigger re-rendering\n  const handleClick = () => {\n    setSelectedFilters({});\n    triggerReset(el => !el);\n  };\n\n  useEffect(() => {\n    onChangeFilters(selectedFilters);\n  }, [selectedFilters, onChangeFilters]);\n\n  // As material table doesn't provide a way to add a column filter tab we will make our own filter logic\n  return (\n    <div className={classes.root}>\n      <div className={classes.header}>\n        <div className={classes.value}>Filters</div>\n        <Button color=\"primary\" onClick={handleClick}>\n          Clear all\n        </Button>\n      </div>\n      <div className={classes.filters}>\n        {props.filters?.length &&\n          props.filters.map(filter => (\n            <Select\n              triggerReset={reset}\n              key={filter.element.label}\n              {...(filter.element as SelectProps)}\n              selected={selectedFilters[filter.element.label]}\n              onChange={el =>\n                setSelectedFilters({\n                  ...selectedFilters,\n                  [filter.element.label]: el as any,\n                })\n              }\n            />\n          ))}\n      </div>\n    </div>\n  );\n};\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { BackstageTheme } from '@backstage/theme';\nimport { makeStyles, useTheme, withStyles } from '@material-ui/core/styles';\nimport IconButton from '@material-ui/core/IconButton';\nimport Typography from '@material-ui/core/Typography';\n// Material-table is not using the standard icons available in in material-ui. https://github.com/mbrn/material-table/issues/51\nimport AddBox from '@material-ui/icons/AddBox';\nimport ArrowUpward from '@material-ui/icons/ArrowUpward';\nimport Check from '@material-ui/icons/Check';\nimport ChevronLeft from '@material-ui/icons/ChevronLeft';\nimport ChevronRight from '@material-ui/icons/ChevronRight';\nimport Clear from '@material-ui/icons/Clear';\nimport DeleteOutline from '@material-ui/icons/DeleteOutline';\nimport Edit from '@material-ui/icons/Edit';\nimport FilterList from '@material-ui/icons/FilterList';\nimport FirstPage from '@material-ui/icons/FirstPage';\nimport LastPage from '@material-ui/icons/LastPage';\nimport Remove from '@material-ui/icons/Remove';\nimport SaveAlt from '@material-ui/icons/SaveAlt';\nimport ViewColumn from '@material-ui/icons/ViewColumn';\nimport { isEqual, transform } from 'lodash';\nimport MTable, {\n  Column,\n  Icons,\n  MaterialTableProps,\n  MTableBody,\n  MTableHeader,\n  MTableToolbar,\n  Options,\n} from '@material-table/core';\nimport React, {\n  forwardRef,\n  MutableRefObject,\n  ReactNode,\n  useCallback,\n  useEffect,\n  useState,\n} from 'react';\nimport { SelectProps } from '../Select/Select';\nimport { Filter, Filters, SelectedFilters, Without } from './Filters';\n\nconst tableIcons: Icons = {\n  Add: forwardRef((props, ref) => <AddBox {...props} ref={ref} />),\n  Check: forwardRef((props, ref) => <Check {...props} ref={ref} />),\n  Clear: forwardRef((props, ref) => <Clear {...props} ref={ref} />),\n  Delete: forwardRef((props, ref) => <DeleteOutline {...props} ref={ref} />),\n  DetailPanel: forwardRef((props, ref) => (\n    <ChevronRight {...props} ref={ref} />\n  )),\n  Edit: forwardRef((props, ref) => <Edit {...props} ref={ref} />),\n  Export: forwardRef((props, ref) => <SaveAlt {...props} ref={ref} />),\n  Filter: forwardRef((props, ref) => <FilterList {...props} ref={ref} />),\n  FirstPage: forwardRef((props, ref) => <FirstPage {...props} ref={ref} />),\n  LastPage: forwardRef((props, ref) => <LastPage {...props} ref={ref} />),\n  NextPage: forwardRef((props, ref) => <ChevronRight {...props} ref={ref} />),\n  PreviousPage: forwardRef((props, ref) => (\n    <ChevronLeft {...props} ref={ref} />\n  )),\n  ResetSearch: forwardRef((props, ref) => <Clear {...props} ref={ref} />),\n  Search: forwardRef((props, ref) => <FilterList {...props} ref={ref} />),\n  SortArrow: forwardRef((props, ref) => <ArrowUpward {...props} ref={ref} />),\n  ThirdStateCheck: forwardRef((props, ref) => <Remove {...props} ref={ref} />),\n  ViewColumn: forwardRef((props, ref) => <ViewColumn {...props} ref={ref} />),\n};\n\n// TODO: Material table might already have such a function internally that we can use?\nfunction extractValueByField(data: any, field: string): any | undefined {\n  const path = field.split('.');\n  let value = data[path[0]];\n\n  for (let i = 1; i < path.length; ++i) {\n    if (value === undefined) {\n      return value;\n    }\n\n    const f = path[i];\n    value = value[f];\n  }\n\n  return value;\n}\n\nexport type TableHeaderClassKey = 'header';\n\nconst StyledMTableHeader = withStyles(\n  theme => ({\n    header: {\n      padding: theme.spacing(1, 2, 1, 2.5),\n      borderTop: `1px solid ${theme.palette.grey.A100}`,\n      borderBottom: `1px solid ${theme.palette.grey.A100}`,\n      // withStyles hasn't a generic overload for theme\n      color: (theme as BackstageTheme).palette.textSubtle,\n      fontWeight: theme.typography.fontWeightBold,\n      position: 'static',\n      wordBreak: 'normal',\n    },\n  }),\n  { name: 'BackstageTableHeader' },\n)(MTableHeader);\n\nexport type TableToolbarClassKey = 'root' | 'title' | 'searchField';\n\nconst StyledMTableToolbar = withStyles(\n  theme => ({\n    root: {\n      padding: theme.spacing(3, 0, 2.5, 2.5),\n    },\n    title: {\n      '& > h6': {\n        fontWeight: 'bold',\n      },\n    },\n    searchField: {\n      paddingRight: theme.spacing(2),\n    },\n  }),\n  { name: 'BackstageTableToolbar' },\n)(MTableToolbar);\n\n/** @public */\nexport type FiltersContainerClassKey = 'root' | 'title';\n\nconst useFilterStyles = makeStyles<BackstageTheme>(\n  () => ({\n    root: {\n      display: 'flex',\n      alignItems: 'center',\n      justifyContent: 'space-between',\n    },\n    title: {\n      fontWeight: 'bold',\n      fontSize: 18,\n      whiteSpace: 'nowrap',\n    },\n  }),\n  { name: 'BackstageTableFiltersContainer' },\n);\n\nexport type TableClassKey = 'root';\n\nconst useTableStyles = makeStyles<BackstageTheme>(\n  () => ({\n    root: {\n      display: 'flex',\n      alignItems: 'start',\n    },\n  }),\n  { name: 'BackstageTable' },\n);\n\nfunction convertColumns<T extends object>(\n  columns: TableColumn<T>[],\n  theme: BackstageTheme,\n): TableColumn<T>[] {\n  return columns.map(column => {\n    const headerStyle: React.CSSProperties = {};\n\n    let cellStyle = column.cellStyle || {};\n\n    if (column.highlight) {\n      headerStyle.color = theme.palette.textContrast;\n\n      if (typeof cellStyle === 'object') {\n        (cellStyle as React.CSSProperties).fontWeight =\n          theme.typography.fontWeightBold;\n      } else {\n        const cellStyleFn = cellStyle as (\n          data: any,\n          rowData: T,\n          column?: Column<T>,\n        ) => React.CSSProperties;\n        cellStyle = (data, rowData, rowColumn) => {\n          const style = cellStyleFn(data, rowData, rowColumn);\n          return { ...style, fontWeight: theme.typography.fontWeightBold };\n        };\n      }\n    }\n\n    return {\n      ...column,\n      headerStyle,\n      cellStyle,\n    };\n  });\n}\n\nfunction removeDefaultValues(state: any, defaultState: any): any {\n  return transform(state, (result, value, key) => {\n    if (!isEqual(value, defaultState[key])) {\n      result[key] = value;\n    }\n  });\n}\n\nconst defaultInitialState = {\n  search: '',\n  filtersOpen: false,\n  filters: {},\n};\n\nexport interface TableColumn<T extends object = {}> extends Column<T> {\n  highlight?: boolean;\n  width?: string;\n}\n\nexport type TableFilter = {\n  column: string;\n  type: 'select' | 'multiple-select';\n};\n\nexport type TableState = {\n  search?: string;\n  filtersOpen?: boolean;\n  filters?: SelectedFilters;\n};\n\nexport interface TableProps<T extends object = {}>\n  extends MaterialTableProps<T> {\n  columns: TableColumn<T>[];\n  subtitle?: string;\n  filters?: TableFilter[];\n  initialState?: TableState;\n  emptyContent?: ReactNode;\n  onStateChange?: (state: TableState) => any;\n}\n\nexport function TableToolbar(toolbarProps: {\n  toolbarRef: MutableRefObject<any>;\n  setSearch: (value: string) => void;\n  onSearchChanged: (value: string) => void;\n  toggleFilters: () => void;\n  hasFilters: boolean;\n  selectedFiltersLength: number;\n}) {\n  const {\n    toolbarRef,\n    setSearch,\n    hasFilters,\n    selectedFiltersLength,\n    toggleFilters,\n  } = toolbarProps;\n  const filtersClasses = useFilterStyles();\n  const onSearchChanged = useCallback(\n    (searchText: string) => {\n      toolbarProps.onSearchChanged(searchText);\n      setSearch(searchText);\n    },\n    [toolbarProps, setSearch],\n  );\n\n  if (hasFilters) {\n    return (\n      <div className={filtersClasses.root}>\n        <div className={filtersClasses.root}>\n          <IconButton onClick={toggleFilters} aria-label=\"filter list\">\n            <FilterList />\n          </IconButton>\n          <Typography className={filtersClasses.title}>\n            Filters ({selectedFiltersLength})\n          </Typography>\n        </div>\n        <StyledMTableToolbar\n          {...toolbarProps}\n          ref={toolbarRef}\n          onSearchChanged={onSearchChanged}\n        />\n      </div>\n    );\n  }\n\n  return (\n    <StyledMTableToolbar\n      {...toolbarProps}\n      ref={toolbarRef}\n      onSearchChanged={onSearchChanged}\n    />\n  );\n}\n\n/**\n * @public\n */\nexport function Table<T extends object = {}>(props: TableProps<T>) {\n  const {\n    data,\n    columns,\n    options,\n    title,\n    subtitle,\n    filters,\n    initialState,\n    emptyContent,\n    onStateChange,\n    components,\n    ...restProps\n  } = props;\n  const tableClasses = useTableStyles();\n\n  const theme = useTheme<BackstageTheme>();\n\n  const calculatedInitialState = { ...defaultInitialState, ...initialState };\n\n  const [filtersOpen, setFiltersOpen] = useState(\n    calculatedInitialState.filtersOpen,\n  );\n  const toggleFilters = useCallback(\n    () => setFiltersOpen(v => !v),\n    [setFiltersOpen],\n  );\n  const [selectedFiltersLength, setSelectedFiltersLength] = useState(0);\n  const [tableData, setTableData] = useState(data as any[]);\n  const [selectedFilters, setSelectedFilters] = useState(\n    calculatedInitialState.filters,\n  );\n\n  const MTColumns = convertColumns(columns, theme);\n\n  const [search, setSearch] = useState(calculatedInitialState.search);\n\n  useEffect(() => {\n    if (onStateChange) {\n      const state = removeDefaultValues(\n        {\n          search,\n          filtersOpen,\n          filters: selectedFilters,\n        },\n        defaultInitialState,\n      );\n\n      onStateChange(state);\n    }\n  }, [search, filtersOpen, selectedFilters, onStateChange]);\n\n  const defaultOptions: Options<T> = {\n    headerStyle: {\n      textTransform: 'uppercase',\n    },\n  };\n\n  const getFieldByTitle = useCallback(\n    (titleValue: string | keyof T) =>\n      columns.find(el => el.title === titleValue)?.field,\n    [columns],\n  );\n\n  useEffect(() => {\n    if (typeof data === 'function') {\n      return;\n    }\n    if (!selectedFilters) {\n      setTableData(data as any[]);\n      return;\n    }\n\n    const selectedFiltersArray = Object.values(selectedFilters);\n    if (data && selectedFiltersArray.flat().length) {\n      const newData = (data as any[]).filter(\n        el =>\n          !!Object.entries(selectedFilters)\n            .filter(([, value]) => !!value.length)\n            .every(([key, filterValue]) => {\n              const fieldValue = extractValueByField(\n                el,\n                getFieldByTitle(key) as string,\n              );\n\n              if (Array.isArray(fieldValue) && Array.isArray(filterValue)) {\n                return fieldValue.some(v => filterValue.includes(v));\n              } else if (Array.isArray(fieldValue)) {\n                return fieldValue.includes(filterValue);\n              } else if (Array.isArray(filterValue)) {\n                return filterValue.includes(fieldValue);\n              }\n\n              return fieldValue === filterValue;\n            }),\n      );\n      setTableData(newData);\n    } else {\n      setTableData(data as any[]);\n    }\n    setSelectedFiltersLength(selectedFiltersArray.flat().length);\n  }, [data, selectedFilters, getFieldByTitle]);\n\n  const constructFilters = (\n    filterConfig: TableFilter[],\n    dataValue: any[] | undefined,\n  ): Filter[] => {\n    const extractDistinctValues = (field: string | keyof T): Set<any> => {\n      const distinctValues = new Set<any>();\n      const addValue = (value: any) => {\n        if (value !== undefined && value !== null) {\n          distinctValues.add(value);\n        }\n      };\n\n      if (dataValue) {\n        dataValue.forEach(el => {\n          const value = extractValueByField(\n            el,\n            getFieldByTitle(field) as string,\n          );\n\n          if (Array.isArray(value)) {\n            (value as []).forEach(addValue);\n          } else {\n            addValue(value);\n          }\n        });\n      }\n\n      return distinctValues;\n    };\n\n    const constructSelect = (\n      filter: TableFilter,\n    ): Without<SelectProps, 'onChange'> => {\n      return {\n        placeholder: 'All results',\n        label: filter.column,\n        multiple: filter.type === 'multiple-select',\n        items: [...extractDistinctValues(filter.column)].sort().map(value => ({\n          label: value,\n          value,\n        })),\n      };\n    };\n\n    return filterConfig.map(filter => ({\n      type: filter.type,\n      element: constructSelect(filter),\n    }));\n  };\n\n  const hasFilters = !!filters?.length;\n  const Toolbar = useCallback(\n    toolbarProps => {\n      return (\n        <TableToolbar\n          setSearch={setSearch}\n          hasFilters={hasFilters}\n          selectedFiltersLength={selectedFiltersLength}\n          toggleFilters={toggleFilters}\n          {...toolbarProps}\n        />\n      );\n    },\n    [toggleFilters, hasFilters, selectedFiltersLength, setSearch],\n  );\n\n  const hasNoRows = typeof data !== 'function' && data.length === 0;\n  const columnCount = columns.length;\n  const Body = useCallback(\n    bodyProps => {\n      if (emptyContent && hasNoRows) {\n        return (\n          <tbody>\n            <tr>\n              <td colSpan={columnCount}>{emptyContent}</td>\n            </tr>\n          </tbody>\n        );\n      }\n\n      return <MTableBody {...bodyProps} />;\n    },\n    [hasNoRows, emptyContent, columnCount],\n  );\n\n  return (\n    <div className={tableClasses.root}>\n      {filtersOpen && data && typeof data !== 'function' && filters?.length && (\n        <Filters\n          filters={constructFilters(filters, data as any[])}\n          selectedFilters={selectedFilters}\n          onChangeFilters={setSelectedFilters}\n        />\n      )}\n      <MTable<T>\n        components={{\n          Header: StyledMTableHeader,\n          Toolbar,\n          Body,\n          ...components,\n        }}\n        options={{ ...defaultOptions, ...options }}\n        columns={MTColumns}\n        icons={tableIcons}\n        title={\n          <>\n            <Typography variant=\"h5\" component=\"h2\">\n              {title}\n            </Typography>\n            {subtitle && (\n              <Typography color=\"textSecondary\" variant=\"body1\">\n                {subtitle}\n              </Typography>\n            )}\n          </>\n        }\n        data={typeof data === 'function' ? data : tableData}\n        style={{ width: '100%' }}\n        localization={{ toolbar: { searchPlaceholder: 'Filter' } }}\n        {...restProps}\n      />\n    </div>\n  );\n}\n\nTable.icons = Object.freeze(tableIcons);\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React, { PropsWithChildren } from 'react';\nimport Box from '@material-ui/core/Box';\n\nexport interface TabPanelProps {\n  value?: any;\n  index?: number;\n}\n\nexport const TabPanel = (props: PropsWithChildren<TabPanelProps>) => {\n  const { children, value, index, ...other } = props;\n\n  return (\n    <div\n      role=\"tabpanel\"\n      hidden={value !== index}\n      aria-labelledby={`scrollable-auto-tab-${index}`}\n      {...other}\n    >\n      {value === index && <Box p={3}>{children}</Box>}\n    </div>\n  );\n};\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React from 'react';\nimport { makeStyles } from '@material-ui/core/styles';\nimport IconButton from '@material-ui/core/IconButton';\nimport { BackstageTheme } from '@backstage/theme';\n\ninterface StyledIconProps {\n  ariaLabel: string;\n  children: any;\n  isNext?: boolean;\n  onClick: any;\n}\n\nexport type TabIconClassKey = 'root';\n\nconst useStyles = makeStyles<BackstageTheme, StyledIconProps>(\n  () => ({\n    root: {\n      color: '#6E6E6E',\n      overflow: 'visible',\n      fontSize: '1.5rem',\n      textAlign: 'center',\n      borderRadius: '50%',\n      backgroundColor: '#E6E6E6',\n      marginLeft: props => (props.isNext ? 'auto' : '0'),\n      marginRight: props => (props.isNext ? '0' : '10px'),\n      '&:hover': {\n        backgroundColor: '#E6E6E6',\n        opacity: '1',\n      },\n    },\n  }),\n  { name: 'BackstageTabIcon' },\n);\n\nexport const StyledIcon = (props: StyledIconProps) => {\n  const classes = useStyles(props);\n  const { ariaLabel, onClick } = props;\n  return (\n    <IconButton\n      onClick={onClick}\n      className={classes.root}\n      size=\"small\"\n      disableRipple\n      disableFocusRipple\n      aria-label={ariaLabel}\n    >\n      {props.children}\n    </IconButton>\n  );\n};\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React from 'react';\nimport { makeStyles } from '@material-ui/core/styles';\nimport Tab from '@material-ui/core/Tab';\nimport { BackstageTheme } from '@backstage/theme';\n\ninterface StyledTabProps {\n  label?: string;\n  icon?: any; // TODO: define type for material-ui icons\n  isFirstNav?: boolean;\n  isFirstIndex?: boolean;\n  value?: any;\n}\n\nconst tabMarginLeft = (isFirstNav: boolean, isFirstIndex: boolean) => {\n  if (isFirstIndex) {\n    if (isFirstNav) {\n      return '20px';\n    }\n    return '0';\n  }\n  return '40px';\n};\n\n/** @public */\nexport type TabClassKey = 'root' | 'selected';\n\nconst useStyles = makeStyles<BackstageTheme, StyledTabProps>(\n  theme => ({\n    root: {\n      textTransform: 'none',\n      height: '64px',\n      fontWeight: theme.typography.fontWeightBold,\n      fontSize: theme.typography.pxToRem(13),\n      color: theme.palette.textSubtle,\n      marginLeft: props =>\n        tabMarginLeft(\n          props.isFirstNav as boolean,\n          props.isFirstIndex as boolean,\n        ),\n      width: '130px',\n      minWidth: '130px',\n      '&:hover': {\n        outline: 'none',\n        backgroundColor: 'transparent',\n        color: theme.palette.textSubtle,\n      },\n    },\n  }),\n  { name: 'BackstageTab' },\n);\n\nexport const StyledTab = (props: StyledTabProps) => {\n  const classes = useStyles(props);\n  const { isFirstNav, isFirstIndex, ...rest } = props;\n  return <Tab classes={classes} disableRipple {...rest} />;\n};\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React, { PropsWithChildren } from 'react';\nimport { makeStyles } from '@material-ui/core/styles';\nimport Tabs from '@material-ui/core/Tabs';\nimport { BackstageTheme } from '@backstage/theme';\n\ninterface StyledTabsProps {\n  value: number | boolean;\n  selectionFollowsFocus: boolean;\n  onChange: (event: React.ChangeEvent<{}>, newValue: number) => void;\n}\n\nexport type TabBarClassKey = 'indicator' | 'flexContainer' | 'root';\n\nconst useStyles = makeStyles<BackstageTheme>(\n  theme => ({\n    indicator: {\n      display: 'flex',\n      justifyContent: 'center',\n      backgroundColor: theme.palette.tabbar.indicator,\n      height: '4px',\n    },\n    flexContainer: {\n      alignItems: 'center',\n    },\n    root: {\n      '&:last-child': {\n        marginLeft: 'auto',\n      },\n    },\n  }),\n  { name: 'BackstageTabBar' },\n);\n\nexport const StyledTabs = (props: PropsWithChildren<StyledTabsProps>) => {\n  const classes = useStyles(props);\n  return (\n    <Tabs\n      classes={classes}\n      {...props}\n      TabIndicatorProps={{ children: <span /> }}\n    />\n  );\n};\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React, { useRef, useEffect, MutableRefObject, useState } from 'react';\nimport { BackstageTheme } from '@backstage/theme';\nimport AppBar from '@material-ui/core/AppBar';\nimport { makeStyles } from '@material-ui/core/styles';\nimport NavigateBeforeIcon from '@material-ui/icons/NavigateBefore';\nimport NavigateNextIcon from '@material-ui/icons/NavigateNext';\nimport { chunkArray } from './utils';\nimport useWindowSize from 'react-use/lib/useWindowSize';\n\n/* Import Components */\n\nimport { TabPanel } from './TabPanel';\nimport { StyledIcon } from './TabIcon';\nimport { StyledTab } from './Tab';\nimport { StyledTabs } from './TabBar';\n\n/* Props Types */\n\nexport interface TabProps {\n  content: any;\n  label?: string;\n  icon?: any; // TODO: define type for material-ui icons\n}\n\nexport interface TabsProps {\n  tabs: TabProps[];\n}\n\nexport type TabsClassKey = 'root' | 'styledTabs' | 'appbar';\n\nconst useStyles = makeStyles<BackstageTheme>(\n  theme => ({\n    root: {\n      flexGrow: 1,\n      width: '100%',\n    },\n    styledTabs: {\n      backgroundColor: theme.palette.background.paper,\n    },\n    appbar: {\n      boxShadow: 'none',\n      backgroundColor: theme.palette.background.paper,\n      paddingLeft: '10px',\n      paddingRight: '10px',\n    },\n  }),\n  { name: 'BackstageTabs' },\n);\n\nexport function Tabs(props: TabsProps) {\n  const { tabs } = props;\n  const classes = useStyles();\n  const [value, setValue] = useState([0, 0]); // [selectedChunkedNavIndex, selectedIndex]\n  const [navIndex, setNavIndex] = useState(0);\n  const [numberOfChunkedElement, setNumberOfChunkedElement] = useState(0);\n  const [chunkedTabs, setChunkedTabs] = useState<TabProps[][]>([[]]);\n  const wrapper = useRef() as MutableRefObject<HTMLDivElement>;\n\n  const { width } = useWindowSize();\n\n  const handleChange = (_: React.ChangeEvent<{}>, newValue: number) => {\n    setValue([navIndex, newValue]);\n  };\n\n  const navigateToPrevChunk = () => {\n    setNavIndex(navIndex - 1);\n  };\n\n  const navigateToNextChunk = () => {\n    setNavIndex(navIndex + 1);\n  };\n\n  const hasNextNavIndex = () => navIndex + 1 < chunkedTabs.length;\n\n  useEffect(() => {\n    // Each time the window is resized we calculate how many tabs we can render given the window width\n    const padding = 20; // The AppBar padding\n\n    const numberOfTabIcons = navIndex === 0 ? 1 : 2;\n    const wrapperWidth =\n      wrapper.current.offsetWidth - padding - numberOfTabIcons * 30;\n    const flattenIndex = value[0] * numberOfChunkedElement + value[1];\n    const newChunkedElementSize = Math.floor(wrapperWidth / 170);\n\n    setNumberOfChunkedElement(newChunkedElementSize);\n    setChunkedTabs(chunkArray(tabs, newChunkedElementSize));\n    setValue([\n      Math.floor(flattenIndex / newChunkedElementSize),\n      flattenIndex % newChunkedElementSize,\n    ]);\n    // eslint-disable-next-line\n  }, [width, tabs]);\n\n  const currentIndex = navIndex === value[0] ? value[1] : false;\n\n  return (\n    <div className={classes.root}>\n      <AppBar ref={wrapper} className={classes.appbar} position=\"static\">\n        <div>\n          <StyledTabs\n            value={currentIndex}\n            onChange={handleChange}\n            selectionFollowsFocus\n          >\n            {navIndex !== 0 && (\n              <StyledIcon\n                onClick={navigateToPrevChunk}\n                ariaLabel=\"navigate-before\"\n              >\n                <NavigateBeforeIcon />\n              </StyledIcon>\n            )}\n            {chunkedTabs[navIndex].map((tab, index) => (\n              <StyledTab\n                value={index}\n                isFirstIndex={index === 0}\n                isFirstNav={navIndex === 0}\n                key={index}\n                icon={tab.icon || undefined}\n                label={tab.label || undefined}\n              />\n            ))}\n            {hasNextNavIndex() && (\n              <StyledIcon\n                isNext\n                onClick={navigateToNextChunk}\n                ariaLabel=\"navigate-next\"\n              >\n                <NavigateNextIcon />\n              </StyledIcon>\n            )}\n          </StyledTabs>\n        </div>\n      </AppBar>\n      {currentIndex !== false ? (\n        chunkedTabs[navIndex].map((tab, index) => (\n          <TabPanel key={index} value={index} index={currentIndex}>\n            {tab.content}\n          </TabPanel>\n        ))\n      ) : (\n        // Render if the selected tab index is outside the current rendered chunked array\n        <TabPanel\n          key=\"panel_outside_chunked_array\"\n          value={value[1]}\n          index={value[1]}\n        >\n          {chunkedTabs[value[0]][value[1]].content}\n        </TabPanel>\n      )}\n    </div>\n  );\n}\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React from 'react';\nimport {\n  Sparklines,\n  SparklinesLine,\n  SparklinesLineProps,\n  SparklinesProps,\n} from 'react-sparklines';\nimport { useTheme } from '@material-ui/core/styles';\nimport { BackstageTheme } from '@backstage/theme';\n\nfunction color(data: number[], theme: BackstageTheme): string | undefined {\n  const lastNum = data[data.length - 1];\n  if (!lastNum) return undefined;\n  if (lastNum >= 0.9) return theme.palette.status.ok;\n  if (lastNum >= 0.5) return theme.palette.status.warning;\n  return theme.palette.status.error;\n}\n\nexport function TrendLine(\n  props: SparklinesProps &\n    Pick<SparklinesLineProps, 'color'> & { title?: string },\n) {\n  const theme = useTheme<BackstageTheme>();\n\n  if (!props.data) return null;\n  return (\n    <Sparklines width={120} height={30} min={0} max={1} {...props}>\n      {props.title && <title>{props.title}</title>}\n      <SparklinesLine color={props.color ?? color(props.data, theme)} />\n    </Sparklines>\n  );\n}\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/**\n * TODO favoriteable capability\n */\n\nimport { makeStyles } from '@material-ui/core/styles';\nimport Typography from '@material-ui/core/Typography';\nimport React, { PropsWithChildren, ReactNode } from 'react';\nimport { Helmet } from 'react-helmet';\n\n/** @public */\nexport type ContentHeaderClassKey =\n  | 'container'\n  | 'leftItemsBox'\n  | 'rightItemsBox'\n  | 'description'\n  | 'title';\n\nconst useStyles = (props: ContentHeaderProps) =>\n  makeStyles(\n    theme => ({\n      container: {\n        width: '100%',\n        display: 'flex',\n        flexDirection: 'row',\n        flexWrap: 'wrap',\n        justifyContent: 'flex-end',\n        alignItems: 'center',\n        marginBottom: theme.spacing(2),\n        textAlign: props.textAlign,\n      },\n      leftItemsBox: {\n        flex: '1 1 auto',\n        minWidth: 0,\n        overflow: 'visible',\n      },\n      rightItemsBox: {\n        flex: '0 1 auto',\n        display: 'flex',\n        flexDirection: 'row',\n        flexWrap: 'wrap',\n        alignItems: 'center',\n        marginLeft: theme.spacing(1),\n        minWidth: 0,\n        overflow: 'visible',\n      },\n      description: {},\n      title: {\n        display: 'inline-flex',\n        marginBottom: 0,\n      },\n    }),\n    { name: 'BackstageContentHeader' },\n  );\n\ntype ContentHeaderTitleProps = {\n  title?: string;\n  className?: string;\n};\n\nconst ContentHeaderTitle = ({\n  title = 'Unknown page',\n  className,\n}: ContentHeaderTitleProps) => (\n  <Typography\n    variant=\"h4\"\n    component=\"h2\"\n    className={className}\n    data-testid=\"header-title\"\n  >\n    {title}\n  </Typography>\n);\n\ntype ContentHeaderProps = {\n  title?: ContentHeaderTitleProps['title'];\n  titleComponent?: ReactNode;\n  description?: string;\n  textAlign?: 'left' | 'right' | 'center';\n};\n\n/**\n *  A header at the top inside a {@link Content}.\n *\n * @public\n *\n */\n\nexport function ContentHeader(props: PropsWithChildren<ContentHeaderProps>) {\n  const {\n    description,\n    title,\n    titleComponent: TitleComponent = undefined,\n    children,\n    textAlign = 'left',\n  } = props;\n  const classes = useStyles({ textAlign })();\n\n  const renderedTitle = TitleComponent ? (\n    TitleComponent\n  ) : (\n    <ContentHeaderTitle title={title} className={classes.title} />\n  );\n\n  return (\n    <>\n      <Helmet title={title} />\n      <div className={classes.container}>\n        <div className={classes.leftItemsBox}>\n          {renderedTitle}\n          {description && (\n            <Typography className={classes.description} variant=\"body2\">\n              {description}\n            </Typography>\n          )}\n        </div>\n        <div className={classes.rightItemsBox}>{children}</div>\n      </div>\n    </>\n  );\n}\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React from 'react';\nimport { makeStyles } from '@material-ui/core/styles';\nimport MicDropSvgUrl from './mic-drop.svg';\n\nconst useStyles = makeStyles(\n  theme => ({\n    micDrop: {\n      maxWidth: '60%',\n      bottom: theme.spacing(2),\n      right: theme.spacing(2),\n      [theme.breakpoints.down('xs')]: {\n        maxWidth: '96%',\n        bottom: 'unset',\n        right: 'unset',\n        margin: `${theme.spacing(10)}px auto ${theme.spacing(4)}px`,\n      },\n    },\n  }),\n  { name: 'BackstageErrorPageMicDrop' },\n);\n\nexport type MicDropClassKey = 'micDrop';\n\nexport const MicDrop = () => {\n  const classes = useStyles();\n  return (\n    <img\n      src={MicDropSvgUrl}\n      className={classes.micDrop}\n      alt=\"Girl dropping mic from her hands\"\n    />\n  );\n};\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { BackstageTheme } from '@backstage/theme';\nimport Grid from '@material-ui/core/Grid';\nimport { makeStyles } from '@material-ui/core/styles';\nimport Typography from '@material-ui/core/Typography';\nimport React from 'react';\nimport { useNavigate } from 'react-router';\nimport { Link } from '../../components/Link';\nimport { useSupportConfig } from '../../hooks';\nimport { MicDrop } from './MicDrop';\n\ninterface IErrorPageProps {\n  status: string;\n  statusMessage: string;\n  additionalInfo?: React.ReactNode;\n  supportUrl?: string;\n}\n\n/** @public */\nexport type ErrorPageClassKey = 'container' | 'title' | 'subtitle';\n\nconst useStyles = makeStyles<BackstageTheme>(\n  theme => ({\n    container: {\n      padding: theme.spacing(8),\n      [theme.breakpoints.down('xs')]: {\n        padding: theme.spacing(2),\n      },\n    },\n    title: {\n      paddingBottom: theme.spacing(5),\n      [theme.breakpoints.down('xs')]: {\n        paddingBottom: theme.spacing(4),\n        fontSize: 32,\n      },\n    },\n    subtitle: {\n      color: theme.palette.textSubtle,\n    },\n  }),\n  { name: 'BackstageErrorPage' },\n);\n\n/**\n * Error page with status and description\n *\n * @public\n *\n */\nexport function ErrorPage(props: IErrorPageProps) {\n  const { status, statusMessage, additionalInfo, supportUrl } = props;\n  const classes = useStyles();\n  const navigate = useNavigate();\n  const support = useSupportConfig();\n\n  return (\n    <Grid container spacing={0} className={classes.container}>\n      <Grid item xs={12} sm={8} md={4}>\n        <Typography\n          data-testid=\"error\"\n          variant=\"body1\"\n          className={classes.subtitle}\n        >\n          ERROR {status}: {statusMessage}\n        </Typography>\n        <Typography variant=\"body1\" className={classes.subtitle}>\n          {additionalInfo}\n        </Typography>\n        <Typography variant=\"h2\" className={classes.title}>\n          Looks like someone dropped the mic!\n        </Typography>\n        <Typography variant=\"h6\">\n          <Link to=\"#\" data-testid=\"go-back-link\" onClick={() => navigate(-1)}>\n            Go back\n          </Link>\n          ... or please{' '}\n          <Link to={supportUrl || support.url}>contact support</Link> if you\n          think this is a bug.\n        </Typography>\n      </Grid>\n      <MicDrop />\n    </Grid>\n  );\n}\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport Box from '@material-ui/core/Box';\nimport MaterialBreadcrumbs from '@material-ui/core/Breadcrumbs';\nimport List from '@material-ui/core/List';\nimport ListItem from '@material-ui/core/ListItem';\nimport Popover from '@material-ui/core/Popover';\nimport { withStyles } from '@material-ui/core/styles';\nimport Typography from '@material-ui/core/Typography';\nimport React, { ComponentProps, Fragment } from 'react';\n\ntype Props = ComponentProps<typeof MaterialBreadcrumbs>;\n\n/** @public */\nexport type BreadcrumbsClickableTextClassKey = 'root';\n\nconst ClickableText = withStyles(\n  {\n    root: {\n      textDecoration: 'underline',\n      cursor: 'pointer',\n    },\n  },\n  { name: 'BackstageBreadcrumbsClickableText' },\n)(Typography);\n\n/** @public */\nexport type BreadcrumbsStyledBoxClassKey = 'root';\n\nconst StyledBox = withStyles(\n  {\n    root: {\n      textDecoration: 'underline',\n      color: 'inherit',\n    },\n  },\n  { name: 'BackstageBreadcrumbsStyledBox' },\n)(Box);\n\n/**\n * Breadcrumbs component to show navigation hierarchical structure\n *\n * @public\n *\n */\nexport function Breadcrumbs(props: Props) {\n  const { children, ...restProps } = props;\n  const [anchorEl, setAnchorEl] = React.useState<HTMLButtonElement | null>(\n    null,\n  );\n\n  const childrenArray = React.Children.toArray(children);\n\n  const [firstPage, secondPage, ...expandablePages] = childrenArray;\n  const currentPage = expandablePages.length\n    ? expandablePages.pop()\n    : childrenArray[childrenArray.length - 1];\n  const hasHiddenBreadcrumbs = childrenArray.length > 3;\n\n  const handleClick = (event: React.MouseEvent<HTMLButtonElement>) => {\n    setAnchorEl(event.currentTarget);\n  };\n\n  const handleClose = () => {\n    setAnchorEl(null);\n  };\n\n  const open = Boolean(anchorEl);\n  return (\n    <Fragment>\n      <MaterialBreadcrumbs aria-label=\"breadcrumb\" {...restProps}>\n        {childrenArray.length > 1 && <StyledBox clone>{firstPage}</StyledBox>}\n        {childrenArray.length > 2 && <StyledBox clone>{secondPage}</StyledBox>}\n        {hasHiddenBreadcrumbs && (\n          <ClickableText onClick={handleClick}>...</ClickableText>\n        )}\n        <Box style={{ fontStyle: 'italic' }}>{currentPage}</Box>\n      </MaterialBreadcrumbs>\n      <Popover\n        open={open}\n        anchorEl={anchorEl}\n        onClose={handleClose}\n        anchorOrigin={{\n          vertical: 'bottom',\n          horizontal: 'left',\n        }}\n        transformOrigin={{\n          vertical: 'top',\n          horizontal: 'left',\n        }}\n      >\n        <List>\n          {expandablePages.map((pageLink, index) => (\n            <ListItem key={index} button>\n              <StyledBox clone>{pageLink}</StyledBox>\n            </ListItem>\n          ))}\n        </List>\n      </Popover>\n    </Fragment>\n  );\n}\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { configApiRef, useApi } from '@backstage/core-plugin-api';\nimport { BackstageTheme } from '@backstage/theme';\nimport Box from '@material-ui/core/Box';\nimport Grid from '@material-ui/core/Grid';\nimport { makeStyles } from '@material-ui/core/styles';\nimport Tooltip from '@material-ui/core/Tooltip';\nimport Typography from '@material-ui/core/Typography';\nimport React, { CSSProperties, PropsWithChildren, ReactNode } from 'react';\nimport { Helmet } from 'react-helmet';\nimport { Link } from '../../components/Link';\nimport { Breadcrumbs } from '../Breadcrumbs';\n\n/** @public */\nexport type HeaderClassKey =\n  | 'header'\n  | 'leftItemsBox'\n  | 'rightItemsBox'\n  | 'title'\n  | 'subtitle'\n  | 'type'\n  | 'breadcrumb'\n  | 'breadcrumbType'\n  | 'breadcrumbTitle';\n\nconst useStyles = makeStyles<BackstageTheme>(\n  theme => ({\n    header: {\n      gridArea: 'pageHeader',\n      padding: theme.spacing(3),\n      width: '100%',\n      boxShadow: theme.shadows[4],\n      position: 'relative',\n      zIndex: 100,\n      display: 'flex',\n      flexDirection: 'row',\n      alignItems: 'center',\n      backgroundImage: theme.page.backgroundImage,\n      backgroundPosition: 'center',\n      backgroundSize: 'cover',\n      [theme.breakpoints.down('sm')]: {\n        flexWrap: 'wrap',\n      },\n    },\n    leftItemsBox: {\n      maxWidth: '100%',\n      flexGrow: 1,\n    },\n    rightItemsBox: {\n      width: 'auto',\n      alignItems: 'center',\n    },\n    title: {\n      color: theme.page.fontColor,\n      wordBreak: 'break-word',\n      fontSize: theme.typography.h3.fontSize,\n      marginBottom: 0,\n    },\n    subtitle: {\n      color: theme.page.fontColor,\n      opacity: 0.8,\n      display: 'inline-block', // prevents margin collapse of adjacent siblings\n      marginTop: theme.spacing(1),\n      maxWidth: '75ch',\n    },\n    type: {\n      textTransform: 'uppercase',\n      fontSize: 11,\n      opacity: 0.8,\n      marginBottom: theme.spacing(1),\n      color: theme.page.fontColor,\n    },\n    breadcrumb: {\n      color: theme.page.fontColor,\n    },\n    breadcrumbType: {\n      fontSize: 'inherit',\n      opacity: 0.7,\n      marginRight: -theme.spacing(0.3),\n      marginBottom: theme.spacing(0.3),\n    },\n    breadcrumbTitle: {\n      fontSize: 'inherit',\n      marginLeft: -theme.spacing(0.3),\n      marginBottom: theme.spacing(0.3),\n    },\n  }),\n  { name: 'BackstageHeader' },\n);\n\ntype HeaderStyles = ReturnType<typeof useStyles>;\n\ntype Props = {\n  component?: ReactNode;\n  pageTitleOverride?: string;\n  style?: CSSProperties;\n  subtitle?: ReactNode;\n  title: ReactNode;\n  tooltip?: string;\n  type?: string;\n  typeLink?: string;\n};\n\ntype TypeFragmentProps = {\n  classes: HeaderStyles;\n  pageTitle: string | ReactNode;\n  type?: Props['type'];\n  typeLink?: Props['typeLink'];\n};\n\ntype TitleFragmentProps = {\n  classes: HeaderStyles;\n  pageTitle: string | ReactNode;\n  tooltip?: Props['tooltip'];\n};\n\ntype SubtitleFragmentProps = {\n  classes: HeaderStyles;\n  subtitle?: Props['subtitle'];\n};\n\nconst TypeFragment = ({\n  type,\n  typeLink,\n  classes,\n  pageTitle,\n}: TypeFragmentProps) => {\n  if (!type) {\n    return null;\n  }\n\n  if (!typeLink) {\n    return <Typography className={classes.type}>{type}</Typography>;\n  }\n\n  return (\n    <Breadcrumbs className={classes.breadcrumb}>\n      <Link to={typeLink}>{type}</Link>\n      <Typography>{pageTitle}</Typography>\n    </Breadcrumbs>\n  );\n};\n\nconst TitleFragment = ({ pageTitle, classes, tooltip }: TitleFragmentProps) => {\n  const FinalTitle = (\n    <Typography className={classes.title} variant=\"h1\">\n      {pageTitle}\n    </Typography>\n  );\n\n  if (!tooltip) {\n    return FinalTitle;\n  }\n\n  return (\n    <Tooltip title={tooltip} placement=\"top-start\">\n      {FinalTitle}\n    </Tooltip>\n  );\n};\n\nconst SubtitleFragment = ({ classes, subtitle }: SubtitleFragmentProps) => {\n  if (!subtitle) {\n    return null;\n  }\n\n  if (typeof subtitle !== 'string') {\n    return <>{subtitle}</>;\n  }\n\n  return (\n    <Typography\n      className={classes.subtitle}\n      variant=\"subtitle2\"\n      component=\"span\"\n    >\n      {subtitle}\n    </Typography>\n  );\n};\n/**\n * Backstage main header with abstract color background in multiple variants\n *\n * @public\n *\n */\nexport function Header(props: PropsWithChildren<Props>) {\n  const {\n    children,\n    pageTitleOverride,\n    style,\n    subtitle,\n    title,\n    tooltip,\n    type,\n    typeLink,\n  } = props;\n  const classes = useStyles();\n  const configApi = useApi(configApiRef);\n  const appTitle = configApi.getOptionalString('app.title') || 'Backstage';\n  const documentTitle = pageTitleOverride || title;\n  const pageTitle = title || pageTitleOverride;\n  const titleTemplate = `${documentTitle} | %s | ${appTitle}`;\n  const defaultTitle = `${documentTitle} | ${appTitle}`;\n\n  return (\n    <>\n      <Helmet titleTemplate={titleTemplate} defaultTitle={defaultTitle} />\n      <header style={style} className={classes.header}>\n        <Box className={classes.leftItemsBox}>\n          <TypeFragment\n            classes={classes}\n            type={type}\n            typeLink={typeLink}\n            pageTitle={pageTitle}\n          />\n          <TitleFragment\n            classes={classes}\n            pageTitle={pageTitle}\n            tooltip={tooltip}\n          />\n          <SubtitleFragment classes={classes} subtitle={subtitle} />\n        </Box>\n        <Grid container className={classes.rightItemsBox} spacing={4}>\n          {children}\n        </Grid>\n      </header>\n    </>\n  );\n}\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React, { Fragment, ReactElement } from 'react';\nimport IconButton from '@material-ui/core/IconButton';\nimport List from '@material-ui/core/List';\nimport ListItem from '@material-ui/core/ListItem';\nimport ListItemIcon from '@material-ui/core/ListItemIcon';\nimport ListItemText, {\n  ListItemTextProps,\n} from '@material-ui/core/ListItemText';\nimport Popover from '@material-ui/core/Popover';\nimport MoreVert from '@material-ui/icons/MoreVert';\n\n/**\n * @public\n */\nexport type HeaderActionMenuItem = {\n  label?: ListItemTextProps['primary'];\n  secondaryLabel?: ListItemTextProps['secondary'];\n  icon?: ReactElement;\n  disabled?: boolean;\n  onClick?: (event: React.MouseEvent<HTMLElement>) => void;\n};\n\nconst ActionItem = ({\n  label,\n  secondaryLabel,\n  icon,\n  disabled = false,\n  onClick,\n}: HeaderActionMenuItem) => {\n  return (\n    <React.Fragment>\n      <ListItem\n        data-testid=\"header-action-item\"\n        disabled={disabled}\n        button\n        onClick={event => {\n          if (onClick) {\n            onClick(event);\n          }\n        }}\n      >\n        {icon && <ListItemIcon>{icon}</ListItemIcon>}\n        <ListItemText primary={label} secondary={secondaryLabel} />\n      </ListItem>\n    </React.Fragment>\n  );\n};\n\n/**\n * @public\n */\nexport type HeaderActionMenuProps = {\n  actionItems: HeaderActionMenuItem[];\n};\n\n/**\n * @public\n */\nexport function HeaderActionMenu(props: HeaderActionMenuProps) {\n  const { actionItems } = props;\n  const [open, setOpen] = React.useState(false);\n  const anchorElRef = React.useRef(null);\n\n  return (\n    <Fragment>\n      <IconButton\n        onClick={() => setOpen(true)}\n        data-testid=\"header-action-menu\"\n        ref={anchorElRef}\n        style={{\n          color: 'white',\n          height: 56,\n          width: 56,\n          marginRight: -4,\n          padding: 0,\n        }}\n      >\n        <MoreVert />\n      </IconButton>\n      <Popover\n        open={open}\n        anchorEl={anchorElRef.current}\n        anchorOrigin={{ horizontal: 'right', vertical: 'bottom' }}\n        transformOrigin={{ horizontal: 'right', vertical: 'top' }}\n        onClose={() => setOpen(false)}\n      >\n        <List>\n          {actionItems.map((actionItem, i) => {\n            return (\n              <ActionItem key={`header-action-menu-${i}`} {...actionItem} />\n            );\n          })}\n        </List>\n      </Popover>\n    </Fragment>\n  );\n}\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport Grid from '@material-ui/core/Grid';\nimport { makeStyles } from '@material-ui/core/styles';\nimport Typography from '@material-ui/core/Typography';\nimport React from 'react';\nimport { Link } from '../../components/Link';\n\n/** @public */\nexport type HeaderLabelClassKey = 'root' | 'label' | 'value';\n\nconst useStyles = makeStyles(\n  theme => ({\n    root: {\n      textAlign: 'left',\n    },\n    label: {\n      color: theme.palette.common.white,\n      fontWeight: 'bold',\n      letterSpacing: 0,\n      fontSize: theme.typography.fontSize,\n      marginBottom: theme.spacing(1) / 2,\n      lineHeight: 1,\n    },\n    value: {\n      color: 'rgba(255, 255, 255, 0.8)',\n      fontSize: theme.typography.fontSize,\n      lineHeight: 1,\n    },\n  }),\n  { name: 'BackstageHeaderLabel' },\n);\n\ntype HeaderLabelContentProps = {\n  value: React.ReactNode;\n  className: string;\n};\n\nconst HeaderLabelContent = ({ value, className }: HeaderLabelContentProps) => (\n  <Typography className={className}>{value}</Typography>\n);\n\ntype HeaderLabelProps = {\n  label: string;\n  value?: HeaderLabelContentProps['value'];\n  url?: string;\n};\n\n/**\n * Additional label to main {@link Header}\n *\n * @public\n *\n */\nexport function HeaderLabel(props: HeaderLabelProps) {\n  const { label, value, url } = props;\n  const classes = useStyles();\n  const content = (\n    <HeaderLabelContent\n      className={classes.value}\n      value={value || '<Unknown>'}\n    />\n  );\n  return (\n    <Grid item>\n      <span className={classes.root}>\n        <Typography className={classes.label}>{label}</Typography>\n        {url ? <Link to={url}>{content}</Link> : content}\n      </span>\n    </Grid>\n  );\n}\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React from 'react';\nimport { HeaderLabel } from '../HeaderLabel';\nimport { ConfigApi, useApi, configApiRef } from '@backstage/core-plugin-api';\n\nconst timeFormat: Intl.DateTimeFormatOptions = {\n  hour: '2-digit',\n  minute: '2-digit',\n};\n\ntype TimeObj = {\n  time: string;\n  label: string;\n};\n\nfunction getTimes(configApi: ConfigApi) {\n  const d = new Date();\n  const lang = window.navigator.language;\n\n  const clocks: TimeObj[] = [];\n\n  if (!configApi.has('homepage.clocks')) {\n    return clocks;\n  }\n\n  const clockConfigs = configApi.getConfigArray('homepage.clocks');\n\n  for (const clock of clockConfigs) {\n    if (clock.has('label') && clock.has('timezone')) {\n      let label = clock.getString('label');\n\n      const options: Intl.DateTimeFormatOptions = {\n        timeZone: clock.getString('timezone'),\n        ...timeFormat,\n      };\n\n      try {\n        new Date().toLocaleString(lang, options);\n      } catch (e) {\n        // eslint-disable-next-line no-console\n        console.warn(\n          `The timezone ${options.timeZone} is invalid. Defaulting to GMT`,\n        );\n        options.timeZone = 'GMT';\n        label = 'GMT';\n      }\n\n      const time = d.toLocaleTimeString(lang, options);\n      clocks.push({ time, label });\n    }\n  }\n  return clocks;\n}\n\n/**\n * Please use the HeaderWorldClock in the home plugin\n *\n * @public\n * @deprecated in favor of the HeaderWorldClock which is found in the to home plugin\n */\nexport function HomepageTimer(_props: {}) {\n  const configApi = useApi(configApiRef);\n\n  const defaultTimes: TimeObj[] = [];\n  const [clocks, setTimes] = React.useState(defaultTimes);\n\n  React.useEffect(() => {\n    setTimes(getTimes(configApi));\n\n    const intervalId = setInterval(() => {\n      setTimes(getTimes(configApi));\n    }, 1000);\n\n    return () => {\n      clearInterval(intervalId);\n    };\n  }, [configApi]);\n\n  if (clocks.length !== 0) {\n    return (\n      <>\n        {clocks.map(clock => (\n          <HeaderLabel\n            label={clock.label}\n            value={clock.time}\n            key={clock.label}\n          />\n        ))}\n      </>\n    );\n  }\n  return null;\n}\n","/*\n * Copyright 2021 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { createStyles, makeStyles, WithStyles } from '@material-ui/core/styles';\nimport Typography from '@material-ui/core/Typography';\nimport React from 'react';\nimport { BackstageTheme } from '@backstage/theme';\n\n/** @public */\nexport type ItemCardHeaderClassKey = 'root';\n\nconst styles = (theme: BackstageTheme) =>\n  createStyles({\n    root: {\n      color: theme.palette.common.white,\n      padding: theme.spacing(2, 2, 3),\n      backgroundImage: theme.getPageTheme({ themeId: 'card' }).backgroundImage,\n      backgroundPosition: 0,\n      backgroundSize: 'inherit',\n    },\n  });\n\nconst useStyles = makeStyles(styles, { name: 'BackstageItemCardHeader' });\n\n/** @public */\nexport type ItemCardHeaderProps = Partial<WithStyles<typeof styles>> & {\n  /**\n   * A large title to show in the header, providing the main heading.\n   *\n   * Use this if you want to have the default styling and placement of a title.\n   */\n  title?: React.ReactNode;\n  /**\n   * A slightly smaller title to show in the header, providing additional\n   * details.\n   *\n   * Use this if you want to have the default styling and placement of a\n   * subtitle.\n   */\n  subtitle?: React.ReactNode;\n  /**\n   * Custom children to draw in the header.\n   *\n   * If the title and/or subtitle were specified, the children are drawn below\n   * those.\n   */\n  children?: React.ReactNode;\n};\n\n/**\n * A simple card header, rendering a default look for \"item cards\" - cards that\n * are arranged in a grid for users to select among several options.\n *\n * @remarks\n * This component expects to be placed within a MUI `<CardMedia>`.\n *\n * Styles for the header can be overridden using the `classes` prop, e.g.:\n *\n * `<ItemCardHeader title=\"Hello\" classes={{ root: myClassName }} />`\n *\n * @public\n */\nexport function ItemCardHeader(props: ItemCardHeaderProps) {\n  const { title, subtitle, children } = props;\n  const classes = useStyles(props);\n  return (\n    <div className={classes.root}>\n      {subtitle && (\n        <Typography variant=\"subtitle2\" component=\"h3\">\n          {subtitle}\n        </Typography>\n      )}\n      {title && (\n        <Typography variant=\"h6\" component=\"h4\">\n          {title}\n        </Typography>\n      )}\n      {children}\n    </div>\n  );\n}\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport Box from '@material-ui/core/Box';\nimport Card from '@material-ui/core/Card';\nimport CardActions from '@material-ui/core/CardActions';\nimport CardContent from '@material-ui/core/CardContent';\nimport CardMedia from '@material-ui/core/CardMedia';\nimport Chip from '@material-ui/core/Chip';\nimport React, { ReactNode } from 'react';\nimport { Button } from '../../components';\nimport { ItemCardHeader } from './ItemCardHeader';\n\ntype ItemCardProps = {\n  description?: string;\n  tags?: string[];\n  title: string;\n  /** @deprecated Use subtitle instead */\n  type?: string;\n  subtitle?: ReactNode;\n  label: string;\n  onClick?: () => void;\n  href?: string;\n};\n\n/**\n * This card type has been deprecated. Instead use plain MUI Card and helpers\n * where appropriate.\n *\n *  @example\n * ```\n *   <Card>\n *     <CardMedia>\n *       <ItemCardHeader title=\"My Card\" subtitle=\"neat!\" />\n *     </CardMedia>\n *     <CardContent>\n *        Some text\n *     </CardContent>\n *     <CardActions>\n *       <Button color=\"primary\" to=\"https://backstage.io\">\n *         Get Started\n *       </Button>\n *     </CardActions>\n *   </Card>\n * ```\n *\n * @deprecated Use plain MUI `<Card>` and composable helpers instead.\n * @see https://material-ui.com/components/cards/\n */\nexport function ItemCard(props: ItemCardProps) {\n  const { description, tags, title, type, subtitle, label, onClick, href } =\n    props;\n  return (\n    <Card>\n      <CardMedia>\n        <ItemCardHeader title={title} subtitle={subtitle || type} />\n      </CardMedia>\n      <CardContent>\n        {tags?.length ? (\n          <Box>\n            {tags.map((tag, i) => (\n              <Chip size=\"small\" label={tag} key={i} />\n            ))}\n          </Box>\n        ) : null}\n        {description}\n      </CardContent>\n      <CardActions>\n        {!href && (\n          <Button to=\"#\" onClick={onClick} color=\"primary\">\n            {label}\n          </Button>\n        )}\n        {href && (\n          <Button to={href} color=\"primary\">\n            {label}\n          </Button>\n        )}\n      </CardActions>\n    </Card>\n  );\n}\n","/*\n * Copyright 2021 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  createStyles,\n  makeStyles,\n  Theme,\n  WithStyles,\n} from '@material-ui/core/styles';\nimport React from 'react';\n\n/** @public */\nexport type ItemCardGridClassKey = 'root';\n\nconst styles = (theme: Theme) =>\n  createStyles({\n    root: {\n      display: 'grid',\n      gridTemplateColumns: 'repeat(auto-fill, minmax(22em, 1fr))',\n      gridAutoRows: '1fr',\n      gridGap: theme.spacing(2),\n    },\n  });\n\nconst useStyles = makeStyles(styles, { name: 'BackstageItemCardGrid' });\n\n/** @public */\nexport type ItemCardGridProps = Partial<WithStyles<typeof styles>> & {\n  /**\n   * The Card items of the grid.\n   */\n  children?: React.ReactNode;\n};\n\n/**\n * A default grid to use when arranging \"item cards\" - cards that let users\n * select among several options.\n *\n * @remarks\n * The immediate children are expected to be MUI Card components.\n *\n * Styles for the grid can be overridden using the `classes` prop, e.g.:\n *\n * `<ItemCardGrid title=\"Hello\" classes={{ root: myClassName }} />`\n *\n * This can be useful for e.g. overriding gridTemplateColumns to adapt the\n * minimum size of the cells to fit the content better.\n *\n * @public\n */\nexport function ItemCardGrid(props: ItemCardGridProps) {\n  const { children, ...otherProps } = props;\n  const classes = useStyles(otherProps);\n  return (\n    <div className={classes.root} {...otherProps}>\n      {children}\n    </div>\n  );\n}\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React from 'react';\nimport { BackstageTheme } from '@backstage/theme';\nimport { makeStyles, ThemeProvider } from '@material-ui/core/styles';\nimport { useSidebarPinState } from '../Sidebar/SidebarPinStateContext';\n\nexport type PageClassKey = 'root';\n\nconst useStyles = makeStyles<BackstageTheme, { isMobile?: boolean }>(\n  () => ({\n    root: ({ isMobile }) => ({\n      display: 'grid',\n      gridTemplateAreas:\n        \"'pageHeader pageHeader pageHeader' 'pageSubheader pageSubheader pageSubheader' 'pageNav pageContent pageSidebar'\",\n      gridTemplateRows: 'max-content auto 1fr',\n      gridTemplateColumns: 'auto 1fr auto',\n      height: isMobile ? '100%' : '100vh',\n      overflowY: 'auto',\n    }),\n  }),\n  { name: 'BackstagePage' },\n);\n\ntype Props = {\n  themeId: string;\n  children?: React.ReactNode;\n};\n\nexport function Page(props: Props) {\n  const { themeId, children } = props;\n  const { isMobile } = useSidebarPinState();\n  const classes = useStyles({ isMobile });\n  return (\n    <ThemeProvider\n      theme={(baseTheme: BackstageTheme) => ({\n        ...baseTheme,\n        page: baseTheme.getPageTheme({ themeId }),\n      })}\n    >\n      <main className={classes.root}>{children}</main>\n    </ThemeProvider>\n  );\n}\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React, { PropsWithChildren, ComponentProps } from 'react';\n\nimport { Header } from '../Header';\nimport { Page } from './Page';\n\ntype PageWithHeaderProps = ComponentProps<typeof Header> & {\n  themeId: string;\n};\n\nexport function PageWithHeader(props: PropsWithChildren<PageWithHeaderProps>) {\n  const { themeId, children, ...restProps } = props;\n  return (\n    <Page themeId={themeId}>\n      <Header {...restProps} />\n      {children}\n    </Page>\n  );\n}\n","/*\n * Copyright 2021 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  BackstageIdentityResponse,\n  ProfileInfo,\n} from '@backstage/core-plugin-api';\nimport { z } from 'zod';\n\nexport const proxiedSessionSchema = z.object({\n  providerInfo: z.object({}).catchall(z.unknown()).optional(),\n  profile: z.object({\n    email: z.string().optional(),\n    displayName: z.string().optional(),\n    picture: z.string().optional(),\n  }),\n  backstageIdentity: z.object({\n    token: z.string(),\n    identity: z.object({\n      type: z.literal('user'),\n      userEntityRef: z.string(),\n      ownershipEntityRefs: z.array(z.string()),\n    }),\n  }),\n});\n\n/**\n * Generic session information for proxied sign-in providers, e.g. common\n * reverse authenticating proxy implementations.\n *\n * @public\n */\nexport type ProxiedSession = {\n  providerInfo?: { [key: string]: unknown };\n  profile: ProfileInfo;\n  backstageIdentity: Omit<BackstageIdentityResponse, 'id'>;\n};\n","/*\n * Copyright 2021 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  BackstageUserIdentity,\n  discoveryApiRef,\n  IdentityApi,\n  ProfileInfo,\n} from '@backstage/core-plugin-api';\nimport { ResponseError } from '@backstage/errors';\nimport { ProxiedSession, proxiedSessionSchema } from './types';\n\nexport const DEFAULTS = {\n  // The amount of time between token refreshes, if we fail to get an actual\n  // value out of the exp claim\n  defaultTokenExpiryMillis: 5 * 60 * 1000,\n  // The amount of time before the actual expiry of the Backstage token, that we\n  // shall start trying to get a new one\n  tokenExpiryMarginMillis: 5 * 60 * 1000,\n} as const;\n\n// When the token expires, with some margin\nexport function tokenToExpiry(jwtToken: string | undefined): Date {\n  const fallback = new Date(Date.now() + DEFAULTS.defaultTokenExpiryMillis);\n  if (!jwtToken) {\n    return fallback;\n  }\n\n  const [_header, rawPayload, _signature] = jwtToken.split('.');\n  const payload = JSON.parse(atob(rawPayload));\n  if (typeof payload.exp !== 'number') {\n    return fallback;\n  }\n\n  return new Date(payload.exp * 1000 - DEFAULTS.tokenExpiryMarginMillis);\n}\n\ntype ProxiedSignInIdentityOptions = {\n  provider: string;\n  discoveryApi: typeof discoveryApiRef.T;\n};\n\ntype State =\n  | {\n      type: 'empty';\n    }\n  | {\n      type: 'fetching';\n      promise: Promise<ProxiedSession>;\n      previous: ProxiedSession | undefined;\n    }\n  | {\n      type: 'active';\n      session: ProxiedSession;\n      expiresAt: Date;\n    }\n  | {\n      type: 'failed';\n      error: Error;\n    };\n\n/**\n * An identity API that gets the user auth information solely based on a\n * provider's `/refresh` endpoint.\n */\nexport class ProxiedSignInIdentity implements IdentityApi {\n  private readonly options: ProxiedSignInIdentityOptions;\n  private readonly abortController: AbortController;\n  private state: State;\n\n  constructor(options: ProxiedSignInIdentityOptions) {\n    this.options = options;\n    this.abortController = new AbortController();\n    this.state = { type: 'empty' };\n  }\n\n  async start() {\n    // Try to make a first fetch, bubble up any errors to the caller\n    await this.getSessionAsync();\n  }\n\n  /** {@inheritdoc @backstage/core-plugin-api#IdentityApi.getUserId} */\n  getUserId(): string {\n    const { backstageIdentity } = this.getSessionSync();\n    const ref = backstageIdentity.identity.userEntityRef;\n    const match = /^([^:/]+:)?([^:/]+\\/)?([^:/]+)$/.exec(ref);\n    if (!match) {\n      throw new TypeError(`Invalid user entity reference \"${ref}\"`);\n    }\n\n    return match[3];\n  }\n\n  /** {@inheritdoc @backstage/core-plugin-api#IdentityApi.getIdToken} */\n  async getIdToken(): Promise<string | undefined> {\n    const session = await this.getSessionAsync();\n    return session.backstageIdentity.token;\n  }\n\n  /** {@inheritdoc @backstage/core-plugin-api#IdentityApi.getProfile} */\n  getProfile(): ProfileInfo {\n    const session = this.getSessionSync();\n    return session.profile;\n  }\n\n  /** {@inheritdoc @backstage/core-plugin-api#IdentityApi.getProfileInfo} */\n  async getProfileInfo(): Promise<ProfileInfo> {\n    const session = await this.getSessionAsync();\n    return session.profile;\n  }\n\n  /** {@inheritdoc @backstage/core-plugin-api#IdentityApi.getBackstageIdentity} */\n  async getBackstageIdentity(): Promise<BackstageUserIdentity> {\n    const session = await this.getSessionAsync();\n    return session.backstageIdentity.identity;\n  }\n\n  /** {@inheritdoc @backstage/core-plugin-api#IdentityApi.getCredentials} */\n  async getCredentials(): Promise<{ token?: string | undefined }> {\n    const session = await this.getSessionAsync();\n    return {\n      token: session.backstageIdentity.token,\n    };\n  }\n\n  /** {@inheritdoc @backstage/core-plugin-api#IdentityApi.signOut} */\n  async signOut(): Promise<void> {\n    this.abortController.abort();\n  }\n\n  getSessionSync(): ProxiedSession {\n    if (this.state.type === 'active') {\n      return this.state.session;\n    } else if (this.state.type === 'fetching' && this.state.previous) {\n      return this.state.previous;\n    }\n    throw new Error('No session available. Try reloading your browser page.');\n  }\n\n  async getSessionAsync(): Promise<ProxiedSession> {\n    if (this.state.type === 'fetching') {\n      return this.state.promise;\n    } else if (\n      this.state.type === 'active' &&\n      new Date() < this.state.expiresAt\n    ) {\n      return this.state.session;\n    }\n\n    const previous =\n      this.state.type === 'active' ? this.state.session : undefined;\n\n    const promise = this.fetchSession().then(\n      session => {\n        this.state = {\n          type: 'active',\n          session,\n          expiresAt: tokenToExpiry(session.backstageIdentity.token),\n        };\n        return session;\n      },\n      error => {\n        this.state = {\n          type: 'failed',\n          error,\n        };\n        throw error;\n      },\n    );\n\n    this.state = {\n      type: 'fetching',\n      promise,\n      previous,\n    };\n\n    return promise;\n  }\n\n  async fetchSession(): Promise<ProxiedSession> {\n    const baseUrl = await this.options.discoveryApi.getBaseUrl('auth');\n\n    // Note that we do not use the fetchApi here, since this all happens before\n    // sign-in completes so there can be no automatic token injection and\n    // similar.\n    const response = await fetch(\n      `${baseUrl}/${this.options.provider}/refresh`,\n      {\n        signal: this.abortController.signal,\n        headers: { 'x-requested-with': 'XMLHttpRequest' },\n        credentials: 'include',\n      },\n    );\n\n    if (!response.ok) {\n      throw await ResponseError.fromResponse(response);\n    }\n\n    return proxiedSessionSchema.parse(await response.json());\n  }\n}\n","/*\n * Copyright 2021 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  discoveryApiRef,\n  SignInPageProps,\n  useApi,\n} from '@backstage/core-plugin-api';\nimport React from 'react';\nimport { useAsync, useMountEffect } from '@react-hookz/web';\nimport { ErrorPanel } from '../../components/ErrorPanel';\nimport { Progress } from '../../components/Progress';\nimport { ProxiedSignInIdentity } from './ProxiedSignInIdentity';\n\n/**\n * Props for {@link ProxiedSignInPage}.\n *\n * @public\n */\nexport type ProxiedSignInPageProps = SignInPageProps & {\n  /**\n   * The provider to use, e.g. \"gcp-iap\" or \"awsalb\". This must correspond to\n   * a properly configured auth provider ID in the auth backend.\n   */\n  provider: string;\n};\n\n/**\n * A sign-in page that has no user interface of its own. Instead, it relies on\n * sign-in being performed by a reverse authenticating proxy that Backstage is\n * deployed behind, and leverages its session handling.\n *\n * @remarks\n *\n * This sign-in page is useful when you are using products such as Google\n * Identity-Aware Proxy or AWS Application Load Balancer or similar, to front\n * your Backstage installation. This sign-in page implementation will silently\n * and regularly punch through the proxy to the auth backend to refresh your\n * frontend session information, without requiring user interaction.\n *\n * @public\n */\nexport const ProxiedSignInPage = (props: ProxiedSignInPageProps) => {\n  const discoveryApi = useApi(discoveryApiRef);\n\n  const [{ status, error }, { execute }] = useAsync(async () => {\n    const identity = new ProxiedSignInIdentity({\n      provider: props.provider,\n      discoveryApi,\n    });\n\n    await identity.start();\n\n    props.onSignInSuccess(identity);\n  });\n\n  useMountEffect(execute);\n\n  if (status === 'loading') {\n    return <Progress />;\n  } else if (error) {\n    return (\n      <ErrorPanel\n        title=\"You do not appear to be signed in. Please try reloading the browser page.\"\n        error={error}\n      />\n    );\n  }\n\n  return null;\n};\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport React from 'react';\nimport { makeStyles } from '@material-ui/core/styles';\nimport Grid from '@material-ui/core/Grid';\n\nexport type SignInPageClassKey = 'container' | 'item';\n\nexport const useStyles = makeStyles(\n  {\n    container: {\n      padding: 0,\n      listStyle: 'none',\n    },\n    item: {\n      display: 'flex',\n      flexDirection: 'column',\n      width: '100%',\n      maxWidth: '400px',\n      margin: 0,\n      padding: 0,\n    },\n  },\n  { name: 'BackstageSignInPage' },\n);\n\nexport const GridItem = ({ children }: { children: JSX.Element }) => {\n  const classes = useStyles();\n\n  return (\n    <Grid component=\"li\" item classes={classes}>\n      {children}\n    </Grid>\n  );\n};\n","/*\n * Copyright 2021 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  IdentityApi,\n  ProfileInfo,\n  BackstageUserIdentity,\n} from '@backstage/core-plugin-api';\n\nexport class GuestUserIdentity implements IdentityApi {\n  getUserId(): string {\n    return 'guest';\n  }\n\n  async getIdToken(): Promise<string | undefined> {\n    return undefined;\n  }\n\n  getProfile(): ProfileInfo {\n    return {\n      email: 'guest@example.com',\n      displayName: 'Guest',\n    };\n  }\n\n  async getProfileInfo(): Promise<ProfileInfo> {\n    return {\n      email: 'guest@example.com',\n      displayName: 'Guest',\n    };\n  }\n\n  async getBackstageIdentity(): Promise<BackstageUserIdentity> {\n    const userEntityRef = `user:default/guest`;\n    return {\n      type: 'user',\n      userEntityRef,\n      ownershipEntityRefs: [userEntityRef],\n    };\n  }\n\n  async getCredentials(): Promise<{ token?: string | undefined }> {\n    return {};\n  }\n\n  async signOut(): Promise<void> {}\n}\n","/*\n * Copyright 2021 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  IdentityApi,\n  ProfileInfo,\n  BackstageUserIdentity,\n} from '@backstage/core-plugin-api';\n\nfunction parseJwtPayload(token: string) {\n  const [_header, payload, _signature] = token.split('.');\n  return JSON.parse(atob(payload));\n}\n\ntype LegacySignInResult = {\n  userId: string;\n  profile: ProfileInfo;\n  getIdToken?: () => Promise<string>;\n  signOut?: () => Promise<void>;\n};\n\n/** @internal */\nexport class LegacyUserIdentity implements IdentityApi {\n  private constructor(private readonly result: LegacySignInResult) {}\n\n  getUserId(): string {\n    return this.result.userId;\n  }\n\n  static fromResult(result: LegacySignInResult): LegacyUserIdentity {\n    return new LegacyUserIdentity(result);\n  }\n\n  async getIdToken(): Promise<string | undefined> {\n    return this.result.getIdToken?.();\n  }\n\n  getProfile(): ProfileInfo {\n    return this.result.profile;\n  }\n\n  async getProfileInfo(): Promise<ProfileInfo> {\n    return this.result.profile;\n  }\n\n  async getBackstageIdentity(): Promise<BackstageUserIdentity> {\n    const token = await this.getIdToken();\n\n    if (!token) {\n      const userEntityRef = `user:default/${this.getUserId()}`;\n      return {\n        type: 'user',\n        userEntityRef,\n        ownershipEntityRefs: [userEntityRef],\n      };\n    }\n\n    const { sub, ent } = parseJwtPayload(token);\n    return {\n      type: 'user',\n      userEntityRef: sub,\n      ownershipEntityRefs: ent ?? [],\n    };\n  }\n\n  async getCredentials(): Promise<{ token?: string | undefined }> {\n    const token = await this.result.getIdToken?.();\n    return { token };\n  }\n\n  async signOut(): Promise<void> {\n    return this.result.signOut?.();\n  }\n}\n","/*\n * Copyright 2021 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  IdentityApi,\n  ProfileInfo,\n  ProfileInfoApi,\n  BackstageUserIdentity,\n  BackstageIdentityApi,\n  SessionApi,\n} from '@backstage/core-plugin-api';\n\nimport { GuestUserIdentity } from './GuestUserIdentity';\nimport { LegacyUserIdentity } from './LegacyUserIdentity';\n\n// TODO(Rugvip): This and the other IdentityApi implementations still implement\n//               the old removed methods. This is to allow for backwards compatibility\n//               with old plugins that still consume this API. We will leave these in\n//               place as a hidden compatibility for a couple of months.\n//               The AppIdentityProxy warns in case any of these methods are called.\n\n/**\n * An implementation of the IdentityApi that is constructed using\n * various backstage user identity representations.\n *\n * @public\n */\nexport class UserIdentity implements IdentityApi {\n  private profilePromise?: Promise<ProfileInfo>;\n  /**\n   * Creates a new IdentityApi that acts as a Guest User.\n   *\n   * @public\n   */\n  static createGuest(): IdentityApi {\n    return new GuestUserIdentity();\n  }\n\n  /**\n   * Creates a new IdentityApi using a legacy SignInResult object.\n   *\n   * @public\n   */\n  static fromLegacy(result: {\n    /**\n     * User ID that will be returned by the IdentityApi\n     */\n    userId: string;\n\n    profile: ProfileInfo;\n\n    /**\n     * Function used to retrieve an ID token for the signed in user.\n     */\n    getIdToken?: () => Promise<string>;\n\n    /**\n     * Sign out handler that will be called if the user requests to sign out.\n     */\n    signOut?: () => Promise<void>;\n  }): IdentityApi {\n    return LegacyUserIdentity.fromResult(result);\n  }\n\n  /**\n   * Creates a new IdentityApi implementation using a user identity\n   * and an auth API that will be used to request backstage tokens.\n   *\n   * @public\n   */\n  static create(options: {\n    identity: BackstageUserIdentity;\n    authApi: ProfileInfoApi & BackstageIdentityApi & SessionApi;\n    /**\n     * Passing a profile synchronously allows the deprecated `getProfile` method to be\n     * called by consumers of the {@link @backstage/core-plugin-api#IdentityApi}. If you\n     * do not have any consumers of that method then this is safe to leave out.\n     *\n     * @deprecated Only provide this if you have plugins that call the synchronous `getProfile` method, which is also deprecated.\n     */\n    profile?: ProfileInfo;\n  }): IdentityApi {\n    return new UserIdentity(options.identity, options.authApi, options.profile);\n  }\n\n  private constructor(\n    private readonly identity: BackstageUserIdentity,\n    private readonly authApi: ProfileInfoApi &\n      BackstageIdentityApi &\n      SessionApi,\n    private readonly profile?: ProfileInfo,\n  ) {}\n\n  /** {@inheritdoc @backstage/core-plugin-api#IdentityApi.getUserId} */\n  getUserId(): string {\n    const ref = this.identity.userEntityRef;\n    const match = /^([^:/]+:)?([^:/]+\\/)?([^:/]+)$/.exec(ref);\n    if (!match) {\n      throw new TypeError(`Invalid user entity reference \"${ref}\"`);\n    }\n\n    return match[3];\n  }\n\n  /** {@inheritdoc @backstage/core-plugin-api#IdentityApi.getIdToken} */\n  async getIdToken(): Promise<string | undefined> {\n    const identity = await this.authApi.getBackstageIdentity();\n    return identity!.token;\n  }\n\n  /** {@inheritdoc @backstage/core-plugin-api#IdentityApi.getProfile} */\n  getProfile(): ProfileInfo {\n    if (!this.profile) {\n      throw new Error(\n        'The identity API does not implement synchronous profile fetching, use getProfileInfo() instead',\n      );\n    }\n    return this.profile;\n  }\n\n  /** {@inheritdoc @backstage/core-plugin-api#IdentityApi.getProfileInfo} */\n  async getProfileInfo(): Promise<ProfileInfo> {\n    if (this.profilePromise) {\n      return await this.profilePromise;\n    }\n\n    try {\n      this.profilePromise = this.authApi.getProfile() as Promise<ProfileInfo>;\n      return await this.profilePromise;\n    } catch (ex) {\n      this.profilePromise = undefined;\n      throw ex;\n    }\n  }\n\n  /** {@inheritdoc @backstage/core-plugin-api#IdentityApi.getBackstageIdentity} */\n  async getBackstageIdentity(): Promise<BackstageUserIdentity> {\n    return this.identity;\n  }\n\n  /** {@inheritdoc @backstage/core-plugin-api#IdentityApi.getCredentials} */\n  async getCredentials(): Promise<{ token?: string | undefined }> {\n    const identity = await this.authApi.getBackstageIdentity();\n    return { token: identity!.token };\n  }\n\n  /** {@inheritdoc @backstage/core-plugin-api#IdentityApi.signOut} */\n  async signOut(): Promise<void> {\n    return this.authApi.signOut();\n  }\n}\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React from 'react';\nimport Typography from '@material-ui/core/Typography';\nimport Button from '@material-ui/core/Button';\nimport { InfoCard } from '../InfoCard/InfoCard';\nimport {\n  ProviderComponent,\n  ProviderLoader,\n  SignInProvider,\n  SignInProviderConfig,\n} from './types';\nimport { useApi, errorApiRef } from '@backstage/core-plugin-api';\nimport { GridItem } from './styles';\nimport { ForwardedError } from '@backstage/errors';\nimport { UserIdentity } from './UserIdentity';\n\nconst Component: ProviderComponent = ({ config, onSignInSuccess }) => {\n  const { apiRef, title, message } = config as SignInProviderConfig;\n  const authApi = useApi(apiRef);\n  const errorApi = useApi(errorApiRef);\n\n  const handleLogin = async () => {\n    try {\n      const identityResponse = await authApi.getBackstageIdentity({\n        instantPopup: true,\n      });\n      if (!identityResponse) {\n        throw new Error(\n          `The ${title} provider is not configured to support sign-in`,\n        );\n      }\n\n      const profile = await authApi.getProfile();\n\n      onSignInSuccess(\n        UserIdentity.create({\n          identity: identityResponse.identity,\n          profile,\n          authApi,\n        }),\n      );\n    } catch (error) {\n      errorApi.post(new ForwardedError('Login failed', error));\n    }\n  };\n\n  return (\n    <GridItem>\n      <InfoCard\n        variant=\"fullHeight\"\n        title={title}\n        actions={\n          <Button color=\"primary\" variant=\"outlined\" onClick={handleLogin}>\n            Sign In\n          </Button>\n        }\n      >\n        <Typography variant=\"body1\">{message}</Typography>\n      </InfoCard>\n    </GridItem>\n  );\n};\n\nconst loader: ProviderLoader = async (apis, apiRef) => {\n  const authApi = apis.get(apiRef)!;\n\n  const identityResponse = await authApi.getBackstageIdentity({\n    optional: true,\n  });\n\n  if (!identityResponse) {\n    return undefined;\n  }\n\n  const profile = await authApi.getProfile();\n\n  return UserIdentity.create({\n    identity: identityResponse.identity,\n    profile,\n    authApi,\n  });\n};\n\nexport const commonProvider: SignInProvider = { Component, loader };\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React from 'react';\nimport Typography from '@material-ui/core/Typography';\nimport Button from '@material-ui/core/Button';\nimport { InfoCard } from '../InfoCard/InfoCard';\nimport { GridItem } from './styles';\nimport { ProviderComponent, ProviderLoader, SignInProvider } from './types';\nimport { GuestUserIdentity } from './GuestUserIdentity';\n\nconst Component: ProviderComponent = ({ onSignInSuccess }) => (\n  <GridItem>\n    <InfoCard\n      title=\"Guest\"\n      variant=\"fullHeight\"\n      actions={\n        <Button\n          color=\"primary\"\n          variant=\"outlined\"\n          onClick={() => onSignInSuccess(new GuestUserIdentity())}\n        >\n          Enter\n        </Button>\n      }\n    >\n      <Typography variant=\"body1\">\n        Enter as a Guest User.\n        <br />\n        You will not have a verified identity,\n        <br />\n        meaning some features might be unavailable.\n      </Typography>\n    </InfoCard>\n  </GridItem>\n);\n\nconst loader: ProviderLoader = async () => {\n  return new GuestUserIdentity();\n};\n\nexport const guestProvider: SignInProvider = { Component, loader };\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React from 'react';\nimport { useForm, UseFormRegisterReturn } from 'react-hook-form';\nimport { makeStyles } from '@material-ui/core/styles';\nimport Typography from '@material-ui/core/Typography';\nimport Button from '@material-ui/core/Button';\nimport FormControl from '@material-ui/core/FormControl';\nimport TextField from '@material-ui/core/TextField';\nimport FormHelperText from '@material-ui/core/FormHelperText';\nimport isEmpty from 'lodash/isEmpty';\nimport { InfoCard } from '../InfoCard/InfoCard';\nimport { ProviderComponent, ProviderLoader, SignInProvider } from './types';\nimport { GridItem } from './styles';\nimport { UserIdentity } from './UserIdentity';\n\n// accept base64url format according to RFC7515 (https://tools.ietf.org/html/rfc7515#section-3)\nconst ID_TOKEN_REGEX = /^[a-z0-9_\\-]+\\.[a-z0-9_\\-]+\\.[a-z0-9_\\-]+$/i;\n\n/** @public */\nexport type CustomProviderClassKey = 'form' | 'button';\n\nconst useFormStyles = makeStyles(\n  theme => ({\n    form: {\n      display: 'flex',\n      flexFlow: 'column nowrap',\n    },\n    button: {\n      alignSelf: 'center',\n      marginTop: theme.spacing(2),\n    },\n  }),\n  { name: 'BackstageCustomProvider' },\n);\n\ntype Data = {\n  userId: string;\n  idToken?: string;\n};\n\nconst asInputRef = (renderResult: UseFormRegisterReturn) => {\n  const { ref, ...rest } = renderResult;\n  return {\n    inputRef: ref,\n    ...rest,\n  };\n};\n\nconst Component: ProviderComponent = ({ onSignInSuccess }) => {\n  const classes = useFormStyles();\n  const { register, handleSubmit, formState } = useForm<Data>({\n    mode: 'onChange',\n  });\n\n  const { errors } = formState;\n\n  const handleResult = ({ userId }: Data) => {\n    onSignInSuccess(\n      UserIdentity.fromLegacy({\n        userId,\n        profile: {\n          email: `${userId}@example.com`,\n        },\n      }),\n    );\n  };\n\n  return (\n    <GridItem>\n      <InfoCard title=\"Custom User\" variant=\"fullHeight\">\n        <Typography variant=\"body1\">\n          Enter your own User ID and credentials.\n          <br />\n          This selection will not be stored.\n        </Typography>\n\n        <form className={classes.form} onSubmit={handleSubmit(handleResult)}>\n          <FormControl>\n            <TextField\n              {...asInputRef(register('userId', { required: true }))}\n              label=\"User ID\"\n              margin=\"normal\"\n              error={Boolean(errors.userId)}\n            />\n            {errors.userId && (\n              <FormHelperText error>{errors.userId.message}</FormHelperText>\n            )}\n          </FormControl>\n          <FormControl>\n            <TextField\n              {...asInputRef(\n                register('idToken', {\n                  required: false,\n                  validate: token =>\n                    !token ||\n                    ID_TOKEN_REGEX.test(token) ||\n                    'Token is not a valid OpenID Connect JWT Token',\n                }),\n              )}\n              label=\"ID Token (optional)\"\n              margin=\"normal\"\n              autoComplete=\"off\"\n              error={Boolean(errors.idToken)}\n            />\n            {errors.idToken && (\n              <FormHelperText error>{errors.idToken.message}</FormHelperText>\n            )}\n          </FormControl>\n          <Button\n            type=\"submit\"\n            color=\"primary\"\n            variant=\"outlined\"\n            className={classes.button}\n            disabled={!formState?.isDirty || !isEmpty(errors)}\n          >\n            Continue\n          </Button>\n        </form>\n      </InfoCard>\n    </GridItem>\n  );\n};\n\n// Custom provider doesn't store credentials\nconst loader: ProviderLoader = async () => undefined;\n\nexport const customProvider: SignInProvider = { Component, loader };\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React, { useLayoutEffect, useState, useMemo, useCallback } from 'react';\nimport {\n  SignInPageProps,\n  useApi,\n  useApiHolder,\n  errorApiRef,\n  IdentityApi,\n} from '@backstage/core-plugin-api';\nimport {\n  IdentityProviders,\n  SignInProvider,\n  SignInProviderConfig,\n} from './types';\nimport { commonProvider } from './commonProvider';\nimport { guestProvider } from './guestProvider';\nimport { customProvider } from './customProvider';\nimport { IdentityApiSignOutProxy } from './IdentityApiSignOutProxy';\n\nconst PROVIDER_STORAGE_KEY = '@backstage/core:SignInPage:provider';\n\nexport type SignInProviderType = {\n  [key: string]: {\n    components: SignInProvider;\n    id: string;\n    config?: SignInProviderConfig;\n  };\n};\n\nconst signInProviders: { [key: string]: SignInProvider } = {\n  guest: guestProvider,\n  custom: customProvider,\n  common: commonProvider,\n};\n\nfunction validateIDs(id: string, providers: SignInProviderType): void {\n  if (id in providers)\n    throw new Error(\n      `\"${id}\" ID is duplicated. IDs of identity providers have to be unique.`,\n    );\n}\n\nexport function getSignInProviders(\n  identityProviders: IdentityProviders,\n): SignInProviderType {\n  const providers = identityProviders.reduce(\n    (acc: SignInProviderType, config) => {\n      if (typeof config === 'string') {\n        validateIDs(config, acc);\n        acc[config] = { components: signInProviders[config], id: config };\n\n        return acc;\n      }\n\n      const { id } = config as SignInProviderConfig;\n      validateIDs(id, acc);\n\n      acc[id] = { components: signInProviders.common, id, config };\n\n      return acc;\n    },\n    {},\n  );\n\n  return providers;\n}\n\nexport const useSignInProviders = (\n  providers: SignInProviderType,\n  onSignInSuccess: SignInPageProps['onSignInSuccess'],\n) => {\n  const errorApi = useApi(errorApiRef);\n  const apiHolder = useApiHolder();\n  const [loading, setLoading] = useState(true);\n\n  // This decorates the result with sign out logic from this hook\n  const handleWrappedResult = useCallback(\n    (identityApi: IdentityApi) => {\n      onSignInSuccess(\n        IdentityApiSignOutProxy.from({\n          identityApi,\n          signOut: async () => {\n            localStorage.removeItem(PROVIDER_STORAGE_KEY);\n            await identityApi.signOut?.();\n          },\n        }),\n      );\n    },\n    [onSignInSuccess],\n  );\n\n  // In this effect we check if the user has already selected an existing login\n  // provider, and in that case try to load an existing session for the provider.\n  useLayoutEffect(() => {\n    if (!loading) {\n      return undefined;\n    }\n\n    // We can't use storageApi here, as it might have a dependency on the IdentityApi\n    const selectedProviderId = localStorage.getItem(\n      PROVIDER_STORAGE_KEY,\n    ) as string;\n\n    // No provider selected, let the user pick one\n    if (selectedProviderId === null) {\n      setLoading(false);\n      return undefined;\n    }\n\n    const provider = providers[selectedProviderId];\n    if (!provider) {\n      setLoading(false);\n      return undefined;\n    }\n\n    let didCancel = false;\n\n    provider.components\n      .loader(apiHolder, provider.config?.apiRef!)\n      .then(result => {\n        if (didCancel) {\n          return;\n        }\n        if (result) {\n          handleWrappedResult(result);\n        } else {\n          setLoading(false);\n        }\n      })\n      .catch(error => {\n        if (didCancel) {\n          return;\n        }\n        localStorage.removeItem(PROVIDER_STORAGE_KEY);\n        errorApi.post(error);\n        setLoading(false);\n      });\n\n    return () => {\n      didCancel = true;\n    };\n  }, [\n    loading,\n    errorApi,\n    onSignInSuccess,\n    apiHolder,\n    providers,\n    handleWrappedResult,\n  ]);\n\n  // This renders all available sign-in providers\n  const elements = useMemo(\n    () =>\n      Object.keys(providers).map(key => {\n        const provider = providers[key];\n\n        const { Component } = provider.components;\n\n        const handleSignInSuccess = (result: IdentityApi) => {\n          localStorage.setItem(PROVIDER_STORAGE_KEY, provider.id);\n\n          handleWrappedResult(result);\n        };\n\n        return (\n          <Component\n            key={provider.id}\n            config={provider.config!}\n            onSignInSuccess={handleSignInSuccess}\n          />\n        );\n      }),\n    [providers, handleWrappedResult],\n  );\n\n  return [loading, elements];\n};\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  BackstageIdentityResponse,\n  configApiRef,\n  SignInPageProps,\n  useApi,\n} from '@backstage/core-plugin-api';\nimport { UserIdentity } from './UserIdentity';\nimport Button from '@material-ui/core/Button';\nimport Grid from '@material-ui/core/Grid';\nimport Typography from '@material-ui/core/Typography';\nimport React, { useState } from 'react';\nimport { useMountEffect } from '@react-hookz/web';\nimport { Progress } from '../../components/Progress';\nimport { Content } from '../Content/Content';\nimport { ContentHeader } from '../ContentHeader/ContentHeader';\nimport { Header } from '../Header';\nimport { InfoCard } from '../InfoCard';\nimport { Page } from '../Page';\nimport { getSignInProviders, useSignInProviders } from './providers';\nimport { GridItem, useStyles } from './styles';\nimport { IdentityProviders, SignInProviderConfig } from './types';\n\ntype MultiSignInPageProps = SignInPageProps & {\n  providers: IdentityProviders;\n  title?: string;\n  align?: 'center' | 'left';\n};\n\ntype SingleSignInPageProps = SignInPageProps & {\n  provider: SignInProviderConfig;\n  auto?: boolean;\n};\n\nexport type Props = MultiSignInPageProps | SingleSignInPageProps;\n\nexport const MultiSignInPage = ({\n  onSignInSuccess,\n  providers = [],\n  title,\n  align = 'left',\n}: MultiSignInPageProps) => {\n  const configApi = useApi(configApiRef);\n  const classes = useStyles();\n\n  const signInProviders = getSignInProviders(providers);\n  const [loading, providerElements] = useSignInProviders(\n    signInProviders,\n    onSignInSuccess,\n  );\n\n  if (loading) {\n    return <Progress />;\n  }\n\n  return (\n    <Page themeId=\"home\">\n      <Header title={configApi.getString('app.title')} />\n      <Content>\n        {title && <ContentHeader title={title} textAlign={align} />}\n        <Grid\n          container\n          justifyContent={align === 'center' ? align : 'flex-start'}\n          spacing={2}\n          component=\"ul\"\n          classes={classes}\n        >\n          {providerElements}\n        </Grid>\n      </Content>\n    </Page>\n  );\n};\n\nexport const SingleSignInPage = ({\n  provider,\n  auto,\n  onSignInSuccess,\n}: SingleSignInPageProps) => {\n  const classes = useStyles();\n  const authApi = useApi(provider.apiRef);\n  const configApi = useApi(configApiRef);\n\n  const [error, setError] = useState<Error>();\n\n  // The SignIn component takes some time to decide whether the user is logged-in or not.\n  // showLoginPage is used to prevent a glitch-like experience where the sign-in page is\n  // displayed for a split second when the user is already logged-in.\n  const [showLoginPage, setShowLoginPage] = useState<boolean>(false);\n\n  type LoginOpts = { checkExisting?: boolean; showPopup?: boolean };\n  const login = async ({ checkExisting, showPopup }: LoginOpts) => {\n    try {\n      let identityResponse: BackstageIdentityResponse | undefined;\n      if (checkExisting) {\n        // Do an initial check if any logged-in session exists\n        identityResponse = await authApi.getBackstageIdentity({\n          optional: true,\n        });\n      }\n\n      // If no session exists, show the sign-in page\n      if (!identityResponse && (showPopup || auto)) {\n        // Unless auto is set to true, this step should not happen.\n        // When user intentionally clicks the Sign In button, autoShowPopup is set to true\n        setShowLoginPage(true);\n        identityResponse = await authApi.getBackstageIdentity({\n          instantPopup: true,\n        });\n        if (!identityResponse) {\n          throw new Error(\n            `The ${provider.title} provider is not configured to support sign-in`,\n          );\n        }\n      }\n\n      if (!identityResponse) {\n        setShowLoginPage(true);\n        return;\n      }\n\n      const profile = await authApi.getProfile();\n      onSignInSuccess(\n        UserIdentity.create({\n          identity: identityResponse.identity,\n          authApi,\n          profile,\n        }),\n      );\n    } catch (err: any) {\n      // User closed the sign-in modal\n      setError(err);\n      setShowLoginPage(true);\n    }\n  };\n\n  useMountEffect(() => login({ checkExisting: true }));\n\n  return showLoginPage ? (\n    <Page themeId=\"home\">\n      <Header title={configApi.getString('app.title')} />\n      <Content>\n        <Grid\n          container\n          justifyContent=\"center\"\n          spacing={2}\n          component=\"ul\"\n          classes={classes}\n        >\n          <GridItem>\n            <InfoCard\n              variant=\"fullHeight\"\n              title={provider.title}\n              actions={\n                <Button\n                  color=\"primary\"\n                  variant=\"outlined\"\n                  onClick={() => {\n                    login({ showPopup: true });\n                  }}\n                >\n                  Sign In\n                </Button>\n              }\n            >\n              <Typography variant=\"body1\">{provider.message}</Typography>\n              {error && error.name !== 'PopupRejectedError' && (\n                <Typography variant=\"body1\" color=\"error\">\n                  {error.message}\n                </Typography>\n              )}\n            </InfoCard>\n          </GridItem>\n        </Grid>\n      </Content>\n    </Page>\n  ) : (\n    <Progress />\n  );\n};\n\nexport function SignInPage(props: Props) {\n  if ('provider' in props) {\n    return <SingleSignInPage {...props} />;\n  }\n\n  return <MultiSignInPage {...props} />;\n}\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport Card from '@material-ui/core/Card';\nimport CardContent from '@material-ui/core/CardContent';\nimport CardHeader from '@material-ui/core/CardHeader';\nimport Divider from '@material-ui/core/Divider';\nimport { makeStyles, withStyles } from '@material-ui/core/styles';\nimport Tab, { TabProps } from '@material-ui/core/Tab';\nimport Tabs from '@material-ui/core/Tabs';\nimport React, {\n  PropsWithChildren,\n  ReactElement,\n  ReactNode,\n  useState,\n} from 'react';\nimport { BottomLink, BottomLinkProps } from '../BottomLink';\nimport { ErrorBoundary, ErrorBoundaryProps } from '../ErrorBoundary';\n\nexport type TabbedCardClassKey = 'root' | 'indicator';\n\nconst useTabsStyles = makeStyles(\n  theme => ({\n    root: {\n      padding: theme.spacing(0, 2, 0, 2.5),\n      minHeight: theme.spacing(3),\n    },\n    indicator: {\n      backgroundColor: theme.palette.info.main,\n      height: theme.spacing(0.3),\n    },\n  }),\n  { name: 'BackstageTabbedCard' },\n);\n\n/** @public */\nexport type BoldHeaderClassKey = 'root' | 'title' | 'subheader';\n\nconst BoldHeader = withStyles(\n  theme => ({\n    root: { padding: theme.spacing(2, 2, 2, 2.5), display: 'inline-block' },\n    title: { fontWeight: 700 },\n    subheader: { paddingTop: theme.spacing(1) },\n  }),\n  { name: 'BackstageTabbedCardBoldHeader' },\n)(CardHeader);\n\ntype Props = {\n  /** @deprecated Use errorBoundaryProps instead */\n  slackChannel?: string;\n  errorBoundaryProps?: ErrorBoundaryProps;\n  children?: ReactElement<TabProps>[];\n  onChange?: (event: React.ChangeEvent<{}>, value: number | string) => void;\n  title?: string;\n  value?: number | string;\n  deepLink?: BottomLinkProps;\n};\n\nexport function TabbedCard(props: PropsWithChildren<Props>) {\n  const {\n    slackChannel,\n    errorBoundaryProps,\n    children,\n    title,\n    deepLink,\n    value,\n    onChange,\n  } = props;\n  const tabsClasses = useTabsStyles();\n  const [selectedIndex, selectIndex] = useState(0);\n\n  const handleChange = onChange\n    ? onChange\n    : (_ev: unknown, newSelectedIndex: number) => selectIndex(newSelectedIndex);\n\n  let selectedTabContent: ReactNode;\n  if (!value) {\n    React.Children.map(children, (child, index) => {\n      if (React.isValidElement(child) && index === selectedIndex) {\n        selectedTabContent = child?.props.children;\n      }\n    });\n  } else {\n    React.Children.map(children, child => {\n      if (React.isValidElement(child) && child?.props.value === value) {\n        selectedTabContent = child?.props.children;\n      }\n    });\n  }\n\n  const errProps: ErrorBoundaryProps =\n    errorBoundaryProps || (slackChannel ? { slackChannel } : {});\n\n  return (\n    <Card>\n      <ErrorBoundary {...errProps}>\n        {title && <BoldHeader title={title} />}\n        <Tabs\n          selectionFollowsFocus\n          classes={tabsClasses}\n          value={value || selectedIndex}\n          onChange={handleChange}\n        >\n          {children}\n        </Tabs>\n        <Divider />\n        <CardContent>{selectedTabContent}</CardContent>\n        {deepLink && <BottomLink {...deepLink} />}\n      </ErrorBoundary>\n    </Card>\n  );\n}\n\n/** @public */\nexport type CardTabClassKey = 'root' | 'selected';\n\nconst useCardTabStyles = makeStyles(\n  theme => ({\n    root: {\n      minWidth: theme.spacing(6),\n      minHeight: theme.spacing(3),\n      margin: theme.spacing(0, 2, 0, 0),\n      padding: theme.spacing(0.5, 0, 0.5, 0),\n      textTransform: 'none',\n      '&:hover': {\n        opacity: 1,\n        backgroundColor: 'transparent',\n        color: theme.palette.text.primary,\n      },\n    },\n    selected: {\n      fontWeight: 'bold',\n    },\n  }),\n  { name: 'BackstageCardTab' },\n);\n\ntype CardTabProps = TabProps & {\n  children: ReactNode;\n};\n\n/**\n * Card tab component used in {@link TabbedCard}\n *\n * @public\n *\n */\nexport function CardTab(props: PropsWithChildren<CardTabProps>) {\n  const { children, ...restProps } = props;\n  const classes = useCardTabStyles();\n\n  return <Tab disableRipple classes={classes} {...restProps} />;\n}\n","/*\n * Copyright 2021 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  createVersionedContext,\n  createVersionedValueMap,\n} from '@backstage/version-bridge';\nimport React, { ReactNode, useContext } from 'react';\nimport { AnalyticsContextValue } from './types';\n\nconst AnalyticsReactContext = createVersionedContext<{\n  1: AnalyticsContextValue;\n}>('analytics-context');\n\n/**\n * A \"private\" (to this package) hook that enables context inheritance and a\n * way to read Analytics Context values at event capture-time.\n *\n * @internal\n */\nexport const useAnalyticsContext = (): AnalyticsContextValue => {\n  const theContext = useContext(AnalyticsReactContext);\n\n  // Provide a default value if no value exists.\n  if (theContext === undefined) {\n    return {\n      routeRef: 'unknown',\n      pluginId: 'root',\n      extension: 'App',\n    };\n  }\n\n  // This should probably never happen, but check for it.\n  const theValue = theContext.atVersion(1);\n  if (theValue === undefined) {\n    throw new Error('No context found for version 1.');\n  }\n\n  return theValue;\n};\n\n/**\n * Provides components in the child react tree an Analytics Context, ensuring\n * all analytics events captured within the context have relevant attributes.\n *\n * @remarks\n *\n * Analytics contexts are additive, meaning the context ultimately emitted with\n * an event is the combination of all contexts in the parent tree.\n *\n * @public\n */\nexport const AnalyticsContext = (options: {\n  attributes: Partial<AnalyticsContextValue>;\n  children: ReactNode;\n}) => {\n  const { attributes, children } = options;\n\n  const parentValues = useAnalyticsContext();\n  const combinedValue = {\n    ...parentValues,\n    ...attributes,\n  };\n\n  const versionedCombinedValue = createVersionedValueMap({ 1: combinedValue });\n  return (\n    <AnalyticsReactContext.Provider value={versionedCombinedValue}>\n      {children}\n    </AnalyticsReactContext.Provider>\n  );\n};\n\n/**\n * Returns an HOC wrapping the provided component in an Analytics context with\n * the given values.\n *\n * @param Component - Component to be wrapped with analytics context attributes\n * @param values - Analytics context key/value pairs.\n * @internal\n */\nexport function withAnalyticsContext<P>(\n  Component: React.ComponentType<P>,\n  values: AnalyticsContextValue,\n) {\n  const ComponentWithAnalyticsContext = (props: P) => {\n    return (\n      <AnalyticsContext attributes={values}>\n        <Component {...props} />\n      </AnalyticsContext>\n    );\n  };\n  ComponentWithAnalyticsContext.displayName = `WithAnalyticsContext(${\n    Component.displayName || Component.name || 'Component'\n  })`;\n  return ComponentWithAnalyticsContext;\n}\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React, { PropsWithChildren } from 'react';\nimport { ApiRef, ApiHolder, TypesToApiRefs } from './types';\nimport { useVersionedContext } from '@backstage/version-bridge';\n\n/**\n * React hook for retrieving {@link ApiHolder}, an API catalog.\n *\n * @public\n */\nexport function useApiHolder(): ApiHolder {\n  const versionedHolder = useVersionedContext<{ 1: ApiHolder }>('api-context');\n  if (!versionedHolder) {\n    throw new Error('API context is not available');\n  }\n\n  const apiHolder = versionedHolder.atVersion(1);\n  if (!apiHolder) {\n    throw new Error('ApiContext v1 not available');\n  }\n  return apiHolder;\n}\n\n/**\n * React hook for retrieving APIs.\n *\n * @param apiRef - Reference of the API to use.\n * @public\n */\nexport function useApi<T>(apiRef: ApiRef<T>): T {\n  const apiHolder = useApiHolder();\n\n  const api = apiHolder.get(apiRef);\n  if (!api) {\n    throw new Error(`No implementation available for ${apiRef}`);\n  }\n  return api;\n}\n\n/**\n * Wrapper for giving component an API context.\n *\n * @param apis - APIs for the context.\n * @public\n */\nexport function withApis<T>(apis: TypesToApiRefs<T>) {\n  return function withApisWrapper<P extends T>(\n    WrappedComponent: React.ComponentType<P>,\n  ) {\n    const Hoc = (props: PropsWithChildren<Omit<P, keyof T>>) => {\n      const apiHolder = useApiHolder();\n\n      const impls = {} as T;\n\n      for (const key in apis) {\n        if (apis.hasOwnProperty(key)) {\n          const ref = apis[key];\n\n          const api = apiHolder.get(ref);\n          if (!api) {\n            throw new Error(`No implementation available for ${ref}`);\n          }\n          impls[key] = api;\n        }\n      }\n\n      return <WrappedComponent {...(props as P)} {...impls} />;\n    };\n    const displayName =\n      WrappedComponent.displayName || WrappedComponent.name || 'Component';\n\n    Hoc.displayName = `withApis(${displayName})`;\n\n    return Hoc;\n  };\n}\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport type { ApiRef } from './types';\n\n/**\n * API reference configuration - holds an ID of the referenced API.\n *\n * @public\n */\nexport type ApiRefConfig = {\n  id: string;\n};\n\nclass ApiRefImpl<T> implements ApiRef<T> {\n  constructor(private readonly config: ApiRefConfig) {\n    const valid = config.id\n      .split('.')\n      .flatMap(part => part.split('-'))\n      .every(part => part.match(/^[a-z][a-z0-9]*$/));\n    if (!valid) {\n      throw new Error(\n        `API id must only contain period separated lowercase alphanum tokens with dashes, got '${config.id}'`,\n      );\n    }\n  }\n\n  get id(): string {\n    return this.config.id;\n  }\n\n  // Utility for getting type of an api, using `typeof apiRef.T`\n  get T(): T {\n    throw new Error(`tried to read ApiRef.T of ${this}`);\n  }\n\n  toString() {\n    return `apiRef{${this.config.id}}`;\n  }\n}\n\n/**\n * Creates a reference to an API.\n *\n * @param config - The descriptor of the API to reference.\n * @returns An API reference.\n * @public\n */\nexport function createApiRef<T>(config: ApiRefConfig): ApiRef<T> {\n  return new ApiRefImpl<T>(config);\n}\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { ApiRef, ApiFactory, TypesToApiRefs } from './types';\n\n/**\n * Used to infer types for a standalone {@link ApiFactory} that isn't immediately passed\n * to another function.\n *\n * @remarks\n *\n * This function doesn't actually do anything, it's only used to infer types.\n *\n * @public\n */\nexport function createApiFactory<\n  Api,\n  Impl extends Api,\n  Deps extends { [name in string]: unknown },\n>(factory: ApiFactory<Api, Impl, Deps>): ApiFactory<Api, Impl, Deps>;\n/**\n * Used to infer types for a standalone {@link ApiFactory} that isn't immediately passed\n * to another function.\n *\n * @param api - Ref of the API that will be produced by the factory.\n * @param instance - Implementation of the API to use.\n * @public\n */\nexport function createApiFactory<Api, Impl extends Api>(\n  api: ApiRef<Api>,\n  instance: Impl,\n): ApiFactory<Api, Impl, {}>;\n/**\n * Used to infer types for a standalone {@link ApiFactory} that isn't immediately passed\n * to another function.\n *\n * @remarks\n *\n * Creates factory from {@link ApiRef} or returns the factory itself if provided.\n *\n * @param factory - Existing factory or {@link ApiRef}.\n * @param instance - The instance to be returned by the factory.\n * @public\n */\nexport function createApiFactory<\n  Api,\n  Impl extends Api,\n  Deps extends { [name in string]: unknown },\n>(\n  factory: ApiFactory<Api, Impl, Deps> | ApiRef<Api>,\n  instance?: Impl,\n): ApiFactory<Api, Impl, Deps> {\n  if ('id' in factory) {\n    return {\n      api: factory,\n      deps: {} as TypesToApiRefs<Deps>,\n      factory: () => instance!,\n    };\n  }\n  return factory;\n}\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { ApiRef, createApiRef } from '../system';\nimport { IconComponent } from '../../icons/types';\nimport { Observable } from '@backstage/types';\n\n/**\n * This file contains declarations for common interfaces of auth-related APIs.\n * The declarations should be used to signal which type of authentication and\n * authorization methods each separate auth provider supports.\n *\n * For example, a Google OAuth provider that supports OAuth 2 and OpenID Connect,\n * would be declared as follows:\n *\n * const googleAuthApiRef = createApiRef<OAuthApi & OpenIDConnectApi>({ ... })\n */\n\n/**\n * Information about the auth provider.\n *\n * @remarks\n *\n * This information is used both to connect the correct auth provider in the backend, as\n * well as displaying the provider to the user.\n *\n * @public\n */\nexport type AuthProviderInfo = {\n  /**\n   * The ID of the auth provider. This should match with ID of the provider in the `@backstage/auth-backend`.\n   */\n  id: string;\n\n  /**\n   * Title for the auth provider, for example \"GitHub\"\n   */\n  title: string;\n\n  /**\n   * Icon for the auth provider.\n   */\n  icon: IconComponent;\n};\n\n/**\n * An array of scopes, or a scope string formatted according to the\n * auth provider, which is typically a space separated list.\n *\n * @remarks\n *\n * See the documentation for each auth provider for the list of scopes\n * supported by each provider.\n *\n * @public\n */\nexport type OAuthScope = string | string[];\n\n/**\n * Configuration of an authentication request.\n *\n * @public\n */\nexport type AuthRequestOptions = {\n  /**\n   * If this is set to true, the user will not be prompted to log in,\n   * and an empty response will be returned if there is no existing session.\n   *\n   * This can be used to perform a check whether the user is logged in, or if you don't\n   * want to force a user to be logged in, but provide functionality if they already are.\n   *\n   * @defaultValue false\n   */\n  optional?: boolean;\n\n  /**\n   * If this is set to true, the request will bypass the regular oauth login modal\n   * and open the login popup directly.\n   *\n   * The method must be called synchronously from a user action for this to work in all browsers.\n   *\n   * @defaultValue false\n   */\n  instantPopup?: boolean;\n};\n\n/**\n * This API provides access to OAuth 2 credentials. It lets you request access tokens,\n * which can be used to act on behalf of the user when talking to APIs.\n *\n * @public\n */\nexport type OAuthApi = {\n  /**\n   * Requests an OAuth 2 Access Token, optionally with a set of scopes. The access token allows\n   * you to make requests on behalf of the user, and the copes may grant you broader access, depending\n   * on the auth provider.\n   *\n   * Each auth provider has separate handling of scope, so you need to look at the documentation\n   * for each one to know what scope you need to request.\n   *\n   * This method is cheap and should be called each time an access token is used. Do not for example\n   * store the access token in React component state, as that could cause the token to expire. Instead\n   * fetch a new access token for each request.\n   *\n   * Be sure to include all required scopes when requesting an access token. When testing your implementation\n   * it is best to log out the Backstage session and then visit your plugin page directly, as\n   * you might already have some required scopes in your existing session. Not requesting the correct\n   * scopes can lead to 403 or other authorization errors, which can be tricky to debug.\n   *\n   * If the user has not yet granted access to the provider and the set of requested scopes, the user\n   * will be prompted to log in. The returned promise will not resolve until the user has\n   * successfully logged in. The returned promise can be rejected, but only if the user rejects the login request.\n   */\n  getAccessToken(\n    scope?: OAuthScope,\n    options?: AuthRequestOptions,\n  ): Promise<string>;\n};\n\n/**\n * This API provides access to OpenID Connect credentials. It lets you request ID tokens,\n * which can be passed to backend services to prove the user's identity.\n *\n * @public\n */\nexport type OpenIdConnectApi = {\n  /**\n   * Requests an OpenID Connect ID Token.\n   *\n   * This method is cheap and should be called each time an ID token is used. Do not for example\n   * store the id token in React component state, as that could cause the token to expire. Instead\n   * fetch a new id token for each request.\n   *\n   * If the user has not yet logged in to Google inside Backstage, the user will be prompted\n   * to log in. The returned promise will not resolve until the user has successfully logged in.\n   * The returned promise can be rejected, but only if the user rejects the login request.\n   */\n  getIdToken(options?: AuthRequestOptions): Promise<string>;\n};\n\n/**\n * This API provides access to profile information of the user from an auth provider.\n *\n * @public\n */\nexport type ProfileInfoApi = {\n  /**\n   * Get profile information for the user as supplied by this auth provider.\n   *\n   * If the optional flag is not set, a session is guaranteed to be returned, while if\n   * the optional flag is set, the session may be undefined. See {@link AuthRequestOptions} for more details.\n   */\n  getProfile(options?: AuthRequestOptions): Promise<ProfileInfo | undefined>;\n};\n\n/**\n * This API provides access to the user's identity within Backstage.\n *\n * @remarks\n *\n * An auth provider that implements this interface can be used to sign-in to backstage. It is\n * not intended to be used directly from a plugin, but instead serves as a connection between\n * this authentication method and the app's {@link IdentityApi}\n *\n * @public\n */\nexport type BackstageIdentityApi = {\n  /**\n   * Get the user's identity within Backstage. This should normally not be called directly,\n   * use the {@link IdentityApi} instead.\n   *\n   * If the optional flag is not set, a session is guaranteed to be returned, while if\n   * the optional flag is set, the session may be undefined. See {@link AuthRequestOptions} for more details.\n   */\n  getBackstageIdentity(\n    options?: AuthRequestOptions,\n  ): Promise<BackstageIdentityResponse | undefined>;\n};\n\n/**\n * User identity information within Backstage.\n *\n * @public\n */\nexport type BackstageUserIdentity = {\n  /**\n   * The type of identity that this structure represents. In the frontend app\n   * this will currently always be 'user'.\n   */\n  type: 'user';\n\n  /**\n   * The entityRef of the user in the catalog.\n   * For example User:default/sandra\n   */\n  userEntityRef: string;\n\n  /**\n   * The user and group entities that the user claims ownership through\n   */\n  ownershipEntityRefs: string[];\n};\n\n/**\n * Token and Identity response, with the users claims in the Identity.\n *\n * @public\n */\nexport type BackstageIdentityResponse = {\n  /**\n   * The token used to authenticate the user within Backstage.\n   */\n  token: string;\n\n  /**\n   * Identity information derived from the token.\n   */\n  identity: BackstageUserIdentity;\n};\n\n/**\n * Profile information of the user.\n *\n * @public\n */\nexport type ProfileInfo = {\n  /**\n   * Email ID.\n   */\n  email?: string;\n\n  /**\n   * Display name that can be presented to the user.\n   */\n  displayName?: string;\n\n  /**\n   * URL to an avatar image of the user.\n   */\n  picture?: string;\n};\n\n/**\n * Session state values passed to subscribers of the SessionApi.\n *\n * @public\n */\nexport enum SessionState {\n  /**\n   * User signed in.\n   */\n  SignedIn = 'SignedIn',\n  /**\n   * User not signed in.\n   */\n  SignedOut = 'SignedOut',\n}\n\n/**\n * The SessionApi provides basic controls for any auth provider that is tied to a persistent session.\n *\n * @public\n */\nexport type SessionApi = {\n  /**\n   * Sign in with a minimum set of permissions.\n   */\n  signIn(): Promise<void>;\n\n  /**\n   * Sign out from the current session. This will reload the page.\n   */\n  signOut(): Promise<void>;\n\n  /**\n   * Observe the current state of the auth session. Emits the current state on subscription.\n   */\n  sessionState$(): Observable<SessionState>;\n};\n\n/**\n * Provides authentication towards Google APIs and identities.\n *\n * @public\n * @remarks\n *\n * See {@link https://developers.google.com/identity/protocols/googlescopes} for a full list of supported scopes.\n *\n * Note that the ID token payload is only guaranteed to contain the user's numerical Google ID,\n * email and expiration information. Do not rely on any other fields, as they might not be present.\n */\nexport const googleAuthApiRef: ApiRef<\n  OAuthApi &\n    OpenIdConnectApi &\n    ProfileInfoApi &\n    BackstageIdentityApi &\n    SessionApi\n> = createApiRef({\n  id: 'core.auth.google',\n});\n\n/**\n * Provides authentication towards GitHub APIs.\n *\n * @public\n * @remarks\n *\n * See {@link https://developer.github.com/apps/building-oauth-apps/understanding-scopes-for-oauth-apps/}\n * for a full list of supported scopes.\n */\nexport const githubAuthApiRef: ApiRef<\n  OAuthApi & ProfileInfoApi & BackstageIdentityApi & SessionApi\n> = createApiRef({\n  id: 'core.auth.github',\n});\n\n/**\n * Provides authentication towards Okta APIs.\n *\n * @public\n * @remarks\n *\n * See {@link https://developer.okta.com/docs/guides/implement-oauth-for-okta/scopes/}\n * for a full list of supported scopes.\n */\nexport const oktaAuthApiRef: ApiRef<\n  OAuthApi &\n    OpenIdConnectApi &\n    ProfileInfoApi &\n    BackstageIdentityApi &\n    SessionApi\n> = createApiRef({\n  id: 'core.auth.okta',\n});\n\n/**\n * Provides authentication towards GitLab APIs.\n *\n * @public\n * @remarks\n *\n * See {@link https://docs.gitlab.com/ee/user/profile/personal_access_tokens.html#limiting-scopes-of-a-personal-access-token}\n * for a full list of supported scopes.\n */\nexport const gitlabAuthApiRef: ApiRef<\n  OAuthApi & ProfileInfoApi & BackstageIdentityApi & SessionApi\n> = createApiRef({\n  id: 'core.auth.gitlab',\n});\n\n/**\n * Provides authentication towards Microsoft APIs and identities.\n *\n * @public\n * @remarks\n *\n * For more info and a full list of supported scopes, see:\n * - {@link https://docs.microsoft.com/en-us/azure/active-directory/develop/v2-permissions-and-consent}\n * - {@link https://docs.microsoft.com/en-us/graph/permissions-reference}\n */\nexport const microsoftAuthApiRef: ApiRef<\n  OAuthApi &\n    OpenIdConnectApi &\n    ProfileInfoApi &\n    BackstageIdentityApi &\n    SessionApi\n> = createApiRef({\n  id: 'core.auth.microsoft',\n});\n\n/**\n * Provides authentication towards OneLogin APIs.\n *\n * @public\n */\nexport const oneloginAuthApiRef: ApiRef<\n  OAuthApi &\n    OpenIdConnectApi &\n    ProfileInfoApi &\n    BackstageIdentityApi &\n    SessionApi\n> = createApiRef({\n  id: 'core.auth.onelogin',\n});\n\n/**\n * Provides authentication towards Bitbucket APIs.\n *\n * @public\n * @remarks\n *\n * See {@link https://support.atlassian.com/bitbucket-cloud/docs/use-oauth-on-bitbucket-cloud/}\n * for a full list of supported scopes.\n */\nexport const bitbucketAuthApiRef: ApiRef<\n  OAuthApi & ProfileInfoApi & BackstageIdentityApi & SessionApi\n> = createApiRef({\n  id: 'core.auth.bitbucket',\n});\n\n/**\n * Provides authentication towards Atlassian APIs.\n *\n * @public\n * @remarks\n *\n * See {@link https://developer.atlassian.com/cloud/jira/platform/scopes-for-connect-and-oauth-2-3LO-apps/}\n * for a full list of supported scopes.\n */\nexport const atlassianAuthApiRef: ApiRef<\n  OAuthApi & ProfileInfoApi & BackstageIdentityApi & SessionApi\n> = createApiRef({\n  id: 'core.auth.atlassian',\n});\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { createApiRef, ApiRef } from '../system';\nimport { Observable } from '@backstage/types';\n\n/**\n * Message handled by the {@link AlertApi}.\n *\n * @public\n */\nexport type AlertMessage = {\n  message: string;\n  // Severity will default to success since that is what material ui defaults the value to.\n  severity?: 'success' | 'info' | 'warning' | 'error';\n};\n\n/**\n * The alert API is used to report alerts to the app, and display them to the user.\n *\n * @public\n */\nexport type AlertApi = {\n  /**\n   * Post an alert for handling by the application.\n   */\n  post(alert: AlertMessage): void;\n\n  /**\n   * Observe alerts posted by other parts of the application.\n   */\n  alert$(): Observable<AlertMessage>;\n};\n\n/**\n * The {@link ApiRef} of {@link AlertApi}.\n *\n * @public\n */\nexport const alertApiRef: ApiRef<AlertApi> = createApiRef({\n  id: 'core.alert',\n});\n","/*\n * Copyright 2021 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { ApiRef, createApiRef } from '../system';\nimport { AnalyticsContextValue } from '../../analytics/types';\n\n/**\n * Represents an event worth tracking in an analytics system that could inform\n * how users of a Backstage instance are using its features.\n *\n * @public\n */\nexport type AnalyticsEvent = {\n  /**\n   * A string that identifies the event being tracked by the type of action the\n   * event represents. Be careful not to encode extra metadata in this string\n   * that should instead be placed in the Analytics Context or attributes.\n   * Examples include:\n   *\n   * - view\n   * - click\n   * - filter\n   * - search\n   * - hover\n   * - scroll\n   */\n  action: string;\n\n  /**\n   * A string that uniquely identifies the object that the action is being\n   * taken on. Examples include:\n   *\n   * - The path of the page viewed\n   * - The url of the link clicked\n   * - The value that was filtered by\n   * - The text that was searched for\n   */\n  subject: string;\n\n  /**\n   * An optional numeric value relevant to the event that could be aggregated\n   * by analytics tools. Examples include:\n   *\n   * - The index or position of the clicked element in an ordered list\n   * - The percentage of an element that has been scrolled through\n   * - The amount of time that has elapsed since a fixed point\n   * - A satisfaction score on a fixed scale\n   */\n  value?: number;\n\n  /**\n   * Optional, additional attributes (representing dimensions or metrics)\n   * specific to the event that could be forwarded on to analytics systems.\n   */\n  attributes?: AnalyticsEventAttributes;\n\n  /**\n   * Contextual metadata relating to where the event was captured and by whom.\n   * This could include information about the route, plugin, or extension in\n   * which an event was captured.\n   */\n  context: AnalyticsContextValue;\n};\n\n/**\n * A structure allowing other arbitrary metadata to be provided by analytics\n * event emitters.\n *\n * @public\n */\nexport type AnalyticsEventAttributes = {\n  [attribute in string]: string | boolean | number;\n};\n\n/**\n * Represents a tracker with methods that can be called to track events in a\n * configured analytics service.\n *\n * @public\n */\nexport type AnalyticsTracker = {\n  captureEvent: (\n    action: string,\n    subject: string,\n    options?: {\n      value?: number;\n      attributes?: AnalyticsEventAttributes;\n    },\n  ) => void;\n};\n\n/**\n * The Analytics API is used to track user behavior in a Backstage instance.\n *\n * @remarks\n *\n * To instrument your App or Plugin, retrieve an analytics tracker using the\n * useAnalytics() hook. This will return a pre-configured AnalyticsTracker\n * with relevant methods for instrumentation.\n *\n * @public\n */\nexport type AnalyticsApi = {\n  /**\n   * Primary event handler responsible for compiling and forwarding events to\n   * an analytics system.\n   */\n  captureEvent(event: AnalyticsEvent): void;\n};\n\n/**\n * The {@link ApiRef} of {@link AnalyticsApi}.\n *\n * @public\n */\nexport const analyticsApiRef: ApiRef<AnalyticsApi> = createApiRef({\n  id: 'core.analytics',\n});\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { ReactNode } from 'react';\nimport { ApiRef, createApiRef } from '../system';\nimport { Observable } from '@backstage/types';\n\n/**\n * Describes a theme provided by the app.\n *\n * @public\n */\nexport type AppTheme = {\n  /**\n   * ID used to remember theme selections.\n   */\n  id: string;\n\n  /**\n   * Title of the theme\n   */\n  title: string;\n\n  /**\n   * Theme variant\n   */\n  variant: 'light' | 'dark';\n\n  /**\n   * An Icon for the theme mode setting.\n   */\n  icon?: React.ReactElement;\n\n  Provider(props: { children: ReactNode }): JSX.Element | null;\n};\n\n/**\n * The AppThemeApi gives access to the current app theme, and allows switching\n * to other options that have been registered as a part of the App.\n *\n * @public\n */\nexport type AppThemeApi = {\n  /**\n   * Get a list of available themes.\n   */\n  getInstalledThemes(): AppTheme[];\n\n  /**\n   * Observe the currently selected theme. A value of undefined means no specific theme has been selected.\n   */\n  activeThemeId$(): Observable<string | undefined>;\n\n  /**\n   * Get the current theme ID. Returns undefined if no specific theme is selected.\n   */\n  getActiveThemeId(): string | undefined;\n\n  /**\n   * Set a specific theme to use in the app, overriding the default theme selection.\n   *\n   * Clear the selection by passing in undefined.\n   */\n  setActiveThemeId(themeId?: string): void;\n};\n\n/**\n * The {@link ApiRef} of {@link AppThemeApi}.\n *\n * @public\n */\nexport const appThemeApiRef: ApiRef<AppThemeApi> = createApiRef({\n  id: 'core.apptheme',\n});\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport { ApiRef, createApiRef } from '../system';\nimport { Config } from '@backstage/config';\n\n/**\n * The Config API is used to provide a mechanism to access the\n * runtime configuration of the system.\n *\n * @public\n */\nexport type ConfigApi = Config;\n\n/**\n * The {@link ApiRef} of {@link ConfigApi}.\n *\n * @public\n */\nexport const configApiRef: ApiRef<ConfigApi> = createApiRef({\n  id: 'core.config',\n});\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport { ApiRef, createApiRef } from '../system';\n\n/**\n * The discovery API is used to provide a mechanism for plugins to\n * discover the endpoint to use to talk to their backend counterpart.\n *\n * @remarks\n *\n * The purpose of the discovery API is to allow for many different deployment\n * setups and routing methods through a central configuration, instead\n * of letting each individual plugin manage that configuration.\n *\n * Implementations of the discovery API can be a simple as a URL pattern\n * using the pluginId, but could also have overrides for individual plugins,\n * or query a separate discovery service.\n *\n * @public\n */\nexport type DiscoveryApi = {\n  /**\n   * Returns the HTTP base backend URL for a given plugin, without a trailing slash.\n   *\n   * This method must always be called just before making a request, as opposed to\n   * fetching the URL when constructing an API client. That is to ensure that more\n   * flexible routing patterns can be supported.\n   *\n   * For example, asking for the URL for `auth` may return something\n   * like `https://backstage.example.com/api/auth`\n   */\n  getBaseUrl(pluginId: string): Promise<string>;\n};\n\n/**\n * The {@link ApiRef} of {@link DiscoveryApi}.\n *\n * @public\n */\nexport const discoveryApiRef: ApiRef<DiscoveryApi> = createApiRef({\n  id: 'core.discovery',\n});\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { ApiRef, createApiRef } from '../system';\nimport { Observable } from '@backstage/types';\n\n/**\n * Mirrors the JavaScript Error class, for the purpose of\n * providing documentation and optional fields.\n *\n * @public\n */\nexport type ErrorApiError = {\n  name: string;\n  message: string;\n  stack?: string;\n};\n\n/**\n * Provides additional information about an error that was posted to the application.\n *\n * @public\n */\nexport type ErrorApiErrorContext = {\n  /**\n   * If set to true, this error should not be displayed to the user.\n   *\n   * Hidden errors are typically not displayed in the UI, but the ErrorApi\n   * implementation may still report them to error tracking services\n   * or other utilities that care about all errors.\n   *\n   * @defaultValue false\n   */\n  hidden?: boolean;\n};\n\n/**\n * The error API is used to report errors to the app, and display them to the user.\n *\n * @remarks\n *\n * Plugins can use this API as a method of displaying errors to the user, but also\n * to report errors for collection by error reporting services.\n *\n * If an error can be displayed inline, e.g. as feedback in a form, that should be\n * preferred over relying on this API to display the error. The main use of this API\n * for displaying errors should be for asynchronous errors, such as a failing background process.\n *\n * Even if an error is displayed inline, it should still be reported through this API\n * if it would be useful to collect or log it for debugging purposes, but with\n * the hidden flag set. For example, an error arising from form field validation\n * should probably not be reported, while a failed REST call would be useful to report.\n *\n * @public\n */\nexport type ErrorApi = {\n  /**\n   * Post an error for handling by the application.\n   */\n  post(error: ErrorApiError, context?: ErrorApiErrorContext): void;\n\n  /**\n   * Observe errors posted by other parts of the application.\n   */\n  error$(): Observable<{\n    error: ErrorApiError;\n    context?: ErrorApiErrorContext;\n  }>;\n};\n\n/**\n * The {@link ApiRef} of {@link ErrorApi}.\n *\n * @public\n */\nexport const errorApiRef: ApiRef<ErrorApi> = createApiRef({\n  id: 'core.error',\n});\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { ApiRef, createApiRef } from '../system';\n\n/**\n * Feature flag descriptor.\n *\n * @public\n */\nexport type FeatureFlag = {\n  name: string;\n  pluginId: string;\n};\n\n/**\n * Enum representing the state of a feature flag (inactive/active).\n *\n * @public\n */\nexport enum FeatureFlagState {\n  /**\n   * Feature flag inactive (disabled).\n   */\n  None = 0,\n  /**\n   * Feature flag active (enabled).\n   */\n  Active = 1,\n}\n\n/**\n * Options to use when saving feature flags.\n *\n * @public\n */\nexport type FeatureFlagsSaveOptions = {\n  /**\n   * The new feature flag states to save.\n   */\n  states: Record<string, FeatureFlagState>;\n\n  /**\n   * Whether the saves states should be merged into the existing ones, or replace them.\n   *\n   * Defaults to false.\n   */\n  merge?: boolean;\n};\n\n/**\n * The feature flags API is used to toggle functionality to users across plugins and Backstage.\n *\n * @remarks\n *\n * Plugins can use this API to register feature flags that they have available\n * for users to enable/disable, and this API will centralize the current user's\n * state of which feature flags they would like to enable.\n *\n * This is ideal for Backstage plugins, as well as your own App, to trial incomplete\n * or unstable upcoming features. Although there will be a common interface for users\n * to enable and disable feature flags, this API acts as another way to enable/disable.\n *\n * @public\n */\nexport interface FeatureFlagsApi {\n  /**\n   * Registers a new feature flag. Once a feature flag has been registered it\n   * can be toggled by users, and read back to enable or disable features.\n   */\n  registerFlag(flag: FeatureFlag): void;\n\n  /**\n   * Get a list of all registered flags.\n   */\n  getRegisteredFlags(): FeatureFlag[];\n\n  /**\n   * Whether the feature flag with the given name is currently activated for the user.\n   */\n  isActive(name: string): boolean;\n\n  /**\n   * Save the user's choice of feature flag states.\n   */\n  save(options: FeatureFlagsSaveOptions): void;\n}\n\n/**\n * The {@link ApiRef} of {@link FeatureFlagsApi}.\n *\n * @public\n */\nexport const featureFlagsApiRef: ApiRef<FeatureFlagsApi> = createApiRef({\n  id: 'core.featureflags',\n});\n","/*\n * Copyright 2021 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { ApiRef, createApiRef } from '../system';\n\n/**\n * A wrapper for the fetch API, that has additional behaviors such as the\n * ability to automatically inject auth information where necessary.\n *\n * @public\n */\nexport type FetchApi = {\n  /**\n   * The `fetch` implementation.\n   */\n  fetch: typeof fetch;\n};\n\n/**\n * The {@link ApiRef} of {@link FetchApi}.\n *\n * @remarks\n *\n * This is a wrapper for the fetch API, that has additional behaviors such as\n * the ability to automatically inject auth information where necessary.\n *\n * Note that the default behavior of this API (unless overridden by your org),\n * is to require that the user is already signed in so that it has auth\n * information to inject. Therefore, using the default implementation of this\n * utility API e.g. on the `SignInPage` or similar, would cause issues. In\n * special circumstances like those, you can use the regular system `fetch`\n * instead.\n *\n * @public\n */\nexport const fetchApiRef: ApiRef<FetchApi> = createApiRef({\n  id: 'core.fetch',\n});\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport { ApiRef, createApiRef } from '../system';\nimport { BackstageUserIdentity, ProfileInfo } from './auth';\n\n/**\n * The Identity API used to identify and get information about the signed in user.\n *\n * @public\n */\nexport type IdentityApi = {\n  /**\n   * The profile of the signed in user.\n   */\n  getProfileInfo(): Promise<ProfileInfo>;\n\n  /**\n   * User identity information within Backstage.\n   */\n  getBackstageIdentity(): Promise<BackstageUserIdentity>;\n\n  /**\n   * Provides credentials in the form of a token which proves the identity of the signed in user.\n   *\n   * The token will be undefined if the signed in user does not have a verified\n   * identity, such as a demo user or mocked user for e2e tests.\n   */\n  getCredentials(): Promise<{ token?: string }>;\n\n  /**\n   * Sign out the current user\n   */\n  signOut(): Promise<void>;\n};\n\n/**\n * The {@link ApiRef} of {@link IdentityApi}.\n *\n * @public\n */\nexport const identityApiRef: ApiRef<IdentityApi> = createApiRef({\n  id: 'core.identity',\n});\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { Observable } from '@backstage/types';\nimport { ApiRef, createApiRef } from '../system';\nimport { AuthProviderInfo } from './auth';\n\n/**\n * Describes how to handle auth requests. Both how to show them to the user, and what to do when\n * the user accesses the auth request.\n *\n * @public\n */\nexport type OAuthRequesterOptions<TOAuthResponse> = {\n  /**\n   * Information about the auth provider, which will be forwarded to auth requests.\n   */\n  provider: AuthProviderInfo;\n\n  /**\n   * Implementation of the auth flow, which will be called synchronously when\n   * trigger() is called on an auth requests.\n   */\n  onAuthRequest(scopes: Set<string>): Promise<TOAuthResponse>;\n};\n\n/**\n * Function used to trigger new auth requests for a set of scopes.\n *\n * @remarks\n *\n * The returned promise will resolve to the same value returned by the onAuthRequest in the\n * {@link OAuthRequesterOptions}. Or rejected, if the request is rejected.\n *\n * This function can be called multiple times before the promise resolves. All calls\n * will be merged into one request, and the scopes forwarded to the onAuthRequest will be the\n * union of all requested scopes.\n *\n * @public\n */\nexport type OAuthRequester<TAuthResponse> = (\n  scopes: Set<string>,\n) => Promise<TAuthResponse>;\n\n/**\n * An pending auth request for a single auth provider. The request will remain in this pending\n * state until either reject() or trigger() is called.\n *\n * @remarks\n *\n * Any new requests for the same provider are merged into the existing pending request, meaning\n * there will only ever be a single pending request for a given provider.\n *\n * @public\n */\nexport type PendingOAuthRequest = {\n  /**\n   * Information about the auth provider, as given in the AuthRequesterOptions\n   */\n  provider: AuthProviderInfo;\n\n  /**\n   * Rejects the request, causing all pending AuthRequester calls to fail with \"RejectedError\".\n   */\n  reject(): void;\n\n  /**\n   * Trigger the auth request to continue the auth flow, by for example showing a popup.\n   *\n   * Synchronously calls onAuthRequest with all scope currently in the request.\n   */\n  trigger(): Promise<void>;\n};\n\n/**\n * Provides helpers for implemented OAuth login flows within Backstage.\n *\n * @public\n */\nexport type OAuthRequestApi = {\n  /**\n   * A utility for showing login popups or similar things, and merging together multiple requests for\n   * different scopes into one request that includes all scopes.\n   *\n   * The passed in options provide information about the login provider, and how to handle auth requests.\n   *\n   * The returned AuthRequester function is used to request login with new scopes. These requests\n   * are merged together and forwarded to the auth handler, as soon as a consumer of auth requests\n   * triggers an auth flow.\n   *\n   * See AuthRequesterOptions, AuthRequester, and handleAuthRequests for more info.\n   */\n  createAuthRequester<OAuthResponse>(\n    options: OAuthRequesterOptions<OAuthResponse>,\n  ): OAuthRequester<OAuthResponse>;\n\n  /**\n   * Observers pending auth requests. The returned observable will emit all\n   * current active auth request, at most one for each created auth requester.\n   *\n   * Each request has its own info about the login provider, forwarded from the auth requester options.\n   *\n   * Depending on user interaction, the request should either be rejected, or used to trigger the auth handler.\n   * If the request is rejected, all pending AuthRequester calls will fail with a \"RejectedError\".\n   * If a auth is triggered, and the auth handler resolves successfully, then all currently pending\n   * AuthRequester calls will resolve to the value returned by the onAuthRequest call.\n   */\n  authRequest$(): Observable<PendingOAuthRequest[]>;\n};\n\n/**\n * The {@link ApiRef} of {@link OAuthRequestApi}.\n *\n * @public\n */\nexport const oauthRequestApiRef: ApiRef<OAuthRequestApi> = createApiRef({\n  id: 'core.oauthrequest',\n});\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { ApiRef, createApiRef } from '../system';\nimport { JsonValue, Observable } from '@backstage/types';\n\n/**\n * A snapshot in time of the current known value of a storage key.\n *\n * @public\n */\nexport type StorageValueSnapshot<TValue extends JsonValue> =\n  | {\n      key: string;\n      presence: 'unknown' | 'absent';\n      value?: undefined;\n    }\n  | {\n      key: string;\n      presence: 'present';\n      value: TValue;\n    };\n\n/**\n * Provides a key-value persistence API.\n *\n * @public\n */\nexport interface StorageApi {\n  /**\n   * Create a bucket to store data in.\n   *\n   * @param name - Namespace for the storage to be stored under,\n   *               will inherit previous namespaces too\n   */\n  forBucket(name: string): StorageApi;\n\n  /**\n   * Remove persistent data.\n   *\n   * @param key - Unique key associated with the data.\n   */\n  remove(key: string): Promise<void>;\n\n  /**\n   * Save persistent data, and emit messages to anyone that is using\n   * {@link StorageApi.observe$} for this key.\n   *\n   * @param key - Unique key associated with the data.\n   * @param data - The data to be stored under the key.\n   */\n  set<T extends JsonValue>(key: string, data: T): Promise<void>;\n\n  /**\n   * Observe the value over time for a particular key in the current bucket.\n   *\n   * @remarks\n   *\n   * The observable will only emit values when the value changes in the underlying\n   * storage, although multiple values with the same shape may be emitted in a row.\n   *\n   * If a {@link StorageApi.snapshot} of a key is retrieved and the presence is\n   * `'unknown'`, then you are guaranteed to receive a snapshot with a known\n   * presence, as long as you observe the key within the same tick.\n   *\n   * Since the emitted values are shared across all subscribers, it is important\n   * not to mutate the returned values. The values may be frozen as a precaution.\n   *\n   * @param key - Unique key associated with the data\n   */\n  observe$<T extends JsonValue>(\n    key: string,\n  ): Observable<StorageValueSnapshot<T>>;\n\n  /**\n   * Returns an immediate snapshot value for the given key, if possible.\n   *\n   * @remarks\n   *\n   * Combine with {@link StorageApi.observe$} to get notified of value changes.\n   *\n   * Note that this method is synchronous, and some underlying storages may be\n   * unable to retrieve a value using this method - the result may or may not\n   * consistently have a presence of 'unknown'. Use {@link StorageApi.observe$}\n   * to be sure to receive an actual value eventually.\n   */\n  snapshot<T extends JsonValue>(key: string): StorageValueSnapshot<T>;\n}\n\n/**\n * The {@link ApiRef} of {@link StorageApi}.\n *\n * @public\n */\nexport const storageApiRef: ApiRef<StorageApi> = createApiRef({\n  id: 'core.storage',\n});\n","/*\n * Copyright 2021 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  AnalyticsApi,\n  AnalyticsEventAttributes,\n  AnalyticsTracker,\n} from '../apis';\nimport { AnalyticsContextValue } from './';\n\nexport class Tracker implements AnalyticsTracker {\n  constructor(\n    private readonly analyticsApi: AnalyticsApi,\n    private context: AnalyticsContextValue = {\n      routeRef: 'unknown',\n      pluginId: 'root',\n      extension: 'App',\n    },\n  ) {}\n\n  setContext(context: AnalyticsContextValue) {\n    this.context = context;\n  }\n\n  captureEvent(\n    action: string,\n    subject: string,\n    {\n      value,\n      attributes,\n    }: { value?: number; attributes?: AnalyticsEventAttributes } = {},\n  ) {\n    try {\n      this.analyticsApi.captureEvent({\n        action,\n        subject,\n        value,\n        attributes,\n        context: this.context,\n      });\n    } catch (e) {\n      // eslint-disable-next-line no-console\n      console.warn('Error during analytics event capture. %o', e);\n    }\n  }\n}\n","/*\n * Copyright 2021 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { useAnalyticsContext } from './AnalyticsContext';\nimport {\n  analyticsApiRef,\n  AnalyticsTracker,\n  AnalyticsApi,\n  useApi,\n} from '../apis';\nimport { useRef } from 'react';\nimport { Tracker } from './Tracker';\n\nfunction useAnalyticsApi(): AnalyticsApi {\n  try {\n    return useApi(analyticsApiRef);\n  } catch {\n    return { captureEvent: () => {} };\n  }\n}\n\n/**\n * Gets a pre-configured analytics tracker.\n *\n * @public\n */\nexport function useAnalytics(): AnalyticsTracker {\n  const trackerRef = useRef<Tracker | null>(null);\n  const context = useAnalyticsContext();\n  // Our goal is to make this API truly optional for any/all consuming code\n  // (including tests). This hook runs last to ensure hook order is, as much as\n  // possible, maintained.\n  const analyticsApi = useAnalyticsApi();\n\n  function getTracker(): Tracker {\n    if (trackerRef.current === null) {\n      trackerRef.current = new Tracker(analyticsApi);\n    }\n    return trackerRef.current;\n  }\n\n  const tracker = getTracker();\n  tracker.setContext(context);\n\n  return tracker;\n}\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  createVersionedContext,\n  createVersionedValueMap,\n  useVersionedContext,\n} from '@backstage/version-bridge';\nimport { BackstagePlugin } from '../plugin';\nimport React, { ReactNode } from 'react';\n\nconst contextKey: string = 'plugin-context';\n\n/**\n * Properties for the PluginProvider component.\n *\n * @alpha\n */\nexport interface PluginOptionsProviderProps {\n  children: ReactNode;\n  plugin?: BackstagePlugin;\n}\n\n/**\n * Contains the plugin configuration.\n *\n * @alpha\n */\nexport const PluginProvider = (\n  props: PluginOptionsProviderProps,\n): JSX.Element => {\n  const { children, plugin } = props;\n\n  const { Provider } = createVersionedContext<{\n    1: { plugin: BackstagePlugin | undefined };\n  }>(contextKey);\n\n  return (\n    <Provider\n      value={createVersionedValueMap({\n        1: {\n          plugin,\n        },\n      })}\n    >\n      {children}\n    </Provider>\n  );\n};\n\n/**\n * Grab the current entity from the context, throws if the entity has not yet been loaded\n * or is not available.\n *\n * @alpha\n */\nexport function usePluginOptions<\n  TPluginOptions extends {} = {},\n>(): TPluginOptions {\n  const versionedHolder = useVersionedContext<{ 1: TPluginOptions }>(\n    contextKey,\n  );\n\n  if (!versionedHolder) {\n    throw new Error('Plugin Options context is not available');\n  }\n\n  const value = versionedHolder.atVersion(1);\n  if (!value) {\n    throw new Error('Plugin Options v1 is not available');\n  }\n\n  return (\n    value as unknown as {\n      plugin: {\n        getPluginOptions(): {};\n      };\n    }\n  ).plugin.getPluginOptions() as TPluginOptions;\n}\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { useVersionedContext } from '@backstage/version-bridge';\nimport { AppContext as AppContextV1 } from './types';\n\n/**\n * React hook providing {@link AppContext}.\n *\n * @public\n */\nexport const useApp = (): AppContextV1 => {\n  const versionedContext = useVersionedContext<{ 1: AppContextV1 }>(\n    'app-context',\n  );\n  if (!versionedContext) {\n    throw new Error('App context is not available');\n  }\n\n  const appContext = versionedContext.atVersion(1);\n  if (!appContext) {\n    throw new Error('AppContext v1 not available');\n  }\n  return appContext;\n};\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { ComponentType, ReactNode } from 'react';\nimport { getOrCreateGlobalSingleton } from '@backstage/version-bridge';\n\ntype DataContainer = {\n  map: Map<string, unknown>;\n};\n\n// This method of storing the component data was deprecated in September 2021, it\n// will be removed in the future for the reasons described below.\nconst globalStore = getOrCreateGlobalSingleton(\n  'component-data-store',\n  () => new WeakMap<ComponentType<any>, DataContainer>(),\n);\n\n// This key is used to attach component data to the component type (function or class)\n// itself. This method is used because it has better compatibility component wrappers\n// like react-hot-loader, as opposed to the WeakMap method or using a symbol.\nconst componentDataKey = '__backstage_data';\n\ntype ComponentWithData = ComponentType<any> & {\n  [componentDataKey]?: DataContainer;\n};\n\ntype MaybeComponentNode = ReactNode & {\n  type?: ComponentWithData;\n};\n\n/**\n * Stores data related to a component in a global store.\n *\n * @remarks\n *\n * See {@link https://backstage.io/docs/plugins/composability#component-data}.\n *\n * @param component - The component to attach the data to.\n * @param type - The key under which the data will be stored.\n * @param data - Arbitrary value.\n * @public\n */\nexport function attachComponentData<P>(\n  component: ComponentType<P>,\n  type: string,\n  data: unknown,\n) {\n  const dataComponent = component as ComponentWithData;\n\n  let container = dataComponent[componentDataKey] ?? globalStore.get(component);\n  if (!container) {\n    container = { map: new Map() };\n    Object.defineProperty(dataComponent, componentDataKey, {\n      enumerable: false,\n      configurable: true,\n      writable: false,\n      value: container,\n    });\n    globalStore.set(component, container);\n  }\n\n  if (container.map.has(type)) {\n    const name = component.displayName || component.name;\n    throw new Error(\n      `Attempted to attach duplicate data \"${type}\" to component \"${name}\"`,\n    );\n  }\n\n  container.map.set(type, data);\n}\n\n/**\n * Retrieves data attached to a component.\n *\n * @remarks\n *\n * See {@link https://backstage.io/docs/plugins/composability#component-data}.\n *\n * @param node - React component to look up.\n * @param type - Key of the data to retrieve.\n * @returns Data stored using {@link attachComponentData}.\n * @public\n */\nexport function getComponentData<T>(\n  node: ReactNode,\n  type: string,\n): T | undefined {\n  if (!node) {\n    return undefined;\n  }\n\n  const component = (node as MaybeComponentNode).type;\n  if (!component) {\n    return undefined;\n  }\n\n  const container = component[componentDataKey] ?? globalStore.get(component);\n  if (!container) {\n    return undefined;\n  }\n\n  return container.map.get(type) as T | undefined;\n}\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { getOrCreateGlobalSingleton } from '@backstage/version-bridge';\n\n/**\n * Catch-all type for route params.\n *\n * @public\n */\nexport type AnyParams = { [param in string]: string } | undefined;\n\n/**\n * Type describing the key type of a route parameter mapping.\n *\n * @public\n */\nexport type ParamKeys<Params extends AnyParams> = keyof Params extends never\n  ? []\n  : (keyof Params)[];\n\n/**\n * Optional route params.\n *\n * @public\n */\nexport type OptionalParams<Params extends { [param in string]: string }> =\n  Params[keyof Params] extends never ? undefined : Params;\n\n/**\n * TS magic for handling route parameters.\n *\n * @remarks\n *\n * The extra TS magic here is to require a single params argument if the RouteRef\n * had at least one param defined, but require 0 arguments if there are no params defined.\n * Without this we'd have to pass in empty object to all parameter-less RouteRefs\n * just to make TypeScript happy, or we would have to make the argument optional in\n * which case you might forget to pass it in when it is actually required.\n *\n * @public\n */\nexport type RouteFunc<Params extends AnyParams> = (\n  ...[params]: Params extends undefined ? readonly [] : readonly [Params]\n) => string;\n\n/**\n * This symbol is what we use at runtime to determine whether a given object\n * is a type of RouteRef or not. It doesn't work well in TypeScript though since\n * the `unique symbol` will refer to different values between package versions.\n * For that reason we use the marker $$routeRefType to represent the symbol at\n * compile-time instead of using the symbol directly.\n *\n * @internal\n */\nexport const routeRefType: unique symbol = getOrCreateGlobalSingleton<any>(\n  'route-ref-type',\n  () => Symbol('route-ref-type'),\n);\n\n/**\n * Absolute route reference.\n *\n * @remarks\n *\n * See {@link https://backstage.io/docs/plugins/composability#routing-system}.\n *\n * @public\n */\nexport type RouteRef<Params extends AnyParams = any> = {\n  $$routeRefType: 'absolute'; // See routeRefType above\n\n  params: ParamKeys<Params>;\n};\n\n/**\n * Descriptor of a route relative to an absolute {@link RouteRef}.\n *\n * @remarks\n *\n * See {@link https://backstage.io/docs/plugins/composability#routing-system}.\n *\n * @public\n */\nexport type SubRouteRef<Params extends AnyParams = any> = {\n  $$routeRefType: 'sub'; // See routeRefType above\n\n  parent: RouteRef;\n\n  path: string;\n\n  params: ParamKeys<Params>;\n};\n\n/**\n * Route descriptor, to be later bound to a concrete route by the app. Used to implement cross-plugin route references.\n *\n * @remarks\n *\n * See {@link https://backstage.io/docs/plugins/composability#routing-system}.\n *\n * @public\n */\nexport type ExternalRouteRef<\n  Params extends AnyParams = any,\n  Optional extends boolean = any,\n> = {\n  $$routeRefType: 'external'; // See routeRefType above\n\n  params: ParamKeys<Params>;\n\n  optional?: Optional;\n};\n\n/**\n * @internal\n */\nexport type AnyRouteRef =\n  | RouteRef<any>\n  | SubRouteRef<any>\n  | ExternalRouteRef<any, any>;\n\n/**\n * A duplicate of the react-router RouteObject, but with routeRef added\n * @internal\n */\nexport interface BackstageRouteObject {\n  caseSensitive: boolean;\n  children?: BackstageRouteObject[];\n  element: React.ReactNode;\n  path: string;\n  routeRefs: Set<RouteRef>;\n}\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  RouteRef,\n  routeRefType,\n  AnyParams,\n  ParamKeys,\n  OptionalParams,\n} from './types';\n\n/**\n * @internal\n */\nexport class RouteRefImpl<Params extends AnyParams>\n  implements RouteRef<Params>\n{\n  // The marker is used for type checking while the symbol is used at runtime.\n  declare $$routeRefType: 'absolute';\n  readonly [routeRefType] = 'absolute';\n\n  constructor(\n    private readonly id: string,\n    readonly params: ParamKeys<Params>,\n  ) {}\n\n  get title() {\n    return this.id;\n  }\n\n  toString() {\n    return `routeRef{type=absolute,id=${this.id}}`;\n  }\n}\n\n/**\n * Create a {@link RouteRef} from a route descriptor.\n *\n * @param config - Description of the route reference to be created.\n * @public\n */\nexport function createRouteRef<\n  // Params is the type that we care about and the one to be embedded in the route ref.\n  // For example, given the params ['name', 'kind'], Params will be {name: string, kind: string}\n  Params extends { [param in ParamKey]: string },\n  // ParamKey is here to make sure the Params type properly has its keys narrowed down\n  // to only the elements of params. Defaulting to never makes sure we end up with\n  // Param = {} if the params array is empty.\n  ParamKey extends string = never,\n>(config: {\n  /** The id of the route ref, used to identify it when printed */\n  id: string;\n  /** A list of parameter names that the path that this route ref is bound to must contain */\n  params?: ParamKey[];\n}): RouteRef<OptionalParams<Params>> {\n  return new RouteRefImpl(\n    config.id,\n    (config.params ?? []) as ParamKeys<OptionalParams<Params>>,\n  );\n}\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  AnyParams,\n  OptionalParams,\n  ParamKeys,\n  RouteRef,\n  routeRefType,\n  SubRouteRef,\n} from './types';\n\n// Should match the pattern in react-router\nconst PARAM_PATTERN = /^\\w+$/;\n\n/**\n * @internal\n */\nexport class SubRouteRefImpl<Params extends AnyParams>\n  implements SubRouteRef<Params>\n{\n  // The marker is used for type checking while the symbol is used at runtime.\n  declare $$routeRefType: 'sub';\n  readonly [routeRefType] = 'sub';\n\n  constructor(\n    private readonly id: string,\n    readonly path: string,\n    readonly parent: RouteRef,\n    readonly params: ParamKeys<Params>,\n  ) {}\n\n  toString() {\n    return `routeRef{type=sub,id=${this.id}}`;\n  }\n}\n\n/**\n * Used in {@link PathParams} type declaration.\n * @public\n */\nexport type ParamPart<S extends string> = S extends `:${infer Param}`\n  ? Param\n  : never;\n\n/**\n * Used in {@link PathParams} type declaration.\n * @public\n */\nexport type ParamNames<S extends string> =\n  S extends `${infer Part}/${infer Rest}`\n    ? ParamPart<Part> | ParamNames<Rest>\n    : ParamPart<S>;\n/**\n * This utility type helps us infer a Param object type from a string path\n * For example, `/foo/:bar/:baz` inferred to `{ bar: string, baz: string }`\n * @public\n */\nexport type PathParams<S extends string> = { [name in ParamNames<S>]: string };\n\n/**\n * Merges a param object type with an optional params type into a params object.\n * @public\n */\nexport type MergeParams<\n  P1 extends { [param in string]: string },\n  P2 extends AnyParams,\n> = (P1[keyof P1] extends never ? {} : P1) & (P2 extends undefined ? {} : P2);\n\n/**\n * Creates a SubRouteRef type given the desired parameters and parent route parameters.\n * The parameters types are merged together while ensuring that there is no overlap between the two.\n *\n * @public\n */\nexport type MakeSubRouteRef<\n  Params extends { [param in string]: string },\n  ParentParams extends AnyParams,\n> = keyof Params & keyof ParentParams extends never\n  ? SubRouteRef<OptionalParams<MergeParams<Params, ParentParams>>>\n  : never;\n\n/**\n * Create a {@link SubRouteRef} from a route descriptor.\n *\n * @param config - Description of the route reference to be created.\n * @public\n */\nexport function createSubRouteRef<\n  Path extends string,\n  ParentParams extends AnyParams = never,\n>(config: {\n  id: string;\n  path: Path;\n  parent: RouteRef<ParentParams>;\n}): MakeSubRouteRef<PathParams<Path>, ParentParams> {\n  const { id, path, parent } = config;\n  type Params = PathParams<Path>;\n\n  // Collect runtime parameters from the path, e.g. ['bar', 'baz'] from '/foo/:bar/:baz'\n  const pathParams = path\n    .split('/')\n    .filter(p => p.startsWith(':'))\n    .map(p => p.substring(1));\n  const params = [...parent.params, ...pathParams];\n\n  if (parent.params.some(p => pathParams.includes(p as string))) {\n    throw new Error(\n      'SubRouteRef may not have params that overlap with its parent',\n    );\n  }\n  if (!path.startsWith('/')) {\n    throw new Error(`SubRouteRef path must start with '/', got '${path}'`);\n  }\n  if (path.endsWith('/')) {\n    throw new Error(`SubRouteRef path must not end with '/', got '${path}'`);\n  }\n  for (const param of pathParams) {\n    if (!PARAM_PATTERN.test(param)) {\n      throw new Error(`SubRouteRef path has invalid param, got '${param}'`);\n    }\n  }\n\n  // We ensure that the type of the return type is sane here\n  const subRouteRef = new SubRouteRefImpl(\n    id,\n    path,\n    parent,\n    params as ParamKeys<MergeParams<Params, ParentParams>>,\n  ) as SubRouteRef<OptionalParams<MergeParams<Params, ParentParams>>>;\n\n  // But skip type checking of the return value itself, because the conditional\n  // type checking of the parent parameter overlap is tricky to express.\n  return subRouteRef as any;\n}\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  ExternalRouteRef,\n  routeRefType,\n  AnyParams,\n  ParamKeys,\n  OptionalParams,\n} from './types';\n\n/**\n * @internal\n */\nexport class ExternalRouteRefImpl<\n  Params extends AnyParams,\n  Optional extends boolean,\n> implements ExternalRouteRef<Params, Optional>\n{\n  // The marker is used for type checking while the symbol is used at runtime.\n  declare $$routeRefType: 'external';\n  readonly [routeRefType] = 'external';\n\n  constructor(\n    private readonly id: string,\n    readonly params: ParamKeys<Params>,\n    readonly optional: Optional,\n  ) {}\n\n  toString() {\n    return `routeRef{type=external,id=${this.id}}`;\n  }\n}\n\n/**\n * Creates a route descriptor, to be later bound to a concrete route by the app. Used to implement cross-plugin route references.\n *\n * @remarks\n *\n * See {@link https://backstage.io/docs/plugins/composability#routing-system}.\n *\n * @param options - Description of the route reference to be created.\n * @public\n */\nexport function createExternalRouteRef<\n  Params extends { [param in ParamKey]: string },\n  Optional extends boolean = false,\n  ParamKey extends string = never,\n>(options: {\n  /**\n   * An identifier for this route, used to identify it in error messages\n   */\n  id: string;\n\n  /**\n   * The parameters that will be provided to the external route reference.\n   */\n  params?: ParamKey[];\n\n  /**\n   * Whether or not this route is optional, defaults to false.\n   *\n   * Optional external routes are not required to be bound in the app, and\n   * if they aren't, `useRouteRef` will return `undefined`.\n   */\n  optional?: Optional;\n}): ExternalRouteRef<OptionalParams<Params>, Optional> {\n  return new ExternalRouteRefImpl(\n    options.id,\n    (options.params ?? []) as ParamKeys<OptionalParams<Params>>,\n    Boolean(options.optional) as Optional,\n  );\n}\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { useMemo } from 'react';\nimport { matchRoutes, useLocation } from 'react-router-dom';\nimport { useVersionedContext } from '@backstage/version-bridge';\nimport {\n  AnyParams,\n  ExternalRouteRef,\n  RouteFunc,\n  RouteRef,\n  SubRouteRef,\n} from './types';\n\n/**\n * @internal\n */\nexport interface RouteResolver {\n  resolve<Params extends AnyParams>(\n    anyRouteRef:\n      | RouteRef<Params>\n      | SubRouteRef<Params>\n      | ExternalRouteRef<Params, any>,\n    sourceLocation: Parameters<typeof matchRoutes>[1],\n  ): RouteFunc<Params> | undefined;\n}\n\n/**\n * React hook for constructing URLs to routes.\n *\n * @remarks\n *\n * See {@link https://backstage.io/docs/plugins/composability#routing-system}\n *\n * @param routeRef - The ref to route that should be converted to URL.\n * @returns A function that will in turn return the concrete URL of the `routeRef`.\n * @public\n */\nexport function useRouteRef<Optional extends boolean, Params extends AnyParams>(\n  routeRef: ExternalRouteRef<Params, Optional>,\n): Optional extends true ? RouteFunc<Params> | undefined : RouteFunc<Params>;\n\n/**\n * React hook for constructing URLs to routes.\n *\n * @remarks\n *\n * See {@link https://backstage.io/docs/plugins/composability#routing-system}\n *\n * @param routeRef - The ref to route that should be converted to URL.\n * @returns A function that will in turn return the concrete URL of the `routeRef`.\n * @public\n */\nexport function useRouteRef<Params extends AnyParams>(\n  routeRef: RouteRef<Params> | SubRouteRef<Params>,\n): RouteFunc<Params>;\n\n/**\n * React hook for constructing URLs to routes.\n *\n * @remarks\n *\n * See {@link https://backstage.io/docs/plugins/composability#routing-system}\n *\n * @param routeRef - The ref to route that should be converted to URL.\n * @returns A function that will in turn return the concrete URL of the `routeRef`.\n * @public\n */\nexport function useRouteRef<Params extends AnyParams>(\n  routeRef:\n    | RouteRef<Params>\n    | SubRouteRef<Params>\n    | ExternalRouteRef<Params, any>,\n): RouteFunc<Params> | undefined {\n  const sourceLocation = useLocation();\n  const versionedContext = useVersionedContext<{ 1: RouteResolver }>(\n    'routing-context',\n  );\n  if (!versionedContext) {\n    throw new Error('Routing context is not available');\n  }\n\n  const resolver = versionedContext.atVersion(1);\n  const routeFunc = useMemo(\n    () => resolver && resolver.resolve(routeRef, sourceLocation),\n    [resolver, routeRef, sourceLocation],\n  );\n\n  if (!versionedContext) {\n    throw new Error('useRouteRef used outside of routing context');\n  }\n  if (!resolver) {\n    throw new Error('RoutingContext v1 not available');\n  }\n\n  const isOptional = 'optional' in routeRef && routeRef.optional;\n  if (!routeFunc && !isOptional) {\n    throw new Error(`No path for ${routeRef}`);\n  }\n\n  return routeFunc;\n}\n","/*\n * Copyright 2021 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { useParams } from 'react-router-dom';\nimport { RouteRef, AnyParams, SubRouteRef } from './types';\n\n/**\n * React hook for retrieving dynamic params from the current URL.\n * @param _routeRef - Ref of the current route.\n * @public\n */\nexport function useRouteRefParams<Params extends AnyParams>(\n  _routeRef: RouteRef<Params> | SubRouteRef<Params>,\n): Params {\n  return useParams() as Params;\n}\n","/*\n * Copyright 2021 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React from 'react';\nimport { AppContext } from '../app/types';\nimport { BackstagePlugin } from '../plugin';\n\ntype Props = {\n  app: AppContext;\n  plugin: BackstagePlugin;\n};\n\ntype State = { error: Error | undefined };\n\nexport class PluginErrorBoundary extends React.Component<Props, State> {\n  static getDerivedStateFromError(error: Error) {\n    return { error };\n  }\n\n  state: State = { error: undefined };\n\n  handleErrorReset = () => {\n    this.setState({ error: undefined });\n  };\n\n  render() {\n    const { error } = this.state;\n    const { app, plugin } = this.props;\n    const { ErrorBoundaryFallback } = app.getComponents();\n\n    if (error) {\n      return (\n        <ErrorBoundaryFallback\n          error={error}\n          resetError={this.handleErrorReset}\n          plugin={plugin}\n        />\n      );\n    }\n\n    return this.props.children;\n  }\n}\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React, { lazy, Suspense } from 'react';\nimport { AnalyticsContext } from '../analytics';\nimport { useApp } from '../app';\nimport { RouteRef, useRouteRef } from '../routing';\nimport { attachComponentData } from './componentData';\nimport { Extension, BackstagePlugin } from '../plugin';\nimport { PluginErrorBoundary } from './PluginErrorBoundary';\nimport { PluginProvider } from '../plugin-options';\n\n/**\n * Lazy or synchronous retrieving of extension components.\n *\n * @public\n */\nexport type ComponentLoader<T> =\n  | {\n      lazy: () => Promise<T>;\n    }\n  | {\n      sync: T;\n    };\n\n/**\n * Extension for components that can have its own URL route (top-level pages, tabs etc.).\n *\n * @remarks\n *\n * We do not use ComponentType as the return type, since it doesn't let us convey the children prop.\n * ComponentType inserts children as an optional prop whether the inner component accepts it or not,\n * making it impossible to make the usage of children type safe.\n *\n * See {@link https://backstage.io/docs/plugins/composability#extensions}.\n *\n * @public\n */\nexport function createRoutableExtension<\n  T extends (props: any) => JSX.Element | null,\n>(options: {\n  /**\n   * A loader for the component that is rendered by this extension.\n   */\n  component: () => Promise<T>;\n\n  /**\n   * The mount point to bind this routable extension to.\n   *\n   * If this extension is placed somewhere in the app element tree of a Backstage\n   * app, callers will be able to route to this extensions by calling,\n   * `useRouteRef` with this mount point.\n   */\n  mountPoint: RouteRef;\n\n  /**\n   * The name of this extension that will represent it at runtime. It is for example\n   * used to identify this extension in analytics data.\n   *\n   * If possible the name should always be the same as the name of the exported\n   * variable for this extension.\n   */\n  name?: string;\n}): Extension<T> {\n  const { component, mountPoint, name } = options;\n  return createReactExtension({\n    component: {\n      lazy: () =>\n        component().then(\n          InnerComponent => {\n            const RoutableExtensionWrapper: any = (props: any) => {\n              // Validate that the routing is wired up correctly in the App.tsx\n              try {\n                useRouteRef(mountPoint);\n              } catch (error) {\n                if (typeof error === 'object' && error !== null) {\n                  const { message } = error as { message?: unknown };\n                  if (\n                    typeof message === 'string' &&\n                    message.startsWith('No path for ')\n                  ) {\n                    throw new Error(\n                      `Routable extension component with mount point ${mountPoint} was not discovered in the app element tree. ` +\n                        'Routable extension components may not be rendered by other components and must be ' +\n                        'directly available as an element within the App provider component.',\n                    );\n                  }\n                }\n                throw error;\n              }\n              return <InnerComponent {...props} />;\n            };\n\n            const componentName =\n              name ||\n              (InnerComponent as { displayName?: string }).displayName ||\n              InnerComponent.name ||\n              'LazyComponent';\n\n            RoutableExtensionWrapper.displayName = `RoutableExtension(${componentName})`;\n\n            return RoutableExtensionWrapper as T;\n          },\n          error => {\n            const RoutableExtensionWrapper: any = (_: any) => {\n              const app = useApp();\n              const { BootErrorPage } = app.getComponents();\n\n              return <BootErrorPage step=\"load-chunk\" error={error} />;\n            };\n            return RoutableExtensionWrapper;\n          },\n        ),\n    },\n    data: {\n      'core.mountPoint': mountPoint,\n    },\n    name,\n  });\n}\n\n/**\n * Plain React component extension.\n *\n * @remarks\n *\n * We do not use ComponentType as the return type, since it doesn't let us convey the children prop.\n * ComponentType inserts children as an optional prop whether the inner component accepts it or not,\n * making it impossible to make the usage of children type safe.\n *\n * See {@link https://backstage.io/docs/plugins/composability#extensions}.\n *\n * @public\n */\nexport function createComponentExtension<\n  T extends (props: any) => JSX.Element | null,\n>(options: {\n  /**\n   * A loader or synchronously supplied component that is rendered by this extension.\n   */\n  component: ComponentLoader<T>;\n\n  /**\n   * The name of this extension that will represent it at runtime. It is for example\n   * used to identify this extension in analytics data.\n   *\n   * If possible the name should always be the same as the name of the exported\n   * variable for this extension.\n   */\n  name?: string;\n}): Extension<T> {\n  const { component, name } = options;\n  return createReactExtension({ component, name });\n}\n\n/**\n * Used by {@link createComponentExtension} and {@link createRoutableExtension}.\n *\n * @remarks\n *\n * We do not use ComponentType as the return type, since it doesn't let us convey the children prop.\n * ComponentType inserts children as an optional prop whether the inner component accepts it or not,\n * making it impossible to make the usage of children type safe.\n *\n * See {@link https://backstage.io/docs/plugins/composability#extensions}.\n *\n * @public\n */\nexport function createReactExtension<\n  T extends (props: any) => JSX.Element | null,\n>(options: {\n  /**\n   * A loader or synchronously supplied component that is rendered by this extension.\n   */\n  component: ComponentLoader<T>;\n\n  /**\n   * Additional component data that is attached to the top-level extension component.\n   */\n  data?: Record<string, unknown>;\n\n  /**\n   * The name of this extension that will represent it at runtime. It is for example\n   * used to identify this extension in analytics data.\n   *\n   * If possible the name should always be the same as the name of the exported\n   * variable for this extension.\n   */\n  name?: string;\n}): Extension<T> {\n  const { data = {}, name } = options;\n  if (!name) {\n    // eslint-disable-next-line no-console\n    console.warn(\n      'Declaring extensions without name is DEPRECATED. ' +\n        'Make sure that all usages of createReactExtension, createComponentExtension and createRoutableExtension provide a name.',\n    );\n  }\n\n  let Component: T;\n  if ('lazy' in options.component) {\n    const lazyLoader = options.component.lazy;\n    Component = lazy(() =>\n      lazyLoader().then(component => ({ default: component })),\n    ) as unknown as T;\n  } else {\n    Component = options.component.sync;\n  }\n  const componentName =\n    name ||\n    (Component as { displayName?: string }).displayName ||\n    Component.name ||\n    'Component';\n\n  return {\n    expose(plugin: BackstagePlugin) {\n      const Result: any = (props: any) => {\n        const app = useApp();\n        const { Progress } = app.getComponents();\n        // todo(iamEAP): Account for situations where this is attached via\n        // separate calls to attachComponentData().\n        const mountPoint = data?.['core.mountPoint'] as\n          | { id?: string }\n          | undefined;\n\n        return (\n          <Suspense fallback={<Progress />}>\n            <PluginErrorBoundary app={app} plugin={plugin}>\n              <AnalyticsContext\n                attributes={{\n                  pluginId: plugin.getId(),\n                  ...(name && { extension: name }),\n                  ...(mountPoint && { routeRef: mountPoint.id }),\n                }}\n              >\n                <PluginProvider plugin={plugin}>\n                  <Component {...props} />\n                </PluginProvider>\n              </AnalyticsContext>\n            </PluginErrorBoundary>\n          </Suspense>\n        );\n      };\n\n      attachComponentData(Result, 'core.plugin', plugin);\n      for (const [key, value] of Object.entries(data)) {\n        attachComponentData(Result, key, value);\n      }\n\n      Result.displayName = `Extension(${componentName})`;\n      return Result;\n    },\n  };\n}\n","/*\n * Copyright 2021 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport {\n  Children,\n  Fragment,\n  isValidElement,\n  ReactNode,\n  ReactElement,\n  useMemo,\n} from 'react';\nimport { getComponentData } from './componentData';\nimport { useApi, FeatureFlagsApi, featureFlagsApiRef } from '../apis';\n\nfunction selectChildren(\n  rootNode: ReactNode,\n  featureFlagsApi: FeatureFlagsApi,\n  selector?: (element: ReactElement<unknown>) => boolean,\n  strictError?: string,\n): Array<ReactElement<unknown>> {\n  return Children.toArray(rootNode).flatMap(node => {\n    if (!isValidElement(node)) {\n      return [];\n    }\n\n    if (node.type === Fragment) {\n      return selectChildren(\n        node.props.children,\n        featureFlagsApi,\n        selector,\n        strictError,\n      );\n    }\n\n    if (getComponentData(node, 'core.featureFlagged')) {\n      const props = node.props as { with: string } | { without: string };\n      const isEnabled =\n        'with' in props\n          ? featureFlagsApi.isActive(props.with)\n          : !featureFlagsApi.isActive(props.without);\n      if (isEnabled) {\n        return selectChildren(\n          node.props.children,\n          featureFlagsApi,\n          selector,\n          strictError,\n        );\n      }\n      return [];\n    }\n\n    if (selector === undefined || selector(node)) {\n      return [node];\n    }\n\n    if (strictError) {\n      throw new Error(strictError);\n    }\n\n    return selectChildren(\n      node.props.children,\n      featureFlagsApi,\n      selector,\n      strictError,\n    );\n  });\n}\n\n/**\n * A querying interface tailored to traversing a set of selected React elements\n * and extracting data.\n *\n * @remarks\n *\n * Methods prefixed with `selectBy` are used to narrow the set of selected elements.\n *\n * Methods prefixed with `find` return concrete data using a deep traversal of the set.\n *\n * Methods prefixed with `get` return concrete data using a shallow traversal of the set.\n *\n * @public\n */\nexport interface ElementCollection {\n  /**\n   * Narrows the set of selected components by doing a deep traversal and\n   * only including those that have defined component data for the given `key`.\n   *\n   * @remarks\n   *\n   * Whether an element in the tree has component data set for the given key\n   * is determined by whether `getComponentData` returns undefined.\n   *\n   * The traversal does not continue deeper past elements that match the criteria,\n   * and it also includes the root children in the selection, meaning that if the,\n   * of all the currently selected elements contain data for the given key, this\n   * method is a no-op.\n   *\n   * If `withStrictError` is set, the resulting selection must be a full match, meaning\n   * there may be no elements that were excluded in the selection. If the selection\n   * is not a clean match, an error will be throw with `withStrictError` as the message.\n   *\n   * @param query - Filtering query.\n   */\n  selectByComponentData(query: {\n    key: string;\n    withStrictError?: string;\n  }): ElementCollection;\n\n  /**\n   * Finds all elements using the same criteria as `selectByComponentData`, but\n   * returns the actual component data of each of those elements instead.\n   *\n   * @param query - Lookup query.\n   */\n  findComponentData<T>(query: { key: string }): T[];\n\n  /**\n   * Returns all of the elements currently selected by this collection.\n   */\n  getElements<Props extends { [name: string]: unknown }>(): Array<\n    ReactElement<Props>\n  >;\n}\n\nclass Collection implements ElementCollection {\n  constructor(\n    private readonly node: ReactNode,\n    private readonly featureFlagsApi: FeatureFlagsApi,\n  ) {}\n\n  selectByComponentData(query: { key: string; withStrictError?: string }) {\n    const selection = selectChildren(\n      this.node,\n      this.featureFlagsApi,\n      node => getComponentData(node, query.key) !== undefined,\n      query.withStrictError,\n    );\n    return new Collection(selection, this.featureFlagsApi);\n  }\n\n  findComponentData<T>(query: { key: string }): T[] {\n    const selection = selectChildren(\n      this.node,\n      this.featureFlagsApi,\n      node => getComponentData(node, query.key) !== undefined,\n    );\n    return selection\n      .map(node => getComponentData<T>(node, query.key))\n      .filter((data: T | undefined): data is T => data !== undefined);\n  }\n\n  getElements<Props extends { [name: string]: unknown }>(): Array<\n    ReactElement<Props>\n  > {\n    return selectChildren(this.node, this.featureFlagsApi) as Array<\n      ReactElement<Props>\n    >;\n  }\n}\n\n/**\n * useElementFilter is a utility that helps you narrow down and retrieve data\n * from a React element tree, typically operating on the `children` property\n * passed in to a component.\n *\n * @remarks\n *\n * A common use-case is to construct declarative APIs\n * where a React component defines its behavior based on its children, such as\n * the relationship between `Routes` and `Route` in `react-router`.\n *\n * The purpose of this hook is similar to `React.Children.map`, and it expands upon\n * it to also handle traversal of fragments and Backstage specific things like the\n * `FeatureFlagged` component.\n *\n * The return value of the hook is computed by the provided filter function, but\n * with added memoization based on the input `node`. If further memoization\n * dependencies are used in the filter function, they should be added to the\n * third `dependencies` argument, just like `useMemo`, `useEffect`, etc.\n *\n * @public\n */\nexport function useElementFilter<T>(\n  node: ReactNode,\n  filterFn: (arg: ElementCollection) => T,\n  dependencies: any[] = [],\n) {\n  const featureFlagsApi = useApi(featureFlagsApiRef);\n  const elements = new Collection(node, featureFlagsApi);\n  // eslint-disable-next-line react-hooks/exhaustive-deps\n  return useMemo(() => filterFn(elements), [node, ...dependencies]);\n}\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  PluginConfig,\n  BackstagePlugin,\n  Extension,\n  AnyRoutes,\n  AnyExternalRoutes,\n  PluginFeatureFlagConfig,\n} from './types';\nimport { AnyApiFactory } from '../apis';\n\n/**\n * @internal\n */\nexport class PluginImpl<\n  Routes extends AnyRoutes,\n  ExternalRoutes extends AnyExternalRoutes,\n  PluginInputOptions extends {},\n> implements BackstagePlugin<Routes, ExternalRoutes, PluginInputOptions>\n{\n  constructor(\n    private readonly config: PluginConfig<\n      Routes,\n      ExternalRoutes,\n      PluginInputOptions\n    >,\n  ) {}\n\n  private options: {} | undefined = undefined;\n\n  getId(): string {\n    return this.config.id;\n  }\n\n  getApis(): Iterable<AnyApiFactory> {\n    return this.config.apis ?? [];\n  }\n\n  getFeatureFlags(): Iterable<PluginFeatureFlagConfig> {\n    return this.config.featureFlags?.slice() ?? [];\n  }\n\n  get routes(): Routes {\n    return this.config.routes ?? ({} as Routes);\n  }\n\n  get externalRoutes(): ExternalRoutes {\n    return this.config.externalRoutes ?? ({} as ExternalRoutes);\n  }\n\n  provide<T>(extension: Extension<T>): T {\n    return extension.expose(this);\n  }\n\n  __experimentalReconfigure(options: PluginInputOptions): void {\n    if (this.config.__experimentalConfigure) {\n      this.options = this.config.__experimentalConfigure(options);\n    }\n  }\n\n  getPluginOptions(): {} {\n    if (this.config.__experimentalConfigure && !this.options) {\n      this.options = this.config.__experimentalConfigure();\n    }\n    return this.options ?? {};\n  }\n\n  toString() {\n    return `plugin{${this.config.id}}`;\n  }\n}\n\n/**\n * Creates Backstage Plugin from config.\n *\n * @param config - Plugin configuration.\n * @public\n */\nexport function createPlugin<\n  Routes extends AnyRoutes = {},\n  ExternalRoutes extends AnyExternalRoutes = {},\n  PluginInputOptions extends {} = {},\n>(\n  config: PluginConfig<Routes, ExternalRoutes, PluginInputOptions>,\n): BackstagePlugin<Routes, ExternalRoutes, PluginInputOptions> {\n  return new PluginImpl(config);\n}\n","/*\n * Copyright 2021 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/**\n * An object that is shaped like an `Error`.\n *\n * @public\n */\nexport type ErrorLike = {\n  name: string;\n  message: string;\n  stack?: string;\n  [unknownKeys: string]: unknown;\n};\n\n/**\n * Checks whether an unknown value is an {@link ErrorLike} object, which guarantees that it's\n * an object that has at least two string properties: a non-empty `name` and `message`.\n *\n * @public\n * @param value - an unknown value\n * @returns true if the value is an {@link ErrorLike} object, false otherwise\n */\nexport function isError(value: unknown): value is ErrorLike {\n  if (typeof value !== 'object' || value === null || Array.isArray(value)) {\n    return false;\n  }\n  const maybe = value as Partial<ErrorLike>;\n  if (typeof maybe.name !== 'string' || maybe.name === '') {\n    return false;\n  }\n  if (typeof maybe.message !== 'string') {\n    return false;\n  }\n  return true;\n}\n\n/**\n * Asserts that an unknown value is an {@link ErrorLike} object, which guarantees that it's\n * an object that has at least two string properties: a non-empty `name` and `message`.\n *\n * If the value is not an {@link ErrorLike} object, an error is thrown.\n *\n * @public\n * @param value - an unknown value\n */\nexport function assertError(value: unknown): asserts value is ErrorLike {\n  if (typeof value !== 'object' || value === null || Array.isArray(value)) {\n    throw new Error(`Encountered invalid error, not an object, got '${value}'`);\n  }\n  const maybe = value as Partial<ErrorLike>;\n  if (typeof maybe.name !== 'string' || maybe.name === '') {\n    throw new Error(`Encountered error object without a name, got '${value}'`);\n  }\n  if (typeof maybe.message !== 'string') {\n    throw new Error(\n      `Encountered error object without a message, got '${value}'`,\n    );\n  }\n}\n","/*\n * Copyright 2021 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { JsonObject } from '@backstage/types';\nimport {\n  deserializeError as deserializeErrorInternal,\n  serializeError as serializeErrorInternal,\n} from 'serialize-error';\nimport { isError } from '../errors';\n\n/**\n * The serialized form of an Error.\n *\n * @public\n */\nexport type SerializedError = JsonObject & {\n  /** The name of the exception that was thrown */\n  name: string;\n  /** The message of the exception that was thrown */\n  message: string;\n  /** A stringified stack trace; may not be present */\n  stack?: string;\n  /** A custom code (not necessarily the same as an HTTP response code); may not be present */\n  code?: string;\n};\n\n/**\n * Serializes an error object to a JSON friendly form.\n *\n * @public\n * @param error - The error.\n * @param options - Optional serialization options.\n */\nexport function serializeError(\n  error: Error,\n  options?: {\n    /** Include stack trace in the output (default false) */\n    includeStack?: boolean;\n  },\n): SerializedError {\n  const serialized = serializeErrorInternal(error);\n  const result: SerializedError = {\n    name: 'Unknown',\n    message: '<no reason given>',\n    ...serialized,\n  };\n\n  if (!options?.includeStack) {\n    delete result.stack;\n  }\n\n  return result;\n}\n\n/**\n * Deserializes a serialized error object back to an Error.\n *\n * @public\n */\nexport function deserializeError<T extends Error = Error>(\n  data: SerializedError,\n): T {\n  const result = deserializeErrorInternal(data) as T;\n  if (!data.stack) {\n    result.stack = undefined;\n  }\n  return result;\n}\n\n/**\n * Stringifies an error, including its name and message where available.\n *\n * @param error - The error.\n * @public\n */\nexport function stringifyError(error: unknown): string {\n  if (isError(error)) {\n    // Prefer error.toString, but if it's not implemented we use a nicer fallback\n    const str = String(error);\n    return str !== '[object Object]' ? str : `${error.name}: ${error.message}`;\n  }\n\n  return `unknown error '${error}'`;\n}\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { stringifyError } from '../serialization';\nimport { isError } from './assertion';\n\n/**\n * A base class that custom Error classes can inherit from.\n *\n * @public\n * @example\n *```ts\n * class MyCustomError extends CustomErrorBase {}\n *\n * const e = new MyCustomError('Some message', cause);\n * // e.name === 'MyCustomError'\n * // e.message === 'Some message'\n * // e.cause === cause\n * // e.stack is set if the runtime supports it\n * ```\n */\nexport class CustomErrorBase extends Error {\n  /**\n   * An inner error that caused this error to be thrown, if any.\n   */\n  readonly cause?: Error | undefined;\n\n  constructor(message?: string, cause?: Error | unknown) {\n    let fullMessage = message;\n    if (cause !== undefined) {\n      const causeStr = stringifyError(cause);\n      if (fullMessage) {\n        fullMessage += `; caused by ${causeStr}`;\n      } else {\n        fullMessage = `caused by ${causeStr}`;\n      }\n    }\n\n    super(fullMessage);\n\n    Error.captureStackTrace?.(this, this.constructor);\n\n    this.name = this.constructor.name;\n    this.cause = isError(cause) ? cause : undefined;\n  }\n}\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { isError } from './assertion';\nimport { CustomErrorBase } from './CustomErrorBase';\n\n/*\n * A set of common business logic errors.\n *\n * A backend error handler middleware would understand these and translate them\n * to well formed HTTP responses.\n *\n * While these are intentionally analogous to HTTP errors, they are not\n * intended to be thrown by the request handling layer. In those places, please\n * use e.g. the http-errors library.\n */\n\n/**\n * The given inputs are malformed and cannot be processed.\n *\n * @public\n */\nexport class InputError extends CustomErrorBase {}\n\n/**\n * The request requires authentication, which was not properly supplied.\n *\n * @public\n */\nexport class AuthenticationError extends CustomErrorBase {}\n\n/**\n * The authenticated caller is not allowed to perform this request.\n *\n * @public\n */\nexport class NotAllowedError extends CustomErrorBase {}\n\n/**\n * The requested resource could not be found.\n *\n * Note that this error usually is used to indicate that an entity with a given\n * ID does not exist, rather than signalling that an entire route is missing.\n *\n * @public\n */\nexport class NotFoundError extends CustomErrorBase {}\n\n/**\n * The request could not complete due to a conflict in the current state of the\n * resource.\n *\n * @public\n */\nexport class ConflictError extends CustomErrorBase {}\n\n/**\n * The requested resource has not changed since last request.\n *\n * @public\n */\nexport class NotModifiedError extends CustomErrorBase {}\n\n/**\n * An error that forwards an underlying cause with additional context in the message.\n *\n * The `name` property of the error will be inherited from the `cause` if\n * possible, and will otherwise be set to `'Error'`.\n *\n * @public\n */\nexport class ForwardedError extends CustomErrorBase {\n  constructor(message: string, cause: Error | unknown) {\n    super(message, cause);\n\n    this.name = isError(cause) ? cause.name : 'Error';\n  }\n}\n","/*\n * Copyright 2021 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { ConsumedResponse } from '../errors/types';\nimport { SerializedError } from './error';\n\n/**\n * A standard shape of JSON data returned as the body of backend errors.\n *\n * @public\n */\nexport type ErrorResponseBody = {\n  /** Details of the error that was caught */\n  error: SerializedError;\n\n  /** Details about the incoming request */\n  request?: {\n    /** The HTTP method of the request */\n    method: string;\n    /** The URL of the request (excluding protocol and host/port) */\n    url: string;\n  };\n\n  /** Details about the response */\n  response: {\n    /** The numeric HTTP status code that was returned */\n    statusCode: number;\n  };\n};\n\n/**\n * Attempts to construct an ErrorResponseBody out of a failed server request.\n * Assumes that the response has already been checked to be not ok. This\n * function consumes the body of the response, and assumes that it hasn't\n * been consumed before.\n *\n * The code is forgiving, and constructs a useful synthetic body as best it can\n * if the response body wasn't on the expected form.\n *\n * @public\n * @param response - The response of a failed request\n */\nexport async function parseErrorResponseBody(\n  response: ConsumedResponse & { text(): Promise<string> },\n): Promise<ErrorResponseBody> {\n  try {\n    const text = await response.text();\n    if (text) {\n      if (\n        response.headers.get('content-type')?.startsWith('application/json')\n      ) {\n        try {\n          const body = JSON.parse(text);\n          if (body.error && body.response) {\n            return body;\n          }\n        } catch {\n          // ignore\n        }\n      }\n\n      return {\n        error: {\n          name: 'Error',\n          message: `Request failed with status ${response.status} ${response.statusText}, ${text}`,\n        },\n        response: {\n          statusCode: response.status,\n        },\n      };\n    }\n  } catch {\n    // ignore\n  }\n\n  return {\n    error: {\n      name: 'Error',\n      message: `Request failed with status ${response.status} ${response.statusText}`,\n    },\n    response: {\n      statusCode: response.status,\n    },\n  };\n}\n","/*\n * Copyright 2021 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { deserializeError } from '../serialization';\nimport {\n  ErrorResponseBody,\n  parseErrorResponseBody,\n} from '../serialization/response';\nimport { ConsumedResponse } from './types';\n\n/**\n * An error thrown as the result of a failed server request.\n *\n * The server is expected to respond on the ErrorResponseBody format.\n *\n * @public\n */\nexport class ResponseError extends Error {\n  /**\n   * The actual response, as seen by the client.\n   *\n   * Note that the body of this response is always consumed. Its parsed form is\n   * in the `body` field.\n   */\n  readonly response: ConsumedResponse;\n\n  /**\n   * The parsed JSON error body, as sent by the server.\n   */\n  readonly body: ErrorResponseBody;\n\n  /**\n   * The Error cause, as seen by the remote server. This is parsed out of the\n   * JSON error body.\n   *\n   * This error always has the plain Error constructor, however all\n   * serializable enumerable fields on the remote error including its name are\n   * preserved. Therefore, if you want to check the error type, use its name\n   * property rather than checking typeof or its constructor or prototype.\n   */\n  readonly cause: Error;\n\n  /**\n   * Constructs a ResponseError based on a failed response.\n   *\n   * Assumes that the response has already been checked to be not ok. This\n   * function consumes the body of the response, and assumes that it hasn't\n   * been consumed before.\n   */\n  static async fromResponse(\n    response: ConsumedResponse & { text(): Promise<string> },\n  ): Promise<ResponseError> {\n    const data = await parseErrorResponseBody(response);\n\n    const status = data.response.statusCode || response.status;\n    const statusText = data.error.name || response.statusText;\n    const message = `Request failed with ${status} ${statusText}`;\n    const cause = deserializeError(data.error);\n\n    return new ResponseError({\n      message,\n      response,\n      data,\n      cause,\n    });\n  }\n\n  private constructor(props: {\n    message: string;\n    response: ConsumedResponse;\n    data: ErrorResponseBody;\n    cause: Error;\n  }) {\n    super(props.message);\n    this.name = 'ResponseError';\n    this.response = props.response;\n    this.body = props.data;\n    this.cause = props.cause;\n  }\n}\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  ApiRef,\n  createApiRef,\n  AuthRequestOptions,\n} from '@backstage/core-plugin-api';\n\n/**\n * The options that control a {@link ScmAuthApi.getCredentials} call.\n *\n * @public\n */\nexport interface ScmAuthTokenOptions extends AuthRequestOptions {\n  /**\n   * The URL of the SCM resource to be accessed.\n   *\n   * @example https://github.com/backstage/backstage\n   */\n  url: string;\n\n  /**\n   * Whether to request additional access scope.\n   *\n   * Read access to user, organization, and repositories is always included.\n   */\n  additionalScope?: {\n    /**\n     * Requests access to be able to write repository content, including\n     * the ability to create things like issues and pull requests.\n     */\n    repoWrite?: boolean;\n    /**\n     * Allow an arbitrary list of scopes provided from the user\n     * to request from the provider.\n     */\n    customScopes?: {\n      github?: string[];\n      azure?: string[];\n      bitbucket?: string[];\n      gitlab?: string[];\n    };\n  };\n}\n\n/**\n * The response from a {@link ScmAuthApi.getCredentials} call.\n *\n * @public\n */\nexport interface ScmAuthTokenResponse {\n  /**\n   * An authorization token that can be used to authenticate requests.\n   */\n  token: string;\n\n  /**\n   * The set of HTTP headers that are needed to authenticate requests.\n   */\n  headers: { [name: string]: string };\n}\n\n/**\n * ScmAuthApi provides methods for authenticating towards source code management services.\n *\n * As opposed to using the GitHub, GitLab and other auth APIs\n * directly, this API allows for more generic access to SCM services.\n *\n * @public\n */\nexport interface ScmAuthApi {\n  /**\n   * Requests credentials for accessing an SCM resource.\n   */\n  getCredentials(options: ScmAuthTokenOptions): Promise<ScmAuthTokenResponse>;\n}\n\n/**\n * The ApiRef for the ScmAuthApi.\n *\n * @public\n */\nexport const scmAuthApiRef: ApiRef<ScmAuthApi> = createApiRef({\n  id: 'core.scmauth',\n});\n","/*\n * Copyright 2021 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  bitbucketAuthApiRef,\n  createApiFactory,\n  githubAuthApiRef,\n  gitlabAuthApiRef,\n  microsoftAuthApiRef,\n  OAuthApi,\n} from '@backstage/core-plugin-api';\nimport {\n  ScmAuthApi,\n  scmAuthApiRef,\n  ScmAuthTokenOptions,\n  ScmAuthTokenResponse,\n} from './ScmAuthApi';\n\ntype ScopeMapping = {\n  /** The base scopes used for all requests */\n  default: string[];\n  /** Additional scopes added if `repoWrite` is requested */\n  repoWrite: string[];\n};\n\n// An enum of all supported providers\ntype ProviderName = 'generic' | 'github' | 'azure' | 'bitbucket' | 'gitlab';\n\nclass ScmAuthMux implements ScmAuthApi {\n  #providers: Array<ScmAuth>;\n\n  constructor(providers: ScmAuth[]) {\n    this.#providers = providers;\n  }\n\n  async getCredentials(\n    options: ScmAuthTokenOptions,\n  ): Promise<ScmAuthTokenResponse> {\n    const url = new URL(options.url);\n    const provider = this.#providers.find(p => p.isUrlSupported(url));\n    if (!provider) {\n      throw new Error(\n        `No auth provider available for '${options.url}', see https://backstage.io/link?scm-auth`,\n      );\n    }\n\n    return provider.getCredentials(options);\n  }\n}\n\n/**\n * An implementation of the ScmAuthApi that merges together OAuthApi instances\n * to form a single instance that can handles authentication for multiple providers.\n *\n * @public\n *\n * @example\n * ```\n * // Supports authentication towards both public GitHub and GHE:\n * createApiFactory({\n *   api: scmAuthApiRef,\n *   deps: {\n *     gheAuthApi: gheAuthApiRef,\n *     githubAuthApi: githubAuthApiRef,\n *   },\n *   factory: ({ githubAuthApi, gheAuthApi }) =>\n *     ScmAuth.merge(\n *       ScmAuth.forGithub(githubAuthApi),\n *       ScmAuth.forGithub(gheAuthApi, {\n *         host: 'ghe.example.com',\n *       }),\n *     )\n * })\n * ```\n */\nexport class ScmAuth implements ScmAuthApi {\n  /**\n   * Creates an API factory that enables auth for each of the default SCM providers.\n   */\n  static createDefaultApiFactory() {\n    return createApiFactory({\n      api: scmAuthApiRef,\n      deps: {\n        github: githubAuthApiRef,\n        gitlab: gitlabAuthApiRef,\n        azure: microsoftAuthApiRef,\n        bitbucket: bitbucketAuthApiRef,\n      },\n      factory: ({ github, gitlab, azure, bitbucket }) =>\n        ScmAuth.merge(\n          ScmAuth.forGithub(github),\n          ScmAuth.forGitlab(gitlab),\n          ScmAuth.forAzure(azure),\n          ScmAuth.forBitbucket(bitbucket),\n        ),\n    });\n  }\n\n  /**\n   * Creates a general purpose ScmAuth instance with a custom scope mapping.\n   */\n  static forAuthApi(\n    authApi: OAuthApi,\n    options: {\n      host: string;\n      scopeMapping: {\n        default: string[];\n        repoWrite: string[];\n      };\n    },\n  ): ScmAuth {\n    return new ScmAuth('generic', authApi, options.host, options.scopeMapping);\n  }\n\n  /**\n   * Creates a new ScmAuth instance that handles authentication towards GitHub.\n   *\n   * The host option determines which URLs that are handled by this instance and defaults to `github.com`.\n   *\n   * The default scopes are:\n   *\n   * `repo read:org read:user`\n   *\n   * If the additional `repoWrite` permission is requested, these scopes are added:\n   *\n   * `gist`\n   */\n  static forGithub(\n    githubAuthApi: OAuthApi,\n    options?: {\n      host?: string;\n    },\n  ): ScmAuth {\n    const host = options?.host ?? 'github.com';\n    return new ScmAuth('github', githubAuthApi, host, {\n      default: ['repo', 'read:org', 'read:user'],\n      repoWrite: ['gist'],\n    });\n  }\n\n  /**\n   * Creates a new ScmAuth instance that handles authentication towards GitLab.\n   *\n   * The host option determines which URLs that are handled by this instance and defaults to `gitlab.com`.\n   *\n   * The default scopes are:\n   *\n   * `read_user read_api read_repository`\n   *\n   * If the additional `repoWrite` permission is requested, these scopes are added:\n   *\n   * `write_repository api`\n   */\n  static forGitlab(\n    gitlabAuthApi: OAuthApi,\n    options?: {\n      host?: string;\n    },\n  ): ScmAuth {\n    const host = options?.host ?? 'gitlab.com';\n    return new ScmAuth('gitlab', gitlabAuthApi, host, {\n      default: ['read_user', 'read_api', 'read_repository'],\n      repoWrite: ['write_repository', 'api'],\n    });\n  }\n\n  /**\n   * Creates a new ScmAuth instance that handles authentication towards Azure.\n   *\n   * The host option determines which URLs that are handled by this instance and defaults to `dev.azure.com`.\n   *\n   * The default scopes are:\n   *\n   * `vso.build vso.code vso.graph vso.project vso.profile`\n   *\n   * If the additional `repoWrite` permission is requested, these scopes are added:\n   *\n   * `vso.code_manage`\n   */\n  static forAzure(\n    microsoftAuthApi: OAuthApi,\n    options?: {\n      host?: string;\n    },\n  ): ScmAuth {\n    const host = options?.host ?? 'dev.azure.com';\n    return new ScmAuth('azure', microsoftAuthApi, host, {\n      default: [\n        'vso.build',\n        'vso.code',\n        'vso.graph',\n        'vso.project',\n        'vso.profile',\n      ],\n      repoWrite: ['vso.code_manage'],\n    });\n  }\n\n  /**\n   * Creates a new ScmAuth instance that handles authentication towards Bitbucket.\n   *\n   * The host option determines which URLs that are handled by this instance and defaults to `bitbucket.org`.\n   *\n   * The default scopes are:\n   *\n   * `account team pullrequest snippet issue`\n   *\n   * If the additional `repoWrite` permission is requested, these scopes are added:\n   *\n   * `pullrequest:write snippet:write issue:write`\n   */\n  static forBitbucket(\n    bitbucketAuthApi: OAuthApi,\n    options?: {\n      host?: string;\n    },\n  ): ScmAuth {\n    const host = options?.host ?? 'bitbucket.org';\n    return new ScmAuth('bitbucket', bitbucketAuthApi, host, {\n      default: ['account', 'team', 'pullrequest', 'snippet', 'issue'],\n      repoWrite: ['pullrequest:write', 'snippet:write', 'issue:write'],\n    });\n  }\n\n  /**\n   * Merges together multiple ScmAuth instances into one that\n   * routes requests to the correct instance based on the URL.\n   */\n  static merge(...providers: ScmAuth[]): ScmAuthApi {\n    return new ScmAuthMux(providers);\n  }\n\n  #api: OAuthApi;\n  #host: string;\n  #scopeMapping: ScopeMapping;\n  #providerName: ProviderName;\n\n  private constructor(\n    providerName: ProviderName,\n    api: OAuthApi,\n    host: string,\n    scopeMapping: ScopeMapping,\n  ) {\n    this.#api = api;\n    this.#host = host;\n    this.#scopeMapping = scopeMapping;\n    this.#providerName = providerName;\n  }\n\n  /**\n   * Checks whether the implementation is able to provide authentication for the given URL.\n   */\n  isUrlSupported(url: URL): boolean {\n    return url.host === this.#host;\n  }\n\n  private getAdditionalScopesForProvider(\n    additionalScopes: ScmAuthTokenOptions['additionalScope'],\n  ): string[] {\n    if (!additionalScopes?.customScopes || this.#providerName === 'generic') {\n      return [];\n    }\n\n    return additionalScopes.customScopes?.[this.#providerName] ?? [];\n  }\n\n  /**\n   * Fetches credentials for the given resource.\n   */\n  async getCredentials(\n    options: ScmAuthTokenOptions,\n  ): Promise<ScmAuthTokenResponse> {\n    const { url, additionalScope, ...restOptions } = options;\n\n    const scopes = this.#scopeMapping.default.slice();\n    if (additionalScope?.repoWrite) {\n      scopes.push(...this.#scopeMapping.repoWrite);\n    }\n\n    const additionalScopes =\n      this.getAdditionalScopesForProvider(additionalScope);\n\n    if (additionalScopes.length) {\n      scopes.push(...additionalScopes);\n    }\n\n    const uniqueScopes = [...new Set(scopes)];\n\n    const token = await this.#api.getAccessToken(uniqueScopes, restOptions);\n\n    return {\n      token,\n      headers: {\n        Authorization: `Bearer ${token}`,\n      },\n    };\n  }\n}\n","/*\n * Copyright 2021 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { Config } from '@backstage/config';\nimport {\n  ScmIntegrationRegistry,\n  ScmIntegrations,\n} from '@backstage/integration';\nimport { ApiRef, createApiRef } from '@backstage/core-plugin-api';\n\n/**\n * Factory class for creating {@link @backstage/integration#ScmIntegrationRegistry} instances.\n *\n * @public\n */\nexport class ScmIntegrationsApi {\n  /**\n   * Instantiates an {@link @backstage/integration#ScmIntegrationRegistry}.\n   *\n   * @param config - The root of the config hierarchy.\n   */\n  static fromConfig(config: Config): ScmIntegrationRegistry {\n    return ScmIntegrations.fromConfig(config);\n  }\n}\n\n/**\n * The API that holds all configured SCM integrations.\n *\n * @public\n */\nexport const scmIntegrationsApiRef: ApiRef<ScmIntegrationRegistry> =\n  createApiRef({\n    id: 'integration.scmintegrations',\n  });\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport CodeIcon from '@material-ui/icons/Code';\nimport React from 'react';\nimport { useApp } from '@backstage/core-plugin-api';\n\n/**\n * Props for {@link ScmIntegrationIcon}.\n *\n * @public\n */\nexport type ScmIntegrationIconProps = {\n  /**\n   * The integration type, e.g. \"github\".\n   */\n  type?: string;\n};\n\n/**\n * An icon that represents a certain SCM integration.\n *\n * @public\n */\nexport const ScmIntegrationIcon = (props: ScmIntegrationIconProps) => {\n  const { type } = props;\n  const app = useApp();\n  const DefaultIcon = CodeIcon;\n  const Icon = type ? app.getSystemIcon(type) ?? DefaultIcon : DefaultIcon;\n  return <Icon />;\n};\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport parseGitUrl from 'git-url-parse';\nimport { trimEnd } from 'lodash';\nimport { ScmIntegration, ScmIntegrationsGroup } from './types';\n\n/** Checks whether the given argument is a valid URL hostname */\nexport function isValidHost(host: string): boolean {\n  const check = new URL('http://example.com');\n  check.host = host;\n  return check.host === host;\n}\n\n/** Checks whether the given argument is a valid URL */\nexport function isValidUrl(url: string): boolean {\n  try {\n    // eslint-disable-next-line no-new\n    new URL(url);\n    return true;\n  } catch {\n    return false;\n  }\n}\n\nexport function basicIntegrations<T extends ScmIntegration>(\n  integrations: T[],\n  getHost: (integration: T) => string,\n): ScmIntegrationsGroup<T> {\n  return {\n    list(): T[] {\n      return integrations;\n    },\n    byUrl(url: string | URL): T | undefined {\n      try {\n        const parsed = typeof url === 'string' ? new URL(url) : url;\n        return integrations.find(i => getHost(i) === parsed.host);\n      } catch {\n        return undefined;\n      }\n    },\n    byHost(host: string): T | undefined {\n      return integrations.find(i => getHost(i) === host);\n    },\n  };\n}\n\n/**\n * Default implementation of {@link ScmIntegration} `resolveUrl`, that only\n * works with URL pathname based providers.\n *\n * @public\n */\nexport function defaultScmResolveUrl(options: {\n  url: string;\n  base: string;\n  lineNumber?: number;\n}): string {\n  const { url, base, lineNumber } = options;\n\n  // If it is a fully qualified URL - then return it verbatim\n  try {\n    // eslint-disable-next-line no-new\n    new URL(url);\n    return url;\n  } catch {\n    // ignore intentionally\n  }\n\n  let updated: URL;\n\n  if (url.startsWith('/')) {\n    // If it is an absolute path, move relative to the repo root\n    const { filepath } = parseGitUrl(base);\n    updated = new URL(base);\n    const repoRootPath = trimEnd(\n      updated.pathname.substring(0, updated.pathname.length - filepath.length),\n      '/',\n    );\n    updated.pathname = `${repoRootPath}${url}`;\n  } else {\n    // For relative URLs, just let the default URL constructor handle the\n    // resolving. Note that this essentially will treat the last segment of the\n    // base as a file - NOT a folder - unless the url ends in a slash.\n    updated = new URL(url, base);\n  }\n\n  updated.search = new URL(base).search;\n  if (lineNumber) {\n    updated.hash = `L${lineNumber}`;\n  }\n  return updated.toString();\n}\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { Config } from '@backstage/config';\n\nconst AMAZON_AWS_HOST = 'amazonaws.com';\n\n/**\n * The configuration parameters for a single AWS S3 provider.\n *\n * @public\n */\nexport type AwsS3IntegrationConfig = {\n  /**\n   * Host, derived from endpoint, and defaults to amazonaws.com\n   */\n  host: string;\n\n  /**\n   * (Optional) AWS Endpoint.\n   * The endpoint URI to send requests to. The default endpoint is built from the configured region.\n   * @see https://docs.aws.amazon.com/AWSJavaScriptSDK/latest/AWS/S3.html#constructor-property\n   *\n   * Supports non-AWS providers, e.g. for LocalStack, endpoint may look like http://localhost:4566\n   */\n  endpoint?: string;\n\n  /**\n   * (Optional) Whether to use path style URLs when communicating with S3.\n   * Defaults to false.\n   * This allows providers like LocalStack, Minio and Wasabi (and possibly others) to be used.\n   */\n  s3ForcePathStyle?: boolean;\n\n  /**\n   * (Optional) User access key id\n   */\n  accessKeyId?: string;\n\n  /**\n   * (Optional) User secret access key\n   */\n  secretAccessKey?: string;\n\n  /**\n   * (Optional) ARN of role to be assumed\n   */\n  roleArn?: string;\n\n  /**\n   * (Optional) External ID to use when assuming role\n   */\n  externalId?: string;\n};\n\n/**\n * Reads a single Aws S3 integration config.\n *\n * @param config - The config object of a single integration\n * @public\n */\n\nexport function readAwsS3IntegrationConfig(\n  config: Config,\n): AwsS3IntegrationConfig {\n  const endpoint = config.getOptionalString('endpoint');\n  const s3ForcePathStyle =\n    config.getOptionalBoolean('s3ForcePathStyle') ?? false;\n  let host;\n  let pathname;\n  if (endpoint) {\n    try {\n      const url = new URL(endpoint);\n      host = url.host;\n      pathname = url.pathname;\n    } catch {\n      throw new Error(\n        `invalid awsS3 integration config, endpoint '${endpoint}' is not a valid URL`,\n      );\n    }\n    if (pathname !== '/') {\n      throw new Error(\n        `invalid awsS3 integration config, endpoints cannot contain path, got '${endpoint}'`,\n      );\n    }\n  } else {\n    host = AMAZON_AWS_HOST;\n  }\n\n  const accessKeyId = config.getOptionalString('accessKeyId');\n  const secretAccessKey = config.getOptionalString('secretAccessKey');\n  const roleArn = config.getOptionalString('roleArn');\n  const externalId = config.getOptionalString('externalId');\n\n  return {\n    host,\n    endpoint,\n    s3ForcePathStyle,\n    accessKeyId,\n    secretAccessKey,\n    roleArn,\n    externalId,\n  };\n}\n\n/**\n * Reads a set of AWS S3 integration configs, and inserts some defaults for\n * public Amazon AWS if not specified.\n *\n * @param configs - The config objects of the integrations\n * @public\n */\nexport function readAwsS3IntegrationConfigs(\n  configs: Config[],\n): AwsS3IntegrationConfig[] {\n  // First read all the explicit integrations\n  const result = configs.map(readAwsS3IntegrationConfig);\n\n  // If no explicit amazonaws.com integration was added, put one in the list as\n  // a convenience\n  if (!result.some(c => c.host === AMAZON_AWS_HOST)) {\n    result.push({\n      host: AMAZON_AWS_HOST,\n    });\n  }\n  return result;\n}\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { basicIntegrations, defaultScmResolveUrl } from '../helpers';\nimport { ScmIntegration, ScmIntegrationsFactory } from '../types';\nimport { AwsS3IntegrationConfig, readAwsS3IntegrationConfigs } from './config';\n\n/**\n * Integrates with AWS S3 or compatible solutions.\n *\n * @public\n */\nexport class AwsS3Integration implements ScmIntegration {\n  static factory: ScmIntegrationsFactory<AwsS3Integration> = ({ config }) => {\n    const configs = readAwsS3IntegrationConfigs(\n      config.getOptionalConfigArray('integrations.awsS3') ?? [],\n    );\n    return basicIntegrations(\n      configs.map(c => new AwsS3Integration(c)),\n      i => i.config.host,\n    );\n  };\n\n  get type(): string {\n    return 'awsS3';\n  }\n\n  get title(): string {\n    return this.integrationConfig.host;\n  }\n\n  get config(): AwsS3IntegrationConfig {\n    return this.integrationConfig;\n  }\n\n  constructor(private readonly integrationConfig: AwsS3IntegrationConfig) {}\n\n  resolveUrl(options: {\n    url: string;\n    base: string;\n    lineNumber?: number | undefined;\n  }): string {\n    const resolved = defaultScmResolveUrl(options);\n    return resolved;\n  }\n\n  resolveEditUrl(url: string): string {\n    // TODO: Implement edit URL for awsS3\n    return url;\n  }\n}\n","/*\n * Copyright 2021 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nconst VERSION_PREFIX_GIT_BRANCH = 'GB';\n\nexport class AzureUrl {\n  /**\n   * Parses an azure URL as copied from the browser address bar.\n   *\n   * Throws an error if the URL is not a valid azure repo URL.\n   */\n  static fromRepoUrl(repoUrl: string): AzureUrl {\n    const url = new URL(repoUrl);\n\n    let owner;\n    let project;\n    let repo;\n\n    const parts = url.pathname.split('/').map(part => decodeURIComponent(part));\n    if (parts[2] === '_git') {\n      owner = parts[1];\n      project = repo = parts[3];\n    } else if (parts[3] === '_git') {\n      owner = parts[1];\n      project = parts[2];\n      repo = parts[4];\n    } else if (parts[4] === '_git') {\n      owner = `${parts[1]}/${parts[2]}`;\n      project = parts[3];\n      repo = parts[5];\n    }\n\n    if (!owner || !project || !repo) {\n      throw new Error('Azure URL must point to a git repository');\n    }\n\n    const path = url.searchParams.get('path') ?? undefined;\n\n    let ref;\n    const version = url.searchParams.get('version');\n    if (version) {\n      const prefix = version.slice(0, 2);\n      if (prefix !== 'GB') {\n        throw new Error('Azure URL version must point to a git branch');\n      }\n      ref = version.slice(2);\n    }\n\n    return new AzureUrl(url.origin, owner, project, repo, path, ref);\n  }\n\n  #origin: string;\n  #owner: string;\n  #project: string;\n  #repo: string;\n  #path?: string;\n  #ref?: string;\n\n  private constructor(\n    origin: string,\n    owner: string,\n    project: string,\n    repo: string,\n    path?: string,\n    ref?: string,\n  ) {\n    this.#origin = origin;\n    this.#owner = owner;\n    this.#project = project;\n    this.#repo = repo;\n    this.#path = path;\n    this.#ref = ref;\n  }\n\n  #baseUrl = (...parts: string[]): URL => {\n    const url = new URL(this.#origin);\n    url.pathname = parts.map(part => encodeURIComponent(part)).join('/');\n    return url;\n  };\n\n  /**\n   * Returns a repo URL that can be used to navigate to the resource in azure.\n   *\n   * Throws an error if the URL is not a valid azure repo URL.\n   */\n  toRepoUrl(): string {\n    let url;\n    if (this.#project === this.#repo) {\n      url = this.#baseUrl(this.#owner, '_git', this.#repo);\n    } else {\n      url = this.#baseUrl(this.#owner, this.#project, '_git', this.#repo);\n    }\n\n    if (this.#path) {\n      url.searchParams.set('path', this.#path);\n    }\n    if (this.#ref) {\n      url.searchParams.set('version', VERSION_PREFIX_GIT_BRANCH + this.#ref);\n    }\n\n    return url.toString();\n  }\n\n  /**\n   * Returns the file download URL for this azure resource.\n   *\n   * Throws an error if the URL does not point to a file.\n   */\n  toFileUrl(): string {\n    if (!this.#path) {\n      throw new Error(\n        'Azure URL must point to a specific path to be able to download a file',\n      );\n    }\n\n    const url = this.#baseUrl(\n      this.#owner,\n      this.#project,\n      '_apis',\n      'git',\n      'repositories',\n      this.#repo,\n      'items',\n    );\n    url.searchParams.set('api-version', '6.0');\n    url.searchParams.set('path', this.#path);\n\n    if (this.#ref) {\n      url.searchParams.set('version', this.#ref);\n    }\n\n    return url.toString();\n  }\n\n  /**\n   * Returns the archive download URL for this azure resource.\n   *\n   * Throws an error if the URL does not point to a repo.\n   */\n  toArchiveUrl(): string {\n    const url = this.#baseUrl(\n      this.#owner,\n      this.#project,\n      '_apis',\n      'git',\n      'repositories',\n      this.#repo,\n      'items',\n    );\n    url.searchParams.set('recursionLevel', 'full');\n    url.searchParams.set('download', 'true');\n    url.searchParams.set('api-version', '6.0');\n\n    if (this.#path) {\n      url.searchParams.set('scopePath', this.#path);\n    }\n    if (this.#ref) {\n      url.searchParams.set('version', this.#ref);\n    }\n\n    return url.toString();\n  }\n\n  /**\n   * Returns the API url for fetching commits from a branch for this azure resource.\n   *\n   * Throws an error if the URL does not point to a commit.\n   */\n  toCommitsUrl(): string {\n    const url = this.#baseUrl(\n      this.#owner,\n      this.#project,\n      '_apis',\n      'git',\n      'repositories',\n      this.#repo,\n      'commits',\n    );\n    url.searchParams.set('api-version', '6.0');\n\n    if (this.#ref) {\n      url.searchParams.set('searchCriteria.itemVersion.version', this.#ref);\n    }\n\n    return url.toString();\n  }\n\n  /**\n   * Returns the name of the owner, a user or an organization.\n   */\n  getOwner(): string {\n    return this.#owner;\n  }\n\n  /**\n   * Returns the name of the project.\n   */\n  getProject(): string {\n    return this.#project;\n  }\n\n  /**\n   * Returns the name of the repo.\n   */\n  getRepo(): string {\n    return this.#repo;\n  }\n\n  /**\n   * Returns the file path within the repo if the URL contains one.\n   */\n  getPath(): string | undefined {\n    return this.#path;\n  }\n\n  /**\n   * Returns the git ref in the repo if the URL contains one.\n   */\n  getRef(): string | undefined {\n    return this.#ref;\n  }\n}\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { Config } from '@backstage/config';\nimport { isValidHost } from '../helpers';\n\nconst AZURE_HOST = 'dev.azure.com';\n\n/**\n * The configuration parameters for a single Azure provider.\n *\n * @public\n */\nexport type AzureIntegrationConfig = {\n  /**\n   * The host of the target that this matches on, e.g. \"dev.azure.com\".\n   *\n   * Currently only \"dev.azure.com\" is supported.\n   */\n  host: string;\n\n  /**\n   * The authorization token to use for requests.\n   *\n   * If no token is specified, anonymous access is used.\n   */\n  token?: string;\n};\n\n/**\n * Reads a single Azure integration config.\n *\n * @param config - The config object of a single integration\n * @public\n */\nexport function readAzureIntegrationConfig(\n  config: Config,\n): AzureIntegrationConfig {\n  const host = config.getOptionalString('host') ?? AZURE_HOST;\n  const token = config.getOptionalString('token');\n\n  if (!isValidHost(host)) {\n    throw new Error(\n      `Invalid Azure integration config, '${host}' is not a valid host`,\n    );\n  }\n\n  return { host, token };\n}\n\n/**\n * Reads a set of Azure integration configs, and inserts some defaults for\n * public Azure if not specified.\n *\n * @param configs - All of the integration config objects\n * @public\n */\nexport function readAzureIntegrationConfigs(\n  configs: Config[],\n): AzureIntegrationConfig[] {\n  // First read all the explicit integrations\n  const result = configs.map(readAzureIntegrationConfig);\n\n  // If no explicit dev.azure.com integration was added, put one in the list as\n  // a convenience\n  if (!result.some(c => c.host === AZURE_HOST)) {\n    result.push({ host: AZURE_HOST });\n  }\n\n  return result;\n}\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { basicIntegrations, isValidUrl } from '../helpers';\nimport { ScmIntegration, ScmIntegrationsFactory } from '../types';\nimport { AzureUrl } from './AzureUrl';\nimport { AzureIntegrationConfig, readAzureIntegrationConfigs } from './config';\n\n/**\n * Microsoft Azure based integration.\n *\n * @public\n */\nexport class AzureIntegration implements ScmIntegration {\n  static factory: ScmIntegrationsFactory<AzureIntegration> = ({ config }) => {\n    const configs = readAzureIntegrationConfigs(\n      config.getOptionalConfigArray('integrations.azure') ?? [],\n    );\n    return basicIntegrations(\n      configs.map(c => new AzureIntegration(c)),\n      i => i.config.host,\n    );\n  };\n\n  constructor(private readonly integrationConfig: AzureIntegrationConfig) {}\n\n  get type(): string {\n    return 'azure';\n  }\n\n  get title(): string {\n    return this.integrationConfig.host;\n  }\n\n  get config(): AzureIntegrationConfig {\n    return this.integrationConfig;\n  }\n\n  /*\n   * Azure repo URLs on the form with a `path` query param are treated specially.\n   *\n   * Example base URL: https://dev.azure.com/organization/project/_git/repository?path=%2Fcatalog-info.yaml\n   */\n  resolveUrl(options: {\n    url: string;\n    base: string;\n    lineNumber?: number;\n  }): string {\n    const { url, base } = options;\n\n    // If we can parse the url, it is absolute - then return it verbatim\n    if (isValidUrl(url)) {\n      return url;\n    }\n\n    try {\n      const azureUrl = AzureUrl.fromRepoUrl(base);\n      const newUrl = new URL(base);\n\n      // We lean on the URL path resolution logic to resolve the path param\n      const mockBaseUrl = new URL(`https://a.com${azureUrl.getPath() ?? ''}`);\n      const updatedPath = new URL(url, mockBaseUrl).pathname;\n      newUrl.searchParams.set('path', updatedPath);\n\n      if (options.lineNumber) {\n        newUrl.searchParams.set('line', String(options.lineNumber));\n        newUrl.searchParams.set('lineEnd', String(options.lineNumber + 1));\n        newUrl.searchParams.set('lineStartColumn', '1');\n        newUrl.searchParams.set('lineEndColumn', '1');\n      }\n\n      return newUrl.toString();\n    } catch {\n      // If not an actual file path within a repo, treat the URL as raw\n      return new URL(url, base).toString();\n    }\n  }\n\n  resolveEditUrl(url: string): string {\n    // TODO: Implement edit URL for Azure, fallback to view url as I don't know\n    // how azure works.\n    return url;\n  }\n}\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { AzureUrl } from './AzureUrl';\nimport { AzureIntegrationConfig } from './config';\n\n/**\n * Given a URL pointing to a file on a provider, returns a URL that is suitable\n * for fetching the contents of the data.\n *\n * @remarks\n *\n * Converts\n * - from: `https://dev.azure.com/{organization}/{project}/_git/reponame?path={path}&version=GB{commitOrBranch}&_a=contents`\n * - to:   `https://dev.azure.com/{organization}/{project}/_apis/git/repositories/reponame/items?path={path}&version={commitOrBranch}`\n *\n * @param url - A URL pointing to a file\n * @public\n */\nexport function getAzureFileFetchUrl(url: string): string {\n  return AzureUrl.fromRepoUrl(url).toFileUrl();\n}\n\n/**\n * Given a URL pointing to a path on a provider, returns a URL that is suitable\n * for downloading the subtree.\n *\n * @param url - A URL pointing to a path\n * @public\n */\nexport function getAzureDownloadUrl(url: string): string {\n  return AzureUrl.fromRepoUrl(url).toArchiveUrl();\n}\n\n/**\n * Given a URL, return the API URL to fetch commits on the branch.\n *\n * @param url - A URL pointing to a repository or a sub-path\n * @public\n */\nexport function getAzureCommitsUrl(url: string): string {\n  return AzureUrl.fromRepoUrl(url).toCommitsUrl();\n}\n\n/**\n * Gets the request options necessary to make requests to a given provider.\n *\n * @param config - The relevant provider config\n * @public\n */\nexport function getAzureRequestOptions(\n  config: AzureIntegrationConfig,\n  additionalHeaders?: Record<string, string>,\n): { headers: Record<string, string> } {\n  const headers: Record<string, string> = additionalHeaders\n    ? { ...additionalHeaders }\n    : {};\n\n  if (config.token) {\n    const buffer = Buffer.from(`:${config.token}`, 'utf8');\n    headers.Authorization = `Basic ${buffer.toString('base64')}`;\n  }\n\n  return { headers };\n}\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { Config } from '@backstage/config';\nimport { trimEnd } from 'lodash';\nimport { isValidHost } from '../helpers';\n\nconst BITBUCKET_HOST = 'bitbucket.org';\nconst BITBUCKET_API_BASE_URL = 'https://api.bitbucket.org/2.0';\n\n/**\n * The configuration parameters for a single Bitbucket API provider.\n *\n * @public\n * @deprecated bitbucket integration replaced by integrations bitbucketCloud and bitbucketServer.\n */\nexport type BitbucketIntegrationConfig = {\n  /**\n   * The host of the target that this matches on, e.g. \"bitbucket.org\"\n   */\n  host: string;\n\n  /**\n   * The base URL of the API of this provider, e.g. \"https://api.bitbucket.org/2.0\",\n   * with no trailing slash.\n   *\n   * Values omitted at the optional property at the app-config will be deduced\n   * from the \"host\" value.\n   */\n  apiBaseUrl: string;\n\n  /**\n   * The authorization token to use for requests to a Bitbucket Server provider.\n   *\n   * See https://confluence.atlassian.com/bitbucketserver/personal-access-tokens-939515499.html\n   *\n   * If no token is specified, anonymous access is used.\n   */\n  token?: string;\n\n  /**\n   * The username to use for requests to Bitbucket Cloud (bitbucket.org).\n   */\n  username?: string;\n\n  /**\n   * Authentication with Bitbucket Cloud (bitbucket.org) is done using app passwords.\n   *\n   * See https://support.atlassian.com/bitbucket-cloud/docs/app-passwords/\n   */\n  appPassword?: string;\n};\n\n/**\n * Reads a single Bitbucket integration config.\n *\n * @param config - The config object of a single integration\n * @public\n * @deprecated bitbucket integration replaced by integrations bitbucketCloud and bitbucketServer.\n */\nexport function readBitbucketIntegrationConfig(\n  config: Config,\n): BitbucketIntegrationConfig {\n  const host = config.getOptionalString('host') ?? BITBUCKET_HOST;\n  let apiBaseUrl = config.getOptionalString('apiBaseUrl');\n  const token = config.getOptionalString('token');\n  const username = config.getOptionalString('username');\n  const appPassword = config.getOptionalString('appPassword');\n\n  if (!isValidHost(host)) {\n    throw new Error(\n      `Invalid Bitbucket integration config, '${host}' is not a valid host`,\n    );\n  }\n\n  if (apiBaseUrl) {\n    apiBaseUrl = trimEnd(apiBaseUrl, '/');\n  } else if (host === BITBUCKET_HOST) {\n    apiBaseUrl = BITBUCKET_API_BASE_URL;\n  } else {\n    apiBaseUrl = `https://${host}/rest/api/1.0`;\n  }\n\n  return {\n    host,\n    apiBaseUrl,\n    token,\n    username,\n    appPassword,\n  };\n}\n\n/**\n * Reads a set of Bitbucket integration configs, and inserts some defaults for\n * public Bitbucket if not specified.\n *\n * @param configs - All of the integration config objects\n * @public\n * @deprecated bitbucket integration replaced by integrations bitbucketCloud and bitbucketServer.\n */\nexport function readBitbucketIntegrationConfigs(\n  configs: Config[],\n): BitbucketIntegrationConfig[] {\n  // First read all the explicit integrations\n  const result = configs.map(readBitbucketIntegrationConfig);\n\n  // If no explicit bitbucket.org integration was added, put one in the list as\n  // a convenience\n  if (!result.some(c => c.host === BITBUCKET_HOST)) {\n    result.push({\n      host: BITBUCKET_HOST,\n      apiBaseUrl: BITBUCKET_API_BASE_URL,\n    });\n  }\n\n  return result;\n}\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport parseGitUrl from 'git-url-parse';\nimport { basicIntegrations, defaultScmResolveUrl } from '../helpers';\nimport { ScmIntegration, ScmIntegrationsFactory } from '../types';\nimport {\n  BitbucketIntegrationConfig,\n  readBitbucketIntegrationConfigs,\n} from './config';\n\n/**\n * A Bitbucket based integration.\n *\n * @public\n * @deprecated replaced by the integrations bitbucketCloud and bitbucketServer.\n */\nexport class BitbucketIntegration implements ScmIntegration {\n  static factory: ScmIntegrationsFactory<BitbucketIntegration> = ({\n    config,\n  }) => {\n    const configs = readBitbucketIntegrationConfigs(\n      config.getOptionalConfigArray('integrations.bitbucket') ?? [\n        // if integrations.bitbucket was not used assume the use was migrated to the new configs\n        // and backport for the deprecated integration to be usable for other parts of the system\n        // until these got migrated\n        ...(config.getOptionalConfigArray('integrations.bitbucketCloud') ?? []),\n        ...(config.getOptionalConfigArray('integrations.bitbucketServer') ??\n          []),\n      ],\n    );\n    return basicIntegrations(\n      configs.map(c => new BitbucketIntegration(c)),\n      i => i.config.host,\n    );\n  };\n\n  constructor(private readonly integrationConfig: BitbucketIntegrationConfig) {}\n\n  get type(): string {\n    return 'bitbucket';\n  }\n\n  get title(): string {\n    return this.integrationConfig.host;\n  }\n\n  get config(): BitbucketIntegrationConfig {\n    return this.integrationConfig;\n  }\n\n  resolveUrl(options: {\n    url: string;\n    base: string;\n    lineNumber?: number;\n  }): string {\n    const resolved = defaultScmResolveUrl(options);\n    if (!options.lineNumber) {\n      return resolved;\n    }\n\n    const url = new URL(resolved);\n\n    if (this.integrationConfig.host === 'bitbucket.org') {\n      // Bitbucket Cloud uses the syntax #lines-{start}[:{end}][,...]\n      url.hash = `lines-${options.lineNumber}`;\n    } else {\n      // Bitbucket Server uses the syntax #{start}[-{end}][,...]\n      url.hash = `${options.lineNumber}`;\n    }\n\n    return url.toString();\n  }\n\n  resolveEditUrl(url: string): string {\n    const urlData = parseGitUrl(url);\n    const editUrl = new URL(url);\n\n    editUrl.searchParams.set('mode', 'edit');\n    // TODO: Not sure what spa=0 does, at least bitbucket.org doesn't support it\n    // but this is taken over from the initial implementation.\n    editUrl.searchParams.set('spa', '0');\n    editUrl.searchParams.set('at', urlData.ref);\n    return editUrl.toString();\n  }\n}\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport fetch from 'cross-fetch';\nimport parseGitUrl from 'git-url-parse';\nimport { BitbucketIntegrationConfig } from './config';\n\n/**\n * Given a URL pointing to a path on a provider, returns the default branch.\n *\n * @param url - A URL pointing to a path\n * @param config - The relevant provider config\n * @public\n * @deprecated no longer in use, bitbucket integration replaced by integrations bitbucketCloud and bitbucketServer.\n */\nexport async function getBitbucketDefaultBranch(\n  url: string,\n  config: BitbucketIntegrationConfig,\n): Promise<string> {\n  const { name: repoName, owner: project, resource } = parseGitUrl(url);\n\n  const isHosted = resource === 'bitbucket.org';\n  // Bitbucket Server https://docs.atlassian.com/bitbucket-server/rest/7.9.0/bitbucket-rest.html#idp184\n  let branchUrl = isHosted\n    ? `${config.apiBaseUrl}/repositories/${project}/${repoName}`\n    : `${config.apiBaseUrl}/projects/${project}/repos/${repoName}/default-branch`;\n\n  let response = await fetch(branchUrl, getBitbucketRequestOptions(config));\n\n  if (response.status === 404 && !isHosted) {\n    // First try the new format, and then if it gets specifically a 404 it should try the old format\n    // (to support old  Atlassian Bitbucket v5.11.1 format )\n    branchUrl = `${config.apiBaseUrl}/projects/${project}/repos/${repoName}/branches/default`;\n    response = await fetch(branchUrl, getBitbucketRequestOptions(config));\n  }\n\n  if (!response.ok) {\n    const message = `Failed to retrieve default branch from ${branchUrl}, ${response.status} ${response.statusText}`;\n    throw new Error(message);\n  }\n\n  let defaultBranch;\n  if (isHosted) {\n    const repoInfo = await response.json();\n    defaultBranch = repoInfo.mainbranch.name;\n  } else {\n    const { displayId } = await response.json();\n    defaultBranch = displayId;\n  }\n  if (!defaultBranch) {\n    throw new Error(\n      `Failed to read default branch from ${branchUrl}. ` +\n        `Response ${response.status} ${response.json()}`,\n    );\n  }\n  return defaultBranch;\n}\n\n/**\n * Given a URL pointing to a path on a provider, returns a URL that is suitable\n * for downloading the subtree.\n *\n * @param url - A URL pointing to a path\n * @param config - The relevant provider config\n * @public\n * @deprecated no longer in use, bitbucket integration replaced by integrations bitbucketCloud and bitbucketServer.\n */\nexport async function getBitbucketDownloadUrl(\n  url: string,\n  config: BitbucketIntegrationConfig,\n): Promise<string> {\n  const {\n    name: repoName,\n    owner: project,\n    ref,\n    protocol,\n    resource,\n    filepath,\n  } = parseGitUrl(url);\n\n  const isHosted = resource === 'bitbucket.org';\n\n  let branch = ref;\n  if (!branch) {\n    branch = await getBitbucketDefaultBranch(url, config);\n  }\n  // path will limit the downloaded content\n  // /docs will only download the docs folder and everything below it\n  // /docs/index.md will download the docs folder and everything below it\n  const path = filepath\n    ? `&path=${encodeURIComponent(decodeURIComponent(filepath))}`\n    : '';\n  const archiveUrl = isHosted\n    ? `${protocol}://${resource}/${project}/${repoName}/get/${branch}.tar.gz`\n    : `${config.apiBaseUrl}/projects/${project}/repos/${repoName}/archive?format=tgz&at=${branch}&prefix=${project}-${repoName}${path}`;\n\n  return archiveUrl;\n}\n\n/**\n * Given a URL pointing to a file on a provider, returns a URL that is suitable\n * for fetching the contents of the data.\n *\n * @remarks\n *\n * Converts\n * from: https://bitbucket.org/orgname/reponame/src/master/file.yaml\n * to:   https://api.bitbucket.org/2.0/repositories/orgname/reponame/src/master/file.yaml\n *\n * @param url - A URL pointing to a file\n * @param config - The relevant provider config\n * @public\n * @deprecated no longer in use, bitbucket integration replaced by integrations bitbucketCloud and bitbucketServer.\n */\nexport function getBitbucketFileFetchUrl(\n  url: string,\n  config: BitbucketIntegrationConfig,\n): string {\n  try {\n    const { owner, name, ref, filepathtype, filepath } = parseGitUrl(url);\n    if (\n      !owner ||\n      !name ||\n      (filepathtype !== 'browse' &&\n        filepathtype !== 'raw' &&\n        filepathtype !== 'src')\n    ) {\n      throw new Error('Invalid Bitbucket URL or file path');\n    }\n\n    const pathWithoutSlash = filepath.replace(/^\\//, '');\n\n    if (config.host === 'bitbucket.org') {\n      if (!ref) {\n        throw new Error('Invalid Bitbucket URL or file path');\n      }\n      return `${config.apiBaseUrl}/repositories/${owner}/${name}/src/${ref}/${pathWithoutSlash}`;\n    }\n    return `${config.apiBaseUrl}/projects/${owner}/repos/${name}/raw/${pathWithoutSlash}?at=${ref}`;\n  } catch (e) {\n    throw new Error(`Incorrect URL: ${url}, ${e}`);\n  }\n}\n\n/**\n * Gets the request options necessary to make requests to a given provider.\n *\n * @param config - The relevant provider config\n * @public\n * @deprecated no longer in use, bitbucket integration replaced by integrations bitbucketCloud and bitbucketServer.\n */\nexport function getBitbucketRequestOptions(\n  config: BitbucketIntegrationConfig,\n): { headers: Record<string, string> } {\n  const headers: Record<string, string> = {};\n\n  if (config.token) {\n    headers.Authorization = `Bearer ${config.token}`;\n  } else if (config.username && config.appPassword) {\n    const buffer = Buffer.from(\n      `${config.username}:${config.appPassword}`,\n      'utf8',\n    );\n    headers.Authorization = `Basic ${buffer.toString('base64')}`;\n  }\n\n  return {\n    headers,\n  };\n}\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { Config } from '@backstage/config';\n\nconst BITBUCKET_CLOUD_HOST = 'bitbucket.org';\nconst BITBUCKET_CLOUD_API_BASE_URL = 'https://api.bitbucket.org/2.0';\n\n/**\n * The configuration parameters for a single Bitbucket Cloud API provider.\n *\n * @public\n */\nexport type BitbucketCloudIntegrationConfig = {\n  /**\n   * Constant. bitbucket.org\n   */\n  host: string;\n\n  /**\n   * Constant. https://api.bitbucket.org/2.0\n   */\n  apiBaseUrl: string;\n\n  /**\n   * The username to use for requests to Bitbucket Cloud (bitbucket.org).\n   */\n  username?: string;\n\n  /**\n   * Authentication with Bitbucket Cloud (bitbucket.org) is done using app passwords.\n   *\n   * See https://support.atlassian.com/bitbucket-cloud/docs/app-passwords/\n   */\n  appPassword?: string;\n};\n\n/**\n * Reads a single Bitbucket Cloud integration config.\n *\n * @param config - The config object of a single integration\n * @public\n */\nexport function readBitbucketCloudIntegrationConfig(\n  config: Config,\n): BitbucketCloudIntegrationConfig {\n  const host = BITBUCKET_CLOUD_HOST;\n  const apiBaseUrl = BITBUCKET_CLOUD_API_BASE_URL;\n  // If config is provided, we assume authenticated access is desired\n  // (as the anonymous one is provided by default).\n  const username = config.getString('username');\n  const appPassword = config.getString('appPassword');\n\n  return {\n    host,\n    apiBaseUrl,\n    username,\n    appPassword,\n  };\n}\n\n/**\n * Reads a set of Bitbucket Cloud integration configs,\n * and inserts one for public Bitbucket Cloud if none specified.\n *\n * @param configs - All of the integration config objects\n * @public\n */\nexport function readBitbucketCloudIntegrationConfigs(\n  configs: Config[],\n): BitbucketCloudIntegrationConfig[] {\n  // First read all the explicit integrations\n  const result = configs.map(readBitbucketCloudIntegrationConfig);\n\n  // If no explicit bitbucket.org integration was added,\n  // put one in the list as a convenience\n  if (result.length === 0) {\n    result.push({\n      host: BITBUCKET_CLOUD_HOST,\n      apiBaseUrl: BITBUCKET_CLOUD_API_BASE_URL,\n    });\n  }\n\n  return result;\n}\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport parseGitUrl from 'git-url-parse';\nimport { basicIntegrations, defaultScmResolveUrl } from '../helpers';\nimport { ScmIntegration, ScmIntegrationsFactory } from '../types';\nimport {\n  BitbucketCloudIntegrationConfig,\n  readBitbucketCloudIntegrationConfigs,\n} from './config';\n\n/**\n * A Bitbucket Cloud based integration.\n *\n * @public\n */\nexport class BitbucketCloudIntegration implements ScmIntegration {\n  static factory: ScmIntegrationsFactory<BitbucketCloudIntegration> = ({\n    config,\n  }) => {\n    const configs = readBitbucketCloudIntegrationConfigs(\n      config.getOptionalConfigArray('integrations.bitbucketCloud') ?? [],\n    );\n    return basicIntegrations(\n      configs.map(c => new BitbucketCloudIntegration(c)),\n      i => i.config.host,\n    );\n  };\n\n  constructor(\n    private readonly integrationConfig: BitbucketCloudIntegrationConfig,\n  ) {}\n\n  get type(): string {\n    return 'bitbucketCloud';\n  }\n\n  get title(): string {\n    return this.integrationConfig.host;\n  }\n\n  get config(): BitbucketCloudIntegrationConfig {\n    return this.integrationConfig;\n  }\n\n  resolveUrl(options: {\n    url: string;\n    base: string;\n    lineNumber?: number;\n  }): string {\n    const resolved = defaultScmResolveUrl(options);\n\n    // Bitbucket Cloud line numbers use the syntax #lines-42, rather than #L42\n    if (options.lineNumber) {\n      const url = new URL(resolved);\n\n      url.hash = `lines-${options.lineNumber}`;\n      return url.toString();\n    }\n\n    return resolved;\n  }\n\n  resolveEditUrl(url: string): string {\n    const urlData = parseGitUrl(url);\n    const editUrl = new URL(url);\n\n    editUrl.searchParams.set('mode', 'edit');\n    editUrl.searchParams.set('at', urlData.ref);\n    return editUrl.toString();\n  }\n}\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport fetch from 'cross-fetch';\nimport parseGitUrl from 'git-url-parse';\nimport { BitbucketCloudIntegrationConfig } from './config';\n\n/**\n * Given a URL pointing to a path on a provider, returns the default branch.\n *\n * @param url - A URL pointing to a path\n * @param config - The relevant provider config\n * @public\n */\nexport async function getBitbucketCloudDefaultBranch(\n  url: string,\n  config: BitbucketCloudIntegrationConfig,\n): Promise<string> {\n  const { name: repoName, owner: project } = parseGitUrl(url);\n\n  const branchUrl = `${config.apiBaseUrl}/repositories/${project}/${repoName}`;\n  const response = await fetch(\n    branchUrl,\n    getBitbucketCloudRequestOptions(config),\n  );\n\n  if (!response.ok) {\n    const message = `Failed to retrieve default branch from ${branchUrl}, ${response.status} ${response.statusText}`;\n    throw new Error(message);\n  }\n\n  const repoInfo = await response.json();\n  const defaultBranch = repoInfo.mainbranch.name;\n  if (!defaultBranch) {\n    throw new Error(\n      `Failed to read default branch from ${branchUrl}. ` +\n        `Response ${response.status} ${response.json()}`,\n    );\n  }\n  return defaultBranch;\n}\n\n/**\n * Given a URL pointing to a path on a provider, returns a URL that is suitable\n * for downloading the subtree.\n *\n * @param url - A URL pointing to a path\n * @param config - The relevant provider config\n * @public\n */\nexport async function getBitbucketCloudDownloadUrl(\n  url: string,\n  config: BitbucketCloudIntegrationConfig,\n): Promise<string> {\n  const {\n    name: repoName,\n    owner: project,\n    ref,\n    protocol,\n    resource,\n  } = parseGitUrl(url);\n\n  let branch = ref;\n  if (!branch) {\n    branch = await getBitbucketCloudDefaultBranch(url, config);\n  }\n  return `${protocol}://${resource}/${project}/${repoName}/get/${branch}.tar.gz`;\n}\n\n/**\n * Given a URL pointing to a file on a provider, returns a URL that is suitable\n * for fetching the contents of the data.\n *\n * @remarks\n *\n * Converts\n * from: https://bitbucket.org/orgname/reponame/src/master/file.yaml\n * to:   https://api.bitbucket.org/2.0/repositories/orgname/reponame/src/master/file.yaml\n *\n * @param url - A URL pointing to a file\n * @param config - The relevant provider config\n * @public\n */\nexport function getBitbucketCloudFileFetchUrl(\n  url: string,\n  config: BitbucketCloudIntegrationConfig,\n): string {\n  try {\n    const { owner, name, ref, filepathtype, filepath } = parseGitUrl(url);\n    if (!owner || !name || (filepathtype !== 'src' && filepathtype !== 'raw')) {\n      throw new Error('Invalid Bitbucket Cloud URL or file path');\n    }\n\n    const pathWithoutSlash = filepath.replace(/^\\//, '');\n\n    if (!ref) {\n      throw new Error('Invalid Bitbucket Cloud URL or file path');\n    }\n    return `${config.apiBaseUrl}/repositories/${owner}/${name}/src/${ref}/${pathWithoutSlash}`;\n  } catch (e) {\n    throw new Error(`Incorrect URL: ${url}, ${e}`);\n  }\n}\n\n/**\n * Gets the request options necessary to make requests to a given provider.\n *\n * @param config - The relevant provider config\n * @public\n */\nexport function getBitbucketCloudRequestOptions(\n  config: BitbucketCloudIntegrationConfig,\n): { headers: Record<string, string> } {\n  const headers: Record<string, string> = {};\n\n  if (config.username && config.appPassword) {\n    const buffer = Buffer.from(\n      `${config.username}:${config.appPassword}`,\n      'utf8',\n    );\n    headers.Authorization = `Basic ${buffer.toString('base64')}`;\n  }\n\n  return {\n    headers,\n  };\n}\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { Config } from '@backstage/config';\nimport { trimEnd } from 'lodash';\nimport { isValidHost } from '../helpers';\n\n/**\n * The configuration parameters for a single Bitbucket Server API provider.\n *\n * @public\n */\nexport type BitbucketServerIntegrationConfig = {\n  /**\n   * The host of the target that this matches on, e.g. \"bitbucket.company.com\"\n   */\n  host: string;\n\n  /**\n   * The base URL of the API of this provider, e.g. \"https://<host>/rest/api/1.0\",\n   * with no trailing slash.\n   *\n   * The API will always be preferred if both its base URL and a token are\n   * present.\n   */\n  apiBaseUrl: string;\n\n  /**\n   * The authorization token to use for requests to a Bitbucket Server provider.\n   *\n   * See https://confluence.atlassian.com/bitbucketserver/personal-access-tokens-939515499.html\n   *\n   * If no token is specified, anonymous access is used.\n   */\n  token?: string;\n\n  /**\n   * The credentials for Basic Authentication for requests to a Bitbucket Server provider.\n   *\n   * If `token` was provided, it will be preferred.\n   *\n   * See https://developer.atlassian.com/server/bitbucket/how-tos/command-line-rest/#authentication\n   */\n  username?: string;\n\n  /**\n   * The credentials for Basic Authentication for requests to a Bitbucket Server provider.\n   *\n   * If `token` was provided, it will be preferred.\n   *\n   * See https://developer.atlassian.com/server/bitbucket/how-tos/command-line-rest/#authentication\n   */\n  password?: string;\n};\n\n/**\n * Reads a single Bitbucket Server integration config.\n *\n * @param config - The config object of a single integration\n * @public\n */\nexport function readBitbucketServerIntegrationConfig(\n  config: Config,\n): BitbucketServerIntegrationConfig {\n  const host = config.getString('host');\n  let apiBaseUrl = config.getOptionalString('apiBaseUrl');\n  const token = config.getOptionalString('token');\n  const username = config.getOptionalString('username');\n  const password = config.getOptionalString('password');\n\n  if (!isValidHost(host)) {\n    throw new Error(\n      `Invalid Bitbucket Server integration config, '${host}' is not a valid host`,\n    );\n  }\n\n  if (apiBaseUrl) {\n    apiBaseUrl = trimEnd(apiBaseUrl, '/');\n  } else {\n    apiBaseUrl = `https://${host}/rest/api/1.0`;\n  }\n\n  return {\n    host,\n    apiBaseUrl,\n    token,\n    username,\n    password,\n  };\n}\n\n/**\n * Reads a set of Bitbucket Server integration configs.\n *\n * @param configs - All of the integration config objects\n * @public\n */\nexport function readBitbucketServerIntegrationConfigs(\n  configs: Config[],\n): BitbucketServerIntegrationConfig[] {\n  // Read all the explicit integrations\n  // No default integration will be added\n  return configs.map(readBitbucketServerIntegrationConfig);\n}\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { basicIntegrations, defaultScmResolveUrl } from '../helpers';\nimport { ScmIntegration, ScmIntegrationsFactory } from '../types';\nimport {\n  BitbucketServerIntegrationConfig,\n  readBitbucketServerIntegrationConfigs,\n} from './config';\n\n/**\n * A Bitbucket Server based integration.\n *\n * @public\n */\nexport class BitbucketServerIntegration implements ScmIntegration {\n  static factory: ScmIntegrationsFactory<BitbucketServerIntegration> = ({\n    config,\n  }) => {\n    const configs = readBitbucketServerIntegrationConfigs(\n      config.getOptionalConfigArray('integrations.bitbucketServer') ?? [],\n    );\n    return basicIntegrations(\n      configs.map(c => new BitbucketServerIntegration(c)),\n      i => i.config.host,\n    );\n  };\n\n  constructor(\n    private readonly integrationConfig: BitbucketServerIntegrationConfig,\n  ) {}\n\n  get type(): string {\n    return 'bitbucketServer';\n  }\n\n  get title(): string {\n    return this.integrationConfig.host;\n  }\n\n  get config(): BitbucketServerIntegrationConfig {\n    return this.integrationConfig;\n  }\n\n  resolveUrl(options: {\n    url: string;\n    base: string;\n    lineNumber?: number;\n  }): string {\n    const resolved = defaultScmResolveUrl(options);\n\n    // Bitbucket Server line numbers use the syntax #42, rather than #L42\n    if (options.lineNumber) {\n      const url = new URL(resolved);\n\n      url.hash = options.lineNumber.toString();\n      return url.toString();\n    }\n\n    return resolved;\n  }\n\n  resolveEditUrl(url: string): string {\n    // Bitbucket Server doesn't support deep linking to edit mode, therefore there's nothing to do here.\n    // We just remove query parameters since they cause issues with TechDocs edit button.\n    if (url.includes('?')) {\n      return url.substring(0, url.indexOf('?'));\n    }\n    return url;\n  }\n}\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport fetch from 'cross-fetch';\nimport parseGitUrl from 'git-url-parse';\nimport { BitbucketServerIntegrationConfig } from './config';\n\n/**\n * Given a URL pointing to a path on a provider, returns the default branch.\n *\n * @param url - A URL pointing to a path\n * @param config - The relevant provider config\n * @public\n */\nexport async function getBitbucketServerDefaultBranch(\n  url: string,\n  config: BitbucketServerIntegrationConfig,\n): Promise<string> {\n  const { name: repoName, owner: project } = parseGitUrl(url);\n\n  // Bitbucket Server https://docs.atlassian.com/bitbucket-server/rest/7.9.0/bitbucket-rest.html#idp184\n  let branchUrl = `${config.apiBaseUrl}/projects/${project}/repos/${repoName}/default-branch`;\n\n  let response = await fetch(\n    branchUrl,\n    getBitbucketServerRequestOptions(config),\n  );\n\n  if (response.status === 404) {\n    // First try the new format, and then if it gets specifically a 404 it should try the old format\n    // (to support old  Atlassian Bitbucket Server v5.11.1 format )\n    branchUrl = `${config.apiBaseUrl}/projects/${project}/repos/${repoName}/branches/default`;\n    response = await fetch(branchUrl, getBitbucketServerRequestOptions(config));\n  }\n\n  if (!response.ok) {\n    const message = `Failed to retrieve default branch from ${branchUrl}, ${response.status} ${response.statusText}`;\n    throw new Error(message);\n  }\n\n  const { displayId } = await response.json();\n  const defaultBranch = displayId;\n  if (!defaultBranch) {\n    throw new Error(\n      `Failed to read default branch from ${branchUrl}. ` +\n        `Response ${response.status} ${response.json()}`,\n    );\n  }\n  return defaultBranch;\n}\n\n/**\n * Given a URL pointing to a path on a provider, returns a URL that is suitable\n * for downloading the subtree.\n *\n * @param url - A URL pointing to a path\n * @param config - The relevant provider config\n * @public\n */\nexport async function getBitbucketServerDownloadUrl(\n  url: string,\n  config: BitbucketServerIntegrationConfig,\n): Promise<string> {\n  const { name: repoName, owner: project, ref, filepath } = parseGitUrl(url);\n\n  let branch = ref;\n  if (!branch) {\n    branch = await getBitbucketServerDefaultBranch(url, config);\n  }\n  // path will limit the downloaded content\n  // /docs will only download the docs folder and everything below it\n  // /docs/index.md will download the docs folder and everything below it\n  const path = filepath\n    ? `&path=${encodeURIComponent(decodeURIComponent(filepath))}`\n    : '';\n  return `${config.apiBaseUrl}/projects/${project}/repos/${repoName}/archive?format=tgz&at=${branch}&prefix=${project}-${repoName}${path}`;\n}\n\n/**\n * Given a URL pointing to a file on a provider, returns a URL that is suitable\n * for fetching the contents of the data.\n *\n * @remarks\n *\n * Converts\n * from: https://bitbucket.company.com/projectname/reponame/src/main/file.yaml\n * to:   https://bitbucket.company.com/rest/api/1.0/project/projectname/reponame/raw/file.yaml?at=main\n *\n * @param url - A URL pointing to a file\n * @param config - The relevant provider config\n * @public\n */\nexport function getBitbucketServerFileFetchUrl(\n  url: string,\n  config: BitbucketServerIntegrationConfig,\n): string {\n  try {\n    const { owner, name, ref, filepathtype, filepath } = parseGitUrl(url);\n    if (\n      !owner ||\n      !name ||\n      (filepathtype !== 'browse' &&\n        filepathtype !== 'raw' &&\n        filepathtype !== 'src')\n    ) {\n      throw new Error('Invalid Bitbucket Server URL or file path');\n    }\n\n    const pathWithoutSlash = filepath.replace(/^\\//, '');\n    return `${config.apiBaseUrl}/projects/${owner}/repos/${name}/raw/${pathWithoutSlash}?at=${ref}`;\n  } catch (e) {\n    throw new Error(`Incorrect URL: ${url}, ${e}`);\n  }\n}\n\n/**\n * Gets the request options necessary to make requests to a given provider.\n *\n * @param config - The relevant provider config\n * @public\n */\nexport function getBitbucketServerRequestOptions(\n  config: BitbucketServerIntegrationConfig,\n): { headers: Record<string, string> } {\n  const headers: Record<string, string> = {};\n\n  if (config.token) {\n    headers.Authorization = `Bearer ${config.token}`;\n  } else if (config.username && config.password) {\n    const buffer = Buffer.from(`${config.username}:${config.password}`, 'utf8');\n    headers.Authorization = `Basic ${buffer.toString('base64')}`;\n  }\n\n  return {\n    headers,\n  };\n}\n","/*\n * Copyright 2022 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { Config } from '@backstage/config';\nimport { trimEnd } from 'lodash';\nimport { isValidHost, isValidUrl } from '../helpers';\n\n/**\n * The configuration parameters for a single Gerrit API provider.\n *\n * @public\n */\nexport type GerritIntegrationConfig = {\n  /**\n   * The host of the target that this matches on, e.g. \"gerrit-review.com\"\n   */\n  host: string;\n\n  /**\n   * The optional base URL of the Gerrit instance. It is assumed that https\n   * is used and that the base path is \"/\" on the host. If that is not the\n   * case set the complete base url to the gerrit instance, e.g.\n   * \"https://gerrit-review.com/gerrit\". This is the url that you would open\n   * in a browser.\n   */\n  baseUrl?: string;\n\n  /**\n   * The optional base url to use for cloning a repository. If not set the\n   * baseUrl will be used.\n   */\n  cloneUrl?: string;\n\n  /**\n   * Optional base url for Gitiles. This is needed for creating a valid\n   * user-friendly url that can be used for browsing the content of the\n   * provider. If not set a default value will be created in the same way\n   * as the \"baseUrl\" option.\n   */\n  gitilesBaseUrl?: string;\n\n  /**\n   * The username to use for requests to gerrit.\n   */\n  username?: string;\n\n  /**\n   * The password or http token to use for authentication.\n   */\n  password?: string;\n};\n\n/**\n * Reads a single Gerrit integration config.\n *\n * @param config - The config object of a single integration\n *\n * @public\n */\nexport function readGerritIntegrationConfig(\n  config: Config,\n): GerritIntegrationConfig {\n  const host = config.getString('host');\n  let baseUrl = config.getOptionalString('baseUrl');\n  let cloneUrl = config.getOptionalString('cloneUrl');\n  let gitilesBaseUrl = config.getOptionalString('gitilesBaseUrl');\n  const username = config.getOptionalString('username');\n  const password = config.getOptionalString('password');\n\n  if (!isValidHost(host)) {\n    throw new Error(\n      `Invalid Gerrit integration config, '${host}' is not a valid host`,\n    );\n  } else if (baseUrl && !isValidUrl(baseUrl)) {\n    throw new Error(\n      `Invalid Gerrit integration config, '${baseUrl}' is not a valid baseUrl`,\n    );\n  } else if (cloneUrl && !isValidUrl(cloneUrl)) {\n    throw new Error(\n      `Invalid Gerrit integration config, '${cloneUrl}' is not a valid cloneUrl`,\n    );\n  } else if (gitilesBaseUrl && !isValidUrl(gitilesBaseUrl)) {\n    throw new Error(\n      `Invalid Gerrit integration config, '${gitilesBaseUrl}' is not a valid gitilesBaseUrl`,\n    );\n  }\n  if (baseUrl) {\n    baseUrl = trimEnd(baseUrl, '/');\n  } else {\n    baseUrl = `https://${host}`;\n  }\n  if (gitilesBaseUrl) {\n    gitilesBaseUrl = trimEnd(gitilesBaseUrl, '/');\n  } else {\n    gitilesBaseUrl = `https://${host}`;\n  }\n  if (cloneUrl) {\n    cloneUrl = trimEnd(cloneUrl, '/');\n  } else {\n    cloneUrl = baseUrl;\n  }\n\n  return {\n    host,\n    baseUrl,\n    cloneUrl,\n    gitilesBaseUrl,\n    username,\n    password,\n  };\n}\n\n/**\n * Reads a set of Gerrit integration configs.\n *\n * @param configs - All of the integration config objects\n *\n * @public\n */\nexport function readGerritIntegrationConfigs(\n  configs: Config[],\n): GerritIntegrationConfig[] {\n  return configs.map(readGerritIntegrationConfig);\n}\n","/*\n * Copyright 2022 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport { trimStart } from 'lodash';\nimport { GerritIntegrationConfig } from '.';\n\nconst GERRIT_BODY_PREFIX = \")]}'\";\n\n/**\n * Parse a Gitiles URL and return branch, file path and project.\n *\n * @remarks\n *\n * Gerrit only handles code reviews so it does not have a native way to browse\n * or showing the content of gits. Image if Github only had the \"pull requests\"\n * tab.\n *\n * Any source code browsing is instead handled by optional services outside\n * Gerrit. The url format chosen for the Gerrit url reader is the one used by\n * the Gitiles project. Gerrit will work perfectly with Backstage without\n * having Gitiles installed but there are some places in the Backstage GUI\n * with links to the url used by the url reader. These will not work unless\n * the urls point to an actual Gitiles installation.\n *\n * Gitiles url:\n * https://g.com/optional_path/\\{project\\}/+/refs/heads/\\{branch\\}/\\{filePath\\}\n *\n *\n * @param url - An URL pointing to a file stored in git.\n * @public\n */\n\nexport function parseGerritGitilesUrl(\n  config: GerritIntegrationConfig,\n  url: string,\n): { branch: string; filePath: string; project: string } {\n  const urlPath = url.replace(config.gitilesBaseUrl!, '');\n  const parts = urlPath.split('/').filter(p => !!p);\n\n  const projectEndIndex = parts.indexOf('+');\n\n  if (projectEndIndex <= 0) {\n    throw new Error(`Unable to parse project from url: ${url}`);\n  }\n  const project = trimStart(parts.slice(0, projectEndIndex).join('/'), '/');\n\n  const branchIndex = parts.indexOf('heads');\n  if (branchIndex <= 0) {\n    throw new Error(`Unable to parse branch from url: ${url}`);\n  }\n  const branch = parts[branchIndex + 1];\n  const filePath = parts.slice(branchIndex + 2).join('/');\n\n  return {\n    branch,\n    filePath: filePath === '' ? '/' : filePath,\n    project,\n  };\n}\n\n/**\n * Build a Gerrit Gitiles url that targets a specific path.\n *\n * @param config - A Gerrit provider config.\n * @param project - The name of the git project\n * @param branch - The branch we will target.\n * @param filePath - The absolute file path.\n * @public\n */\nexport function builldGerritGitilesUrl(\n  config: GerritIntegrationConfig,\n  project: string,\n  branch: string,\n  filePath: string,\n): string {\n  return `${\n    config.gitilesBaseUrl\n  }/${project}/+/refs/heads/${branch}/${trimStart(filePath, '/')}`;\n}\n\n/**\n * Return the authentication prefix.\n *\n * @remarks\n *\n * To authenticate with a password the API url must be prefixed with \"/a/\".\n * If no password is set anonymous access (without the prefix) will\n * be used.\n *\n * @param config - A Gerrit provider config.\n * @public\n */\nexport function getAuthenticationPrefix(\n  config: GerritIntegrationConfig,\n): string {\n  return config.password ? '/a/' : '/';\n}\n\n/**\n * Return the url to get branch info from the Gerrit API.\n *\n * @param config - A Gerrit provider config.\n * @param url - An url pointing to a file in git.\n * @public\n */\nexport function getGerritBranchApiUrl(\n  config: GerritIntegrationConfig,\n  url: string,\n) {\n  const { branch, project } = parseGerritGitilesUrl(config, url);\n\n  return `${config.baseUrl}${getAuthenticationPrefix(\n    config,\n  )}projects/${encodeURIComponent(project)}/branches/${branch}`;\n}\n\n/**\n * Return the url to clone the repo that is referenced by the url.\n *\n * @param url - An url pointing to a file in git.\n * @public\n */\nexport function getGerritCloneRepoUrl(\n  config: GerritIntegrationConfig,\n  url: string,\n) {\n  const { project } = parseGerritGitilesUrl(config, url);\n\n  return `${config.cloneUrl}${getAuthenticationPrefix(config)}${project}`;\n}\n\n/**\n * Return the url to fetch the contents of a file using the Gerrit API.\n *\n * @param config - A Gerrit provider config.\n * @param url - An url pointing to a file in git.\n * @public\n */\nexport function getGerritFileContentsApiUrl(\n  config: GerritIntegrationConfig,\n  url: string,\n) {\n  const { branch, filePath, project } = parseGerritGitilesUrl(config, url);\n\n  return `${config.baseUrl}${getAuthenticationPrefix(\n    config,\n  )}projects/${encodeURIComponent(\n    project,\n  )}/branches/${branch}/files/${encodeURIComponent(filePath)}/content`;\n}\n\n/**\n * Return the url to query available projects using the Gerrit API.\n *\n * @param config - A Gerrit provider config.\n * @public\n */\nexport function getGerritProjectsApiUrl(config: GerritIntegrationConfig) {\n  return `${config.baseUrl}${getAuthenticationPrefix(config)}projects/`;\n}\n\n/**\n * Return request headers for a Gerrit provider.\n *\n * @param config - A Gerrit provider config\n * @public\n */\nexport function getGerritRequestOptions(config: GerritIntegrationConfig): {\n  headers?: Record<string, string>;\n} {\n  const headers: Record<string, string> = {};\n\n  if (!config.password) {\n    return headers;\n  }\n  const buffer = Buffer.from(`${config.username}:${config.password}`, 'utf8');\n  headers.Authorization = `Basic ${buffer.toString('base64')}`;\n  return {\n    headers,\n  };\n}\n\n/**\n * Parse the json response from Gerrit and strip the magic prefix.\n *\n * @remarks\n *\n * To prevent against XSSI attacks the JSON response body from Gerrit starts\n * with a magic prefix that must be stripped before it can be fed to a JSON\n * parser.\n *\n * @param response - An API response.\n * @public\n */\nexport async function parseGerritJsonResponse(\n  response: Response,\n): Promise<unknown> {\n  const responseBody = await response.text();\n  if (responseBody.startsWith(GERRIT_BODY_PREFIX)) {\n    try {\n      return JSON.parse(responseBody.slice(GERRIT_BODY_PREFIX.length));\n    } catch (ex) {\n      throw new Error(\n        `Invalid response from Gerrit: ${responseBody.slice(0, 10)} - ${ex}`,\n      );\n    }\n  }\n  throw new Error(\n    `Gerrit JSON body prefix missing. Found: ${responseBody.slice(0, 10)}`,\n  );\n}\n","/*\n * Copyright 2022 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { basicIntegrations } from '../helpers';\nimport { ScmIntegration, ScmIntegrationsFactory } from '../types';\nimport {\n  GerritIntegrationConfig,\n  readGerritIntegrationConfigs,\n} from './config';\nimport { parseGerritGitilesUrl, builldGerritGitilesUrl } from './core';\n\n/**\n * A Gerrit based integration.\n *\n * @public\n */\nexport class GerritIntegration implements ScmIntegration {\n  static factory: ScmIntegrationsFactory<GerritIntegration> = ({ config }) => {\n    const configs = readGerritIntegrationConfigs(\n      config.getOptionalConfigArray('integrations.gerrit') ?? [],\n    );\n    return basicIntegrations(\n      configs.map(c => new GerritIntegration(c)),\n      i => i.config.host,\n    );\n  };\n\n  constructor(private readonly integrationConfig: GerritIntegrationConfig) {}\n\n  get type(): string {\n    return 'gerrit';\n  }\n\n  get title(): string {\n    return this.integrationConfig.host;\n  }\n\n  get config(): GerritIntegrationConfig {\n    return this.integrationConfig;\n  }\n\n  resolveUrl(options: {\n    url: string;\n    base: string;\n    lineNumber?: number;\n  }): string {\n    const { url, base, lineNumber } = options;\n    let updated;\n    if (url.startsWith('/')) {\n      const { branch, project } = parseGerritGitilesUrl(this.config, base);\n      return builldGerritGitilesUrl(this.config, project, branch, url);\n    }\n    if (url) {\n      updated = new URL(url, base);\n    } else {\n      updated = new URL(base);\n    }\n    if (lineNumber) {\n      updated.hash = lineNumber.toString();\n    }\n    return updated.toString();\n  }\n\n  resolveEditUrl(url: string): string {\n    // Not applicable for gerrit.\n    return url;\n  }\n}\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { Config } from '@backstage/config';\nimport { trimEnd } from 'lodash';\nimport { isValidHost } from '../helpers';\n\nconst GITHUB_HOST = 'github.com';\nconst GITHUB_API_BASE_URL = 'https://api.github.com';\nconst GITHUB_RAW_BASE_URL = 'https://raw.githubusercontent.com';\n\n/**\n * The configuration parameters for a single GitHub integration.\n *\n * @public\n */\nexport type GitHubIntegrationConfig = {\n  /**\n   * The host of the target that this matches on, e.g. \"github.com\"\n   */\n  host: string;\n\n  /**\n   * The base URL of the API of this provider, e.g. \"https://api.github.com\",\n   * with no trailing slash.\n   *\n   * May be omitted specifically for GitHub; then it will be deduced.\n   *\n   * The API will always be preferred if both its base URL and a token are\n   * present.\n   */\n  apiBaseUrl?: string;\n\n  /**\n   * The base URL of the raw fetch endpoint of this provider, e.g.\n   * \"https://raw.githubusercontent.com\", with no trailing slash.\n   *\n   * May be omitted specifically for GitHub; then it will be deduced.\n   *\n   * The API will always be preferred if both its base URL and a token are\n   * present.\n   */\n  rawBaseUrl?: string;\n\n  /**\n   * The authorization token to use for requests to this provider.\n   *\n   * If no token is specified, anonymous access is used.\n   */\n  token?: string;\n\n  /**\n   * The GitHub Apps configuration to use for requests to this provider.\n   *\n   * If no apps are specified, token or anonymous is used.\n   */\n  apps?: GithubAppConfig[];\n};\n\n/**\n * The configuration parameters for authenticating a GitHub Application.\n *\n * @remarks\n *\n * A GitHub Apps configuration can be generated using the `backstage-cli create-github-app` command.\n *\n * @public\n */\nexport type GithubAppConfig = {\n  /**\n   * Unique app identifier, found at https://github.com/organizations/$org/settings/apps/$AppName\n   */\n  appId: number;\n  /**\n   * The private key is used by the GitHub App integration to authenticate the app.\n   * A private key can be generated from the app at https://github.com/organizations/$org/settings/apps/$AppName\n   */\n  privateKey: string;\n  /**\n   * Webhook secret can be configured at https://github.com/organizations/$org/settings/apps/$AppName\n   */\n  webhookSecret: string;\n  /**\n   * Found at https://github.com/organizations/$org/settings/apps/$AppName\n   */\n  clientId: string;\n  /**\n   * Client secrets can be generated at https://github.com/organizations/$org/settings/apps/$AppName\n   */\n  clientSecret: string;\n  /**\n   * List of installation owners allowed to be used by this GitHub app. The GitHub UI does not provide a way to list the installations.\n   * However you can list the installations with the GitHub API. You can find the list of installations here:\n   * https://api.github.com/app/installations\n   * The relevant documentation for this is here.\n   * https://docs.github.com/en/rest/reference/apps#list-installations-for-the-authenticated-app--code-samples\n   */\n  allowedInstallationOwners?: string[];\n};\n\n/**\n * Reads a single GitHub integration config.\n *\n * @param config - The config object of a single integration\n * @public\n */\nexport function readGitHubIntegrationConfig(\n  config: Config,\n): GitHubIntegrationConfig {\n  const host = config.getOptionalString('host') ?? GITHUB_HOST;\n  let apiBaseUrl = config.getOptionalString('apiBaseUrl');\n  let rawBaseUrl = config.getOptionalString('rawBaseUrl');\n  const token = config.getOptionalString('token');\n  const apps = config.getOptionalConfigArray('apps')?.map(c => ({\n    appId: c.getNumber('appId'),\n    clientId: c.getString('clientId'),\n    clientSecret: c.getString('clientSecret'),\n    webhookSecret: c.getString('webhookSecret'),\n    privateKey: c.getString('privateKey'),\n    allowedInstallationOwners: c.getOptionalStringArray(\n      'allowedInstallationOwners',\n    ),\n  }));\n\n  if (!isValidHost(host)) {\n    throw new Error(\n      `Invalid GitHub integration config, '${host}' is not a valid host`,\n    );\n  }\n\n  if (apiBaseUrl) {\n    apiBaseUrl = trimEnd(apiBaseUrl, '/');\n  } else if (host === GITHUB_HOST) {\n    apiBaseUrl = GITHUB_API_BASE_URL;\n  }\n\n  if (rawBaseUrl) {\n    rawBaseUrl = trimEnd(rawBaseUrl, '/');\n  } else if (host === GITHUB_HOST) {\n    rawBaseUrl = GITHUB_RAW_BASE_URL;\n  }\n\n  return { host, apiBaseUrl, rawBaseUrl, token, apps };\n}\n\n/**\n * Reads a set of GitHub integration configs, and inserts some defaults for\n * public GitHub if not specified.\n *\n * @param configs - All of the integration config objects\n * @public\n */\nexport function readGitHubIntegrationConfigs(\n  configs: Config[],\n): GitHubIntegrationConfig[] {\n  // First read all the explicit integrations\n  const result = configs.map(readGitHubIntegrationConfig);\n\n  // If no explicit github.com integration was added, put one in the list as\n  // a convenience\n  if (!result.some(c => c.host === GITHUB_HOST)) {\n    result.push({\n      host: GITHUB_HOST,\n      apiBaseUrl: GITHUB_API_BASE_URL,\n      rawBaseUrl: GITHUB_RAW_BASE_URL,\n    });\n  }\n\n  return result;\n}\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport parseGitUrl from 'git-url-parse';\nimport { GitHubIntegrationConfig } from './config';\nimport { GithubCredentials } from './types';\n\n/**\n * Given a URL pointing to a file on a provider, returns a URL that is suitable\n * for fetching the contents of the data.\n *\n * @remarks\n *\n * Converts\n * from: https://github.com/a/b/blob/branchname/path/to/c.yaml\n * to:   https://api.github.com/repos/a/b/contents/path/to/c.yaml?ref=branchname\n * or:   https://raw.githubusercontent.com/a/b/branchname/c.yaml\n *\n * @param url - A URL pointing to a file\n * @param config - The relevant provider config\n * @public\n */\nexport function getGitHubFileFetchUrl(\n  url: string,\n  config: GitHubIntegrationConfig,\n  credentials: GithubCredentials,\n): string {\n  try {\n    const { owner, name, ref, filepathtype, filepath } = parseGitUrl(url);\n    if (\n      !owner ||\n      !name ||\n      !ref ||\n      // GitHub is automatically redirecting tree urls to blob urls so it's\n      // fine to pass a tree url.\n      (filepathtype !== 'blob' &&\n        filepathtype !== 'raw' &&\n        filepathtype !== 'tree')\n    ) {\n      throw new Error('Invalid GitHub URL or file path');\n    }\n\n    const pathWithoutSlash = filepath.replace(/^\\//, '');\n    if (chooseEndpoint(config, credentials) === 'api') {\n      return `${config.apiBaseUrl}/repos/${owner}/${name}/contents/${pathWithoutSlash}?ref=${ref}`;\n    }\n    return `${config.rawBaseUrl}/${owner}/${name}/${ref}/${pathWithoutSlash}`;\n  } catch (e) {\n    throw new Error(`Incorrect URL: ${url}, ${e}`);\n  }\n}\n\n/**\n * Gets the request options necessary to make requests to a given provider.\n *\n * @deprecated This function is no longer used internally\n * @param config - The relevant provider config\n * @public\n */\nexport function getGitHubRequestOptions(\n  config: GitHubIntegrationConfig,\n  credentials: GithubCredentials,\n): { headers: Record<string, string> } {\n  const headers: Record<string, string> = {};\n\n  if (chooseEndpoint(config, credentials) === 'api') {\n    headers.Accept = 'application/vnd.github.v3.raw';\n  }\n\n  if (credentials.token) {\n    headers.Authorization = `token ${credentials.token}`;\n  }\n\n  return { headers };\n}\n\nexport function chooseEndpoint(\n  config: GitHubIntegrationConfig,\n  credentials: GithubCredentials,\n): 'api' | 'raw' {\n  if (config.apiBaseUrl && (credentials.token || !config.rawBaseUrl)) {\n    return 'api';\n  }\n  return 'raw';\n}\n","/*\n * Copyright 2021 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport parseGitUrl from 'git-url-parse';\nimport { GithubAppConfig, GitHubIntegrationConfig } from './config';\nimport { createAppAuth } from '@octokit/auth-app';\nimport { Octokit, RestEndpointMethodTypes } from '@octokit/rest';\nimport { DateTime } from 'luxon';\nimport {\n  GithubCredentials,\n  GithubCredentialsProvider,\n  GithubCredentialType,\n} from './types';\n\ntype InstallationData = {\n  installationId: number;\n  suspended: boolean;\n};\n\ntype InstallationTokenData = {\n  token: string;\n  expiresAt: DateTime;\n  repositories?: String[];\n};\n\nclass Cache {\n  private readonly tokenCache = new Map<string, InstallationTokenData>();\n\n  async getOrCreateToken(\n    owner: string,\n    repo: string | undefined,\n    supplier: () => Promise<InstallationTokenData>,\n  ): Promise<{ accessToken: string }> {\n    let existingInstallationData = this.tokenCache.get(owner);\n\n    if (\n      !existingInstallationData ||\n      this.isExpired(existingInstallationData.expiresAt)\n    ) {\n      existingInstallationData = await supplier();\n      // Allow 10 minutes grace to account for clock skew\n      existingInstallationData.expiresAt =\n        existingInstallationData.expiresAt.minus({ minutes: 10 });\n      this.tokenCache.set(owner, existingInstallationData);\n    }\n\n    if (!this.appliesToRepo(existingInstallationData, repo)) {\n      throw new Error(\n        `The Backstage GitHub application used in the ${owner} organization does not have access to a repository with the name ${repo}`,\n      );\n    }\n\n    return { accessToken: existingInstallationData.token };\n  }\n\n  private isExpired = (date: DateTime) => DateTime.local() > date;\n\n  private appliesToRepo(tokenData: InstallationTokenData, repo?: string) {\n    // If no specific repo has been requested the token is applicable\n    if (repo === undefined) {\n      return true;\n    }\n    // If the token is restricted to repositories, the token only applies if the repo is in the allow list\n    if (tokenData.repositories !== undefined) {\n      return tokenData.repositories.includes(repo);\n    }\n    // Otherwise the token is applicable\n    return true;\n  }\n}\n\n/**\n * This accept header is required when calling App APIs in GitHub Enterprise.\n * It has no effect on calls to github.com and can probably be removed entirely\n * once GitHub Apps is out of preview.\n */\nconst HEADERS = {\n  Accept: 'application/vnd.github.machine-man-preview+json',\n};\n\n/**\n * GithubAppManager issues and caches tokens for a specific GitHub App.\n */\nclass GithubAppManager {\n  private readonly appClient: Octokit;\n  private readonly baseUrl?: string;\n  private readonly baseAuthConfig: { appId: number; privateKey: string };\n  private readonly cache = new Cache();\n  private readonly allowedInstallationOwners: string[] | undefined; // undefined allows all installations\n\n  constructor(config: GithubAppConfig, baseUrl?: string) {\n    this.allowedInstallationOwners = config.allowedInstallationOwners;\n    this.baseUrl = baseUrl;\n    this.baseAuthConfig = {\n      appId: config.appId,\n      privateKey: config.privateKey.replace(/\\\\n/gm, '\\n'),\n    };\n    this.appClient = new Octokit({\n      baseUrl,\n      headers: HEADERS,\n      authStrategy: createAppAuth,\n      auth: this.baseAuthConfig,\n    });\n  }\n\n  async getInstallationCredentials(\n    owner: string,\n    repo?: string,\n  ): Promise<{ accessToken: string | undefined }> {\n    if (this.allowedInstallationOwners) {\n      if (!this.allowedInstallationOwners?.includes(owner)) {\n        return { accessToken: undefined }; // An empty token allows anonymous access to public repos\n      }\n    }\n\n    // Go and grab an access token for the app scoped to a repository if provided, if not use the organisation installation.\n    return this.cache.getOrCreateToken(owner, repo, async () => {\n      const { installationId, suspended } = await this.getInstallationData(\n        owner,\n      );\n      if (suspended) {\n        throw new Error(`The GitHub application for ${owner} is suspended`);\n      }\n\n      const result = await this.appClient.apps.createInstallationAccessToken({\n        installation_id: installationId,\n        headers: HEADERS,\n      });\n\n      let repositoryNames;\n\n      if (result.data.repository_selection === 'selected') {\n        const installationClient = new Octokit({\n          baseUrl: this.baseUrl,\n          auth: result.data.token,\n        });\n        const repos = await installationClient.paginate(\n          installationClient.apps.listReposAccessibleToInstallation,\n        );\n        // The return type of the paginate method is incorrect.\n        const repositories: RestEndpointMethodTypes['apps']['listReposAccessibleToInstallation']['response']['data']['repositories'] =\n          repos.repositories ?? repos;\n\n        repositoryNames = repositories.map(repository => repository.name);\n      }\n      return {\n        token: result.data.token,\n        expiresAt: DateTime.fromISO(result.data.expires_at),\n        repositories: repositoryNames,\n      };\n    });\n  }\n\n  getInstallations(): Promise<\n    RestEndpointMethodTypes['apps']['listInstallations']['response']['data']\n  > {\n    return this.appClient.paginate(this.appClient.apps.listInstallations);\n  }\n\n  private async getInstallationData(owner: string): Promise<InstallationData> {\n    const allInstallations = await this.getInstallations();\n    const installation = allInstallations.find(\n      inst =>\n        inst.account?.login?.toLocaleLowerCase('en-US') ===\n        owner.toLocaleLowerCase('en-US'),\n    );\n    if (installation) {\n      return {\n        installationId: installation.id,\n        suspended: Boolean(installation.suspended_by),\n      };\n    }\n    const notFoundError = new Error(\n      `No app installation found for ${owner} in ${this.baseAuthConfig.appId}`,\n    );\n    notFoundError.name = 'NotFoundError';\n    throw notFoundError;\n  }\n}\n\n/**\n * Corresponds to a Github installation which internally could hold several GitHub Apps.\n *\n * @public\n */\nexport class GithubAppCredentialsMux {\n  private readonly apps: GithubAppManager[];\n\n  constructor(config: GitHubIntegrationConfig) {\n    this.apps =\n      config.apps?.map(ac => new GithubAppManager(ac, config.apiBaseUrl)) ?? [];\n  }\n\n  async getAllInstallations(): Promise<\n    RestEndpointMethodTypes['apps']['listInstallations']['response']['data']\n  > {\n    if (!this.apps.length) {\n      return [];\n    }\n\n    const installs = await Promise.all(\n      this.apps.map(app => app.getInstallations()),\n    );\n\n    return installs.flat();\n  }\n\n  async getAppToken(owner: string, repo?: string): Promise<string | undefined> {\n    if (this.apps.length === 0) {\n      return undefined;\n    }\n\n    const results = await Promise.all(\n      this.apps.map(app =>\n        app.getInstallationCredentials(owner, repo).then(\n          credentials => ({ credentials, error: undefined }),\n          error => ({ credentials: undefined, error }),\n        ),\n      ),\n    );\n\n    const result = results.find(resultItem => resultItem.credentials);\n    if (result) {\n      return result.credentials!.accessToken;\n    }\n\n    const errors = results.map(r => r.error);\n    const notNotFoundError = errors.find(err => err.name !== 'NotFoundError');\n    if (notNotFoundError) {\n      throw notNotFoundError;\n    }\n\n    return undefined;\n  }\n}\n\n/**\n * Handles the creation and caching of credentials for GitHub integrations.\n *\n * @public\n * @remarks\n *\n * TODO: Possibly move this to a backend only package so that it's not used in the frontend by mistake\n */\nexport class SingleInstanceGithubCredentialsProvider\n  implements GithubCredentialsProvider\n{\n  static create: (\n    config: GitHubIntegrationConfig,\n  ) => GithubCredentialsProvider = config => {\n    return new SingleInstanceGithubCredentialsProvider(\n      new GithubAppCredentialsMux(config),\n      config.token,\n    );\n  };\n\n  private constructor(\n    private readonly githubAppCredentialsMux: GithubAppCredentialsMux,\n    private readonly token?: string,\n  ) {}\n\n  /**\n   * Returns {@link GithubCredentials} for a given URL.\n   *\n   * @remarks\n   *\n   * Consecutive calls to this method with the same URL will return cached\n   * credentials.\n   *\n   * The shortest lifetime for a token returned is 10 minutes.\n   *\n   * @example\n   * ```ts\n   * const { token, headers } = await getCredentials({\n   *   url: 'github.com/backstage/foobar'\n   * })\n   * ```\n   *\n   * @param opts - The organization or repository URL\n   * @returns A promise of {@link GithubCredentials}.\n   */\n  async getCredentials(opts: { url: string }): Promise<GithubCredentials> {\n    const parsed = parseGitUrl(opts.url);\n\n    const owner = parsed.owner || parsed.name;\n    const repo = parsed.owner ? parsed.name : undefined;\n\n    let type: GithubCredentialType = 'app';\n    let token = await this.githubAppCredentialsMux.getAppToken(owner, repo);\n    if (!token) {\n      type = 'token';\n      token = this.token;\n    }\n\n    return {\n      headers: token ? { Authorization: `Bearer ${token}` } : undefined,\n      token,\n      type,\n    };\n  }\n}\n","/*\n * Copyright 2021 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { GithubCredentials, GithubCredentialsProvider } from './types';\nimport { ScmIntegrationRegistry } from '../registry';\nimport { SingleInstanceGithubCredentialsProvider } from './SingleInstanceGithubCredentialsProvider';\n\n/**\n * Handles the creation and caching of credentials for GitHub integrations.\n *\n * @public\n * @remarks\n *\n * TODO: Possibly move this to a backend only package so that it's not used in the frontend by mistake\n */\nexport class DefaultGithubCredentialsProvider\n  implements GithubCredentialsProvider\n{\n  static fromIntegrations(integrations: ScmIntegrationRegistry) {\n    const credentialsProviders: Map<string, GithubCredentialsProvider> =\n      new Map<string, GithubCredentialsProvider>();\n\n    integrations.github.list().forEach(integration => {\n      const credentialsProvider =\n        SingleInstanceGithubCredentialsProvider.create(integration.config);\n      credentialsProviders.set(integration.config.host, credentialsProvider);\n    });\n    return new DefaultGithubCredentialsProvider(credentialsProviders);\n  }\n\n  private constructor(\n    private readonly providers: Map<string, GithubCredentialsProvider>,\n  ) {}\n\n  /**\n   * Returns {@link GithubCredentials} for a given URL.\n   *\n   * @remarks\n   *\n   * Consecutive calls to this method with the same URL will return cached\n   * credentials.\n   *\n   * The shortest lifetime for a token returned is 10 minutes.\n   *\n   * @example\n   * ```ts\n   * const { token, headers } = await getCredentials({\n   *   url: 'https://github.com/backstage/foobar'\n   * })\n   *\n   * const { token, headers } = await getCredentials({\n   *   url: 'https://github.com/backstage'\n   * })\n   * ```\n   *\n   * @param opts - The organization or repository URL\n   * @returns A promise of {@link GithubCredentials}.\n   */\n  async getCredentials(opts: { url: string }): Promise<GithubCredentials> {\n    const parsed = new URL(opts.url);\n    const provider = this.providers.get(parsed.host);\n\n    if (!provider) {\n      throw new Error(\n        `There is no GitHub integration that matches ${opts.url}. Please add a configuration for an integration.`,\n      );\n    }\n\n    return provider.getCredentials(opts);\n  }\n}\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { basicIntegrations, defaultScmResolveUrl } from '../helpers';\nimport { ScmIntegration, ScmIntegrationsFactory } from '../types';\nimport {\n  GitHubIntegrationConfig,\n  readGitHubIntegrationConfigs,\n} from './config';\n\n/**\n * A GitHub based integration.\n *\n * @public\n */\nexport class GitHubIntegration implements ScmIntegration {\n  static factory: ScmIntegrationsFactory<GitHubIntegration> = ({ config }) => {\n    const configs = readGitHubIntegrationConfigs(\n      config.getOptionalConfigArray('integrations.github') ?? [],\n    );\n    return basicIntegrations(\n      configs.map(c => new GitHubIntegration(c)),\n      i => i.config.host,\n    );\n  };\n\n  constructor(private readonly integrationConfig: GitHubIntegrationConfig) {}\n\n  get type(): string {\n    return 'github';\n  }\n\n  get title(): string {\n    return this.integrationConfig.host;\n  }\n\n  get config(): GitHubIntegrationConfig {\n    return this.integrationConfig;\n  }\n\n  resolveUrl(options: {\n    url: string;\n    base: string;\n    lineNumber?: number;\n  }): string {\n    // GitHub uses blob URLs for files and tree urls for directory listings. But\n    // there is a redirect from tree to blob for files, so we can always return\n    // tree urls here.\n    return replaceGitHubUrlType(defaultScmResolveUrl(options), 'tree');\n  }\n\n  resolveEditUrl(url: string): string {\n    return replaceGitHubUrlType(url, 'edit');\n  }\n}\n\n/**\n * Takes a GitHub URL and replaces the type part (blob, tree etc).\n *\n * @param url - The original URL\n * @param type - The desired type, e.g. \"blob\"\n * @public\n */\nexport function replaceGitHubUrlType(\n  url: string,\n  type: 'blob' | 'tree' | 'edit',\n): string {\n  return url.replace(\n    /\\/\\/([^/]+)\\/([^/]+)\\/([^/]+)\\/(blob|tree|edit)\\//,\n    (_, host, owner, repo) => {\n      return `//${host}/${owner}/${repo}/${type}/`;\n    },\n  );\n}\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { Config } from '@backstage/config';\nimport { trimEnd } from 'lodash';\nimport { isValidHost, isValidUrl } from '../helpers';\n\nconst GITLAB_HOST = 'gitlab.com';\nconst GITLAB_API_BASE_URL = 'https://gitlab.com/api/v4';\n\n/**\n * The configuration parameters for a single GitLab integration.\n *\n * @public\n */\nexport type GitLabIntegrationConfig = {\n  /**\n   * The host of the target that this matches on, e.g. `gitlab.com`.\n   */\n  host: string;\n\n  /**\n   * The base URL of the API of this provider, e.g.\n   * `https://gitlab.com/api/v4`, with no trailing slash.\n   *\n   * May be omitted specifically for public GitLab; then it will be deduced.\n   */\n  apiBaseUrl: string;\n\n  /**\n   * The authorization token to use for requests to this provider.\n   *\n   * If no token is specified, anonymous access is used.\n   */\n  token?: string;\n\n  /**\n   * The baseUrl of this provider, e.g. `https://gitlab.com`, which is passed\n   * into the GitLab client.\n   *\n   * If no baseUrl is provided, it will default to `https://${host}`\n   */\n  baseUrl: string;\n};\n\n/**\n * Reads a single GitLab integration config.\n *\n * @param config - The config object of a single integration\n * @public\n */\nexport function readGitLabIntegrationConfig(\n  config: Config,\n): GitLabIntegrationConfig {\n  const host = config.getString('host');\n  let apiBaseUrl = config.getOptionalString('apiBaseUrl');\n  const token = config.getOptionalString('token');\n  let baseUrl = config.getOptionalString('baseUrl');\n  if (apiBaseUrl) {\n    apiBaseUrl = trimEnd(apiBaseUrl, '/');\n  } else if (host === GITLAB_HOST) {\n    apiBaseUrl = GITLAB_API_BASE_URL;\n  }\n\n  if (baseUrl) {\n    baseUrl = trimEnd(baseUrl, '/');\n  } else {\n    baseUrl = `https://${host}`;\n  }\n\n  if (!isValidHost(host)) {\n    throw new Error(\n      `Invalid GitLab integration config, '${host}' is not a valid host`,\n    );\n  } else if (!apiBaseUrl || !isValidUrl(apiBaseUrl)) {\n    throw new Error(\n      `Invalid GitLab integration config, '${apiBaseUrl}' is not a valid apiBaseUrl`,\n    );\n  } else if (!isValidUrl(baseUrl)) {\n    throw new Error(\n      `Invalid GitLab integration config, '${baseUrl}' is not a valid baseUrl`,\n    );\n  }\n\n  return { host, token, apiBaseUrl, baseUrl };\n}\n\n/**\n * Reads a set of GitLab integration configs, and inserts some defaults for\n * public GitLab if not specified.\n *\n * @param configs - All of the integration config objects\n * @public\n */\nexport function readGitLabIntegrationConfigs(\n  configs: Config[],\n): GitLabIntegrationConfig[] {\n  // First read all the explicit integrations\n  const result = configs.map(readGitLabIntegrationConfig);\n\n  // As a convenience we always make sure there's at least an unauthenticated\n  // reader for public gitlab repos.\n  if (!result.some(c => c.host === GITLAB_HOST)) {\n    result.push({\n      host: GITLAB_HOST,\n      apiBaseUrl: GITLAB_API_BASE_URL,\n      baseUrl: `https://${GITLAB_HOST}`,\n    });\n  }\n\n  return result;\n}\n\n/**\n * Reads a GitLab integration config, and returns\n * relative path.\n *\n * @param config - GitLabIntegrationConfig object\n * @public\n */\nexport function getGitLabIntegrationRelativePath(\n  config: GitLabIntegrationConfig,\n): string {\n  let relativePath = '';\n  if (config.host !== GITLAB_HOST) {\n    relativePath = new URL(config.baseUrl).pathname;\n  }\n  return trimEnd(relativePath, '/');\n}\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  getGitLabIntegrationRelativePath,\n  GitLabIntegrationConfig,\n} from './config';\nimport fetch from 'cross-fetch';\n\n/**\n * Given a URL pointing to a file on a provider, returns a URL that is suitable\n * for fetching the contents of the data.\n *\n * @remarks\n *\n * Converts\n * from: https://gitlab.example.com/a/b/blob/master/c.yaml\n * to:   https://gitlab.com/api/v4/projects/projectId/repository/c.yaml?ref=master\n * -or-\n * from: https://gitlab.com/groupA/teams/teamA/subgroupA/repoA/-/blob/branch/filepath\n * to:   https://gitlab.com/api/v4/projects/projectId/repository/files/filepath?ref=branch\n *\n * @param url - A URL pointing to a file\n * @param config - The relevant provider config\n * @public\n */\nexport async function getGitLabFileFetchUrl(\n  url: string,\n  config: GitLabIntegrationConfig,\n): Promise<string> {\n  const projectID = await getProjectId(url, config);\n  return buildProjectUrl(url, projectID, config).toString();\n}\n\n/**\n * Gets the request options necessary to make requests to a given provider.\n *\n * @param config - The relevant provider config\n * @public\n */\nexport function getGitLabRequestOptions(config: GitLabIntegrationConfig): {\n  headers: Record<string, string>;\n} {\n  const { token = '' } = config;\n  return {\n    headers: {\n      'PRIVATE-TOKEN': token,\n    },\n  };\n}\n\n// Converts\n// from: https://gitlab.com/groupA/teams/teamA/subgroupA/repoA/-/blob/branch/filepath\n// to:   https://gitlab.com/api/v4/projects/projectId/repository/files/filepath?ref=branch\nexport function buildProjectUrl(\n  target: string,\n  projectID: Number,\n  config: GitLabIntegrationConfig,\n): URL {\n  try {\n    const url = new URL(target);\n\n    const branchAndFilePath = url.pathname\n      .split('/blob/')\n      .slice(1)\n      .join('/blob/');\n    const [branch, ...filePath] = branchAndFilePath.split('/');\n    const relativePath = getGitLabIntegrationRelativePath(config);\n\n    url.pathname = [\n      ...(relativePath ? [relativePath] : []),\n      'api/v4/projects',\n      projectID,\n      'repository/files',\n      encodeURIComponent(decodeURIComponent(filePath.join('/'))),\n      'raw',\n    ].join('/');\n\n    url.search = `?ref=${branch}`;\n\n    return url;\n  } catch (e) {\n    throw new Error(`Incorrect url: ${target}, ${e}`);\n  }\n}\n\n// Convert\n// from: https://gitlab.com/groupA/teams/teamA/subgroupA/repoA/-/blob/branch/filepath\n// to:   The project ID that corresponds to the URL\nexport async function getProjectId(\n  target: string,\n  config: GitLabIntegrationConfig,\n): Promise<number> {\n  const url = new URL(target);\n\n  if (!url.pathname.includes('/blob/')) {\n    throw new Error('Please provide full path to yaml file from GitLab');\n  }\n\n  try {\n    let repo = url.pathname.split('/-/blob/')[0].split('/blob/')[0];\n\n    // Get gitlab relative path\n    const relativePath = getGitLabIntegrationRelativePath(config);\n\n    // Check relative path exist and replace it if it's the case.\n    if (relativePath) {\n      repo = repo.replace(relativePath, '');\n    }\n\n    // Convert\n    // to: https://gitlab.com/api/v4/projects/groupA%2Fteams%2FsubgroupA%2FteamA%2Frepo\n    const repoIDLookup = new URL(\n      `${url.origin}${relativePath}/api/v4/projects/${encodeURIComponent(\n        repo.replace(/^\\//, ''),\n      )}`,\n    );\n\n    const response = await fetch(\n      repoIDLookup.toString(),\n      getGitLabRequestOptions(config),\n    );\n\n    const data = await response.json();\n\n    if (!response.ok) {\n      throw new Error(\n        `GitLab Error '${data.error}', ${data.error_description}`,\n      );\n    }\n\n    return Number(data.id);\n  } catch (e) {\n    throw new Error(`Could not get GitLab project ID for: ${target}, ${e}`);\n  }\n}\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { basicIntegrations, defaultScmResolveUrl } from '../helpers';\nimport { ScmIntegration, ScmIntegrationsFactory } from '../types';\nimport {\n  GitLabIntegrationConfig,\n  readGitLabIntegrationConfigs,\n} from './config';\n\n/**\n * A GitLab based integration.\n *\n * @public\n */\nexport class GitLabIntegration implements ScmIntegration {\n  static factory: ScmIntegrationsFactory<GitLabIntegration> = ({ config }) => {\n    const configs = readGitLabIntegrationConfigs(\n      config.getOptionalConfigArray('integrations.gitlab') ?? [],\n    );\n    return basicIntegrations(\n      configs.map(c => new GitLabIntegration(c)),\n      i => i.config.host,\n    );\n  };\n\n  constructor(private readonly integrationConfig: GitLabIntegrationConfig) {}\n\n  get type(): string {\n    return 'gitlab';\n  }\n\n  get title(): string {\n    return this.integrationConfig.host;\n  }\n\n  get config(): GitLabIntegrationConfig {\n    return this.integrationConfig;\n  }\n\n  resolveUrl(options: {\n    url: string;\n    base: string;\n    lineNumber?: number;\n  }): string {\n    return defaultScmResolveUrl(options);\n  }\n\n  resolveEditUrl(url: string): string {\n    return replaceGitLabUrlType(url, 'edit');\n  }\n}\n\n/**\n * Takes a GitLab URL and replaces the type part (blob, tree etc).\n *\n * @param url - The original URL\n * @param type - The desired type, e.g. 'blob', 'tree', 'edit'\n * @public\n */\nexport function replaceGitLabUrlType(\n  url: string,\n  type: 'blob' | 'tree' | 'edit',\n): string {\n  return url.replace(/\\/\\-\\/(blob|tree|edit)\\//, `/-/${type}/`);\n}\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { Config } from '@backstage/config';\nimport { AwsS3Integration } from './awsS3/AwsS3Integration';\nimport { AzureIntegration } from './azure/AzureIntegration';\nimport { BitbucketCloudIntegration } from './bitbucketCloud/BitbucketCloudIntegration';\nimport { BitbucketIntegration } from './bitbucket/BitbucketIntegration';\nimport { BitbucketServerIntegration } from './bitbucketServer/BitbucketServerIntegration';\nimport { GerritIntegration } from './gerrit/GerritIntegration';\nimport { GitHubIntegration } from './github/GitHubIntegration';\nimport { GitLabIntegration } from './gitlab/GitLabIntegration';\nimport { defaultScmResolveUrl } from './helpers';\nimport { ScmIntegration, ScmIntegrationsGroup } from './types';\nimport { ScmIntegrationRegistry } from './registry';\n\n/**\n * The set of supported integrations.\n *\n * @public\n */\nexport interface IntegrationsByType {\n  awsS3: ScmIntegrationsGroup<AwsS3Integration>;\n  azure: ScmIntegrationsGroup<AzureIntegration>;\n  /**\n   * @deprecated in favor of `bitbucketCloud` and `bitbucketServer`\n   */\n  bitbucket: ScmIntegrationsGroup<BitbucketIntegration>;\n  bitbucketCloud: ScmIntegrationsGroup<BitbucketCloudIntegration>;\n  bitbucketServer: ScmIntegrationsGroup<BitbucketServerIntegration>;\n  gerrit: ScmIntegrationsGroup<GerritIntegration>;\n  github: ScmIntegrationsGroup<GitHubIntegration>;\n  gitlab: ScmIntegrationsGroup<GitLabIntegration>;\n}\n\n/**\n * Exposes the set of supported integrations.\n *\n * @public\n */\nexport class ScmIntegrations implements ScmIntegrationRegistry {\n  private readonly byType: IntegrationsByType;\n\n  static fromConfig(config: Config): ScmIntegrations {\n    return new ScmIntegrations({\n      awsS3: AwsS3Integration.factory({ config }),\n      azure: AzureIntegration.factory({ config }),\n      bitbucket: BitbucketIntegration.factory({ config }),\n      bitbucketCloud: BitbucketCloudIntegration.factory({ config }),\n      bitbucketServer: BitbucketServerIntegration.factory({ config }),\n      gerrit: GerritIntegration.factory({ config }),\n      github: GitHubIntegration.factory({ config }),\n      gitlab: GitLabIntegration.factory({ config }),\n    });\n  }\n\n  constructor(integrationsByType: IntegrationsByType) {\n    this.byType = integrationsByType;\n  }\n\n  get awsS3(): ScmIntegrationsGroup<AwsS3Integration> {\n    return this.byType.awsS3;\n  }\n\n  get azure(): ScmIntegrationsGroup<AzureIntegration> {\n    return this.byType.azure;\n  }\n\n  /**\n   * @deprecated in favor of `bitbucketCloud()` and `bitbucketServer()`\n   */\n  get bitbucket(): ScmIntegrationsGroup<BitbucketIntegration> {\n    return this.byType.bitbucket;\n  }\n\n  get bitbucketCloud(): ScmIntegrationsGroup<BitbucketCloudIntegration> {\n    return this.byType.bitbucketCloud;\n  }\n\n  get bitbucketServer(): ScmIntegrationsGroup<BitbucketServerIntegration> {\n    return this.byType.bitbucketServer;\n  }\n\n  get gerrit(): ScmIntegrationsGroup<GerritIntegration> {\n    return this.byType.gerrit;\n  }\n\n  get github(): ScmIntegrationsGroup<GitHubIntegration> {\n    return this.byType.github;\n  }\n\n  get gitlab(): ScmIntegrationsGroup<GitLabIntegration> {\n    return this.byType.gitlab;\n  }\n\n  list(): ScmIntegration[] {\n    return Object.values(this.byType).flatMap(\n      i => i.list() as ScmIntegration[],\n    );\n  }\n\n  byUrl(url: string | URL): ScmIntegration | undefined {\n    let candidates = Object.values(this.byType)\n      .map(i => i.byUrl(url))\n      .filter(Boolean);\n\n    // Do not return deprecated integrations if there are other options\n    if (candidates.length > 1) {\n      const filteredCandidates = candidates.filter(\n        x => !(x instanceof BitbucketIntegration),\n      );\n      if (filteredCandidates.length !== 0) {\n        candidates = filteredCandidates;\n      }\n    }\n\n    return candidates[0];\n  }\n\n  byHost(host: string): ScmIntegration | undefined {\n    return Object.values(this.byType)\n      .map(i => i.byHost(host))\n      .find(Boolean);\n  }\n\n  resolveUrl(options: {\n    url: string;\n    base: string;\n    lineNumber?: number;\n  }): string {\n    const integration = this.byUrl(options.base);\n    if (!integration) {\n      return defaultScmResolveUrl(options);\n    }\n\n    return integration.resolveUrl(options);\n  }\n\n  resolveEditUrl(url: string): string {\n    const integration = this.byUrl(url);\n    if (!integration) {\n      return url;\n    }\n\n    return integration.resolveEditUrl(url);\n  }\n}\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { CompoundEntityRef } from '@backstage/catalog-model';\nimport {\n  TechDocsEntityMetadata,\n  TechDocsMetadata,\n} from '@backstage/plugin-techdocs-react';\nimport { createApiRef } from '@backstage/core-plugin-api';\n\n/**\n * Utility API reference for the {@link TechDocsStorageApi}.\n *\n * @public\n * @deprecated Import from `@backstage/plugin-techdocs-react` instead\n */\nexport const techdocsStorageApiRef = createApiRef<TechDocsStorageApi>({\n  id: 'plugin.techdocs.storageservice',\n});\n\n/**\n * Utility API reference for the {@link TechDocsApi}.\n *\n * @public\n * @deprecated Import from `@backstage/plugin-techdocs-react` instead\n */\nexport const techdocsApiRef = createApiRef<TechDocsApi>({\n  id: 'plugin.techdocs.service',\n});\n\n/**\n * The outcome of a docs sync operation.\n *\n * @public\n * @deprecated Import from `@backstage/plugin-techdocs-react` instead\n */\nexport type SyncResult = 'cached' | 'updated';\n\n/**\n * API which talks to TechDocs storage to fetch files to render.\n *\n * @public\n * @deprecated Import from `@backstage/plugin-techdocs-react` instead\n */\nexport interface TechDocsStorageApi {\n  getApiOrigin(): Promise<string>;\n  getStorageUrl(): Promise<string>;\n  getBuilder(): Promise<string>;\n  getEntityDocs(entityId: CompoundEntityRef, path: string): Promise<string>;\n  syncEntityDocs(\n    entityId: CompoundEntityRef,\n    logHandler?: (line: string) => void,\n  ): Promise<SyncResult>;\n  getBaseUrl(\n    oldBaseUrl: string,\n    entityId: CompoundEntityRef,\n    path: string,\n  ): Promise<string>;\n}\n\n/**\n * API to talk to techdocs-backend.\n *\n * @public\n * @deprecated Import from `@backstage/plugin-techdocs-react` instead\n */\nexport interface TechDocsApi {\n  getApiOrigin(): Promise<string>;\n  getTechDocsMetadata(entityId: CompoundEntityRef): Promise<TechDocsMetadata>;\n  getEntityMetadata(\n    entityId: CompoundEntityRef,\n  ): Promise<TechDocsEntityMetadata>;\n}\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { ApiRef, ApiHolder } from '@backstage/core-plugin-api';\n\n/**\n * An ApiHolder that queries multiple other holders from for\n * an Api implementation, returning the first one encountered..\n */\nexport class ApiAggregator implements ApiHolder {\n  private readonly holders: ApiHolder[];\n\n  constructor(...holders: ApiHolder[]) {\n    this.holders = holders;\n  }\n\n  get<T>(apiRef: ApiRef<T>): T | undefined {\n    for (const holder of this.holders) {\n      const api = holder.get(apiRef);\n      if (api) {\n        return api;\n      }\n    }\n    return undefined;\n  }\n}\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React, { useContext, ReactNode, PropsWithChildren } from 'react';\nimport PropTypes from 'prop-types';\nimport { ApiHolder } from '@backstage/core-plugin-api';\nimport { ApiAggregator } from './ApiAggregator';\nimport {\n  createVersionedValueMap,\n  createVersionedContext,\n} from '@backstage/version-bridge';\n\n/**\n * Prop types for the ApiProvider component.\n * @public\n */\nexport type ApiProviderProps = {\n  apis: ApiHolder;\n  children: ReactNode;\n};\n\nconst ApiContext = createVersionedContext<{ 1: ApiHolder }>('api-context');\n\n/**\n * Provides an {@link @backstage/core-plugin-api#ApiHolder} for consumption in\n * the React tree.\n *\n * @public\n */\nexport const ApiProvider = (props: PropsWithChildren<ApiProviderProps>) => {\n  const { apis, children } = props;\n  const parentHolder = useContext(ApiContext)?.atVersion(1);\n  const holder = parentHolder ? new ApiAggregator(apis, parentHolder) : apis;\n\n  return (\n    <ApiContext.Provider\n      value={createVersionedValueMap({ 1: holder })}\n      children={children}\n    />\n  );\n};\n\nApiProvider.propTypes = {\n  apis: PropTypes.shape({ get: PropTypes.func.isRequired }).isRequired,\n  children: PropTypes.node,\n};\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  ApiRef,\n  ApiHolder,\n  AnyApiRef,\n  TypesToApiRefs,\n} from '@backstage/core-plugin-api';\nimport { ApiFactoryHolder } from './types';\n\n/**\n * Handles the actual on-demand instantiation and memoization of APIs out of\n * an {@link ApiFactoryHolder}.\n *\n * @public\n */\nexport class ApiResolver implements ApiHolder {\n  /**\n   * Validate factories by making sure that each of the apis can be created\n   * without hitting any circular dependencies.\n   */\n  static validateFactories(\n    factories: ApiFactoryHolder,\n    apis: Iterable<AnyApiRef>,\n  ) {\n    for (const api of apis) {\n      const heap = [api];\n      const allDeps = new Set<AnyApiRef>();\n\n      while (heap.length) {\n        const apiRef = heap.shift()!;\n        const factory = factories.get(apiRef);\n        if (!factory) {\n          continue;\n        }\n\n        for (const dep of Object.values(factory.deps)) {\n          if (dep.id === api.id) {\n            throw new Error(`Circular dependency of api factory for ${api}`);\n          }\n          if (!allDeps.has(dep)) {\n            allDeps.add(dep);\n            heap.push(dep);\n          }\n        }\n      }\n    }\n  }\n\n  private readonly apis = new Map<string, unknown>();\n\n  constructor(private readonly factories: ApiFactoryHolder) {}\n\n  get<T>(ref: ApiRef<T>): T | undefined {\n    return this.load(ref);\n  }\n\n  private load<T>(ref: ApiRef<T>, loading: AnyApiRef[] = []): T | undefined {\n    const impl = this.apis.get(ref.id);\n    if (impl) {\n      return impl as T;\n    }\n\n    const factory = this.factories.get(ref);\n    if (!factory) {\n      return undefined;\n    }\n\n    if (loading.includes(factory.api)) {\n      throw new Error(`Circular dependency of api factory for ${factory.api}`);\n    }\n\n    const deps = this.loadDeps(ref, factory.deps, [...loading, factory.api]);\n    const api = factory.factory(deps);\n    this.apis.set(ref.id, api);\n    return api as T;\n  }\n\n  private loadDeps<T>(\n    dependent: ApiRef<unknown>,\n    apis: TypesToApiRefs<T>,\n    loading: AnyApiRef[],\n  ): T {\n    const impls = {} as T;\n\n    for (const key in apis) {\n      if (apis.hasOwnProperty(key)) {\n        const ref = apis[key];\n\n        const api = this.load(ref, loading);\n        if (!api) {\n          throw new Error(\n            `No API factory available for dependency ${ref} of dependent ${dependent}`,\n          );\n        }\n        impls[key] = api;\n      }\n    }\n\n    return impls;\n  }\n}\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { ApiFactoryHolder } from './types';\nimport {\n  ApiRef,\n  ApiFactory,\n  AnyApiRef,\n  AnyApiFactory,\n} from '@backstage/core-plugin-api';\n\n/**\n * Scope type when registering API factories.\n * @public\n */\nexport type ApiFactoryScope =\n  | 'default' // Default factories registered by core and plugins\n  | 'app' // Factories registered in the app, overriding default ones\n  | 'static'; // APIs that can't be overridden, e.g. config\n\nenum ScopePriority {\n  default = 10,\n  app = 50,\n  static = 100,\n}\n\ntype FactoryTuple = {\n  priority: number;\n  factory: AnyApiFactory;\n};\n\n/**\n * ApiFactoryRegistry is an ApiFactoryHolder implementation that enables\n * registration of API Factories with different scope.\n *\n * Each scope has an assigned priority, where factories registered with\n * higher priority scopes override ones with lower priority.\n *\n * @public\n */\nexport class ApiFactoryRegistry implements ApiFactoryHolder {\n  private readonly factories = new Map<string, FactoryTuple>();\n\n  /**\n   * Register a new API factory. Returns true if the factory was added\n   * to the registry.\n   *\n   * A factory will not be added to the registry if there is already\n   * an existing factory with the same or higher priority.\n   */\n  register<Api, Impl extends Api, Deps extends { [name in string]: unknown }>(\n    scope: ApiFactoryScope,\n    factory: ApiFactory<Api, Impl, Deps>,\n  ) {\n    const priority = ScopePriority[scope];\n    const existing = this.factories.get(factory.api.id);\n    if (existing && existing.priority >= priority) {\n      return false;\n    }\n\n    this.factories.set(factory.api.id, { priority, factory });\n    return true;\n  }\n\n  get<T>(\n    api: ApiRef<T>,\n  ): ApiFactory<T, T, { [x: string]: unknown }> | undefined {\n    const tuple = this.factories.get(api.id);\n    if (!tuple) {\n      return undefined;\n    }\n    return tuple.factory as ApiFactory<T, T, { [x: string]: unknown }>;\n  }\n\n  getAllApis(): Set<AnyApiRef> {\n    const refs = new Set<AnyApiRef>();\n    for (const { factory } of this.factories.values()) {\n      refs.add(factory.api);\n    }\n    return refs;\n  }\n}\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/**\n * Options used to open a login popup.\n */\nexport type LoginPopupOptions = {\n  /**\n   * The URL that the auth popup should point to\n   */\n  url: string;\n\n  /**\n   * The name of the popup, as in second argument to window.open\n   */\n  name: string;\n\n  /**\n   * The origin of the final popup page that will post a message to this window.\n   */\n  origin: string;\n\n  /**\n   * The width of the popup in pixels, defaults to 500\n   */\n  width?: number;\n\n  /**\n   * The height of the popup in pixels, defaults to 700\n   */\n  height?: number;\n};\n\ntype AuthResult =\n  | {\n      type: 'authorization_response';\n      response: unknown;\n    }\n  | {\n      type: 'authorization_response';\n      error: {\n        name: string;\n        message: string;\n      };\n    };\n\n/**\n * Show a popup pointing to a URL that starts an auth flow. Implementing the receiving\n * end of the postMessage mechanism outlined in https://tools.ietf.org/html/draft-sakimura-oauth-wmrm-00\n *\n * The redirect handler of the flow should use postMessage to communicate back\n * to the app window. The message posted to the app must match the AuthResult type.\n *\n * The returned promise resolves to the response of the message that was posted from the auth popup.\n */\nexport function showLoginPopup(options: LoginPopupOptions): Promise<any> {\n  return new Promise((resolve, reject) => {\n    const width = options.width || 500;\n    const height = options.height || 700;\n    const left = window.screen.width / 2 - width / 2;\n    const top = window.screen.height / 2 - height / 2;\n\n    const popup = window.open(\n      options.url,\n      options.name,\n      `menubar=no,location=no,resizable=no,scrollbars=no,status=no,width=${width},height=${height},top=${top},left=${left}`,\n    );\n\n    let targetOrigin = '';\n\n    if (!popup || typeof popup.closed === 'undefined' || popup.closed) {\n      const error = new Error('Failed to open auth popup.');\n      error.name = 'PopupRejectedError';\n      reject(error);\n      return;\n    }\n\n    const messageListener = (event: MessageEvent) => {\n      if (event.source !== popup) {\n        return;\n      }\n      if (event.origin !== options.origin) {\n        return;\n      }\n      const { data } = event;\n\n      if (data.type === 'config_info') {\n        targetOrigin = data.targetOrigin;\n        return;\n      }\n\n      if (data.type !== 'authorization_response') {\n        return;\n      }\n      const authResult = data as AuthResult;\n\n      if ('error' in authResult) {\n        const error = new Error(authResult.error.message);\n        error.name = authResult.error.name;\n        // TODO: proper error type\n        // error.extra = authResult.error.extra;\n        reject(error);\n      } else {\n        resolve(authResult.response);\n      }\n      done();\n    };\n\n    const intervalId = setInterval(() => {\n      if (popup.closed) {\n        const errMessage = `Login failed, ${\n          targetOrigin && targetOrigin !== window.location.origin\n            ? `Incorrect app origin, expected ${targetOrigin}`\n            : 'popup was closed'\n        }`;\n        const error = new Error(errMessage);\n        error.name = 'PopupClosedError';\n        reject(error);\n        done();\n      }\n    }, 100);\n\n    function done() {\n      window.removeEventListener('message', messageListener);\n      clearInterval(intervalId);\n    }\n\n    window.addEventListener('message', messageListener);\n  });\n}\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  OAuthRequester,\n  OAuthRequestApi,\n  AuthProviderInfo,\n  DiscoveryApi,\n} from '@backstage/core-plugin-api';\nimport { showLoginPopup } from '../loginPopup';\nimport { AuthConnector, CreateSessionOptions } from './types';\n\ntype Options<AuthSession> = {\n  /**\n   * DiscoveryApi instance used to locate the auth backend endpoint.\n   */\n  discoveryApi: DiscoveryApi;\n  /**\n   * Environment hint passed on to auth backend, for example 'production' or 'development'\n   */\n  environment: string;\n  /**\n   * Information about the auth provider to be shown to the user.\n   * The ID Must match the backend auth plugin configuration, for example 'google'.\n   */\n  provider: AuthProviderInfo;\n  /**\n   * API used to instantiate an auth requester.\n   */\n  oauthRequestApi: OAuthRequestApi;\n  /**\n   * Function used to join together a set of scopes, defaults to joining with a space character.\n   */\n  joinScopes?: (scopes: Set<string>) => string;\n  /**\n   * Function used to transform an auth response into the session type.\n   */\n  sessionTransform?(response: any): AuthSession | Promise<AuthSession>;\n};\n\nfunction defaultJoinScopes(scopes: Set<string>) {\n  return [...scopes].join(' ');\n}\n\n/**\n * DefaultAuthConnector is the default auth connector in Backstage. It talks to the\n * backend auth plugin through the standardized API, and requests user permission\n * via the OAuthRequestApi.\n */\nexport class DefaultAuthConnector<AuthSession>\n  implements AuthConnector<AuthSession>\n{\n  private readonly discoveryApi: DiscoveryApi;\n  private readonly environment: string;\n  private readonly provider: AuthProviderInfo;\n  private readonly joinScopesFunc: (scopes: Set<string>) => string;\n  private readonly authRequester: OAuthRequester<AuthSession>;\n  private readonly sessionTransform: (response: any) => Promise<AuthSession>;\n\n  constructor(options: Options<AuthSession>) {\n    const {\n      discoveryApi,\n      environment,\n      provider,\n      joinScopes = defaultJoinScopes,\n      oauthRequestApi,\n      sessionTransform = id => id,\n    } = options;\n\n    this.authRequester = oauthRequestApi.createAuthRequester({\n      provider,\n      onAuthRequest: scopes => this.showPopup(scopes),\n    });\n\n    this.discoveryApi = discoveryApi;\n    this.environment = environment;\n    this.provider = provider;\n    this.joinScopesFunc = joinScopes;\n    this.sessionTransform = sessionTransform;\n  }\n\n  async createSession(options: CreateSessionOptions): Promise<AuthSession> {\n    if (options.instantPopup) {\n      return this.showPopup(options.scopes);\n    }\n    return this.authRequester(options.scopes);\n  }\n\n  async refreshSession(): Promise<any> {\n    const res = await fetch(\n      await this.buildUrl('/refresh', { optional: true }),\n      {\n        headers: {\n          'x-requested-with': 'XMLHttpRequest',\n        },\n        credentials: 'include',\n      },\n    ).catch(error => {\n      throw new Error(`Auth refresh request failed, ${error}`);\n    });\n\n    if (!res.ok) {\n      const error: any = new Error(\n        `Auth refresh request failed, ${res.statusText}`,\n      );\n      error.status = res.status;\n      throw error;\n    }\n\n    const authInfo = await res.json();\n\n    if (authInfo.error) {\n      const error = new Error(authInfo.error.message);\n      if (authInfo.error.name) {\n        error.name = authInfo.error.name;\n      }\n      throw error;\n    }\n    return await this.sessionTransform(authInfo);\n  }\n\n  async removeSession(): Promise<void> {\n    const res = await fetch(await this.buildUrl('/logout'), {\n      method: 'POST',\n      headers: {\n        'x-requested-with': 'XMLHttpRequest',\n      },\n      credentials: 'include',\n    }).catch(error => {\n      throw new Error(`Logout request failed, ${error}`);\n    });\n\n    if (!res.ok) {\n      const error: any = new Error(`Logout request failed, ${res.statusText}`);\n      error.status = res.status;\n      throw error;\n    }\n  }\n\n  private async showPopup(scopes: Set<string>): Promise<AuthSession> {\n    const scope = this.joinScopesFunc(scopes);\n    const popupUrl = await this.buildUrl('/start', {\n      scope,\n      origin: location.origin,\n    });\n\n    const payload = await showLoginPopup({\n      url: popupUrl,\n      name: `${this.provider.title} Login`,\n      origin: new URL(popupUrl).origin,\n      width: 450,\n      height: 730,\n    });\n\n    return await this.sessionTransform(payload);\n  }\n\n  private async buildUrl(\n    path: string,\n    query?: { [key: string]: string | boolean | undefined },\n  ): Promise<string> {\n    const baseUrl = await this.discoveryApi.getBaseUrl('auth');\n    const queryString = this.buildQueryString({\n      ...query,\n      env: this.environment,\n    });\n\n    return `${baseUrl}/${this.provider.id}${path}${queryString}`;\n  }\n\n  private buildQueryString(query?: {\n    [key: string]: string | boolean | undefined;\n  }): string {\n    if (!query) {\n      return '';\n    }\n\n    const queryString = Object.entries<string | boolean | undefined>(query)\n      .map(([key, value]) => {\n        if (typeof value === 'string') {\n          return `${encodeURIComponent(key)}=${encodeURIComponent(value)}`;\n        } else if (value) {\n          return encodeURIComponent(key);\n        }\n        return undefined;\n      })\n      .filter(Boolean)\n      .join('&');\n\n    if (!queryString) {\n      return '';\n    }\n    return `?${queryString}`;\n  }\n}\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { SessionScopesFunc } from './types';\n\nexport function hasScopes(\n  searched: Set<string>,\n  searchFor: Set<string>,\n): boolean {\n  for (const scope of searchFor) {\n    if (!searched.has(scope)) {\n      return false;\n    }\n  }\n  return true;\n}\n\ntype ScopeHelperOptions<T> = {\n  sessionScopes: SessionScopesFunc<T> | undefined;\n  defaultScopes?: Set<string>;\n};\n\nexport class SessionScopeHelper<T> {\n  constructor(private readonly options: ScopeHelperOptions<T>) {}\n\n  sessionExistsAndHasScope(\n    session: T | undefined,\n    scopes?: Set<string>,\n  ): boolean {\n    if (!session) {\n      return false;\n    }\n    if (!scopes) {\n      return true;\n    }\n    if (this.options.sessionScopes === undefined) {\n      return true;\n    }\n    const sessionScopes = this.options.sessionScopes(session);\n    return hasScopes(sessionScopes, scopes);\n  }\n\n  getExtendedScope(session: T | undefined, scopes?: Set<string>) {\n    const newScope = new Set(this.options.defaultScopes);\n    if (session && this.options.sessionScopes !== undefined) {\n      const sessionScopes = this.options.sessionScopes(session);\n      for (const scope of sessionScopes) {\n        newScope.add(scope);\n      }\n    }\n    if (scopes) {\n      for (const scope of scopes) {\n        newScope.add(scope);\n      }\n    }\n    return newScope;\n  }\n}\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { Observable } from '@backstage/types';\nimport ObservableImpl from 'zen-observable';\n\n// TODO(Rugvip): These are stopgap and probably incomplete implementations of subjects.\n// If we add a more complete Observables library they should be replaced.\n\n/**\n * A basic implementation of ReactiveX publish subjects.\n *\n * A subject is a convenient way to create an observable when you want\n * to fan out a single value to all subscribers.\n *\n * See http://reactivex.io/documentation/subject.html\n */\nexport class PublishSubject<T>\n  implements Observable<T>, ZenObservable.SubscriptionObserver<T>\n{\n  private isClosed = false;\n  private terminatingError?: Error;\n\n  private readonly observable = new ObservableImpl<T>(subscriber => {\n    if (this.isClosed) {\n      if (this.terminatingError) {\n        subscriber.error(this.terminatingError);\n      } else {\n        subscriber.complete();\n      }\n      return () => {};\n    }\n\n    this.subscribers.add(subscriber);\n    return () => {\n      this.subscribers.delete(subscriber);\n    };\n  });\n\n  private readonly subscribers = new Set<\n    ZenObservable.SubscriptionObserver<T>\n  >();\n\n  [Symbol.observable]() {\n    return this;\n  }\n\n  get closed() {\n    return this.isClosed;\n  }\n\n  next(value: T) {\n    if (this.isClosed) {\n      throw new Error('PublishSubject is closed');\n    }\n    this.subscribers.forEach(subscriber => subscriber.next(value));\n  }\n\n  error(error: Error) {\n    if (this.isClosed) {\n      throw new Error('PublishSubject is closed');\n    }\n    this.isClosed = true;\n    this.terminatingError = error;\n    this.subscribers.forEach(subscriber => subscriber.error(error));\n  }\n\n  complete() {\n    if (this.isClosed) {\n      throw new Error('PublishSubject is closed');\n    }\n    this.isClosed = true;\n    this.subscribers.forEach(subscriber => subscriber.complete());\n  }\n\n  subscribe(observer: ZenObservable.Observer<T>): ZenObservable.Subscription;\n  subscribe(\n    onNext: (value: T) => void,\n    onError?: (error: any) => void,\n    onComplete?: () => void,\n  ): ZenObservable.Subscription;\n  subscribe(\n    onNext: ZenObservable.Observer<T> | ((value: T) => void),\n    onError?: (error: any) => void,\n    onComplete?: () => void,\n  ): ZenObservable.Subscription {\n    const observer =\n      typeof onNext === 'function'\n        ? {\n            next: onNext,\n            error: onError,\n            complete: onComplete,\n          }\n        : onNext;\n\n    return this.observable.subscribe(observer);\n  }\n}\n\n/**\n * A basic implementation of ReactiveX behavior subjects.\n *\n * A subject is a convenient way to create an observable when you want\n * to fan out a single value to all subscribers.\n *\n * The BehaviorSubject will emit the most recently emitted value or error\n * whenever a new observer subscribes to the subject.\n *\n * See http://reactivex.io/documentation/subject.html\n */\n\nexport class BehaviorSubject<T>\n  implements Observable<T>, ZenObservable.SubscriptionObserver<T>\n{\n  private isClosed: boolean;\n  private currentValue: T;\n  private terminatingError: Error | undefined;\n  private readonly observable: Observable<T>;\n\n  constructor(value: T) {\n    this.isClosed = false;\n    this.currentValue = value;\n    this.terminatingError = undefined;\n    this.observable = new ObservableImpl<T>(subscriber => {\n      if (this.isClosed) {\n        if (this.terminatingError) {\n          subscriber.error(this.terminatingError);\n        } else {\n          subscriber.complete();\n        }\n        return () => {};\n      }\n\n      subscriber.next(this.currentValue);\n\n      this.subscribers.add(subscriber);\n      return () => {\n        this.subscribers.delete(subscriber);\n      };\n    });\n  }\n\n  private readonly subscribers = new Set<\n    ZenObservable.SubscriptionObserver<T>\n  >();\n\n  [Symbol.observable]() {\n    return this;\n  }\n\n  get closed() {\n    return this.isClosed;\n  }\n\n  next(value: T) {\n    if (this.isClosed) {\n      throw new Error('BehaviorSubject is closed');\n    }\n    this.currentValue = value;\n    this.subscribers.forEach(subscriber => subscriber.next(value));\n  }\n\n  error(error: Error) {\n    if (this.isClosed) {\n      throw new Error('BehaviorSubject is closed');\n    }\n    this.isClosed = true;\n    this.terminatingError = error;\n    this.subscribers.forEach(subscriber => subscriber.error(error));\n  }\n\n  complete() {\n    if (this.isClosed) {\n      throw new Error('BehaviorSubject is closed');\n    }\n    this.isClosed = true;\n    this.subscribers.forEach(subscriber => subscriber.complete());\n  }\n\n  subscribe(observer: ZenObservable.Observer<T>): ZenObservable.Subscription;\n  subscribe(\n    onNext: (value: T) => void,\n    onError?: (error: any) => void,\n    onComplete?: () => void,\n  ): ZenObservable.Subscription;\n  subscribe(\n    onNext: ZenObservable.Observer<T> | ((value: T) => void),\n    onError?: (error: any) => void,\n    onComplete?: () => void,\n  ): ZenObservable.Subscription {\n    const observer =\n      typeof onNext === 'function'\n        ? {\n            next: onNext,\n            error: onError,\n            complete: onComplete,\n          }\n        : onNext;\n\n    return this.observable.subscribe(observer);\n  }\n}\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { BehaviorSubject } from '../subjects';\nimport { SessionState } from '@backstage/core-plugin-api';\nimport { Observable } from '@backstage/types';\n\nexport class SessionStateTracker {\n  private readonly subject = new BehaviorSubject<SessionState>(\n    SessionState.SignedOut,\n  );\n\n  private signedIn: boolean = false;\n\n  setIsSignedIn(isSignedIn: boolean) {\n    if (this.signedIn !== isSignedIn) {\n      this.signedIn = isSignedIn;\n      this.subject.next(\n        this.signedIn ? SessionState.SignedIn : SessionState.SignedOut,\n      );\n    }\n  }\n\n  sessionState$(): Observable<SessionState> {\n    return this.subject;\n  }\n}\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  SessionManager,\n  SessionScopesFunc,\n  SessionShouldRefreshFunc,\n  GetSessionOptions,\n} from './types';\nimport { AuthConnector } from '../AuthConnector';\nimport { SessionScopeHelper, hasScopes } from './common';\nimport { SessionStateTracker } from './SessionStateTracker';\n\ntype Options<T> = {\n  /** The connector used for acting on the auth session */\n  connector: AuthConnector<T>;\n  /** Used to get the scope of the session */\n  sessionScopes: SessionScopesFunc<T>;\n  /** Used to check if the session needs to be refreshed */\n  sessionShouldRefresh: SessionShouldRefreshFunc<T>;\n  /** The default scopes that should always be present in a session, defaults to none. */\n  defaultScopes?: Set<string>;\n};\n\n/**\n * RefreshingAuthSessionManager manages an underlying session that has\n * and expiration time and needs to be refreshed periodically.\n */\nexport class RefreshingAuthSessionManager<T> implements SessionManager<T> {\n  private readonly connector: AuthConnector<T>;\n  private readonly helper: SessionScopeHelper<T>;\n  private readonly sessionScopesFunc: SessionScopesFunc<T>;\n  private readonly sessionShouldRefreshFunc: SessionShouldRefreshFunc<T>;\n  private readonly stateTracker = new SessionStateTracker();\n\n  private refreshPromise?: Promise<T>;\n  private currentSession: T | undefined;\n\n  constructor(options: Options<T>) {\n    const {\n      connector,\n      defaultScopes = new Set(),\n      sessionScopes,\n      sessionShouldRefresh,\n    } = options;\n\n    this.connector = connector;\n    this.sessionScopesFunc = sessionScopes;\n    this.sessionShouldRefreshFunc = sessionShouldRefresh;\n    this.helper = new SessionScopeHelper({ sessionScopes, defaultScopes });\n  }\n\n  async getSession(options: GetSessionOptions): Promise<T | undefined> {\n    if (\n      this.helper.sessionExistsAndHasScope(this.currentSession, options.scopes)\n    ) {\n      const shouldRefresh = this.sessionShouldRefreshFunc(this.currentSession!);\n      if (!shouldRefresh) {\n        return this.currentSession!;\n      }\n\n      try {\n        const refreshedSession = await this.collapsedSessionRefresh();\n        const currentScopes = this.sessionScopesFunc(this.currentSession!);\n        const refreshedScopes = this.sessionScopesFunc(refreshedSession);\n        if (hasScopes(refreshedScopes, currentScopes)) {\n          this.currentSession = refreshedSession;\n        }\n        return refreshedSession;\n      } catch (error) {\n        if (options.optional) {\n          return undefined;\n        }\n        throw error;\n      }\n    }\n\n    // The user may still have a valid refresh token in their cookies. Attempt to\n    // initiate a fresh session through the backend using that refresh token.\n    //\n    // We skip this check if an instant login popup is requested, as we need to\n    // stay in a synchronous call stack from the user interaction. The downside\n    // is that that the user will sometimes be requested to log in even if they\n    // already had an existing session.\n    if (!this.currentSession && !options.instantPopup) {\n      try {\n        const newSession = await this.collapsedSessionRefresh();\n        this.currentSession = newSession;\n        // The session might not have the scopes requested so go back and check again\n        return this.getSession(options);\n      } catch {\n        // If the refresh attempt fails we assume we don't have a session, so continue to create one.\n      }\n    }\n\n    // If we continue here we will show a popup, so exit if this is an optional session request.\n    if (options.optional) {\n      return undefined;\n    }\n\n    // We can call authRequester multiple times, the returned session will contain all requested scopes.\n    this.currentSession = await this.connector.createSession({\n      ...options,\n      scopes: this.helper.getExtendedScope(this.currentSession, options.scopes),\n    });\n    this.stateTracker.setIsSignedIn(true);\n    return this.currentSession;\n  }\n\n  async removeSession() {\n    this.currentSession = undefined;\n    await this.connector.removeSession();\n    this.stateTracker.setIsSignedIn(false);\n  }\n\n  sessionState$() {\n    return this.stateTracker.sessionState$();\n  }\n\n  private async collapsedSessionRefresh(): Promise<T> {\n    if (this.refreshPromise) {\n      return this.refreshPromise;\n    }\n\n    this.refreshPromise = this.connector.refreshSession();\n\n    try {\n      const session = await this.refreshPromise;\n      this.stateTracker.setIsSignedIn(true);\n      return session;\n    } finally {\n      delete this.refreshPromise;\n    }\n  }\n}\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { MutableSessionManager, GetSessionOptions } from './types';\nimport { AuthConnector } from '../AuthConnector';\nimport { SessionScopeHelper } from './common';\nimport { SessionStateTracker } from './SessionStateTracker';\n\ntype Options<T> = {\n  /** The connector used for acting on the auth session */\n  connector: AuthConnector<T>;\n  /** Used to get the scope of the session */\n  sessionScopes?: (session: T) => Set<string>;\n  /** The default scopes that should always be present in a session, defaults to none. */\n  defaultScopes?: Set<string>;\n};\n\n/**\n * StaticAuthSessionManager manages an underlying session that does not expire.\n */\nexport class StaticAuthSessionManager<T> implements MutableSessionManager<T> {\n  private readonly connector: AuthConnector<T>;\n  private readonly helper: SessionScopeHelper<T>;\n  private readonly stateTracker = new SessionStateTracker();\n\n  private currentSession: T | undefined;\n\n  constructor(options: Options<T>) {\n    const { connector, defaultScopes = new Set(), sessionScopes } = options;\n\n    this.connector = connector;\n    this.helper = new SessionScopeHelper({ sessionScopes, defaultScopes });\n  }\n\n  setSession(session: T | undefined): void {\n    this.currentSession = session;\n    this.stateTracker.setIsSignedIn(Boolean(session));\n  }\n\n  async getSession(options: GetSessionOptions): Promise<T | undefined> {\n    if (\n      this.helper.sessionExistsAndHasScope(this.currentSession, options.scopes)\n    ) {\n      return this.currentSession;\n    }\n\n    // If we continue here we will show a popup, so exit if this is an optional session request.\n    if (options.optional) {\n      return undefined;\n    }\n\n    // We can call authRequester multiple times, the returned session will contain all requested scopes.\n    this.currentSession = await this.connector.createSession({\n      ...options,\n      scopes: this.helper.getExtendedScope(this.currentSession, options.scopes),\n    });\n    this.stateTracker.setIsSignedIn(true);\n    return this.currentSession;\n  }\n\n  /**\n   * We don't call this.connector.removeSession here, since this session manager\n   * is intended to be static. As such there's no need to hit the remote logout\n   * endpoint - simply discarding the local session state when signing out is\n   * enough.\n   */\n  async removeSession() {\n    this.currentSession = undefined;\n    this.stateTracker.setIsSignedIn(false);\n  }\n\n  sessionState$() {\n    return this.stateTracker.sessionState$();\n  }\n}\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { DefaultAuthConnector } from '../../../../lib/AuthConnector';\nimport { RefreshingAuthSessionManager } from '../../../../lib/AuthSessionManager';\nimport { SessionManager } from '../../../../lib/AuthSessionManager/types';\nimport {\n  AuthRequestOptions,\n  BackstageIdentityResponse,\n  OAuthApi,\n  OpenIdConnectApi,\n  ProfileInfo,\n  ProfileInfoApi,\n  SessionState,\n  SessionApi,\n  BackstageIdentityApi,\n} from '@backstage/core-plugin-api';\nimport { Observable } from '@backstage/types';\nimport { OAuth2Session } from './types';\nimport { OAuthApiCreateOptions } from '../types';\n\n/**\n * OAuth2 create options.\n * @public\n */\nexport type OAuth2CreateOptions = OAuthApiCreateOptions & {\n  scopeTransform?: (scopes: string[]) => string[];\n};\n\nexport type OAuth2Response = {\n  providerInfo: {\n    accessToken: string;\n    idToken: string;\n    scope: string;\n    expiresInSeconds: number;\n  };\n  profile: ProfileInfo;\n  backstageIdentity: BackstageIdentityResponse;\n};\n\nconst DEFAULT_PROVIDER = {\n  id: 'oauth2',\n  title: 'Your Identity Provider',\n  icon: () => null,\n};\n\n/**\n * Implements a generic OAuth2 flow for auth.\n *\n * @public\n */\nexport default class OAuth2\n  implements\n    OAuthApi,\n    OpenIdConnectApi,\n    ProfileInfoApi,\n    BackstageIdentityApi,\n    SessionApi\n{\n  static create(options: OAuth2CreateOptions) {\n    const {\n      discoveryApi,\n      environment = 'development',\n      provider = DEFAULT_PROVIDER,\n      oauthRequestApi,\n      defaultScopes = [],\n      scopeTransform = x => x,\n    } = options;\n\n    const connector = new DefaultAuthConnector({\n      discoveryApi,\n      environment,\n      provider,\n      oauthRequestApi: oauthRequestApi,\n      sessionTransform(res: OAuth2Response): OAuth2Session {\n        return {\n          ...res,\n          providerInfo: {\n            idToken: res.providerInfo.idToken,\n            accessToken: res.providerInfo.accessToken,\n            scopes: OAuth2.normalizeScopes(\n              scopeTransform,\n              res.providerInfo.scope,\n            ),\n            expiresAt: new Date(\n              Date.now() + res.providerInfo.expiresInSeconds * 1000,\n            ),\n          },\n        };\n      },\n    });\n\n    const sessionManager = new RefreshingAuthSessionManager({\n      connector,\n      defaultScopes: new Set(defaultScopes),\n      sessionScopes: (session: OAuth2Session) => session.providerInfo.scopes,\n      sessionShouldRefresh: (session: OAuth2Session) => {\n        const expiresInSec =\n          (session.providerInfo.expiresAt.getTime() - Date.now()) / 1000;\n        return expiresInSec < 60 * 5;\n      },\n    });\n\n    return new OAuth2({ sessionManager, scopeTransform });\n  }\n\n  private readonly sessionManager: SessionManager<OAuth2Session>;\n  private readonly scopeTransform: (scopes: string[]) => string[];\n\n  private constructor(options: {\n    sessionManager: SessionManager<OAuth2Session>;\n    scopeTransform: (scopes: string[]) => string[];\n  }) {\n    this.sessionManager = options.sessionManager;\n    this.scopeTransform = options.scopeTransform;\n  }\n\n  async signIn() {\n    await this.getAccessToken();\n  }\n\n  async signOut() {\n    await this.sessionManager.removeSession();\n  }\n\n  sessionState$(): Observable<SessionState> {\n    return this.sessionManager.sessionState$();\n  }\n\n  async getAccessToken(\n    scope?: string | string[],\n    options?: AuthRequestOptions,\n  ) {\n    const normalizedScopes = OAuth2.normalizeScopes(this.scopeTransform, scope);\n    const session = await this.sessionManager.getSession({\n      ...options,\n      scopes: normalizedScopes,\n    });\n    return session?.providerInfo.accessToken ?? '';\n  }\n\n  async getIdToken(options: AuthRequestOptions = {}) {\n    const session = await this.sessionManager.getSession(options);\n    return session?.providerInfo.idToken ?? '';\n  }\n\n  async getBackstageIdentity(\n    options: AuthRequestOptions = {},\n  ): Promise<BackstageIdentityResponse | undefined> {\n    const session = await this.sessionManager.getSession(options);\n    return session?.backstageIdentity;\n  }\n\n  async getProfile(options: AuthRequestOptions = {}) {\n    const session = await this.sessionManager.getSession(options);\n    return session?.profile;\n  }\n\n  private static normalizeScopes(\n    scopeTransform: (scopes: string[]) => string[],\n    scopes?: string | string[],\n  ): Set<string> {\n    if (!scopes) {\n      return new Set();\n    }\n\n    const scopeList = Array.isArray(scopes)\n      ? scopes\n      : scopes.split(/[\\s|,]/).filter(Boolean);\n\n    return new Set(scopeTransform(scopeList));\n  }\n}\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { githubAuthApiRef } from '@backstage/core-plugin-api';\nimport { OAuth2 } from '../oauth2';\nimport { OAuthApiCreateOptions } from '../types';\n\nconst DEFAULT_PROVIDER = {\n  id: 'github',\n  title: 'GitHub',\n  icon: () => null,\n};\n\n/**\n * Implements the OAuth flow to GitHub products.\n *\n * @public\n */\nexport default class GithubAuth {\n  static create(options: OAuthApiCreateOptions): typeof githubAuthApiRef.T {\n    const {\n      discoveryApi,\n      environment = 'development',\n      provider = DEFAULT_PROVIDER,\n      oauthRequestApi,\n      defaultScopes = ['read:user'],\n    } = options;\n\n    return OAuth2.create({\n      discoveryApi,\n      oauthRequestApi,\n      provider,\n      environment,\n      defaultScopes,\n    });\n  }\n}\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { gitlabAuthApiRef } from '@backstage/core-plugin-api';\nimport { OAuth2 } from '../oauth2';\nimport { OAuthApiCreateOptions } from '../types';\n\nconst DEFAULT_PROVIDER = {\n  id: 'gitlab',\n  title: 'GitLab',\n  icon: () => null,\n};\n\n/**\n * Implements the OAuth flow to GitLab products.\n *\n * @public\n */\nexport default class GitlabAuth {\n  static create(options: OAuthApiCreateOptions): typeof gitlabAuthApiRef.T {\n    const {\n      discoveryApi,\n      environment = 'development',\n      provider = DEFAULT_PROVIDER,\n      oauthRequestApi,\n      defaultScopes = ['read_user'],\n    } = options;\n\n    return OAuth2.create({\n      discoveryApi,\n      oauthRequestApi,\n      provider,\n      environment,\n      defaultScopes,\n    });\n  }\n}\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { googleAuthApiRef } from '@backstage/core-plugin-api';\nimport { OAuth2 } from '../oauth2';\nimport { OAuthApiCreateOptions } from '../types';\n\nconst DEFAULT_PROVIDER = {\n  id: 'google',\n  title: 'Google',\n  icon: () => null,\n};\n\nconst SCOPE_PREFIX = 'https://www.googleapis.com/auth/';\n\n/**\n * Implements the OAuth flow to Google products.\n *\n * @public\n */\nexport default class GoogleAuth {\n  static create(options: OAuthApiCreateOptions): typeof googleAuthApiRef.T {\n    const {\n      discoveryApi,\n      oauthRequestApi,\n      environment = 'development',\n      provider = DEFAULT_PROVIDER,\n      defaultScopes = [\n        'openid',\n        `${SCOPE_PREFIX}userinfo.email`,\n        `${SCOPE_PREFIX}userinfo.profile`,\n      ],\n    } = options;\n\n    return OAuth2.create({\n      discoveryApi,\n      oauthRequestApi,\n      provider,\n      environment,\n      defaultScopes,\n      scopeTransform(scopes: string[]) {\n        return scopes.map(scope => {\n          if (scope === 'openid') {\n            return scope;\n          }\n\n          if (scope === 'profile' || scope === 'email') {\n            return `${SCOPE_PREFIX}userinfo.${scope}`;\n          }\n\n          if (scope.startsWith(SCOPE_PREFIX)) {\n            return scope;\n          }\n\n          return `${SCOPE_PREFIX}${scope}`;\n        });\n      },\n    });\n  }\n}\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { oktaAuthApiRef } from '@backstage/core-plugin-api';\nimport { OAuth2 } from '../oauth2';\nimport { OAuthApiCreateOptions } from '../types';\n\nconst DEFAULT_PROVIDER = {\n  id: 'okta',\n  title: 'Okta',\n  icon: () => null,\n};\n\nconst OKTA_OIDC_SCOPES: Set<String> = new Set([\n  'openid',\n  'profile',\n  'email',\n  'phone',\n  'address',\n  'groups',\n  'offline_access',\n]);\n\nconst OKTA_SCOPE_PREFIX: string = 'okta.';\n\n/**\n * Implements the OAuth flow to Okta products.\n *\n * @public\n */\nexport default class OktaAuth {\n  static create(options: OAuthApiCreateOptions): typeof oktaAuthApiRef.T {\n    const {\n      discoveryApi,\n      environment = 'development',\n      provider = DEFAULT_PROVIDER,\n      oauthRequestApi,\n      defaultScopes = ['openid', 'email', 'profile', 'offline_access'],\n    } = options;\n\n    return OAuth2.create({\n      discoveryApi,\n      oauthRequestApi,\n      provider,\n      environment,\n      defaultScopes,\n      scopeTransform(scopes) {\n        return scopes.map(scope => {\n          if (OKTA_OIDC_SCOPES.has(scope)) {\n            return scope;\n          }\n\n          if (scope.startsWith(OKTA_SCOPE_PREFIX)) {\n            return scope;\n          }\n\n          return `${OKTA_SCOPE_PREFIX}${scope}`;\n        });\n      },\n    });\n  }\n}\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  BackstageIdentityResponse,\n  ProfileInfo,\n} from '@backstage/core-plugin-api';\nimport { z } from 'zod';\n\n/** @internal */\nexport type SamlSession = {\n  profile: ProfileInfo;\n  backstageIdentity: BackstageIdentityResponse;\n};\n\n/** @internal */\nexport const samlSessionSchema: z.ZodSchema<SamlSession> = z.object({\n  profile: z.object({\n    email: z.string().optional(),\n    displayName: z.string().optional(),\n    picture: z.string().optional(),\n  }),\n  backstageIdentity: z.object({\n    token: z.string(),\n    identity: z.object({\n      type: z.literal('user'),\n      userEntityRef: z.string(),\n      ownershipEntityRefs: z.array(z.string()),\n    }),\n  }),\n});\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  AuthRequestOptions,\n  BackstageIdentityApi,\n  ProfileInfo,\n  ProfileInfoApi,\n  SessionApi,\n  SessionState,\n  BackstageIdentityResponse,\n} from '@backstage/core-plugin-api';\nimport { Observable } from '@backstage/types';\nimport { DirectAuthConnector } from '../../../../lib/AuthConnector';\nimport {\n  AuthSessionStore,\n  StaticAuthSessionManager,\n} from '../../../../lib/AuthSessionManager';\nimport { SessionManager } from '../../../../lib/AuthSessionManager/types';\nimport { AuthApiCreateOptions } from '../types';\nimport { SamlSession, samlSessionSchema } from './types';\n\nexport type SamlAuthResponse = {\n  profile: ProfileInfo;\n  backstageIdentity: BackstageIdentityResponse;\n};\n\nconst DEFAULT_PROVIDER = {\n  id: 'saml',\n  title: 'SAML',\n  icon: () => null,\n};\n\n/**\n * Implements a general SAML based auth flow.\n *\n * @public\n */\nexport default class SamlAuth\n  implements ProfileInfoApi, BackstageIdentityApi, SessionApi\n{\n  static create(options: AuthApiCreateOptions) {\n    const {\n      discoveryApi,\n      environment = 'development',\n      provider = DEFAULT_PROVIDER,\n    } = options;\n\n    const connector = new DirectAuthConnector<SamlSession>({\n      discoveryApi,\n      environment,\n      provider,\n    });\n\n    const sessionManager = new StaticAuthSessionManager<SamlSession>({\n      connector,\n    });\n\n    const authSessionStore = new AuthSessionStore<SamlSession>({\n      manager: sessionManager,\n      storageKey: `${provider.id}Session`,\n      schema: samlSessionSchema,\n    });\n\n    return new SamlAuth(authSessionStore);\n  }\n\n  sessionState$(): Observable<SessionState> {\n    return this.sessionManager.sessionState$();\n  }\n\n  private constructor(\n    private readonly sessionManager: SessionManager<SamlSession>,\n  ) {}\n\n  async signIn() {\n    await this.getBackstageIdentity({});\n  }\n  async signOut() {\n    await this.sessionManager.removeSession();\n  }\n\n  async getBackstageIdentity(\n    options: AuthRequestOptions = {},\n  ): Promise<BackstageIdentityResponse | undefined> {\n    const session = await this.sessionManager.getSession(options);\n    return session?.backstageIdentity;\n  }\n\n  async getProfile(options: AuthRequestOptions = {}) {\n    const session = await this.sessionManager.getSession(options);\n    return session?.profile;\n  }\n}\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { microsoftAuthApiRef } from '@backstage/core-plugin-api';\nimport { OAuth2 } from '../oauth2';\nimport { OAuthApiCreateOptions } from '../types';\n\nconst DEFAULT_PROVIDER = {\n  id: 'microsoft',\n  title: 'Microsoft',\n  icon: () => null,\n};\n\n/**\n * Implements the OAuth flow to Microsoft products.\n *\n * @public\n */\nexport default class MicrosoftAuth {\n  static create(options: OAuthApiCreateOptions): typeof microsoftAuthApiRef.T {\n    const {\n      environment = 'development',\n      provider = DEFAULT_PROVIDER,\n      oauthRequestApi,\n      discoveryApi,\n      defaultScopes = [\n        'openid',\n        'offline_access',\n        'profile',\n        'email',\n        'User.Read',\n      ],\n    } = options;\n\n    return OAuth2.create({\n      discoveryApi,\n      oauthRequestApi,\n      provider,\n      environment,\n      defaultScopes,\n    });\n  }\n}\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  oneloginAuthApiRef,\n  OAuthRequestApi,\n  AuthProviderInfo,\n  DiscoveryApi,\n} from '@backstage/core-plugin-api';\nimport { OAuth2 } from '../oauth2';\n\n/**\n * OneLogin auth provider create options.\n * @public\n */\nexport type OneLoginAuthCreateOptions = {\n  discoveryApi: DiscoveryApi;\n  oauthRequestApi: OAuthRequestApi;\n  environment?: string;\n  provider?: AuthProviderInfo;\n};\n\nconst DEFAULT_PROVIDER = {\n  id: 'onelogin',\n  title: 'onelogin',\n  icon: () => null,\n};\n\nconst OIDC_SCOPES: Set<String> = new Set([\n  'openid',\n  'profile',\n  'email',\n  'phone',\n  'address',\n  'groups',\n  'offline_access',\n]);\n\nconst SCOPE_PREFIX: string = 'onelogin.';\n\n/**\n * Implements a OneLogin OAuth flow.\n *\n * @public\n */\nexport default class OneLoginAuth {\n  static create(\n    options: OneLoginAuthCreateOptions,\n  ): typeof oneloginAuthApiRef.T {\n    const {\n      discoveryApi,\n      environment = 'development',\n      provider = DEFAULT_PROVIDER,\n      oauthRequestApi,\n    } = options;\n\n    return OAuth2.create({\n      discoveryApi,\n      oauthRequestApi,\n      provider,\n      environment,\n      defaultScopes: ['openid', 'email', 'profile', 'offline_access'],\n      scopeTransform(scopes) {\n        return scopes.map(scope => {\n          if (OIDC_SCOPES.has(scope)) {\n            return scope;\n          }\n\n          if (scope.startsWith(SCOPE_PREFIX)) {\n            return scope;\n          }\n\n          return `${SCOPE_PREFIX}${scope}`;\n        });\n      },\n    });\n  }\n}\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  BackstageIdentityResponse,\n  bitbucketAuthApiRef,\n  ProfileInfo,\n} from '@backstage/core-plugin-api';\n\nimport { OAuthApiCreateOptions } from '../types';\nimport { OAuth2 } from '../oauth2';\n\nexport type BitbucketAuthResponse = {\n  providerInfo: {\n    accessToken: string;\n    scope: string;\n    expiresInSeconds: number;\n  };\n  profile: ProfileInfo;\n  backstageIdentity: BackstageIdentityResponse;\n};\n\nconst DEFAULT_PROVIDER = {\n  id: 'bitbucket',\n  title: 'Bitbucket',\n  icon: () => null,\n};\n\n/**\n * Implements the OAuth flow to Bitbucket products.\n *\n * @public\n */\nexport default class BitbucketAuth {\n  static create(options: OAuthApiCreateOptions): typeof bitbucketAuthApiRef.T {\n    const {\n      discoveryApi,\n      environment = 'development',\n      provider = DEFAULT_PROVIDER,\n      oauthRequestApi,\n      defaultScopes = ['team'],\n    } = options;\n\n    return OAuth2.create({\n      discoveryApi,\n      oauthRequestApi,\n      provider,\n      environment,\n      defaultScopes,\n    });\n  }\n}\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { atlassianAuthApiRef } from '@backstage/core-plugin-api';\nimport { OAuth2 } from '../oauth2';\nimport { OAuthApiCreateOptions } from '../types';\n\nconst DEFAULT_PROVIDER = {\n  id: 'atlassian',\n  title: 'Atlassian',\n  icon: () => null,\n};\n\n/**\n * Implements the OAuth flow to Atlassian products.\n *\n * @public\n */\nexport default class AtlassianAuth {\n  static create(options: OAuthApiCreateOptions): typeof atlassianAuthApiRef.T {\n    const {\n      discoveryApi,\n      environment = 'development',\n      provider = DEFAULT_PROVIDER,\n      oauthRequestApi,\n    } = options;\n\n    return OAuth2.create({\n      discoveryApi,\n      oauthRequestApi,\n      provider,\n      environment,\n    });\n  }\n}\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { AlertApi, AlertMessage } from '@backstage/core-plugin-api';\nimport { Observable } from '@backstage/types';\nimport { PublishSubject } from '../../../lib/subjects';\n\n/**\n * Base implementation for the AlertApi that simply forwards alerts to consumers.\n *\n * @public\n */\nexport class AlertApiForwarder implements AlertApi {\n  private readonly subject = new PublishSubject<AlertMessage>();\n\n  post(alert: AlertMessage) {\n    this.subject.next(alert);\n  }\n\n  alert$(): Observable<AlertMessage> {\n    return this.subject;\n  }\n}\n","/*\n * Copyright 2021 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport { AnalyticsApi, AnalyticsEvent } from '@backstage/core-plugin-api';\n\n/**\n * Base implementation for the AnalyticsApi that does nothing.\n *\n * @public\n */\nexport class NoOpAnalyticsApi implements AnalyticsApi {\n  captureEvent(_event: AnalyticsEvent): void {}\n}\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { AppThemeApi, AppTheme } from '@backstage/core-plugin-api';\nimport { Observable } from '@backstage/types';\nimport { BehaviorSubject } from '../../../lib/subjects';\n\nconst STORAGE_KEY = 'theme';\n\n/**\n * Exposes the themes installed in the app, and permits switching the currently\n * active theme.\n *\n * @public\n */\nexport class AppThemeSelector implements AppThemeApi {\n  static createWithStorage(themes: AppTheme[]) {\n    const selector = new AppThemeSelector(themes);\n\n    if (!window.localStorage) {\n      return selector;\n    }\n\n    const initialThemeId =\n      window.localStorage.getItem(STORAGE_KEY) ?? undefined;\n\n    selector.setActiveThemeId(initialThemeId);\n\n    selector.activeThemeId$().subscribe(themeId => {\n      if (themeId) {\n        window.localStorage.setItem(STORAGE_KEY, themeId);\n      } else {\n        window.localStorage.removeItem(STORAGE_KEY);\n      }\n    });\n\n    window.addEventListener('storage', event => {\n      if (event.key === STORAGE_KEY) {\n        const themeId = localStorage.getItem(STORAGE_KEY) ?? undefined;\n        selector.setActiveThemeId(themeId);\n      }\n    });\n\n    return selector;\n  }\n\n  private activeThemeId: string | undefined;\n  private readonly subject = new BehaviorSubject<string | undefined>(undefined);\n\n  constructor(private readonly themes: AppTheme[]) {}\n\n  getInstalledThemes(): AppTheme[] {\n    return this.themes.slice();\n  }\n\n  activeThemeId$(): Observable<string | undefined> {\n    return this.subject;\n  }\n\n  getActiveThemeId(): string | undefined {\n    return this.activeThemeId;\n  }\n\n  setActiveThemeId(themeId?: string): void {\n    this.activeThemeId = themeId;\n    this.subject.next(themeId);\n  }\n}\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { JsonValue, JsonObject } from '@backstage/types';\nimport { AppConfig, Config } from './types';\nimport cloneDeep from 'lodash/cloneDeep';\nimport mergeWith from 'lodash/mergeWith';\n\n// Update the same pattern in config-loader package if this is changed\nconst CONFIG_KEY_PART_PATTERN = /^[a-z][a-z0-9]*(?:[-_][a-z][a-z0-9]*)*$/i;\n\nfunction isObject(value: JsonValue | undefined): value is JsonObject {\n  return typeof value === 'object' && value !== null && !Array.isArray(value);\n}\n\nfunction typeOf(value: JsonValue | undefined): string {\n  if (value === null) {\n    return 'null';\n  } else if (Array.isArray(value)) {\n    return 'array';\n  }\n  const type = typeof value;\n  if (type === 'number' && isNaN(value as number)) {\n    return 'nan';\n  }\n  if (type === 'string' && value === '') {\n    return 'empty-string';\n  }\n  return type;\n}\n\n// Separate out a couple of common error messages to reduce bundle size.\nconst errors = {\n  type(key: string, context: string, typeName: string, expected: string) {\n    return `Invalid type in config for key '${key}' in '${context}', got ${typeName}, wanted ${expected}`;\n  },\n  missing(key: string) {\n    return `Missing required config value at '${key}'`;\n  },\n  convert(key: string, context: string, expected: string) {\n    return `Unable to convert config value for key '${key}' in '${context}' to a ${expected}`;\n  },\n};\n\n/**\n * An implementation of the `Config` interface that uses a plain JavaScript object\n * for the backing data, with the ability of linking multiple readers together.\n *\n * @public\n */\nexport class ConfigReader implements Config {\n  /**\n   * A set of key paths that where removed from the config due to not being visible.\n   *\n   * This was added as a mutable private member to avoid changes to the public API.\n   * Its only purpose of this is to warn users of missing visibility when running\n   * the frontend in development mode.\n   */\n  private filteredKeys?: string[];\n  private notifiedFilteredKeys = new Set<string>();\n\n  /**\n   * Instantiates the config reader from a list of application config objects.\n   */\n  static fromConfigs(configs: AppConfig[]): ConfigReader {\n    if (configs.length === 0) {\n      return new ConfigReader(undefined);\n    }\n\n    // Merge together all configs into a single config with recursive fallback\n    // readers, giving the first config object in the array the lowest priority.\n    return configs.reduce<ConfigReader>(\n      (previousReader, { data, context, filteredKeys, deprecatedKeys }) => {\n        const reader = new ConfigReader(data, context, previousReader);\n        reader.filteredKeys = filteredKeys;\n\n        if (deprecatedKeys) {\n          for (const { key, description } of deprecatedKeys) {\n            // eslint-disable-next-line no-console\n            console.warn(\n              `The configuration key '${key}' of ${context} is deprecated and may be removed soon. ${\n                description || ''\n              }`,\n            );\n          }\n        }\n\n        return reader;\n      },\n      undefined!,\n    );\n  }\n\n  constructor(\n    private readonly data: JsonObject | undefined,\n    private readonly context: string = 'mock-config',\n    private readonly fallback?: ConfigReader,\n    private readonly prefix: string = '',\n  ) {}\n\n  /** {@inheritdoc Config.has} */\n  has(key: string): boolean {\n    const value = this.readValue(key);\n    if (value !== undefined) {\n      return true;\n    }\n    return this.fallback?.has(key) ?? false;\n  }\n\n  /** {@inheritdoc Config.keys} */\n  keys(): string[] {\n    const localKeys = this.data ? Object.keys(this.data) : [];\n    const fallbackKeys = this.fallback?.keys() ?? [];\n    return [...new Set([...localKeys, ...fallbackKeys])];\n  }\n\n  /** {@inheritdoc Config.get} */\n  get<T = JsonValue>(key?: string): T {\n    const value = this.getOptional(key);\n    if (value === undefined) {\n      throw new Error(errors.missing(this.fullKey(key ?? '')));\n    }\n    return value as T;\n  }\n\n  /** {@inheritdoc Config.getOptional} */\n  getOptional<T = JsonValue>(key?: string): T | undefined {\n    const value = cloneDeep(this.readValue(key));\n    const fallbackValue = this.fallback?.getOptional<T>(key);\n\n    if (value === undefined) {\n      if (process.env.NODE_ENV === 'development') {\n        if (fallbackValue === undefined && key) {\n          const fullKey = this.fullKey(key);\n          if (\n            this.filteredKeys?.includes(fullKey) &&\n            !this.notifiedFilteredKeys.has(fullKey)\n          ) {\n            this.notifiedFilteredKeys.add(fullKey);\n            // eslint-disable-next-line no-console\n            console.warn(\n              `Failed to read configuration value at '${fullKey}' as it is not visible. ` +\n                'See https://backstage.io/docs/conf/defining#visibility for instructions on how to make it visible.',\n            );\n          }\n        }\n      }\n      return fallbackValue;\n    } else if (fallbackValue === undefined) {\n      return value as T;\n    }\n\n    // Avoid merging arrays and primitive values, since that's how merging works for other\n    // methods for reading config.\n    return mergeWith({}, { value: fallbackValue }, { value }, (into, from) =>\n      !isObject(from) || !isObject(into) ? from : undefined,\n    ).value as T;\n  }\n\n  /** {@inheritdoc Config.getConfig} */\n  getConfig(key: string): ConfigReader {\n    const value = this.getOptionalConfig(key);\n    if (value === undefined) {\n      throw new Error(errors.missing(this.fullKey(key)));\n    }\n    return value;\n  }\n\n  /** {@inheritdoc Config.getOptionalConfig} */\n  getOptionalConfig(key: string): ConfigReader | undefined {\n    const value = this.readValue(key);\n    const fallbackConfig = this.fallback?.getOptionalConfig(key);\n\n    if (isObject(value)) {\n      return this.copy(value, key, fallbackConfig);\n    }\n    if (value !== undefined) {\n      throw new TypeError(\n        errors.type(this.fullKey(key), this.context, typeOf(value), 'object'),\n      );\n    }\n    return fallbackConfig;\n  }\n\n  /** {@inheritdoc Config.getConfigArray} */\n  getConfigArray(key: string): ConfigReader[] {\n    const value = this.getOptionalConfigArray(key);\n    if (value === undefined) {\n      throw new Error(errors.missing(this.fullKey(key)));\n    }\n    return value;\n  }\n\n  /** {@inheritdoc Config.getOptionalConfigArray} */\n  getOptionalConfigArray(key: string): ConfigReader[] | undefined {\n    const configs = this.readConfigValue<JsonObject[]>(key, values => {\n      if (!Array.isArray(values)) {\n        return { expected: 'object-array' };\n      }\n\n      for (const [index, value] of values.entries()) {\n        if (!isObject(value)) {\n          return { expected: 'object-array', value, key: `${key}[${index}]` };\n        }\n      }\n      return true;\n    });\n\n    if (!configs) {\n      if (process.env.NODE_ENV === 'development') {\n        const fullKey = this.fullKey(key);\n        if (\n          this.filteredKeys?.some(k => k.startsWith(fullKey)) &&\n          !this.notifiedFilteredKeys.has(key)\n        ) {\n          this.notifiedFilteredKeys.add(key);\n          // eslint-disable-next-line no-console\n          console.warn(\n            `Failed to read configuration array at '${key}' as it does not have any visible elements. ` +\n              'See https://backstage.io/docs/conf/defining#visibility for instructions on how to make it visible.',\n          );\n        }\n      }\n      return undefined;\n    }\n\n    return configs.map((obj, index) => this.copy(obj, `${key}[${index}]`));\n  }\n\n  /** {@inheritdoc Config.getNumber} */\n  getNumber(key: string): number {\n    const value = this.getOptionalNumber(key);\n    if (value === undefined) {\n      throw new Error(errors.missing(this.fullKey(key)));\n    }\n    return value;\n  }\n\n  /** {@inheritdoc Config.getOptionalNumber} */\n  getOptionalNumber(key: string): number | undefined {\n    const value = this.readConfigValue<string | number>(\n      key,\n      val =>\n        typeof val === 'number' ||\n        typeof val === 'string' || { expected: 'number' },\n    );\n    if (typeof value === 'number' || value === undefined) {\n      return value;\n    }\n    const number = Number(value);\n    if (!Number.isFinite(number)) {\n      throw new Error(\n        errors.convert(this.fullKey(key), this.context, 'number'),\n      );\n    }\n    return number;\n  }\n\n  /** {@inheritdoc Config.getBoolean} */\n  getBoolean(key: string): boolean {\n    const value = this.getOptionalBoolean(key);\n    if (value === undefined) {\n      throw new Error(errors.missing(this.fullKey(key)));\n    }\n    return value;\n  }\n\n  /** {@inheritdoc Config.getOptionalBoolean} */\n  getOptionalBoolean(key: string): boolean | undefined {\n    return this.readConfigValue(\n      key,\n      value => typeof value === 'boolean' || { expected: 'boolean' },\n    );\n  }\n\n  /** {@inheritdoc Config.getString} */\n  getString(key: string): string {\n    const value = this.getOptionalString(key);\n    if (value === undefined) {\n      throw new Error(errors.missing(this.fullKey(key)));\n    }\n    return value;\n  }\n\n  /** {@inheritdoc Config.getOptionalString} */\n  getOptionalString(key: string): string | undefined {\n    return this.readConfigValue(\n      key,\n      value =>\n        (typeof value === 'string' && value !== '') || { expected: 'string' },\n    );\n  }\n\n  /** {@inheritdoc Config.getStringArray} */\n  getStringArray(key: string): string[] {\n    const value = this.getOptionalStringArray(key);\n    if (value === undefined) {\n      throw new Error(errors.missing(this.fullKey(key)));\n    }\n    return value;\n  }\n\n  /** {@inheritdoc Config.getOptionalStringArray} */\n  getOptionalStringArray(key: string): string[] | undefined {\n    return this.readConfigValue(key, values => {\n      if (!Array.isArray(values)) {\n        return { expected: 'string-array' };\n      }\n      for (const [index, value] of values.entries()) {\n        if (typeof value !== 'string' || value === '') {\n          return { expected: 'string-array', value, key: `${key}[${index}]` };\n        }\n      }\n      return true;\n    });\n  }\n\n  private fullKey(key: string): string {\n    return `${this.prefix}${this.prefix ? '.' : ''}${key}`;\n  }\n\n  private copy(data: JsonObject, key: string, fallback?: ConfigReader) {\n    const reader = new ConfigReader(\n      data,\n      this.context,\n      fallback,\n      this.fullKey(key),\n    );\n    reader.filteredKeys = this.filteredKeys;\n    return reader;\n  }\n\n  private readConfigValue<T extends JsonValue>(\n    key: string,\n    validate: (\n      value: JsonValue,\n    ) => { expected: string; value?: JsonValue; key?: string } | true,\n  ): T | undefined {\n    const value = this.readValue(key);\n\n    if (value === undefined) {\n      if (process.env.NODE_ENV === 'development') {\n        const fullKey = this.fullKey(key);\n        if (\n          this.filteredKeys?.includes(fullKey) &&\n          !this.notifiedFilteredKeys.has(fullKey)\n        ) {\n          this.notifiedFilteredKeys.add(fullKey);\n          // eslint-disable-next-line no-console\n          console.warn(\n            `Failed to read configuration value at '${fullKey}' as it is not visible. ` +\n              'See https://backstage.io/docs/conf/defining#visibility for instructions on how to make it visible.',\n          );\n        }\n      }\n\n      return this.fallback?.readConfigValue(key, validate);\n    }\n    const result = validate(value);\n    if (result !== true) {\n      const { key: keyName = key, value: theValue = value, expected } = result;\n      throw new TypeError(\n        errors.type(\n          this.fullKey(keyName),\n          this.context,\n          typeOf(theValue),\n          expected,\n        ),\n      );\n    }\n\n    return value as T;\n  }\n\n  private readValue(key?: string): JsonValue | undefined {\n    const parts = key ? key.split('.') : [];\n    for (const part of parts) {\n      if (!CONFIG_KEY_PART_PATTERN.test(part)) {\n        throw new TypeError(`Invalid config key '${key}'`);\n      }\n    }\n\n    if (this.data === undefined) {\n      return undefined;\n    }\n\n    let value: JsonValue | undefined = this.data;\n    for (const [index, part] of parts.entries()) {\n      if (isObject(value)) {\n        value = value[part];\n      } else if (value !== undefined) {\n        const badKey = this.fullKey(parts.slice(0, index).join('.'));\n        throw new TypeError(\n          errors.type(badKey, this.context, typeOf(value), 'object'),\n        );\n      }\n    }\n\n    return value;\n  }\n}\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { DiscoveryApi } from '@backstage/core-plugin-api';\n\nconst ERROR_PREFIX = 'Invalid discovery URL pattern,';\n\n/**\n * UrlPatternDiscovery is a lightweight DiscoveryApi implementation.\n * It uses a single template string to construct URLs for each plugin.\n *\n * @public\n */\nexport class UrlPatternDiscovery implements DiscoveryApi {\n  /**\n   * Creates a new UrlPatternDiscovery given a template. The the only\n   * interpolation done for the template is to replace instances of `{{pluginId}}`\n   * with the ID of the plugin being requested.\n   *\n   * Example pattern: `http://localhost:7007/api/{{ pluginId }}`\n   */\n  static compile(pattern: string): UrlPatternDiscovery {\n    const parts = pattern.split(/\\{\\{\\s*pluginId\\s*\\}\\}/);\n    const urlStr = parts.join('pluginId');\n\n    let url;\n    try {\n      url = new URL(urlStr);\n    } catch {\n      throw new Error(`${ERROR_PREFIX} URL '${urlStr}' is invalid`);\n    }\n    if (url.hash) {\n      throw new Error(`${ERROR_PREFIX} URL must not have a hash`);\n    }\n    if (url.search) {\n      throw new Error(`${ERROR_PREFIX} URL must not have a query`);\n    }\n    if (urlStr.endsWith('/')) {\n      throw new Error(`${ERROR_PREFIX} URL must not end with a slash`);\n    }\n\n    return new UrlPatternDiscovery(parts);\n  }\n\n  private constructor(private readonly parts: string[]) {}\n\n  async getBaseUrl(pluginId: string): Promise<string> {\n    return this.parts.join(pluginId);\n  }\n}\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport {\n  ErrorApi,\n  ErrorApiError,\n  ErrorApiErrorContext,\n  AlertApi,\n} from '@backstage/core-plugin-api';\n\n/**\n * Decorates an ErrorApi by also forwarding error messages\n * to the alertApi with an 'error' severity.\n *\n * @public\n */\nexport class ErrorAlerter implements ErrorApi {\n  constructor(\n    private readonly alertApi: AlertApi,\n    private readonly errorApi: ErrorApi,\n  ) {}\n\n  post(error: ErrorApiError, context?: ErrorApiErrorContext) {\n    if (!context?.hidden) {\n      this.alertApi.post({ message: error.message, severity: 'error' });\n    }\n\n    return this.errorApi.post(error, context);\n  }\n\n  error$() {\n    return this.errorApi.error$();\n  }\n}\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  ErrorApi,\n  ErrorApiError,\n  ErrorApiErrorContext,\n} from '@backstage/core-plugin-api';\nimport { Observable } from '@backstage/types';\nimport { PublishSubject } from '../../../lib/subjects';\n\n/**\n * Base implementation for the ErrorApi that simply forwards errors to consumers.\n *\n * @public\n */\nexport class ErrorApiForwarder implements ErrorApi {\n  private readonly subject = new PublishSubject<{\n    error: Error;\n    context?: ErrorApiErrorContext;\n  }>();\n\n  post(error: ErrorApiError, context?: ErrorApiErrorContext) {\n    this.subject.next({ error, context });\n  }\n\n  error$(): Observable<{ error: Error; context?: ErrorApiErrorContext }> {\n    return this.subject;\n  }\n}\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  ErrorApi,\n  ErrorApiError,\n  ErrorApiErrorContext,\n} from '@backstage/core-plugin-api';\n\n/**\n * Utility class that helps with error forwarding.\n *\n * @public\n */\nexport class UnhandledErrorForwarder {\n  /**\n   * Add event listener, such that unhandled errors can be forwarded using an given `ErrorApi` instance\n   */\n  static forward(errorApi: ErrorApi, errorContext: ErrorApiErrorContext) {\n    window.addEventListener(\n      'unhandledrejection',\n      (e: PromiseRejectionEvent) => {\n        errorApi.post(e.reason as ErrorApiError, errorContext);\n      },\n    );\n  }\n}\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  FeatureFlagState,\n  FeatureFlagsApi,\n  FeatureFlag,\n  FeatureFlagsSaveOptions,\n} from '@backstage/core-plugin-api';\n\nexport function validateFlagName(name: string): void {\n  if (name.length < 3) {\n    throw new Error(\n      `The '${name}' feature flag must have a minimum length of three characters.`,\n    );\n  }\n\n  if (name.length > 150) {\n    throw new Error(\n      `The '${name}' feature flag must not exceed 150 characters.`,\n    );\n  }\n\n  if (!name.match(/^[a-z]+[a-z0-9-]+$/)) {\n    throw new Error(\n      `The '${name}' feature flag must start with a lowercase letter and only contain lowercase letters, numbers and hyphens. ` +\n        'Examples: feature-flag-one, alpha, release-2020',\n    );\n  }\n}\n\n/**\n * A feature flags implementation that stores the flags in the browser's local\n * storage.\n *\n * @public\n */\nexport class LocalStorageFeatureFlags implements FeatureFlagsApi {\n  private registeredFeatureFlags: FeatureFlag[] = [];\n  private flags?: Map<string, FeatureFlagState>;\n\n  registerFlag(flag: FeatureFlag) {\n    validateFlagName(flag.name);\n    this.registeredFeatureFlags.push(flag);\n  }\n\n  getRegisteredFlags(): FeatureFlag[] {\n    return this.registeredFeatureFlags.slice();\n  }\n\n  isActive(name: string): boolean {\n    if (!this.flags) {\n      this.flags = this.load();\n    }\n    return this.flags.get(name) === FeatureFlagState.Active;\n  }\n\n  save(options: FeatureFlagsSaveOptions): void {\n    if (!this.flags) {\n      this.flags = this.load();\n    }\n    if (!options.merge) {\n      this.flags.clear();\n    }\n    for (const [name, state] of Object.entries(options.states)) {\n      this.flags.set(name, state);\n    }\n\n    const enabled = Array.from(this.flags.entries()).filter(\n      ([, state]) => state === FeatureFlagState.Active,\n    );\n    window.localStorage.setItem(\n      'featureFlags',\n      JSON.stringify(Object.fromEntries(enabled)),\n    );\n  }\n\n  private load(): Map<string, FeatureFlagState> {\n    try {\n      const jsonStr = window.localStorage.getItem('featureFlags');\n      if (!jsonStr) {\n        return new Map();\n      }\n      const json = JSON.parse(jsonStr) as unknown;\n      if (typeof json !== 'object' || json === null || Array.isArray(json)) {\n        return new Map();\n      }\n\n      const entries = Object.entries(json).filter(([name, value]) => {\n        validateFlagName(name);\n        return value === FeatureFlagState.Active;\n      });\n\n      return new Map(entries);\n    } catch {\n      return new Map();\n    }\n  }\n}\n","/*\n * Copyright 2021 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { FetchApi } from '@backstage/core-plugin-api';\nimport { FetchMiddleware } from './types';\n\n/**\n * Builds a fetch API, based on the builtin fetch wrapped by a set of optional\n * middleware implementations that add behaviors.\n *\n * @remarks\n *\n * The middleware are applied in reverse order, i.e. the last one will be\n * \"closest\" to the base implementation. Passing in `[M1, M2, M3]` effectively\n * leads to `M1(M2(M3(baseImplementation)))`.\n *\n * @public\n */\nexport function createFetchApi(options: {\n  baseImplementation?: typeof fetch | undefined;\n  middleware?: FetchMiddleware | FetchMiddleware[] | undefined;\n}): FetchApi {\n  let result = options.baseImplementation || global.fetch;\n\n  const middleware = [options.middleware ?? []].flat().reverse();\n  for (const m of middleware) {\n    result = m.apply(result);\n  }\n\n  return {\n    fetch: result,\n  };\n}\n","/*\n * Copyright 2021 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { Config } from '@backstage/config';\nimport { IdentityApi } from '@backstage/core-plugin-api';\nimport { FetchMiddleware } from './types';\n\n/**\n * A fetch middleware, which injects a Backstage token header when the user is\n * signed in.\n */\nexport class IdentityAuthInjectorFetchMiddleware implements FetchMiddleware {\n  static create(options: {\n    identityApi: IdentityApi;\n    config?: Config;\n    urlPrefixAllowlist?: string[];\n    allowUrl?: (url: string) => boolean;\n    header?: {\n      name: string;\n      value: (backstageToken: string) => string;\n    };\n  }): IdentityAuthInjectorFetchMiddleware {\n    const matcher = buildMatcher(options);\n    const headerName = options.header?.name || 'authorization';\n    const headerValue = options.header?.value || (token => `Bearer ${token}`);\n\n    return new IdentityAuthInjectorFetchMiddleware(\n      options.identityApi,\n      matcher,\n      headerName,\n      headerValue,\n    );\n  }\n\n  constructor(\n    public readonly identityApi: IdentityApi,\n    public readonly allowUrl: (url: string) => boolean,\n    public readonly headerName: string,\n    public readonly headerValue: (pluginId: string) => string,\n  ) {}\n\n  apply(next: typeof fetch): typeof fetch {\n    return async (input, init) => {\n      // Skip this middleware if the header already exists, or if the URL\n      // doesn't match any of the allowlist items, or if there was no token\n      const request = new Request(input, init);\n      const { token } = await this.identityApi.getCredentials();\n      if (\n        request.headers.get(this.headerName) ||\n        typeof token !== 'string' ||\n        !token ||\n        !this.allowUrl(request.url)\n      ) {\n        return next(input, init);\n      }\n\n      request.headers.set(this.headerName, this.headerValue(token));\n      return next(request);\n    };\n  }\n}\n\nfunction buildMatcher(options: {\n  config?: Config;\n  urlPrefixAllowlist?: string[];\n  allowUrl?: (url: string) => boolean;\n}): (url: string) => boolean {\n  if (options.allowUrl) {\n    return options.allowUrl;\n  } else if (options.urlPrefixAllowlist) {\n    return buildPrefixMatcher(options.urlPrefixAllowlist);\n  } else if (options.config) {\n    return buildPrefixMatcher([options.config.getString('backend.baseUrl')]);\n  }\n  return () => false;\n}\n\nfunction buildPrefixMatcher(prefixes: string[]): (url: string) => boolean {\n  const trimmedPrefixes = prefixes.map(prefix => prefix.replace(/\\/$/, ''));\n  return url =>\n    trimmedPrefixes.some(\n      prefix => url === prefix || url.startsWith(`${prefix}/`),\n    );\n}\n","/*\n * Copyright 2021 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { DiscoveryApi } from '@backstage/core-plugin-api';\nimport { FetchMiddleware } from './types';\n\nfunction join(left: string, right: string): string {\n  if (!right || right === '/') {\n    return left;\n  }\n\n  return `${left.replace(/\\/$/, '')}/${right.replace(/^\\//, '')}`;\n}\n\n/**\n * Handles translation from plugin://some-plugin-id/<path> to concrete http(s)\n * URLs.\n */\nexport class PluginProtocolResolverFetchMiddleware implements FetchMiddleware {\n  constructor(private readonly discoveryApi: DiscoveryApi) {}\n\n  apply(next: typeof fetch): typeof fetch {\n    return async (input, init) => {\n      const request = new Request(input, init);\n      const prefix = 'plugin://';\n\n      if (!request.url.startsWith(prefix)) {\n        return next(input, init);\n      }\n\n      // Switch to a known protocol, since browser URL parsing misbehaves wildly\n      // on foreign protocols\n      const { hostname, pathname, search, hash, username, password } = new URL(\n        `http://${request.url.substring(prefix.length)}`,\n      );\n\n      let base = await this.discoveryApi.getBaseUrl(hostname);\n      if (username || password) {\n        const baseUrl = new URL(base);\n        const authority = `${username}${password ? `:${password}` : ''}@`;\n        base = `${baseUrl.protocol}//${authority}${baseUrl.host}${baseUrl.pathname}`;\n      }\n\n      const target = `${join(base, pathname)}${search}${hash}`;\n      return next(\n        target,\n        typeof input === 'string' || isUrl(input) ? init : input,\n      );\n    };\n  }\n}\n\nfunction isUrl(a: unknown): a is URL {\n  return typeof a === 'object' && a?.constructor === URL;\n}\n","/*\n * Copyright 2021 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { Config } from '@backstage/config';\nimport { DiscoveryApi, IdentityApi } from '@backstage/core-plugin-api';\nimport { IdentityAuthInjectorFetchMiddleware } from './IdentityAuthInjectorFetchMiddleware';\nimport { PluginProtocolResolverFetchMiddleware } from './PluginProtocolResolverFetchMiddleware';\nimport { FetchMiddleware } from './types';\n\n/**\n * A collection of common middlewares for the FetchApi.\n *\n * @public\n */\nexport class FetchMiddlewares {\n  /**\n   * Handles translation from `plugin://` URLs to concrete http(s) URLs based on\n   * the discovery API.\n   *\n   * @remarks\n   *\n   * If the request is for `plugin://catalog/entities?filter=x=y`, the discovery\n   * API will be queried for `'catalog'`. If it returned\n   * `https://backstage.example.net/api/catalog`, the resulting query would be\n   * `https://backstage.example.net/api/catalog/entities?filter=x=y`.\n   *\n   * If the incoming URL protocol was not `plugin`, the request is just passed\n   * through verbatim to the underlying implementation.\n   */\n  static resolvePluginProtocol(options: {\n    discoveryApi: DiscoveryApi;\n  }): FetchMiddleware {\n    return new PluginProtocolResolverFetchMiddleware(options.discoveryApi);\n  }\n\n  /**\n   * Injects a Backstage token header when the user is signed in.\n   *\n   * @remarks\n   *\n   * Per default, an `Authorization: Bearer <token>` is generated. This can be\n   * customized using the `header` option.\n   *\n   * The header injection only happens on allowlisted URLs. Per default, if the\n   * `config` option is passed in, the `backend.baseUrl` is allowlisted, unless\n   * the `urlPrefixAllowlist` or `allowUrl` options are passed in, in which case\n   * they take precedence. If you pass in neither config nor an\n   * allowlist/callback, the middleware will have no effect since effectively no\n   * request will match the (nonexistent) rules.\n   */\n  static injectIdentityAuth(options: {\n    identityApi: IdentityApi;\n    config?: Config;\n    urlPrefixAllowlist?: string[];\n    allowUrl?: (url: string) => boolean;\n    header?: {\n      name: string;\n      value: (backstageToken: string) => string;\n    };\n  }): FetchMiddleware {\n    return IdentityAuthInjectorFetchMiddleware.create(options);\n  }\n\n  private constructor() {}\n}\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { Observable } from '@backstage/types';\nimport { BehaviorSubject } from '../../../lib/subjects';\n\ntype RequestQueueEntry<ResultType> = {\n  scopes: Set<string>;\n  resolve: (value: ResultType | PromiseLike<ResultType>) => void;\n  reject: (reason: Error) => void;\n};\n\nexport type PendingRequest<ResultType> = {\n  scopes: Set<string> | undefined;\n  resolve: (value: ResultType) => void;\n  reject: (reason: Error) => void;\n};\n\nexport function hasScopes(\n  searched: Set<string>,\n  searchFor: Set<string>,\n): boolean {\n  for (const scope of searchFor) {\n    if (!searched.has(scope)) {\n      return false;\n    }\n  }\n  return true;\n}\n\nexport function joinScopes(\n  scopes: Set<string>,\n  ...moreScopess: Set<string>[]\n): Set<string> {\n  const result = new Set(scopes);\n\n  for (const moreScopes of moreScopess) {\n    for (const scope of moreScopes) {\n      result.add(scope);\n    }\n  }\n\n  return result;\n}\n\n/**\n * The OAuthPendingRequests class is a utility for managing and observing\n * a stream of requests for oauth scopes for a single provider, and resolving\n * them correctly once requests are fulfilled.\n */\nexport class OAuthPendingRequests<ResultType> {\n  private requests: RequestQueueEntry<ResultType>[] = [];\n  private subject = new BehaviorSubject<PendingRequest<ResultType>>(\n    this.getCurrentPending(),\n  );\n\n  request(scopes: Set<string>): Promise<ResultType> {\n    return new Promise((resolve, reject) => {\n      this.requests.push({ scopes, resolve, reject });\n\n      this.subject.next(this.getCurrentPending());\n    });\n  }\n\n  resolve(scopes: Set<string>, result: ResultType): void {\n    this.requests = this.requests.filter(request => {\n      if (hasScopes(scopes, request.scopes)) {\n        request.resolve(result);\n        return false;\n      }\n      return true;\n    });\n\n    this.subject.next(this.getCurrentPending());\n  }\n\n  reject(error: Error) {\n    this.requests.forEach(request => request.reject(error));\n    this.requests = [];\n\n    this.subject.next(this.getCurrentPending());\n  }\n\n  pending(): Observable<PendingRequest<ResultType>> {\n    return this.subject;\n  }\n\n  private getCurrentPending(): PendingRequest<ResultType> {\n    const currentScopes =\n      this.requests.length === 0\n        ? undefined\n        : this.requests\n            .slice(1)\n            .reduce(\n              (acc, current) => joinScopes(acc, current.scopes),\n              this.requests[0].scopes,\n            );\n\n    return {\n      scopes: currentScopes,\n      resolve: (value: ResultType) => {\n        if (currentScopes) {\n          this.resolve(currentScopes, value);\n        }\n      },\n      reject: (reason: Error) => {\n        if (currentScopes) {\n          this.reject(reason);\n        }\n      },\n    };\n  }\n}\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  OAuthRequestApi,\n  PendingOAuthRequest,\n  OAuthRequester,\n  OAuthRequesterOptions,\n} from '@backstage/core-plugin-api';\nimport { Observable } from '@backstage/types';\nimport { OAuthPendingRequests, PendingRequest } from './OAuthPendingRequests';\nimport { BehaviorSubject } from '../../../lib/subjects';\n\n/**\n * The OAuthRequestManager is an implementation of the OAuthRequestApi.\n *\n * The purpose of this class and the API is to read a stream of incoming requests\n * of OAuth access tokens from different providers with varying scope, and funnel\n * them all together into a single request for each OAuth provider.\n *\n * @public\n */\nexport class OAuthRequestManager implements OAuthRequestApi {\n  private readonly subject = new BehaviorSubject<PendingOAuthRequest[]>([]);\n  private currentRequests: PendingOAuthRequest[] = [];\n  private handlerCount = 0;\n\n  createAuthRequester<T>(options: OAuthRequesterOptions<T>): OAuthRequester<T> {\n    const handler = new OAuthPendingRequests<T>();\n\n    const index = this.handlerCount;\n    this.handlerCount++;\n\n    handler.pending().subscribe({\n      next: scopeRequest => {\n        const newRequests = this.currentRequests.slice();\n        const request = this.makeAuthRequest(scopeRequest, options);\n        if (!request) {\n          delete newRequests[index];\n        } else {\n          newRequests[index] = request;\n        }\n        this.currentRequests = newRequests;\n        // Convert from sparse array to array of present items only\n        this.subject.next(newRequests.filter(Boolean));\n      },\n    });\n\n    return scopes => {\n      return handler.request(scopes);\n    };\n  }\n\n  // Converts the pending request and popup options into a popup request that we can forward to subscribers.\n  private makeAuthRequest(\n    request: PendingRequest<any>,\n    options: OAuthRequesterOptions<any>,\n  ): PendingOAuthRequest | undefined {\n    const { scopes } = request;\n    if (!scopes) {\n      return undefined;\n    }\n\n    return {\n      provider: options.provider,\n      trigger: async () => {\n        const result = await options.onAuthRequest(scopes);\n        request.resolve(result);\n      },\n      reject: () => {\n        const error = new Error('Login failed, rejected by user');\n        error.name = 'RejectedError';\n        request.reject(error);\n      },\n    };\n  }\n\n  authRequest$(): Observable<PendingOAuthRequest[]> {\n    return this.subject;\n  }\n}\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  StorageApi,\n  StorageValueSnapshot,\n  ErrorApi,\n} from '@backstage/core-plugin-api';\nimport { JsonValue, Observable } from '@backstage/types';\nimport ObservableImpl from 'zen-observable';\n\nconst buckets = new Map<string, WebStorage>();\n\n/**\n * An implementation of the storage API, that uses the browser's local storage.\n *\n * @public\n */\nexport class WebStorage implements StorageApi {\n  constructor(\n    private readonly namespace: string,\n    private readonly errorApi: ErrorApi,\n  ) {}\n\n  static create(options: {\n    errorApi: ErrorApi;\n    namespace?: string;\n  }): WebStorage {\n    return new WebStorage(options.namespace ?? '', options.errorApi);\n  }\n\n  get<T>(key: string): T | undefined {\n    return this.snapshot(key).value as T | undefined;\n  }\n\n  snapshot<T extends JsonValue>(key: string): StorageValueSnapshot<T> {\n    let value = undefined;\n    let presence: 'present' | 'absent' = 'absent';\n    try {\n      const item = localStorage.getItem(this.getKeyName(key));\n      if (item) {\n        value = JSON.parse(item, (_key, val) => {\n          if (typeof val === 'object' && val !== null) {\n            Object.freeze(val);\n          }\n          return val;\n        });\n        presence = 'present';\n      }\n    } catch (e) {\n      this.errorApi.post(\n        new Error(`Error when parsing JSON config from storage for: ${key}`),\n      );\n    }\n    return { key, value, presence };\n  }\n\n  forBucket(name: string): WebStorage {\n    const bucketPath = `${this.namespace}/${name}`;\n    if (!buckets.has(bucketPath)) {\n      buckets.set(bucketPath, new WebStorage(bucketPath, this.errorApi));\n    }\n    return buckets.get(bucketPath)!;\n  }\n\n  async set<T>(key: string, data: T): Promise<void> {\n    localStorage.setItem(this.getKeyName(key), JSON.stringify(data));\n    this.notifyChanges(key);\n  }\n\n  async remove(key: string): Promise<void> {\n    localStorage.removeItem(this.getKeyName(key));\n    this.notifyChanges(key);\n  }\n\n  observe$<T extends JsonValue>(\n    key: string,\n  ): Observable<StorageValueSnapshot<T>> {\n    return this.observable.filter(({ key: messageKey }) => messageKey === key);\n  }\n\n  private getKeyName(key: string) {\n    return `${this.namespace}/${encodeURIComponent(key)}`;\n  }\n\n  private notifyChanges(key: string) {\n    const snapshot = this.snapshot(key);\n    for (const subscription of this.subscribers) {\n      subscription.next(snapshot);\n    }\n  }\n\n  private subscribers = new Set<\n    ZenObservable.SubscriptionObserver<StorageValueSnapshot<JsonValue>>\n  >();\n\n  private readonly observable = new ObservableImpl<\n    StorageValueSnapshot<JsonValue>\n  >(subscriber => {\n    this.subscribers.add(subscriber);\n    return () => {\n      this.subscribers.delete(subscriber);\n    };\n  });\n}\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { isValidElement, ReactNode, ReactElement, Children } from 'react';\n\nexport type Discoverer = (element: ReactElement) => ReactNode;\n\nexport type Collector<Result, Context> = () => {\n  accumulator: Result;\n  visit(\n    accumulator: Result,\n    element: ReactElement,\n    parent: ReactElement | undefined,\n    context: Context,\n  ): Context;\n};\n\n/**\n * A function that allows you to traverse a tree of React elements using\n * varying methods to discover child nodes and collect data along the way.\n */\nexport function traverseElementTree<Results>(options: {\n  root: ReactNode;\n  discoverers: Discoverer[];\n  collectors: { [name in keyof Results]: Collector<Results[name], any> };\n}): Results {\n  const collectors: {\n    [name in string]: ReturnType<Collector<any, any>>;\n  } = {};\n\n  // Bootstrap all collectors, initializing the accumulators and providing the visitor function\n  for (const name in options.collectors) {\n    if (options.collectors.hasOwnProperty(name)) {\n      collectors[name] = options.collectors[name]();\n    }\n  }\n\n  // Internal representation of an element in the tree that we're iterating over\n  type QueueItem = {\n    node: ReactNode;\n    parent: ReactElement | undefined;\n    contexts: { [name in string]: unknown };\n  };\n\n  const queue = [\n    {\n      node: Children.toArray(options.root),\n      parent: undefined,\n      contexts: {},\n    } as QueueItem,\n  ];\n\n  while (queue.length !== 0) {\n    const { node, parent, contexts } = queue.shift()!;\n\n    // While the parent and the element we pass on to collectors and discoverers\n    // have been validated and are known to be React elements, the child nodes\n    // emitted by the discoverers are not.\n    Children.forEach(node, element => {\n      if (!isValidElement(element)) {\n        return;\n      }\n\n      const nextContexts: QueueItem['contexts'] = {};\n\n      // Collectors populate their result data using the current node, and compute\n      // context for the next iteration\n      for (const name in collectors) {\n        if (collectors.hasOwnProperty(name)) {\n          const collector = collectors[name];\n\n          nextContexts[name] = collector.visit(\n            collector.accumulator,\n            element,\n            parent,\n            contexts[name],\n          );\n        }\n      }\n\n      // Discoverers provide ways to continue the traversal from the current element\n      for (const discoverer of options.discoverers) {\n        const children = discoverer(element);\n        if (children) {\n          queue.push({\n            node: children,\n            parent: element,\n            contexts: nextContexts,\n          });\n        }\n      }\n    });\n  }\n\n  return Object.fromEntries(\n    Object.entries(collectors).map(([name, c]) => [name, c.accumulator]),\n  ) as Results;\n}\n\nexport function createCollector<Result, Context>(\n  accumulatorFactory: () => Result,\n  visit: ReturnType<Collector<Result, Context>>['visit'],\n): Collector<Result, Context> {\n  return () => ({ accumulator: accumulatorFactory(), visit });\n}\n\nexport function childDiscoverer(element: ReactElement): ReactNode {\n  return element.props?.children;\n}\n\nexport function routeElementDiscoverer(element: ReactElement): ReactNode {\n  if (element.props?.path && element.props?.element) {\n    return element.props?.element;\n  }\n  return undefined;\n}\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { BackstagePlugin, getComponentData } from '@backstage/core-plugin-api';\nimport { createCollector } from '../extensions/traversal';\n\nexport const pluginCollector = createCollector(\n  () => new Set<BackstagePlugin>(),\n  (acc, node) => {\n    const plugin = getComponentData<BackstagePlugin>(node, 'core.plugin');\n    if (plugin) {\n      acc.add(plugin);\n    }\n  },\n);\n","/*\n * Copyright 2021 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  featureFlagsApiRef,\n  useApi,\n  attachComponentData,\n} from '@backstage/core-plugin-api';\nimport React, { ReactNode } from 'react';\n\n/**\n * Props for the {@link FeatureFlagged} component.\n *\n * @public\n */\nexport type FeatureFlaggedProps = { children: ReactNode } & (\n  | { with: string }\n  | { without: string }\n);\n\n/**\n * Enables or disables rendering of its children based on the state of a given\n * feature flag.\n *\n * @public\n */\nexport const FeatureFlagged = (props: FeatureFlaggedProps) => {\n  const { children } = props;\n  const featureFlagApi = useApi(featureFlagsApiRef);\n  const isEnabled =\n    'with' in props\n      ? featureFlagApi.isActive(props.with)\n      : !featureFlagApi.isActive(props.without);\n  return <>{isEnabled ? children : null}</>;\n};\n\nattachComponentData(FeatureFlagged, 'core.featureFlagged', true);\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  RouteRef,\n  getComponentData,\n  BackstagePlugin,\n} from '@backstage/core-plugin-api';\nimport { isValidElement, ReactNode, Children } from 'react';\nimport { BackstageRouteObject } from './types';\nimport { createCollector } from '../extensions/traversal';\nimport { FeatureFlagged, FeatureFlaggedProps } from './FeatureFlagged';\n\n// We always add a child that matches all subroutes but without any route refs. This makes\n// sure that we're always able to match each route no matter how deep the navigation goes.\n// The route resolver then takes care of selecting the most specific match in order to find\n// mount points that are as deep in the routing tree as possible.\nexport const MATCH_ALL_ROUTE: BackstageRouteObject = {\n  caseSensitive: false,\n  path: '*',\n  element: 'match-all', // These elements aren't used, so we add in a bit of debug information\n  routeRefs: new Set(),\n};\n\nfunction stringifyNode(node: ReactNode): string {\n  const anyNode = node as { type?: { displayName?: string; name?: string } };\n  if (anyNode?.type) {\n    return (\n      anyNode.type.displayName ?? anyNode.type.name ?? String(anyNode.type)\n    );\n  }\n  return String(anyNode);\n}\n\ninterface RoutingV2CollectorContext {\n  routeRef?: RouteRef;\n  gatherPath?: string;\n  gatherRouteRef?: RouteRef;\n  obj?: BackstageRouteObject;\n  isElementAncestor?: boolean;\n}\n\n// This collects all the mount points and their plugins within an element tree.\n// Unlike regular traversal this ignores all other things, like path props and mount point gatherers.\nfunction collectSubTree(\n  node: ReactNode,\n  entries = new Array<{ routeRef: RouteRef; plugin?: BackstagePlugin }>(),\n) {\n  Children.forEach(node, element => {\n    if (!isValidElement(element)) {\n      return;\n    }\n\n    const routeRef = getComponentData<RouteRef>(element, 'core.mountPoint');\n    if (routeRef) {\n      const plugin = getComponentData<BackstagePlugin>(element, 'core.plugin');\n      entries.push({ routeRef, plugin });\n    }\n\n    collectSubTree(element.props.children, entries);\n  });\n\n  return entries;\n}\n\nexport const routingV2Collector = createCollector(\n  () => ({\n    paths: new Map<RouteRef, string>(),\n    parents: new Map<RouteRef, RouteRef | undefined>(),\n    objects: new Array<BackstageRouteObject>(),\n  }),\n  (acc, node, parent, ctx?: RoutingV2CollectorContext) => {\n    // If we're in an element prop, ignore everything\n    if (ctx?.isElementAncestor) {\n      return ctx;\n    }\n\n    // Start ignoring everything if we enter an element prop\n    if (parent?.props.element === node) {\n      return { ...ctx, isElementAncestor: true };\n    }\n\n    const pathProp: unknown = node.props?.path;\n\n    const mountPoint = getComponentData<RouteRef>(node, 'core.mountPoint');\n    if (mountPoint && pathProp) {\n      throw new Error(\n        `Path property may not be set directly on a routable extension \"${stringifyNode(\n          node,\n        )}\"`,\n      );\n    }\n\n    const parentChildren = ctx?.obj?.children ?? acc.objects;\n\n    if (pathProp !== undefined) {\n      if (typeof pathProp !== 'string') {\n        throw new Error(\n          `Element path must be a string at \"${stringifyNode(node)}\"`,\n        );\n      }\n\n      const path = pathProp.startsWith('/') ? pathProp.slice(1) : pathProp;\n\n      const elementProp = node.props.element;\n\n      if (getComponentData<boolean>(node, 'core.gatherMountPoints')) {\n        if (elementProp) {\n          throw new Error(\n            `Mount point gatherers may not have an element prop \"${stringifyNode(\n              node,\n            )}\"`,\n          );\n        }\n\n        const newObj = {\n          path,\n          element: 'gathered',\n          routeRefs: new Set<RouteRef>(),\n          caseSensitive: Boolean(node.props?.caseSensitive),\n          children: [MATCH_ALL_ROUTE],\n          plugin: undefined,\n        };\n        parentChildren.push(newObj);\n\n        return {\n          obj: newObj,\n          gatherPath: path,\n          routeRef: ctx?.routeRef,\n          gatherRouteRef: ctx?.routeRef,\n        };\n      }\n\n      if (elementProp) {\n        const [extension, ...others] = collectSubTree(elementProp);\n        if (others.length > 0) {\n          throw new Error(\n            `Route element with path \"${pathProp}\" may not contain multiple routable extensions`,\n          );\n        }\n        if (!extension) {\n          return ctx;\n        }\n        const { routeRef, plugin } = extension;\n\n        const newObj = {\n          path,\n          element: 'mounted',\n          routeRefs: new Set([routeRef]),\n          caseSensitive: Boolean(node.props?.caseSensitive),\n          children: [MATCH_ALL_ROUTE],\n          plugin,\n        };\n        parentChildren.push(newObj);\n        acc.paths.set(routeRef, path);\n        acc.parents.set(routeRef, ctx?.routeRef);\n\n        return {\n          obj: newObj,\n          routeRef: routeRef ?? ctx?.routeRef,\n          gatherPath: path,\n          gatherRouteRef: ctx?.gatherRouteRef,\n        };\n      }\n    }\n\n    if (mountPoint) {\n      if (ctx?.gatherPath === undefined) {\n        throw new Error(\n          `Routable extension \"${stringifyNode(\n            node,\n          )}\" with mount point \"${mountPoint}\" must be assigned a path`,\n        );\n      }\n\n      ctx?.obj?.routeRefs.add(mountPoint);\n      acc.paths.set(mountPoint, ctx.gatherPath);\n      acc.parents.set(mountPoint, ctx?.gatherRouteRef);\n\n      return {\n        ...ctx,\n        routeRef: mountPoint,\n      };\n    }\n\n    return ctx;\n  },\n);\n\ninterface RoutingV1CollectorContext {\n  path?: string;\n  routeRef?: RouteRef;\n  obj?: BackstageRouteObject;\n  sticky?: boolean;\n}\n\n/**\n * This is the old V1 logic for collecting the routing model.\n * It is being replaced by a new collector because this collection\n * logic does not work well beyond react-router v6 beta.\n *\n * The breaking change is that react-router now requires route\n * elements to be `Route` components, and directly renders the\n * element prop rather than the `Route` itself. This means it is\n * no longer possible to create utility route components. In order\n * to fill this gap and in general simplify the route collection\n * logic, a new route collection logic is created.\n *\n * @internal\n */\nexport const routingV1Collector = createCollector(\n  () => ({\n    paths: new Map<RouteRef, string>(),\n    parents: new Map<RouteRef, RouteRef | undefined>(),\n    objects: new Array<BackstageRouteObject>(),\n  }),\n  (acc, node, parent, ctx?: RoutingV1CollectorContext) => {\n    // Ignore the top-level element within element props, since it's already been collected.\n    if (parent?.props.element === node) {\n      return ctx;\n    }\n\n    let currentObj = ctx?.obj;\n    let currentParentRouteRef = ctx?.routeRef;\n    let sticky = ctx?.sticky;\n\n    const path: string | undefined = node.props?.path;\n    const parentChildren = currentObj?.children ?? acc.objects;\n    const caseSensitive: boolean = Boolean(node.props?.caseSensitive);\n\n    // The context path is used during mount point gathering to assign the same path\n    // to all discovered mount points\n    let currentCtxPath = ctx?.path;\n\n    // Start gathering mount points when we encounter a mount point gathering flag\n    if (getComponentData<boolean>(node, 'core.gatherMountPoints')) {\n      if (!path) {\n        throw new Error('Mount point gatherer must have a path');\n      }\n      currentCtxPath = path;\n    }\n\n    // Route refs are discovered on the element itself, and on the top-level\n    // element within the element prop if it exists.\n    const element = node.props?.element;\n    let routeRef = getComponentData<RouteRef>(node, 'core.mountPoint');\n    if (!routeRef && isValidElement(element)) {\n      routeRef = getComponentData<RouteRef>(element, 'core.mountPoint');\n    }\n\n    if (routeRef) {\n      // First the path gathering\n\n      let routePath: string | undefined = path;\n      // If we're gathering mount points we use the context path as out path, unless\n      // the element has its own path, in which case we use that instead and stop gathering\n      if (currentCtxPath) {\n        if (routePath) {\n          currentCtxPath = undefined;\n        } else {\n          routePath = currentCtxPath;\n        }\n      }\n      if (!routePath) {\n        throw new Error('Mounted routable extension must have a path');\n      }\n      acc.paths.set(routeRef, routePath);\n\n      // Then the parent gathering\n\n      // \"sticky\" route ref is when we've encountered a mount point gatherer, and we want a\n      // mount points beneath it to have the same parent, regardless of internal structure\n      if (currentParentRouteRef && sticky) {\n        acc.parents.set(routeRef, currentParentRouteRef);\n\n        // When we encounter a mount point with an explicit path, we stop gathering\n        // mount points within the children and remove the sticky state\n        if (path) {\n          currentParentRouteRef = routeRef;\n          sticky = false;\n        }\n      } else {\n        acc.parents.set(routeRef, currentParentRouteRef);\n        currentParentRouteRef = routeRef;\n      }\n\n      // Then construct the objects\n\n      if (path) {\n        currentObj = {\n          caseSensitive,\n          path,\n          element: 'mounted',\n          routeRefs: new Set([routeRef]),\n          children: [MATCH_ALL_ROUTE],\n          plugin: getComponentData<BackstagePlugin>(\n            node.props.element,\n            'core.plugin',\n          ),\n        };\n        parentChildren.push(currentObj);\n      } else {\n        currentObj?.routeRefs.add(routeRef);\n      }\n    }\n\n    if (getComponentData<boolean>(node, 'core.gatherMountPoints')) {\n      sticky = true;\n    }\n\n    const isGatherer = getComponentData<boolean>(\n      node,\n      'core.gatherMountPoints',\n    );\n    if (isGatherer) {\n      if (!path) {\n        throw new Error('Mount point gatherer must have a path');\n      }\n      if (!routeRef) {\n        currentObj = {\n          caseSensitive,\n          path,\n          element: 'gathered',\n          routeRefs: new Set(),\n          children: [MATCH_ALL_ROUTE],\n          plugin: ctx?.obj?.plugin,\n        };\n        parentChildren.push(currentObj);\n      }\n    }\n\n    return {\n      obj: currentObj,\n      path: currentCtxPath,\n      routeRef: currentParentRouteRef,\n      sticky,\n    };\n  },\n);\n\nexport const featureFlagCollector = createCollector(\n  () => new Set<string>(),\n  (acc, node) => {\n    if (node.type === FeatureFlagged) {\n      const props = node.props as FeatureFlaggedProps;\n      acc.add('with' in props ? props.with : props.without);\n    }\n  },\n);\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  RouteRef,\n  SubRouteRef,\n  ExternalRouteRef,\n  BackstagePlugin,\n} from '@backstage/core-plugin-api';\nimport { getOrCreateGlobalSingleton } from '@backstage/version-bridge';\n\ntype RouteRefType = Exclude<\n  keyof RouteRef,\n  'params' | 'path' | 'title' | 'icon'\n>;\nexport const routeRefType: RouteRefType = getOrCreateGlobalSingleton<any>(\n  'route-ref-type',\n  () => Symbol('route-ref-type'),\n);\n\nexport type AnyParams = { [param in string]: string } | undefined;\n\nexport type AnyRouteRef =\n  | RouteRef<any>\n  | SubRouteRef<any>\n  | ExternalRouteRef<any, any>;\n\n// The extra TS magic here is to require a single params argument if the RouteRef\n// had at least one param defined, but require 0 arguments if there are no params defined.\n// Without this we'd have to pass in empty object to all parameter-less RouteRefs\n// just to make TypeScript happy, or we would have to make the argument optional in\n// which case you might forget to pass it in when it is actually required.\nexport type RouteFunc<Params extends AnyParams> = (\n  ...[params]: Params extends undefined ? readonly [] : readonly [Params]\n) => string;\n\n// A duplicate of the react-router RouteObject, but with routeRef added\nexport interface BackstageRouteObject {\n  caseSensitive: boolean;\n  children?: BackstageRouteObject[];\n  element: React.ReactNode;\n  path: string;\n  routeRefs: Set<RouteRef>;\n  plugin?: BackstagePlugin;\n}\n\nexport function isRouteRef<Params extends AnyParams>(\n  routeRef:\n    | RouteRef<Params>\n    | SubRouteRef<Params>\n    | ExternalRouteRef<Params, any>,\n): routeRef is RouteRef<Params> {\n  return routeRef[routeRefType] === 'absolute';\n}\n\nexport function isSubRouteRef<Params extends AnyParams>(\n  routeRef:\n    | RouteRef<Params>\n    | SubRouteRef<Params>\n    | ExternalRouteRef<Params, any>,\n): routeRef is SubRouteRef<Params> {\n  return routeRef[routeRefType] === 'sub';\n}\n\nexport function isExternalRouteRef<\n  Params extends AnyParams,\n  Optional extends boolean,\n>(\n  routeRef:\n    | RouteRef<Params>\n    | SubRouteRef<Params>\n    | ExternalRouteRef<Params, Optional>,\n): routeRef is ExternalRouteRef<Params, Optional> {\n  return routeRef[routeRefType] === 'external';\n}\n","/*\n * Copyright 2022 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n// Joins a list of paths together, avoiding trailing and duplicate slashes\nexport function joinPaths(...paths: string[]): string {\n  const normalized = paths.join('/').replace(/\\/\\/+/g, '/');\n  if (normalized !== '/' && normalized.endsWith('/')) {\n    return normalized.slice(0, -1);\n  }\n  return normalized;\n}\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { generatePath, matchRoutes } from 'react-router-dom';\nimport {\n  AnyRouteRef,\n  BackstageRouteObject,\n  AnyParams,\n  RouteFunc,\n  routeRefType,\n  isRouteRef,\n  isSubRouteRef,\n  isExternalRouteRef,\n} from './types';\nimport {\n  RouteRef,\n  ExternalRouteRef,\n  SubRouteRef,\n} from '@backstage/core-plugin-api';\nimport { joinPaths } from './helpers';\n\n/**\n * Resolves the absolute route ref that our target route ref is pointing pointing to, as well\n * as the relative target path.\n *\n * Returns an undefined target ref if one could not be fully resolved.\n */\nfunction resolveTargetRef(\n  anyRouteRef: AnyRouteRef,\n  routePaths: Map<RouteRef, string>,\n  routeBindings: Map<AnyRouteRef, AnyRouteRef | undefined>,\n): readonly [RouteRef | undefined, string] {\n  // First we figure out which absolute route ref we're dealing with, an if there was an sub route path to append.\n  // For sub routes it will be the parent path, while for external routes it will be the bound route.\n  let targetRef: RouteRef;\n  let subRoutePath = '';\n  if (isRouteRef(anyRouteRef)) {\n    targetRef = anyRouteRef;\n  } else if (isSubRouteRef(anyRouteRef)) {\n    targetRef = anyRouteRef.parent;\n    subRoutePath = anyRouteRef.path;\n  } else if (isExternalRouteRef(anyRouteRef)) {\n    const resolvedRoute = routeBindings.get(anyRouteRef);\n    if (!resolvedRoute) {\n      return [undefined, ''];\n    }\n    if (isRouteRef(resolvedRoute)) {\n      targetRef = resolvedRoute;\n    } else if (isSubRouteRef(resolvedRoute)) {\n      targetRef = resolvedRoute.parent;\n      subRoutePath = resolvedRoute.path;\n    } else {\n      throw new Error(\n        `ExternalRouteRef was bound to invalid target, ${resolvedRoute}`,\n      );\n    }\n  } else if (anyRouteRef[routeRefType]) {\n    throw new Error(\n      `Unknown or invalid route ref type, ${anyRouteRef[routeRefType]}`,\n    );\n  } else {\n    throw new Error(`Unknown object passed to useRouteRef, got ${anyRouteRef}`);\n  }\n\n  // Bail if no absolute path could be resolved\n  if (!targetRef) {\n    return [undefined, ''];\n  }\n\n  // Find the path that our target route is bound to\n  const resolvedPath = routePaths.get(targetRef);\n  if (resolvedPath === undefined) {\n    return [undefined, ''];\n  }\n\n  // SubRouteRefs join the path from the parent route with its own path\n  const targetPath = joinPaths(resolvedPath, subRoutePath);\n  return [targetRef, targetPath];\n}\n\n/**\n * Resolves the complete base path for navigating to the target RouteRef.\n */\nfunction resolveBasePath(\n  targetRef: RouteRef,\n  sourceLocation: Parameters<typeof matchRoutes>[1],\n  routePaths: Map<RouteRef, string>,\n  routeParents: Map<RouteRef, RouteRef | undefined>,\n  routeObjects: BackstageRouteObject[],\n) {\n  // While traversing the app element tree we build up the routeObjects structure\n  // used here. It is the same kind of structure that react-router creates, with the\n  // addition that associated route refs are stored throughout the tree. This lets\n  // us look up all route refs that can be reached from our source location.\n  // Because of the similar route object structure, we can use `matchRoutes` from\n  // react-router to do the lookup of our current location.\n  const match = matchRoutes(routeObjects, sourceLocation) ?? [];\n\n  // While we search for a common routing root between our current location and\n  // the target route, we build a list of all route refs we find that we need\n  // to traverse to reach the target.\n  const refDiffList = Array<RouteRef>();\n\n  let matchIndex = -1;\n  for (\n    let targetSearchRef: RouteRef | undefined = targetRef;\n    targetSearchRef;\n    targetSearchRef = routeParents.get(targetSearchRef)\n  ) {\n    // The match contains a list of all ancestral route refs present at our current location\n    // Starting at the desired target ref and traversing back through its parents, we search\n    // for a target ref that is present in the match for our current location. When a match\n    // is found it means we have found a common base to resolve the route from.\n    matchIndex = match.findIndex(m =>\n      (m.route as BackstageRouteObject).routeRefs.has(targetSearchRef!),\n    );\n    if (matchIndex !== -1) {\n      break;\n    }\n\n    // Every time we move a step up in the ancestry of the target ref, we add the current ref\n    // to the diff list, which ends up being the list of route refs to traverse form the common base\n    // in order to reach our target.\n    refDiffList.unshift(targetSearchRef);\n  }\n\n  // If our target route is present in the initial match we need to construct the final path\n  // from the parent of the matched route segment. That's to allow the caller of the route\n  // function to supply their own params.\n  if (refDiffList.length === 0) {\n    matchIndex -= 1;\n  }\n\n  // This is the part of the route tree that the target and source locations have in common.\n  // We re-use the existing pathname directly along with all params.\n  const parentPath = matchIndex === -1 ? '' : match[matchIndex].pathname;\n\n  // This constructs the mid section of the path using paths resolved from all route refs\n  // we need to traverse to reach our target except for the very last one. None of these\n  // paths are allowed to require any parameters, as the caller would have no way of knowing\n  // what parameters those are.\n  const diffPaths = refDiffList.slice(0, -1).map(ref => {\n    const path = routePaths.get(ref);\n    if (path === undefined) {\n      throw new Error(`No path for ${ref}`);\n    }\n    if (path.includes(':')) {\n      throw new Error(\n        `Cannot route to ${targetRef} with parent ${ref} as it has parameters`,\n      );\n    }\n    return path;\n  });\n\n  return `${joinPaths(parentPath, ...diffPaths)}/`;\n}\n\nexport class RouteResolver {\n  constructor(\n    private readonly routePaths: Map<RouteRef, string>,\n    private readonly routeParents: Map<RouteRef, RouteRef | undefined>,\n    private readonly routeObjects: BackstageRouteObject[],\n    private readonly routeBindings: Map<\n      ExternalRouteRef,\n      RouteRef | SubRouteRef\n    >,\n    private readonly appBasePath: string, // base path without a trailing slash\n  ) {}\n\n  resolve<Params extends AnyParams>(\n    anyRouteRef:\n      | RouteRef<Params>\n      | SubRouteRef<Params>\n      | ExternalRouteRef<Params, any>,\n    sourceLocation: Parameters<typeof matchRoutes>[1],\n  ): RouteFunc<Params> | undefined {\n    // First figure out what our target absolute ref is, as well as our target path.\n    const [targetRef, targetPath] = resolveTargetRef(\n      anyRouteRef,\n      this.routePaths,\n      this.routeBindings,\n    );\n    if (!targetRef) {\n      return undefined;\n    }\n\n    // The location that we get passed in uses the full path, so start by trimming off\n    // the app base path prefix in case we're running the app on a sub-path.\n    let relativeSourceLocation: Parameters<typeof matchRoutes>[1];\n    if (typeof sourceLocation === 'string') {\n      relativeSourceLocation = this.trimPath(sourceLocation);\n    } else if (sourceLocation.pathname) {\n      relativeSourceLocation = {\n        ...sourceLocation,\n        pathname: this.trimPath(sourceLocation.pathname),\n      };\n    } else {\n      relativeSourceLocation = sourceLocation;\n    }\n\n    // Next we figure out the base path, which is the combination of the common parent path\n    // between our current location and our target location, as well as the additional path\n    // that is the difference between the parent path and the base of our target location.\n    const basePath =\n      this.appBasePath +\n      resolveBasePath(\n        targetRef,\n        relativeSourceLocation,\n        this.routePaths,\n        this.routeParents,\n        this.routeObjects,\n      );\n\n    const routeFunc: RouteFunc<Params> = (...[params]) => {\n      return joinPaths(basePath, generatePath(targetPath, params));\n    };\n    return routeFunc;\n  }\n\n  private trimPath(targetPath: string) {\n    if (!targetPath) {\n      return targetPath;\n    }\n\n    if (targetPath.startsWith(this.appBasePath)) {\n      return targetPath.slice(this.appBasePath.length);\n    }\n    return targetPath;\n  }\n}\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React, { ReactNode } from 'react';\nimport {\n  ExternalRouteRef,\n  RouteRef,\n  SubRouteRef,\n} from '@backstage/core-plugin-api';\nimport {\n  createVersionedValueMap,\n  createVersionedContext,\n} from '@backstage/version-bridge';\nimport { RouteResolver } from './RouteResolver';\nimport { BackstageRouteObject } from './types';\n\nconst RoutingContext = createVersionedContext<{ 1: RouteResolver }>(\n  'routing-context',\n);\n\ntype ProviderProps = {\n  routePaths: Map<RouteRef, string>;\n  routeParents: Map<RouteRef, RouteRef | undefined>;\n  routeObjects: BackstageRouteObject[];\n  routeBindings: Map<ExternalRouteRef, RouteRef | SubRouteRef>;\n  basePath?: string;\n  children: ReactNode;\n};\n\nexport const RoutingProvider = ({\n  routePaths,\n  routeParents,\n  routeObjects,\n  routeBindings,\n  basePath = '',\n  children,\n}: ProviderProps) => {\n  const resolver = new RouteResolver(\n    routePaths,\n    routeParents,\n    routeObjects,\n    routeBindings,\n    basePath,\n  );\n\n  const versionedValue = createVersionedValueMap({ 1: resolver });\n  return (\n    <RoutingContext.Provider value={versionedValue}>\n      {children}\n    </RoutingContext.Provider>\n  );\n};\n","/*\n * Copyright 2021 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React, { useEffect } from 'react';\nimport { matchRoutes, useLocation } from 'react-router-dom';\nimport {\n  useAnalytics,\n  AnalyticsContext,\n  CommonAnalyticsContext,\n  RouteRef,\n} from '@backstage/core-plugin-api';\nimport { BackstageRouteObject } from './types';\n\n/**\n * Returns an extension context given the current pathname and a list of\n * Backstage route objects.\n */\nconst getExtensionContext = (\n  pathname: string,\n  routes: BackstageRouteObject[],\n): CommonAnalyticsContext | {} => {\n  try {\n    // Find matching routes for the given path name.\n    const matches = matchRoutes(routes, { pathname }) as\n      | { route: BackstageRouteObject }[]\n      | null;\n\n    // Of the matching routes, get the last (e.g. most specific) instance of\n    // the BackstageRouteObject.\n    const routeObject = matches\n      ?.filter(match => match?.route.routeRefs?.size > 0)\n      .pop()?.route;\n\n    // If there is no route object, then allow inheritance of default context.\n    if (!routeObject) {\n      return {};\n    }\n\n    // If there is a single route ref, return it.\n    // todo: get routeRef of rendered gathered mount point(?)\n    let routeRef: RouteRef | undefined;\n    if (routeObject.routeRefs.size === 1) {\n      routeRef = routeObject.routeRefs.values().next().value;\n    }\n\n    return {\n      extension: 'App',\n      pluginId: routeObject.plugin?.getId() || 'root',\n      ...(routeRef ? { routeRef: (routeRef as { id?: string }).id } : {}),\n    };\n  } catch {\n    return {};\n  }\n};\n\n/**\n * Performs the actual event capture on render.\n */\nconst TrackNavigation = ({\n  pathname,\n  search,\n  hash,\n}: {\n  pathname: string;\n  search: string;\n  hash: string;\n}) => {\n  const analytics = useAnalytics();\n\n  useEffect(() => {\n    analytics.captureEvent('navigate', `${pathname}${search}${hash}`);\n  }, [analytics, pathname, search, hash]);\n\n  return null;\n};\n\n/**\n * Logs a \"navigate\" event with appropriate plugin-level analytics context\n * attributes each time the user navigates to a page.\n */\nexport const RouteTracker = ({\n  routeObjects,\n}: {\n  routeObjects: BackstageRouteObject[];\n}) => {\n  const { pathname, search, hash } = useLocation();\n\n  return (\n    <AnalyticsContext attributes={getExtensionContext(pathname, routeObjects)}>\n      <TrackNavigation pathname={pathname} search={search} hash={hash} />\n    </AnalyticsContext>\n  );\n};\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  BackstagePlugin,\n  ExternalRouteRef,\n  RouteRef,\n  SubRouteRef,\n} from '@backstage/core-plugin-api';\nimport { joinPaths } from './helpers';\nimport { AnyRouteRef } from './types';\n\n// Validates that there is no duplication of route parameter names\nexport function validateRouteParameters(\n  routePaths: Map<AnyRouteRef, string>,\n  routeParents: Map<AnyRouteRef, AnyRouteRef | undefined>,\n) {\n  const notLeafRoutes = new Set(routeParents.values());\n  notLeafRoutes.delete(undefined);\n\n  for (const route of routeParents.keys()) {\n    if (notLeafRoutes.has(route)) {\n      continue;\n    }\n\n    let currentRouteRef: AnyRouteRef | undefined = route;\n\n    let fullPath = '';\n    while (currentRouteRef) {\n      const path = routePaths.get(currentRouteRef);\n      if (path === undefined) {\n        throw new Error(`No path for ${currentRouteRef}`);\n      }\n      fullPath = joinPaths(path, fullPath);\n      currentRouteRef = routeParents.get(currentRouteRef);\n    }\n\n    const params = fullPath.match(/:(\\w+)/g);\n    if (params) {\n      for (let j = 0; j < params.length; j++) {\n        for (let i = j + 1; i < params.length; i++) {\n          if (params[i] === params[j]) {\n            throw new Error(\n              `Parameter ${params[i]} is duplicated in path ${fullPath}`,\n            );\n          }\n        }\n      }\n    }\n  }\n}\n\n// Validates that all non-optional external routes have been bound\nexport function validateRouteBindings(\n  routeBindings: Map<ExternalRouteRef, RouteRef | SubRouteRef>,\n  plugins: Iterable<BackstagePlugin<{}, Record<string, ExternalRouteRef>>>,\n) {\n  for (const plugin of plugins) {\n    if (!plugin.externalRoutes) {\n      continue;\n    }\n\n    for (const [name, externalRouteRef] of Object.entries(\n      plugin.externalRoutes,\n    )) {\n      if (externalRouteRef.optional) {\n        continue;\n      }\n\n      if (!routeBindings.has(externalRouteRef)) {\n        throw new Error(\n          `External route '${name}' of the '${plugin.getId()}' plugin must be bound to a target route. ` +\n            'See https://backstage.io/link?bind-routes for details.',\n        );\n      }\n    }\n  }\n}\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React, { PropsWithChildren } from 'react';\nimport {\n  createVersionedValueMap,\n  createVersionedContext,\n} from '@backstage/version-bridge';\nimport { AppContext as AppContextV1 } from './types';\n\nconst AppContext = createVersionedContext<{ 1: AppContextV1 }>('app-context');\n\ntype Props = {\n  appContext: AppContextV1;\n};\n\nexport const AppContextProvider = ({\n  appContext,\n  children,\n}: PropsWithChildren<Props>) => {\n  const versionedValue = createVersionedValueMap({ 1: appContext });\n\n  return <AppContext.Provider value={versionedValue} children={children} />;\n};\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  IdentityApi,\n  ProfileInfo,\n  BackstageUserIdentity,\n} from '@backstage/core-plugin-api';\n\nfunction mkError(thing: string) {\n  return new Error(\n    `Tried to access IdentityApi ${thing} before app was loaded`,\n  );\n}\n\nfunction logDeprecation(thing: string) {\n  // eslint-disable-next-line no-console\n  console.warn(\n    `WARNING: Call to ${thing} is deprecated and will break in the future`,\n  );\n}\n\n// We use this for a period of backwards compatibility. It is a hidden\n// compatibility that will allow old plugins to continue working for a limited time.\ntype CompatibilityIdentityApi = IdentityApi & {\n  getUserId?(): string;\n  getIdToken?(): Promise<string | undefined>;\n  getProfile?(): ProfileInfo;\n};\n\n/**\n * Implementation of the connection between the App-wide IdentityApi\n * and sign-in page.\n */\nexport class AppIdentityProxy implements IdentityApi {\n  private target?: CompatibilityIdentityApi;\n  private waitForTarget: Promise<CompatibilityIdentityApi>;\n  private resolveTarget: (api: CompatibilityIdentityApi) => void = () => {};\n  private signOutTargetUrl = '/';\n\n  constructor() {\n    this.waitForTarget = new Promise<CompatibilityIdentityApi>(resolve => {\n      this.resolveTarget = resolve;\n    });\n  }\n\n  // This is called by the app manager once the sign-in page provides us with an implementation\n  setTarget(\n    identityApi: CompatibilityIdentityApi,\n    targetOptions: { signOutTargetUrl: string },\n  ) {\n    this.target = identityApi;\n    this.signOutTargetUrl = targetOptions.signOutTargetUrl;\n    this.resolveTarget(identityApi);\n  }\n\n  getUserId(): string {\n    if (!this.target) {\n      throw mkError('getUserId');\n    }\n    if (!this.target.getUserId) {\n      throw new Error('IdentityApi does not implement getUserId');\n    }\n    logDeprecation('getUserId');\n    return this.target.getUserId();\n  }\n\n  getProfile(): ProfileInfo {\n    if (!this.target) {\n      throw mkError('getProfile');\n    }\n    if (!this.target.getProfile) {\n      throw new Error('IdentityApi does not implement getProfile');\n    }\n    logDeprecation('getProfile');\n    return this.target.getProfile();\n  }\n\n  async getProfileInfo(): Promise<ProfileInfo> {\n    return this.waitForTarget.then(target => target.getProfileInfo());\n  }\n\n  async getBackstageIdentity(): Promise<BackstageUserIdentity> {\n    const identity = await this.waitForTarget.then(target =>\n      target.getBackstageIdentity(),\n    );\n    if (!identity.userEntityRef.match(/^.*:.*\\/.*$/)) {\n      // eslint-disable-next-line no-console\n      console.warn(\n        `WARNING: The App IdentityApi provided an invalid userEntityRef, '${identity.userEntityRef}'. ` +\n          `It must be a full Entity Reference of the form '<kind>:<namespace>/<name>'.`,\n      );\n    }\n\n    return identity;\n  }\n\n  async getCredentials(): Promise<{ token?: string | undefined }> {\n    return this.waitForTarget.then(target => target.getCredentials());\n  }\n\n  async getIdToken(): Promise<string | undefined> {\n    return this.waitForTarget.then(target => {\n      if (!target.getIdToken) {\n        throw new Error('IdentityApi does not implement getIdToken');\n      }\n      logDeprecation('getIdToken');\n      return target.getIdToken();\n    });\n  }\n\n  async signOut(): Promise<void> {\n    await this.waitForTarget.then(target => target.signOut());\n    location.href = this.signOutTargetUrl;\n  }\n}\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React, { useMemo, useEffect, useState, PropsWithChildren } from 'react';\nimport { useApi, appThemeApiRef, AppTheme } from '@backstage/core-plugin-api';\nimport useObservable from 'react-use/lib/useObservable';\n\n// This tries to find the most accurate match, but also falls back to less\n// accurate results in order to avoid errors.\nfunction resolveTheme(\n  themeId: string | undefined,\n  shouldPreferDark: boolean,\n  themes: AppTheme[],\n) {\n  if (themeId !== undefined) {\n    const selectedTheme = themes.find(theme => theme.id === themeId);\n    if (selectedTheme) {\n      return selectedTheme;\n    }\n  }\n\n  if (shouldPreferDark) {\n    const darkTheme = themes.find(theme => theme.variant === 'dark');\n    if (darkTheme) {\n      return darkTheme;\n    }\n  }\n\n  const lightTheme = themes.find(theme => theme.variant === 'light');\n  if (lightTheme) {\n    return lightTheme;\n  }\n\n  return themes[0];\n}\n\nconst useShouldPreferDarkTheme = () => {\n  const mediaQuery = useMemo(\n    () => window.matchMedia('(prefers-color-scheme: dark)'),\n    [],\n  );\n  const [shouldPreferDark, setPrefersDark] = useState(mediaQuery.matches);\n\n  useEffect(() => {\n    const listener = (event: MediaQueryListEvent) => {\n      setPrefersDark(event.matches);\n    };\n    mediaQuery.addListener(listener);\n    return () => {\n      mediaQuery.removeListener(listener);\n    };\n  }, [mediaQuery]);\n\n  return shouldPreferDark;\n};\n\nexport function AppThemeProvider({ children }: PropsWithChildren<{}>) {\n  const appThemeApi = useApi(appThemeApiRef);\n  const themeId = useObservable(\n    appThemeApi.activeThemeId$(),\n    appThemeApi.getActiveThemeId(),\n  );\n\n  // Browser feature detection won't change over time, so ignore lint rule\n  const shouldPreferDark = Boolean(window.matchMedia)\n    ? useShouldPreferDarkTheme() // eslint-disable-line react-hooks/rules-of-hooks\n    : false;\n\n  const appTheme = resolveTheme(\n    themeId,\n    shouldPreferDark,\n    appThemeApi.getInstalledThemes(),\n  );\n  if (!appTheme) {\n    throw new Error('App has no themes');\n  }\n\n  return <appTheme.Provider children={children} />;\n}\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { AppConfig } from '@backstage/config';\nimport { JsonObject } from '@backstage/types';\nimport { AppConfigLoader } from './types';\n\n/**\n * The default config loader, which expects that config is available at compile-time\n * in `process.env.APP_CONFIG`. APP_CONFIG should be an array of config objects as\n * returned by the config loader.\n *\n * It will also load runtime config from the __APP_INJECTED_RUNTIME_CONFIG__ string,\n * which can be rewritten at runtime to contain an additional JSON config object.\n * If runtime config is present, it will be placed first in the config array, overriding\n * other config values.\n *\n * @public\n */\nexport const defaultConfigLoader: AppConfigLoader = async (\n  // This string may be replaced at runtime to provide additional config.\n  // It should be replaced by a JSON-serialized config object.\n  // It's a param so we can test it, but at runtime this will always fall back to default.\n  runtimeConfigJson: string = '__APP_INJECTED_RUNTIME_CONFIG__',\n) => {\n  const appConfig = process.env.APP_CONFIG;\n  if (!appConfig) {\n    throw new Error('No static configuration provided');\n  }\n  if (!Array.isArray(appConfig)) {\n    throw new Error('Static configuration has invalid format');\n  }\n  const configs = appConfig.slice() as unknown as AppConfig[];\n\n  // Avoiding this string also being replaced at runtime\n  if (\n    runtimeConfigJson !==\n    '__app_injected_runtime_config__'.toLocaleUpperCase('en-US')\n  ) {\n    try {\n      const data = JSON.parse(runtimeConfigJson) as JsonObject;\n      if (Array.isArray(data)) {\n        configs.push(...data);\n      } else {\n        configs.push({ data, context: 'env' });\n      }\n    } catch (error) {\n      throw new Error(`Failed to load runtime configuration, ${error}`);\n    }\n  }\n\n  const windowAppConfig = (window as any).__APP_CONFIG__;\n  if (windowAppConfig) {\n    configs.push({\n      context: 'window',\n      data: windowAppConfig,\n    });\n  }\n  return configs;\n};\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { ApiRef, ApiHolder } from '@backstage/core-plugin-api';\n\ntype ApiImpl<T = unknown> = readonly [ApiRef<T>, T];\n\n/** @internal */\nclass ApiRegistryBuilder {\n  private apis: [string, unknown][] = [];\n\n  add<T, I extends T>(api: ApiRef<T>, impl: I): I {\n    this.apis.push([api.id, impl]);\n    return impl;\n  }\n\n  build(): ApiRegistry {\n    // eslint-disable-next-line @typescript-eslint/no-use-before-define\n    return new ApiRegistry(new Map(this.apis));\n  }\n}\n\n/**\n * A registry for utility APIs.\n *\n * @internal\n */\nexport class ApiRegistry implements ApiHolder {\n  static builder() {\n    return new ApiRegistryBuilder();\n  }\n\n  /**\n   * Creates a new ApiRegistry with a list of API implementations.\n   *\n   * @param apis - A list of pairs mapping an ApiRef to its respective implementation\n   */\n  static from(apis: ApiImpl[]) {\n    return new ApiRegistry(new Map(apis.map(([api, impl]) => [api.id, impl])));\n  }\n\n  /**\n   * Creates a new ApiRegistry with a single API implementation.\n   *\n   * @param api - ApiRef for the API to add\n   * @param impl - Implementation of the API to add\n   */\n  static with<T>(api: ApiRef<T>, impl: T): ApiRegistry {\n    return new ApiRegistry(new Map([[api.id, impl]]));\n  }\n\n  constructor(private readonly apis: Map<string, unknown>) {}\n\n  /**\n   * Returns a new ApiRegistry with the provided API added to the existing ones.\n   *\n   * @param api - ApiRef for the API to add\n   * @param impl - Implementation of the API to add\n   */\n  with<T>(api: ApiRef<T>, impl: T): ApiRegistry {\n    return new ApiRegistry(new Map([...this.apis, [api.id, impl]]));\n  }\n\n  get<T>(api: ApiRef<T>): T | undefined {\n    return this.apis.get(api.id) as T | undefined;\n  }\n}\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  RouteRef,\n  SubRouteRef,\n  ExternalRouteRef,\n} from '@backstage/core-plugin-api';\nimport { AppOptions, AppRouteBinder } from './types';\n\nexport function resolveRouteBindings(bindRoutes: AppOptions['bindRoutes']) {\n  const result = new Map<ExternalRouteRef, RouteRef | SubRouteRef>();\n\n  if (bindRoutes) {\n    const bind: AppRouteBinder = (\n      externalRoutes,\n      targetRoutes: { [name: string]: RouteRef | SubRouteRef },\n    ) => {\n      for (const [key, value] of Object.entries(targetRoutes)) {\n        const externalRoute = externalRoutes[key];\n        if (!externalRoute) {\n          throw new Error(`Key ${key} is not an existing external route`);\n        }\n        if (!value && !externalRoute.optional) {\n          throw new Error(\n            `External route ${key} is required but was undefined`,\n          );\n        }\n        if (value) {\n          result.set(externalRoute, value);\n        }\n      }\n    };\n    bindRoutes({ bind });\n  }\n\n  return result;\n}\n","/*\n * Copyright 2022 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React from 'react';\nimport { createRoutesFromChildren, Route } from 'react-router-dom';\n\nexport function isReactRouterBeta(): boolean {\n  const [obj] = createRoutesFromChildren(<Route index element={<div />} />);\n  return !obj.index;\n}\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { Config } from '@backstage/config';\nimport React, {\n  ComponentType,\n  createContext,\n  PropsWithChildren,\n  ReactElement,\n  useContext,\n  useEffect,\n  useMemo,\n  useState,\n} from 'react';\nimport { Route, Routes } from 'react-router-dom';\nimport useAsync from 'react-use/lib/useAsync';\nimport {\n  ApiProvider,\n  AppThemeSelector,\n  ConfigReader,\n  LocalStorageFeatureFlags,\n} from '../apis';\nimport {\n  useApi,\n  AnyApiFactory,\n  ApiHolder,\n  IconComponent,\n  AppTheme,\n  appThemeApiRef,\n  configApiRef,\n  AppThemeApi,\n  ConfigApi,\n  featureFlagsApiRef,\n  IdentityApi,\n  identityApiRef,\n  BackstagePlugin,\n} from '@backstage/core-plugin-api';\nimport { ApiFactoryRegistry, ApiResolver } from '../apis/system';\nimport {\n  childDiscoverer,\n  routeElementDiscoverer,\n  traverseElementTree,\n} from '../extensions/traversal';\nimport { pluginCollector } from '../plugins/collectors';\nimport {\n  featureFlagCollector,\n  routingV1Collector,\n  routingV2Collector,\n} from '../routing/collectors';\nimport { RoutingProvider } from '../routing/RoutingProvider';\nimport { RouteTracker } from '../routing/RouteTracker';\nimport {\n  validateRouteParameters,\n  validateRouteBindings,\n} from '../routing/validation';\nimport { AppContextProvider } from './AppContext';\nimport { AppIdentityProxy } from '../apis/implementations/IdentityApi/AppIdentityProxy';\nimport {\n  AppComponents,\n  AppConfigLoader,\n  AppContext,\n  AppOptions,\n  BackstageApp,\n  SignInPageProps,\n} from './types';\nimport { AppThemeProvider } from './AppThemeProvider';\nimport { defaultConfigLoader } from './defaultConfigLoader';\nimport { ApiRegistry } from '../apis/system/ApiRegistry';\nimport { resolveRouteBindings } from './resolveRouteBindings';\nimport { BackstageRouteObject } from '../routing/types';\nimport { isReactRouterBeta } from './isReactRouterBeta';\n\ntype CompatiblePlugin =\n  | BackstagePlugin\n  | (Omit<BackstagePlugin, 'getFeatureFlags'> & {\n      output(): Array<{ type: 'feature-flag'; name: string }>;\n    });\n\nconst InternalAppContext = createContext<{\n  routeObjects: BackstageRouteObject[];\n}>({ routeObjects: [] });\n\n/**\n * Get the app base path from the configured app baseUrl.\n *\n * The returned path does not have a trailing slash.\n */\nfunction getBasePath(configApi: Config) {\n  let { pathname } = new URL(\n    configApi.getOptionalString('app.baseUrl') ?? '/',\n    'http://dummy.dev', // baseUrl can be specified as just a path\n  );\n  pathname = pathname.replace(/\\/*$/, '');\n  return pathname;\n}\n\nfunction useConfigLoader(\n  configLoader: AppConfigLoader | undefined,\n  components: AppComponents,\n  appThemeApi: AppThemeApi,\n): { api: ConfigApi } | { node: JSX.Element } {\n  // Keeping this synchronous when a config loader isn't set simplifies tests a lot\n  const hasConfig = Boolean(configLoader);\n  const config = useAsync(configLoader || (() => Promise.resolve([])));\n\n  let noConfigNode = undefined;\n\n  if (hasConfig && config.loading) {\n    const { Progress } = components;\n    noConfigNode = <Progress />;\n  } else if (config.error) {\n    const { BootErrorPage } = components;\n    noConfigNode = <BootErrorPage step=\"load-config\" error={config.error} />;\n  }\n\n  const { ThemeProvider = AppThemeProvider } = components;\n\n  // Before the config is loaded we can't use a router, so exit early\n  if (noConfigNode) {\n    return {\n      node: (\n        <ApiProvider apis={ApiRegistry.with(appThemeApiRef, appThemeApi)}>\n          <ThemeProvider>{noConfigNode}</ThemeProvider>\n        </ApiProvider>\n      ),\n    };\n  }\n\n  const configReader = ConfigReader.fromConfigs(config.value ?? []);\n\n  return { api: configReader };\n}\n\nclass AppContextImpl implements AppContext {\n  constructor(private readonly app: AppManager) {}\n\n  getPlugins(): BackstagePlugin[] {\n    return this.app.getPlugins();\n  }\n\n  getSystemIcon(key: string): IconComponent | undefined {\n    return this.app.getSystemIcon(key);\n  }\n\n  getSystemIcons(): Record<string, IconComponent> {\n    return this.app.getSystemIcons();\n  }\n\n  getComponents(): AppComponents {\n    return this.app.getComponents();\n  }\n}\n\nexport class AppManager implements BackstageApp {\n  private apiHolder?: ApiHolder;\n  private configApi?: ConfigApi;\n\n  private readonly apis: Iterable<AnyApiFactory>;\n  private readonly icons: NonNullable<AppOptions['icons']>;\n  private readonly plugins: Set<CompatiblePlugin>;\n  private readonly components: AppComponents;\n  private readonly themes: AppTheme[];\n  private readonly configLoader?: AppConfigLoader;\n  private readonly defaultApis: Iterable<AnyApiFactory>;\n  private readonly bindRoutes: AppOptions['bindRoutes'];\n\n  private readonly appIdentityProxy = new AppIdentityProxy();\n  private readonly apiFactoryRegistry: ApiFactoryRegistry;\n\n  constructor(options: AppOptions) {\n    this.apis = options.apis ?? [];\n    this.icons = options.icons;\n    this.plugins = new Set((options.plugins as CompatiblePlugin[]) ?? []);\n    this.components = options.components;\n    this.themes = options.themes as AppTheme[];\n    this.configLoader = options.configLoader ?? defaultConfigLoader;\n    this.defaultApis = options.defaultApis ?? [];\n    this.bindRoutes = options.bindRoutes;\n    this.apiFactoryRegistry = new ApiFactoryRegistry();\n  }\n\n  getPlugins(): BackstagePlugin[] {\n    return Array.from(this.plugins) as BackstagePlugin[];\n  }\n\n  getSystemIcon(key: string): IconComponent | undefined {\n    return this.icons[key];\n  }\n\n  getSystemIcons(): Record<string, IconComponent> {\n    return this.icons;\n  }\n\n  getComponents(): AppComponents {\n    return this.components;\n  }\n\n  getProvider(): ComponentType<{}> {\n    const appContext = new AppContextImpl(this);\n\n    // We only validate routes once\n    let routesHaveBeenValidated = false;\n\n    const Provider = ({ children }: PropsWithChildren<{}>) => {\n      const appThemeApi = useMemo(\n        () => AppThemeSelector.createWithStorage(this.themes),\n        [],\n      );\n\n      const { routing, featureFlags, routeBindings } = useMemo(() => {\n        const result = traverseElementTree({\n          root: children,\n          discoverers: [childDiscoverer, routeElementDiscoverer],\n          collectors: {\n            routing: isReactRouterBeta()\n              ? routingV1Collector\n              : routingV2Collector,\n            collectedPlugins: pluginCollector,\n            featureFlags: featureFlagCollector,\n          },\n        });\n\n        // TODO(Rugvip): Restructure the public API so that we can get an immediate view of\n        //               the app, rather than having to wait for the provider to render.\n        //               For now we need to push the additional plugins we find during\n        //               collection and then make sure we initialize things afterwards.\n        result.collectedPlugins.forEach(plugin => this.plugins.add(plugin));\n        this.verifyPlugins(this.plugins);\n\n        // Initialize APIs once all plugins are available\n        this.getApiHolder();\n        return {\n          ...result,\n          routeBindings: resolveRouteBindings(this.bindRoutes),\n        };\n      }, [children]);\n\n      if (!routesHaveBeenValidated) {\n        routesHaveBeenValidated = true;\n        validateRouteParameters(routing.paths, routing.parents);\n        validateRouteBindings(\n          routeBindings,\n          this.plugins as Iterable<BackstagePlugin>,\n        );\n      }\n\n      const loadedConfig = useConfigLoader(\n        this.configLoader,\n        this.components,\n        appThemeApi,\n      );\n\n      const hasConfigApi = 'api' in loadedConfig;\n      if (hasConfigApi) {\n        const { api } = loadedConfig as { api: Config };\n        this.configApi = api;\n      }\n\n      useEffect(() => {\n        if (hasConfigApi) {\n          const featureFlagsApi = this.getApiHolder().get(featureFlagsApiRef)!;\n\n          for (const plugin of this.plugins.values()) {\n            if ('getFeatureFlags' in plugin) {\n              for (const flag of plugin.getFeatureFlags()) {\n                featureFlagsApi.registerFlag({\n                  name: flag.name,\n                  pluginId: plugin.getId(),\n                });\n              }\n            } else {\n              for (const output of plugin.output()) {\n                if (output.type === 'feature-flag') {\n                  featureFlagsApi.registerFlag({\n                    name: output.name,\n                    pluginId: plugin.getId(),\n                  });\n                }\n              }\n            }\n          }\n\n          // Go through the featureFlags returned from the traversal and\n          // register those now the configApi has been loaded\n          for (const name of featureFlags) {\n            featureFlagsApi.registerFlag({ name, pluginId: '' });\n          }\n        }\n      }, [hasConfigApi, loadedConfig, featureFlags]);\n\n      if ('node' in loadedConfig) {\n        // Loading or error\n        return loadedConfig.node;\n      }\n\n      const { ThemeProvider = AppThemeProvider } = this.components;\n\n      return (\n        <ApiProvider apis={this.getApiHolder()}>\n          <AppContextProvider appContext={appContext}>\n            <ThemeProvider>\n              <RoutingProvider\n                routePaths={routing.paths}\n                routeParents={routing.parents}\n                routeObjects={routing.objects}\n                routeBindings={routeBindings}\n                basePath={getBasePath(loadedConfig.api)}\n              >\n                <InternalAppContext.Provider\n                  value={{ routeObjects: routing.objects }}\n                >\n                  {children}\n                </InternalAppContext.Provider>\n              </RoutingProvider>\n            </ThemeProvider>\n          </AppContextProvider>\n        </ApiProvider>\n      );\n    };\n    return Provider;\n  }\n\n  getRouter(): ComponentType<{}> {\n    const { Router: RouterComponent, SignInPage: SignInPageComponent } =\n      this.components;\n\n    // This wraps the sign-in page and waits for sign-in to be completed before rendering the app\n    const SignInPageWrapper = ({\n      component: Component,\n      children,\n    }: {\n      component: ComponentType<SignInPageProps>;\n      children: ReactElement;\n    }) => {\n      const [identityApi, setIdentityApi] = useState<IdentityApi>();\n      const configApi = useApi(configApiRef);\n      const basePath = getBasePath(configApi);\n\n      if (!identityApi) {\n        return <Component onSignInSuccess={setIdentityApi} />;\n      }\n\n      this.appIdentityProxy.setTarget(identityApi, {\n        signOutTargetUrl: basePath || '/',\n      });\n      return children;\n    };\n\n    const AppRouter = ({ children }: PropsWithChildren<{}>) => {\n      const configApi = useApi(configApiRef);\n      const basePath = getBasePath(configApi);\n      const mountPath = `${basePath}/*`;\n      const { routeObjects } = useContext(InternalAppContext);\n\n      // If the app hasn't configured a sign-in page, we just continue as guest.\n      if (!SignInPageComponent) {\n        this.appIdentityProxy.setTarget(\n          {\n            getUserId: () => 'guest',\n            getIdToken: async () => undefined,\n            getProfile: () => ({\n              email: 'guest@example.com',\n              displayName: 'Guest',\n            }),\n            getProfileInfo: async () => ({\n              email: 'guest@example.com',\n              displayName: 'Guest',\n            }),\n            getBackstageIdentity: async () => ({\n              type: 'user',\n              userEntityRef: 'user:default/guest',\n              ownershipEntityRefs: ['user:default/guest'],\n            }),\n            getCredentials: async () => ({}),\n            signOut: async () => {},\n          },\n          { signOutTargetUrl: basePath || '/' },\n        );\n\n        return (\n          <RouterComponent>\n            <RouteTracker routeObjects={routeObjects} />\n            <Routes>\n              <Route path={mountPath} element={<>{children}</>} />\n            </Routes>\n          </RouterComponent>\n        );\n      }\n\n      return (\n        <RouterComponent>\n          <RouteTracker routeObjects={routeObjects} />\n          <SignInPageWrapper component={SignInPageComponent}>\n            <Routes>\n              <Route path={mountPath} element={<>{children}</>} />\n            </Routes>\n          </SignInPageWrapper>\n        </RouterComponent>\n      );\n    };\n\n    return AppRouter;\n  }\n\n  private getApiHolder(): ApiHolder {\n    if (this.apiHolder) {\n      // Register additional plugins if they have been added.\n      // Routes paths, objects and others are already updated in the provider when children of it change\n      for (const plugin of this.plugins) {\n        for (const factory of plugin.getApis()) {\n          if (!this.apiFactoryRegistry.get(factory.api)) {\n            this.apiFactoryRegistry.register('default', factory);\n          }\n        }\n      }\n      ApiResolver.validateFactories(\n        this.apiFactoryRegistry,\n        this.apiFactoryRegistry.getAllApis(),\n      );\n      return this.apiHolder;\n    }\n    this.apiFactoryRegistry.register('static', {\n      api: appThemeApiRef,\n      deps: {},\n      factory: () => AppThemeSelector.createWithStorage(this.themes),\n    });\n    this.apiFactoryRegistry.register('static', {\n      api: configApiRef,\n      deps: {},\n      factory: () => {\n        if (!this.configApi) {\n          throw new Error(\n            'Tried to access config API before config was loaded',\n          );\n        }\n        return this.configApi;\n      },\n    });\n    this.apiFactoryRegistry.register('static', {\n      api: identityApiRef,\n      deps: {},\n      factory: () => this.appIdentityProxy,\n    });\n\n    // It's possible to replace the feature flag API, but since we must have at least\n    // one implementation we add it here directly instead of through the defaultApis.\n    this.apiFactoryRegistry.register('default', {\n      api: featureFlagsApiRef,\n      deps: {},\n      factory: () => new LocalStorageFeatureFlags(),\n    });\n    for (const factory of this.defaultApis) {\n      this.apiFactoryRegistry.register('default', factory);\n    }\n\n    for (const plugin of this.plugins) {\n      for (const factory of plugin.getApis()) {\n        if (!this.apiFactoryRegistry.register('default', factory)) {\n          throw new Error(\n            `Plugin ${plugin.getId()} tried to register duplicate or forbidden API factory for ${\n              factory.api\n            }`,\n          );\n        }\n      }\n    }\n\n    for (const factory of this.apis) {\n      if (!this.apiFactoryRegistry.register('app', factory)) {\n        throw new Error(\n          `Duplicate or forbidden API factory for ${factory.api} in app`,\n        );\n      }\n    }\n\n    ApiResolver.validateFactories(\n      this.apiFactoryRegistry,\n      this.apiFactoryRegistry.getAllApis(),\n    );\n\n    this.apiHolder = new ApiResolver(this.apiFactoryRegistry);\n    return this.apiHolder;\n  }\n\n  private verifyPlugins(plugins: Iterable<CompatiblePlugin>) {\n    const pluginIds = new Set<string>();\n\n    for (const plugin of plugins) {\n      const id = plugin.getId();\n      if (pluginIds.has(id)) {\n        throw new Error(`Duplicate plugin found '${id}'`);\n      }\n      pluginIds.add(id);\n    }\n  }\n}\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { AppManager } from './AppManager';\nimport { AppOptions, BackstageApp } from './types';\n\n/**\n * Creates a new Backstage App where the full set of options are required.\n *\n * @public\n * @param options - A set of options for creating the app\n * @returns\n * @remarks\n *\n * You will most likely want to use {@link @backstage/app-defaults#createApp},\n * however, this low-level API allows you to provide a full set of options,\n * including your own `components`, `icons`, `defaultApis`, and `themes`. This\n * is particularly useful if you are not using `@backstage/core-components` or\n * MUI, as it allows you to avoid those dependencies completely.\n */\nexport function createSpecializedApp(options: AppOptions): BackstageApp {\n  return new AppManager(options);\n}\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React, { ReactNode, useMemo } from 'react';\nimport { useRoutes } from 'react-router-dom';\nimport { useApp, useElementFilter } from '@backstage/core-plugin-api';\nimport { isReactRouterBeta } from '../app/isReactRouterBeta';\n\nlet warned = false;\n\ntype RouteObject = {\n  path: string;\n  element: ReactNode;\n  children?: RouteObject[];\n};\n\n/**\n * Props for the {@link FlatRoutes} component.\n *\n * @public\n */\nexport type FlatRoutesProps = {\n  children: ReactNode;\n};\n\n/**\n * A wrapper around a set of routes.\n *\n * @remarks\n *\n * The root of the routing hierarchy in your app should use this component,\n * instead of the one from `react-router-dom`. This ensures that all of the\n * plugin route and utility API wiring happens under the hood.\n *\n * @public\n */\nexport const FlatRoutes = (props: FlatRoutesProps): JSX.Element | null => {\n  const app = useApp();\n  const { NotFoundErrorPage } = app.getComponents();\n  const isBeta = useMemo(() => isReactRouterBeta(), []);\n  const routes = useElementFilter(props.children, elements =>\n    elements\n      .getElements<{\n        path?: string;\n        element?: ReactNode;\n        children?: ReactNode;\n      }>()\n      .flatMap<RouteObject>(child => {\n        let path = child.props.path;\n\n        // TODO(Rugvip): Work around plugins registering empty paths, remove once deprecated routes are gone\n        if (path === '') {\n          return [];\n        }\n        path = path?.replace(/\\/\\*$/, '') ?? '/';\n\n        let element = isBeta ? child : child.props.element;\n        if (!isBeta && !element) {\n          element = child;\n          if (!warned && process.env.NODE_ENV !== 'test') {\n            // eslint-disable-next-line no-console\n            console.warn(\n              'DEPRECATION WARNING: All elements within <FlatRoutes> must be of type <Route> with an element prop. ' +\n                'Existing usages of <Navigate key=[path] to=[to] /> should be replaced with <Route path=[path] element={<Navigate to=[to] />} />.',\n            );\n            warned = true;\n          }\n        }\n\n        return [\n          {\n            // Each route matches any sub route, except for the explicit root path\n            path,\n            element,\n            children: child.props.children\n              ? [\n                  // These are the children of each route, which we all add in under a catch-all\n                  // subroute in order to make them available to `useOutlet`\n                  {\n                    path: path === '/' ? '/' : '*', // The root path must require an exact match\n                    element: child.props.children,\n                  },\n                ]\n              : undefined,\n          },\n        ];\n      })\n      // Routes are sorted to work around a bug where prefixes are unexpectedly matched\n      // TODO(Rugvip): This can be removed once react-router v6 beta is no longer supported\n      .sort((a, b) => b.path.localeCompare(a.path))\n      .map(obj => ({ ...obj, path: obj.path === '/' ? '/' : `${obj.path}/*` })),\n  );\n\n  // TODO(Rugvip): Possibly add a way to skip this, like a noNotFoundPage prop\n  const withNotFound = [\n    ...routes,\n    {\n      path: '*',\n      element: <NotFoundErrorPage />,\n    },\n  ];\n\n  return useRoutes(withNotFound);\n};\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  AlertApiForwarder,\n  NoOpAnalyticsApi,\n  ErrorApiForwarder,\n  ErrorAlerter,\n  GoogleAuth,\n  GithubAuth,\n  OktaAuth,\n  GitlabAuth,\n  MicrosoftAuth,\n  BitbucketAuth,\n  OAuthRequestManager,\n  WebStorage,\n  UrlPatternDiscovery,\n  OneLoginAuth,\n  UnhandledErrorForwarder,\n  AtlassianAuth,\n  createFetchApi,\n  FetchMiddlewares,\n} from '@backstage/core-app-api';\n\nimport {\n  createApiFactory,\n  alertApiRef,\n  analyticsApiRef,\n  errorApiRef,\n  discoveryApiRef,\n  fetchApiRef,\n  identityApiRef,\n  oauthRequestApiRef,\n  googleAuthApiRef,\n  githubAuthApiRef,\n  oktaAuthApiRef,\n  gitlabAuthApiRef,\n  microsoftAuthApiRef,\n  storageApiRef,\n  configApiRef,\n  oneloginAuthApiRef,\n  bitbucketAuthApiRef,\n  atlassianAuthApiRef,\n} from '@backstage/core-plugin-api';\nimport {\n  permissionApiRef,\n  IdentityPermissionApi,\n} from '@backstage/plugin-permission-react';\n\nexport const apis = [\n  createApiFactory({\n    api: discoveryApiRef,\n    deps: { configApi: configApiRef },\n    factory: ({ configApi }) =>\n      UrlPatternDiscovery.compile(\n        `${configApi.getString('backend.baseUrl')}/api/{{ pluginId }}`,\n      ),\n  }),\n  createApiFactory({\n    api: alertApiRef,\n    deps: {},\n    factory: () => new AlertApiForwarder(),\n  }),\n  createApiFactory({\n    api: analyticsApiRef,\n    deps: {},\n    factory: () => new NoOpAnalyticsApi(),\n  }),\n  createApiFactory({\n    api: errorApiRef,\n    deps: { alertApi: alertApiRef },\n    factory: ({ alertApi }) => {\n      const errorApi = new ErrorAlerter(alertApi, new ErrorApiForwarder());\n      UnhandledErrorForwarder.forward(errorApi, { hidden: false });\n      return errorApi;\n    },\n  }),\n  createApiFactory({\n    api: storageApiRef,\n    deps: { errorApi: errorApiRef },\n    factory: ({ errorApi }) => WebStorage.create({ errorApi }),\n  }),\n  createApiFactory({\n    api: fetchApiRef,\n    deps: {\n      configApi: configApiRef,\n      identityApi: identityApiRef,\n      discoveryApi: discoveryApiRef,\n    },\n    factory: ({ configApi, identityApi, discoveryApi }) => {\n      return createFetchApi({\n        middleware: [\n          FetchMiddlewares.resolvePluginProtocol({\n            discoveryApi,\n          }),\n          FetchMiddlewares.injectIdentityAuth({\n            identityApi,\n            config: configApi,\n          }),\n        ],\n      });\n    },\n  }),\n  createApiFactory({\n    api: oauthRequestApiRef,\n    deps: {},\n    factory: () => new OAuthRequestManager(),\n  }),\n  createApiFactory({\n    api: googleAuthApiRef,\n    deps: {\n      discoveryApi: discoveryApiRef,\n      oauthRequestApi: oauthRequestApiRef,\n      configApi: configApiRef,\n    },\n    factory: ({ discoveryApi, oauthRequestApi, configApi }) =>\n      GoogleAuth.create({\n        discoveryApi,\n        oauthRequestApi,\n        environment: configApi.getOptionalString('auth.environment'),\n      }),\n  }),\n  createApiFactory({\n    api: microsoftAuthApiRef,\n    deps: {\n      discoveryApi: discoveryApiRef,\n      oauthRequestApi: oauthRequestApiRef,\n      configApi: configApiRef,\n    },\n    factory: ({ discoveryApi, oauthRequestApi, configApi }) =>\n      MicrosoftAuth.create({\n        discoveryApi,\n        oauthRequestApi,\n        environment: configApi.getOptionalString('auth.environment'),\n      }),\n  }),\n  createApiFactory({\n    api: githubAuthApiRef,\n    deps: {\n      discoveryApi: discoveryApiRef,\n      oauthRequestApi: oauthRequestApiRef,\n      configApi: configApiRef,\n    },\n    factory: ({ discoveryApi, oauthRequestApi, configApi }) =>\n      GithubAuth.create({\n        discoveryApi,\n        oauthRequestApi,\n        defaultScopes: ['read:user'],\n        environment: configApi.getOptionalString('auth.environment'),\n      }),\n  }),\n  createApiFactory({\n    api: oktaAuthApiRef,\n    deps: {\n      discoveryApi: discoveryApiRef,\n      oauthRequestApi: oauthRequestApiRef,\n      configApi: configApiRef,\n    },\n    factory: ({ discoveryApi, oauthRequestApi, configApi }) =>\n      OktaAuth.create({\n        discoveryApi,\n        oauthRequestApi,\n        environment: configApi.getOptionalString('auth.environment'),\n      }),\n  }),\n  createApiFactory({\n    api: gitlabAuthApiRef,\n    deps: {\n      discoveryApi: discoveryApiRef,\n      oauthRequestApi: oauthRequestApiRef,\n      configApi: configApiRef,\n    },\n    factory: ({ discoveryApi, oauthRequestApi, configApi }) =>\n      GitlabAuth.create({\n        discoveryApi,\n        oauthRequestApi,\n        environment: configApi.getOptionalString('auth.environment'),\n      }),\n  }),\n  createApiFactory({\n    api: oneloginAuthApiRef,\n    deps: {\n      discoveryApi: discoveryApiRef,\n      oauthRequestApi: oauthRequestApiRef,\n      configApi: configApiRef,\n    },\n    factory: ({ discoveryApi, oauthRequestApi, configApi }) =>\n      OneLoginAuth.create({\n        discoveryApi,\n        oauthRequestApi,\n        environment: configApi.getOptionalString('auth.environment'),\n      }),\n  }),\n  createApiFactory({\n    api: bitbucketAuthApiRef,\n    deps: {\n      discoveryApi: discoveryApiRef,\n      oauthRequestApi: oauthRequestApiRef,\n      configApi: configApiRef,\n    },\n    factory: ({ discoveryApi, oauthRequestApi, configApi }) =>\n      BitbucketAuth.create({\n        discoveryApi,\n        oauthRequestApi,\n        defaultScopes: ['team'],\n        environment: configApi.getOptionalString('auth.environment'),\n      }),\n  }),\n  createApiFactory({\n    api: atlassianAuthApiRef,\n    deps: {\n      discoveryApi: discoveryApiRef,\n      oauthRequestApi: oauthRequestApiRef,\n      configApi: configApiRef,\n    },\n    factory: ({ discoveryApi, oauthRequestApi, configApi }) => {\n      return AtlassianAuth.create({\n        discoveryApi,\n        oauthRequestApi,\n        environment: configApi.getOptionalString('auth.environment'),\n      });\n    },\n  }),\n  createApiFactory({\n    api: permissionApiRef,\n    deps: {\n      discovery: discoveryApiRef,\n      identity: identityApiRef,\n      config: configApiRef,\n    },\n    factory: ({ config, discovery, identity }) =>\n      IdentityPermissionApi.create({ config, discovery, identity }),\n  }),\n];\n","/*\n * Copyright 2021 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React, { ReactNode } from 'react';\nimport Button from '@material-ui/core/Button';\nimport { ErrorPanel, Progress, ErrorPage } from '@backstage/core-components';\nimport {\n  MemoryRouter,\n  useInRouterContext,\n  BrowserRouter,\n} from 'react-router-dom';\nimport {\n  AppComponents,\n  BootErrorPageProps,\n  ErrorBoundaryFallbackProps,\n} from '@backstage/core-plugin-api';\n\nexport function OptionallyWrapInRouter({ children }: { children: ReactNode }) {\n  if (useInRouterContext()) {\n    return <>{children}</>;\n  }\n  return <MemoryRouter>{children}</MemoryRouter>;\n}\n\nconst DefaultNotFoundPage = () => (\n  <ErrorPage status=\"404\" statusMessage=\"PAGE NOT FOUND\" />\n);\n\nconst DefaultBootErrorPage = ({ step, error }: BootErrorPageProps) => {\n  let message = '';\n  if (step === 'load-config') {\n    message = `The configuration failed to load, someone should have a look at this error: ${error.message}`;\n  } else if (step === 'load-chunk') {\n    message = `Lazy loaded chunk failed to load, try to reload the page: ${error.message}`;\n  }\n  // TODO: figure out a nicer way to handle routing on the error page, when it can be done.\n  return (\n    <OptionallyWrapInRouter>\n      <ErrorPage status=\"501\" statusMessage={message} />\n    </OptionallyWrapInRouter>\n  );\n};\n\nconst DefaultErrorBoundaryFallback = ({\n  error,\n  resetError,\n  plugin,\n}: ErrorBoundaryFallbackProps) => {\n  return (\n    <ErrorPanel\n      title={`Error in ${plugin?.getId()}`}\n      defaultExpanded\n      error={error}\n    >\n      <Button variant=\"outlined\" onClick={resetError}>\n        Retry\n      </Button>\n    </ErrorPanel>\n  );\n};\n\n/**\n * Creates a set of default components to pass along to {@link @backstage/core-app-api#createSpecializedApp}.\n *\n * @public\n */\nexport const components: AppComponents = {\n  Progress,\n  Router: BrowserRouter,\n  NotFoundErrorPage: DefaultNotFoundPage,\n  BootErrorPage: DefaultBootErrorPage,\n  ErrorBoundaryFallback: DefaultErrorBoundaryFallback,\n};\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { IconComponent } from '@backstage/core-plugin-api';\nimport MuiApartmentIcon from '@material-ui/icons/Apartment';\nimport MuiBrokenImageIcon from '@material-ui/icons/BrokenImage';\nimport MuiCategoryIcon from '@material-ui/icons/Category';\nimport MuiCreateNewFolderIcon from '@material-ui/icons/CreateNewFolder';\nimport MuiSubjectIcon from '@material-ui/icons/Subject';\nimport MuiSearchIcon from '@material-ui/icons/Search';\nimport MuiChatIcon from '@material-ui/icons/Chat';\nimport MuiDashboardIcon from '@material-ui/icons/Dashboard';\nimport MuiDocsIcon from '@material-ui/icons/Description';\nimport MuiEmailIcon from '@material-ui/icons/Email';\nimport MuiExtensionIcon from '@material-ui/icons/Extension';\nimport MuiGitHubIcon from '@material-ui/icons/GitHub';\nimport MuiHelpIcon from '@material-ui/icons/Help';\nimport MuiLocationOnIcon from '@material-ui/icons/LocationOn';\nimport MuiMemoryIcon from '@material-ui/icons/Memory';\nimport MuiMenuBookIcon from '@material-ui/icons/MenuBook';\nimport MuiPeopleIcon from '@material-ui/icons/People';\nimport MuiPersonIcon from '@material-ui/icons/Person';\nimport MuiWarningIcon from '@material-ui/icons/Warning';\n\nexport const icons = {\n  brokenImage: MuiBrokenImageIcon as IconComponent,\n  // To be confirmed: see https://github.com/backstage/backstage/issues/4970\n  catalog: MuiMenuBookIcon as IconComponent,\n  scaffolder: MuiCreateNewFolderIcon as IconComponent,\n  techdocs: MuiSubjectIcon as IconComponent,\n  search: MuiSearchIcon as IconComponent,\n  chat: MuiChatIcon as IconComponent,\n  dashboard: MuiDashboardIcon as IconComponent,\n  docs: MuiDocsIcon as IconComponent,\n  email: MuiEmailIcon as IconComponent,\n  github: MuiGitHubIcon as IconComponent,\n  group: MuiPeopleIcon as IconComponent,\n  help: MuiHelpIcon as IconComponent,\n  'kind:api': MuiExtensionIcon as IconComponent,\n  'kind:component': MuiMemoryIcon as IconComponent,\n  'kind:domain': MuiApartmentIcon as IconComponent,\n  'kind:group': MuiPeopleIcon as IconComponent,\n  'kind:location': MuiLocationOnIcon as IconComponent,\n  'kind:system': MuiCategoryIcon as IconComponent,\n  'kind:user': MuiPersonIcon as IconComponent,\n  user: MuiPersonIcon as IconComponent,\n  warning: MuiWarningIcon as IconComponent,\n};\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport { PageTheme } from './types';\n\n/**\n * The default predefined burst shapes.\n *\n * @public\n * @remarks\n *\n * How to add a shape:\n *\n * 1. Get the svg shape from figma, should be ~1400 wide, ~400 high\n *    and only the white-to-transparent mask, no colors.\n * 2. Run it through https://jakearchibald.github.io/svgomg/\n * 3. Run that through https://github.com/tigt/mini-svg-data-uri\n *    with something like https://npm.runkit.com/mini-svg-data-uri\n * 4. Wrap the output in `url(\"\")`\n * 5. Give it a name and paste it into the `shapes` object below.\n */\nexport const shapes: Record<string, string> = {\n  wave: `url(\"data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' width='1368' height='400' fill='none'%3e%3cmask id='a' width='1368' height='401' x='0' y='0' maskUnits='userSpaceOnUse'%3e%3cpath fill='url(%23paint0_linear)' d='M437 116C223 116 112 0 112 0h1256v400c-82 0-225-21-282-109-112-175-436-175-649-175z'/%3e%3cpath fill='url(%23paint1_linear)' d='M1368 400V282C891-29 788 40 711 161 608 324 121 372 0 361v39h1368z'/%3e%3cpath fill='url(%23paint2_linear)' d='M1368 244v156H0V94c92-24 198-46 375 0l135 41c176 51 195 109 858 109z'/%3e%3cpath fill='url(%23paint3_linear)' d='M1252 400h116c-14-7-35-14-116-16-663-14-837-128-1013-258l-85-61C98 28 46 8 0 0v400h1252z'/%3e%3c/mask%3e%3cg mask='url(%23a)'%3e%3cpath fill='white' d='M-172-98h1671v601H-172z'/%3e%3c/g%3e%3cdefs%3e%3clinearGradient id='paint0_linear' x1='602' x2='1093.5' y1='-960.5' y2='272' gradientUnits='userSpaceOnUse'%3e%3cstop stop-color='white'/%3e%3cstop offset='1' stop-color='white' stop-opacity='0'/%3e%3c/linearGradient%3e%3clinearGradient id='paint1_linear' x1='482' x2='480' y1='1058.5' y2='70.5' gradientUnits='userSpaceOnUse'%3e%3cstop stop-color='white'/%3e%3cstop offset='1' stop-color='white' stop-opacity='0'/%3e%3c/linearGradient%3e%3clinearGradient id='paint2_linear' x1='424' x2='446.1' y1='-587.5' y2='274.6' gradientUnits='userSpaceOnUse'%3e%3cstop stop-color='white'/%3e%3cstop offset='1' stop-color='white' stop-opacity='0'/%3e%3c/linearGradient%3e%3clinearGradient id='paint3_linear' x1='587' x2='349' y1='-1120.5' y2='341' gradientUnits='userSpaceOnUse'%3e%3cstop stop-color='white'/%3e%3cstop offset='1' stop-color='white' stop-opacity='0'/%3e%3c/linearGradient%3e%3c/defs%3e%3c/svg%3e\")`,\n  wave2: `url(\"data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' width='1368' height='400' fill='none'%3e%3cmask id='a' width='1764' height='479' x='-229' y='-6' maskUnits='userSpaceOnUse'%3e%3cpath fill='url(%23paint0_linear)' d='M0 400h1350C1321 336 525 33 179-2c-345-34-395 236-408 402H0z'/%3e%3cpath fill='url(%23paint1_linear)' d='M1378 177v223H0V217s219 75 327 52C436 246 717-35 965 45s254 144 413 132z'/%3e%3cpath fill='url(%23paint2_linear)' d='M26 400l-78-16c-170 205-44-6-137-30l-4-1 4 1 137 30c37-45 89-110 159-201 399-514-45 238 1176-50 275-65 354-39 91 267H26z'/%3e%3c/mask%3e%3cg mask='url(%23a)'%3e%3cpath fill='white' d='M0 0h1368v400H0z'/%3e%3c/g%3e%3cdefs%3e%3clinearGradient id='paint0_linear' x1='431' x2='397.3' y1='-599' y2='372.8' gradientUnits='userSpaceOnUse'%3e%3cstop stop-color='white'/%3e%3cstop offset='1' stop-color='white' stop-opacity='0'/%3e%3c/linearGradient%3e%3clinearGradient id='paint1_linear' x1='236.5' x2='446.6' y1='-586' y2='381.5' gradientUnits='userSpaceOnUse'%3e%3cstop stop-color='white'/%3e%3cstop offset='1' stop-color='white' stop-opacity='0'/%3e%3c/linearGradient%3e%3clinearGradient id='paint2_linear' x1='851.8' x2='640.4' y1='-867.2' y2='363.7' gradientUnits='userSpaceOnUse'%3e%3cstop stop-color='white'/%3e%3cstop offset='1' stop-color='white' stop-opacity='0'/%3e%3c/linearGradient%3e%3c/defs%3e%3c/svg%3e\")`,\n  round: `url(\"data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' width='1368' height='400' fill='none'%3e%3cmask id='a' width='2269' height='1408' x='-610' y='-509' maskUnits='userSpaceOnUse'%3e%3ccircle cx='1212.8' cy='74.8' r='317.5' fill='url(%23paint0_linear)' transform='rotate(-52 1213 75)'/%3e%3ccircle cx='737.8' cy='445.8' r='317.5' fill='url(%23paint1_linear)' transform='rotate(-116 738 446)'/%3e%3ccircle cx='601.8' cy='52.8' r='418.6' fill='url(%23paint2_linear)' transform='rotate(-117 602 53)'/%3e%3ccircle cx='999.8' cy='364' r='389.1' fill='url(%23paint3_linear)' transform='rotate(31 1000 364)'/%3e%3cellipse cx='-109.2' cy='263.5' fill='url(%23paint4_linear)' rx='429.2' ry='465.8' transform='rotate(-85 -109 264)'/%3e%3c/mask%3e%3cg mask='url(%23a)'%3e%3cpath fill='white' d='M0 0h1368v400H0z'/%3e%3c/g%3e%3cdefs%3e%3clinearGradient id='paint0_linear' x1='1301.2' x2='161.4' y1='-1879.7' y2='-969.6' gradientUnits='userSpaceOnUse'%3e%3cstop stop-color='white'/%3e%3cstop offset='1' stop-color='white' stop-opacity='0'/%3e%3c/linearGradient%3e%3clinearGradient id='paint1_linear' x1='826.2' x2='-313.6' y1='-1508.7' y2='-598.6' gradientUnits='userSpaceOnUse'%3e%3cstop stop-color='white'/%3e%3cstop offset='1' stop-color='white' stop-opacity='0'/%3e%3c/linearGradient%3e%3clinearGradient id='paint2_linear' x1='718.4' x2='-784.3' y1='-2524' y2='-1324.2' gradientUnits='userSpaceOnUse'%3e%3cstop stop-color='white'/%3e%3cstop offset='1' stop-color='white' stop-opacity='0'/%3e%3c/linearGradient%3e%3clinearGradient id='paint3_linear' x1='1108.2' x2='-288.6' y1='-2031.1' y2='-915.9' gradientUnits='userSpaceOnUse'%3e%3cstop stop-color='white'/%3e%3cstop offset='1' stop-color='white' stop-opacity='0'/%3e%3c/linearGradient%3e%3clinearGradient id='paint4_linear' x1='10.4' x2='-1626.5' y1='-2603.8' y2='-1399.5' gradientUnits='userSpaceOnUse'%3e%3cstop stop-color='white'/%3e%3cstop offset='1' stop-color='white' stop-opacity='0'/%3e%3c/linearGradient%3e%3c/defs%3e%3c/svg%3e\")`,\n};\n\n/**\n * The color range variants that are used in e.g. colorful bursts.\n *\n * @public\n */\nexport const colorVariants: Record<string, string[]> = {\n  darkGrey: ['#171717', '#383838'],\n  marineBlue: ['#006D8F', '#0049A1'],\n  veryBlue: ['#0027AF', '#270094'],\n  rubyRed: ['#98002B', '#8D1134'],\n  toastyOrange: ['#BE2200', '#A41D00'],\n  purpleSky: ['#8912CA', '#3E00EA'],\n  eveningSea: ['#00FFF2', '#035355'],\n  teal: ['#005B4B'],\n  pinkSea: ['#C8077A', '#C2297D'],\n  greens: ['#4BB8A5', '#187656'],\n};\n\n/**\n * Utility to not have to write colors and shapes twice.\n *\n * @public\n * @remarks\n *\n * As the background shapes and colors are decorative, we place them onto the\n * page as a css background-image instead of an html element of its own.\n */\nexport function genPageTheme(props: {\n  colors: string[];\n  shape: string;\n  options?: {\n    fontColor?: string;\n  };\n}): PageTheme {\n  const { colors, shape, options } = props;\n  const gradientColors = colors.length === 1 ? [colors[0], colors[0]] : colors;\n  const gradient = `linear-gradient(90deg, ${gradientColors.join(', ')})`;\n  const backgroundImage = `${shape},  ${gradient}`;\n  const fontColor = options?.fontColor ?? '#FFFFFF';\n\n  return {\n    colors: colors,\n    shape: shape,\n    backgroundImage: backgroundImage,\n    fontColor: fontColor,\n  };\n}\n\n/**\n * All of the builtin page themes.\n *\n * @public\n */\nexport const pageTheme: Record<string, PageTheme> = {\n  home: genPageTheme({ colors: colorVariants.teal, shape: shapes.wave }),\n  documentation: genPageTheme({\n    colors: colorVariants.pinkSea,\n    shape: shapes.wave2,\n  }),\n  tool: genPageTheme({ colors: colorVariants.purpleSky, shape: shapes.round }),\n  service: genPageTheme({\n    colors: colorVariants.marineBlue,\n    shape: shapes.wave,\n  }),\n  website: genPageTheme({ colors: colorVariants.veryBlue, shape: shapes.wave }),\n  library: genPageTheme({ colors: colorVariants.rubyRed, shape: shapes.wave }),\n  other: genPageTheme({ colors: colorVariants.darkGrey, shape: shapes.wave }),\n  app: genPageTheme({ colors: colorVariants.toastyOrange, shape: shapes.wave }),\n  apis: genPageTheme({ colors: colorVariants.teal, shape: shapes.wave2 }),\n  card: genPageTheme({ colors: colorVariants.greens, shape: shapes.wave }),\n};\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { createTheme as createMuiTheme } from '@material-ui/core/styles';\nimport { darken, lighten } from '@material-ui/core/styles/colorManipulator';\nimport { Overrides } from '@material-ui/core/styles/overrides';\nimport {\n  BackstageTheme,\n  BackstageThemeOptions,\n  SimpleThemeOptions,\n} from './types';\nimport { pageTheme as defaultPageThemes } from './pageTheme';\n\nconst DEFAULT_HTML_FONT_SIZE = 16;\nconst DEFAULT_FONT_FAMILY =\n  '\"Helvetica Neue\", Helvetica, Roboto, Arial, sans-serif';\n\n/**\n * A helper for creating theme options.\n *\n * @public\n */\nexport function createThemeOptions(\n  options: SimpleThemeOptions,\n): BackstageThemeOptions {\n  const {\n    palette,\n    htmlFontSize = DEFAULT_HTML_FONT_SIZE,\n    fontFamily = DEFAULT_FONT_FAMILY,\n    defaultPageTheme,\n    pageTheme = defaultPageThemes,\n  } = options;\n\n  if (!pageTheme[defaultPageTheme]) {\n    throw new Error(`${defaultPageTheme} is not defined in pageTheme.`);\n  }\n\n  return {\n    palette,\n    props: {\n      MuiGrid: {\n        spacing: 2,\n      },\n      MuiSwitch: {\n        color: 'primary',\n      },\n    },\n    typography: {\n      htmlFontSize,\n      fontFamily,\n      h6: {\n        fontWeight: 700,\n        fontSize: 20,\n        marginBottom: 2,\n      },\n      h5: {\n        fontWeight: 700,\n        fontSize: 24,\n        marginBottom: 4,\n      },\n      h4: {\n        fontWeight: 700,\n        fontSize: 28,\n        marginBottom: 6,\n      },\n      h3: {\n        fontSize: 32,\n        fontWeight: 700,\n        marginBottom: 6,\n      },\n      h2: {\n        fontSize: 40,\n        fontWeight: 700,\n        marginBottom: 8,\n      },\n      h1: {\n        fontSize: 54,\n        fontWeight: 700,\n        marginBottom: 10,\n      },\n    },\n    page: pageTheme[defaultPageTheme],\n    getPageTheme: ({ themeId }) =>\n      pageTheme[themeId] ?? pageTheme[defaultPageTheme],\n  };\n}\n\n/**\n * A helper for creating theme overrides.\n *\n * @public\n */\nexport function createThemeOverrides(theme: BackstageTheme): Overrides {\n  return {\n    MuiCssBaseline: {\n      '@global': {\n        html: {\n          height: '100%',\n          fontFamily: theme.typography.fontFamily,\n        },\n        body: {\n          height: '100%',\n          fontFamily: theme.typography.fontFamily,\n          'overscroll-behavior-y': 'none',\n        },\n        a: {\n          color: 'inherit',\n          textDecoration: 'none',\n        },\n      },\n    },\n    MuiTableRow: {\n      // Alternating row backgrounds\n      root: {\n        '&:nth-of-type(odd)': {\n          backgroundColor: theme.palette.background.default,\n        },\n      },\n      // Use pointer for hoverable rows\n      hover: {\n        '&:hover': {\n          cursor: 'pointer',\n        },\n      },\n      // Alternating head backgrounds\n      head: {\n        '&:nth-of-type(odd)': {\n          backgroundColor: theme.palette.background.paper,\n        },\n      },\n    },\n    // Tables are more dense than default mui tables\n    MuiTableCell: {\n      root: {\n        wordBreak: 'break-word',\n        overflow: 'hidden',\n        verticalAlign: 'middle',\n        lineHeight: '1',\n        margin: 0,\n        padding: theme.spacing(3, 2, 3, 2.5),\n        borderBottom: 0,\n      },\n      sizeSmall: {\n        padding: theme.spacing(1.5, 2, 1.5, 2.5),\n      },\n      head: {\n        wordBreak: 'break-word',\n        overflow: 'hidden',\n        color: 'rgb(179, 179, 179)',\n        fontWeight: 'normal',\n        lineHeight: '1',\n      },\n    },\n    MuiTabs: {\n      // Tabs are smaller than default mui tab rows\n      root: {\n        minHeight: 24,\n      },\n    },\n    MuiTab: {\n      // Tabs are smaller and have a hover background\n      root: {\n        color: theme.palette.link,\n        minHeight: 24,\n        textTransform: 'initial',\n        letterSpacing: '0.07em',\n        '&:hover': {\n          color: darken(theme.palette.link, 0.3),\n          background: lighten(theme.palette.link, 0.95),\n        },\n        [theme.breakpoints.up('md')]: {\n          minWidth: 120,\n          fontSize: theme.typography.pxToRem(14),\n          fontWeight: 500,\n        },\n      },\n      textColorPrimary: {\n        color: theme.palette.link,\n      },\n    },\n    MuiTableSortLabel: {\n      // No color change on hover, just rely on the arrow showing up instead.\n      root: {\n        color: 'inherit',\n        '&:hover': {\n          color: 'inherit',\n        },\n        '&:focus': {\n          color: 'inherit',\n        },\n      },\n      // Bold font for highlighting selected column\n      active: {\n        fontWeight: 'bold',\n        color: 'inherit',\n      },\n    },\n    MuiListItemText: {\n      dense: {\n        // Default dense list items to adding ellipsis for really long str...\n        whiteSpace: 'nowrap',\n        overflow: 'hidden',\n        textOverflow: 'ellipsis',\n      },\n    },\n    MuiButton: {\n      text: {\n        // Text buttons have less padding by default, but we want to keep the original padding\n        padding: undefined,\n      },\n    },\n    MuiChip: {\n      root: {\n        backgroundColor: '#D9D9D9',\n        // By default there's no margin, but it's usually wanted, so we add some trailing margin\n        marginRight: theme.spacing(1),\n        marginBottom: theme.spacing(1),\n        color: theme.palette.grey[900],\n      },\n      outlined: {\n        color: theme.palette.text.primary,\n      },\n      label: {\n        lineHeight: `${theme.spacing(2.5)}px`,\n        fontWeight: theme.typography.fontWeightMedium,\n        fontSize: `${theme.spacing(1.75)}px`,\n      },\n      labelSmall: {\n        fontSize: `${theme.spacing(1.5)}px`,\n      },\n      deleteIcon: {\n        color: theme.palette.grey[500],\n        width: `${theme.spacing(3)}px`,\n        height: `${theme.spacing(3)}px`,\n        margin: `0 ${theme.spacing(0.75)}px 0 -${theme.spacing(0.75)}px`,\n      },\n      deleteIconSmall: {\n        width: `${theme.spacing(2)}px`,\n        height: `${theme.spacing(2)}px`,\n        margin: `0 ${theme.spacing(0.5)}px 0 -${theme.spacing(0.5)}px`,\n      },\n    },\n    MuiCard: {\n      root: {\n        // When cards have a forced size, such as when they are arranged in a\n        // CSS grid, the content needs to flex such that the actions (buttons\n        // etc) end up at the bottom of the card instead of just below the body\n        // contents.\n        display: 'flex',\n        flexDirection: 'column',\n      },\n    },\n    MuiCardHeader: {\n      root: {\n        // Reduce padding between header and content\n        paddingBottom: 0,\n      },\n    },\n    MuiCardContent: {\n      root: {\n        // When cards have a forced size, such as when they are arranged in a\n        // CSS grid, the content needs to flex such that the actions (buttons\n        // etc) end up at the bottom of the card instead of just below the body\n        // contents.\n        flexGrow: 1,\n        '&:last-child': {\n          paddingBottom: undefined,\n        },\n      },\n    },\n    MuiCardActions: {\n      root: {\n        // We default to putting the card actions at the end\n        justifyContent: 'flex-end',\n      },\n    },\n  };\n}\n\n/**\n * Creates a Backstage MUI theme using a palette. The theme is created with the\n * common Backstage options and component styles.\n *\n * @public\n */\nexport function createTheme(options: SimpleThemeOptions): BackstageTheme {\n  const themeOptions = createThemeOptions(options);\n  const baseTheme = createMuiTheme(themeOptions) as BackstageTheme;\n  const overrides = createThemeOverrides(baseTheme);\n  const theme = { ...baseTheme, overrides };\n  return theme;\n}\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { createTheme } from './baseTheme';\nimport { pageTheme } from './pageTheme';\nimport { yellow } from '@material-ui/core/colors';\n\n/**\n * The default Backstage light theme.\n *\n * @public\n */\nexport const lightTheme = createTheme({\n  palette: {\n    type: 'light',\n    background: {\n      default: '#F8F8F8',\n    },\n    status: {\n      ok: '#1DB954',\n      warning: '#FF9800',\n      error: '#E22134',\n      running: '#2E77D0',\n      pending: '#FFED51',\n      aborted: '#757575',\n    },\n    bursts: {\n      fontColor: '#FEFEFE',\n      slackChannelText: '#ddd',\n      backgroundColor: {\n        default: '#7C3699',\n      },\n      gradient: {\n        linear: 'linear-gradient(-137deg, #4BB8A5 0%, #187656 100%)',\n      },\n    },\n    primary: {\n      main: '#2E77D0',\n    },\n    banner: {\n      info: '#2E77D0',\n      error: '#E22134',\n      text: '#FFFFFF',\n      link: '#000000',\n      warning: '#FF9800',\n    },\n    border: '#E6E6E6',\n    textContrast: '#000000',\n    textVerySubtle: '#DDD',\n    textSubtle: '#6E6E6E',\n    highlight: '#FFFBCC',\n    errorBackground: '#FFEBEE',\n    warningBackground: '#F59B23',\n    infoBackground: '#ebf5ff',\n    errorText: '#CA001B',\n    infoText: '#004e8a',\n    warningText: '#000000',\n    linkHover: '#2196F3',\n    link: '#0A6EBE',\n    gold: yellow.A700,\n    navigation: {\n      background: '#171717',\n      indicator: '#9BF0E1',\n      color: '#b5b5b5',\n      selectedColor: '#FFF',\n      navItem: {\n        hoverBackground: '#404040',\n      },\n      submenu: {\n        background: '#404040',\n      },\n    },\n    pinSidebarButton: {\n      icon: '#181818',\n      background: '#BDBDBD',\n    },\n    tabbar: {\n      indicator: '#9BF0E1',\n    },\n  },\n  defaultPageTheme: 'home',\n  pageTheme,\n});\n\n/**\n * The default Backstage dark theme.\n *\n * @public\n */\nexport const darkTheme = createTheme({\n  palette: {\n    type: 'dark',\n    background: {\n      default: '#333333',\n    },\n    status: {\n      ok: '#71CF88',\n      warning: '#FFB84D',\n      error: '#F84C55',\n      running: '#3488E3',\n      pending: '#FEF071',\n      aborted: '#9E9E9E',\n    },\n    bursts: {\n      fontColor: '#FEFEFE',\n      slackChannelText: '#ddd',\n      backgroundColor: {\n        default: '#7C3699',\n      },\n      gradient: {\n        linear: 'linear-gradient(-137deg, #4BB8A5 0%, #187656 100%)',\n      },\n    },\n    primary: {\n      main: '#9CC9FF',\n      dark: '#82BAFD',\n    },\n    secondary: {\n      main: '#FF88B2',\n    },\n    banner: {\n      info: '#2E77D0',\n      error: '#E22134',\n      text: '#FFFFFF',\n      link: '#000000',\n      warning: '#FF9800',\n    },\n    border: '#E6E6E6',\n    textContrast: '#FFFFFF',\n    textVerySubtle: '#727272',\n    textSubtle: '#CCCCCC',\n    highlight: '#FFFBCC',\n    errorBackground: '#FFEBEE',\n    warningBackground: '#F59B23',\n    infoBackground: '#ebf5ff',\n    errorText: '#CA001B',\n    infoText: '#004e8a',\n    warningText: '#000000',\n    linkHover: '#82BAFD',\n    link: '#9CC9FF',\n    gold: yellow.A700,\n    navigation: {\n      background: '#424242',\n      indicator: '#9BF0E1',\n      color: '#b5b5b5',\n      selectedColor: '#FFF',\n      navItem: {\n        hoverBackground: '#404040',\n      },\n      submenu: {\n        background: '#404040',\n      },\n    },\n    pinSidebarButton: {\n      icon: '#404040',\n      background: '#BDBDBD',\n    },\n    tabbar: {\n      indicator: '#9BF0E1',\n    },\n  },\n  defaultPageTheme: 'home',\n  pageTheme,\n});\n","/*\n * Copyright 2021 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React from 'react';\nimport { darkTheme, lightTheme } from '@backstage/theme';\nimport DarkIcon from '@material-ui/icons/Brightness2';\nimport LightIcon from '@material-ui/icons/WbSunny';\nimport { ThemeProvider } from '@material-ui/core/styles';\nimport CssBaseline from '@material-ui/core/CssBaseline';\nimport { AppTheme } from '@backstage/core-plugin-api';\n\nexport const themes: AppTheme[] = [\n  {\n    id: 'light',\n    title: 'Light Theme',\n    variant: 'light',\n    icon: <LightIcon />,\n    Provider: ({ children }) => (\n      <ThemeProvider theme={lightTheme}>\n        <CssBaseline>{children}</CssBaseline>\n      </ThemeProvider>\n    ),\n  },\n  {\n    id: 'dark',\n    title: 'Dark Theme',\n    variant: 'dark',\n    icon: <DarkIcon />,\n    Provider: ({ children }) => (\n      <ThemeProvider theme={darkTheme}>\n        <CssBaseline>{children}</CssBaseline>\n      </ThemeProvider>\n    ),\n  },\n];\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { apis, components, icons, themes } from './defaults';\nimport {\n  AppTheme,\n  BackstagePlugin,\n  IconComponent,\n} from '@backstage/core-plugin-api';\nimport {\n  AppComponents,\n  AppOptions,\n  AppIcons,\n  createSpecializedApp,\n} from '@backstage/core-app-api';\n\n/**\n * Creates a new Backstage App using a default set of components, icons and themes unless\n * they are explicitly provided.\n *\n * @public\n */\nexport function createApp(\n  options?: Omit<AppOptions, keyof OptionalAppOptions> & OptionalAppOptions,\n) {\n  return createSpecializedApp({\n    ...options,\n    apis: options?.apis ?? [],\n    bindRoutes: options?.bindRoutes,\n    components: {\n      ...components,\n      ...options?.components,\n    },\n    configLoader: options?.configLoader,\n    defaultApis: apis,\n    icons: {\n      ...icons,\n      ...options?.icons,\n    },\n    plugins: (options?.plugins as BackstagePlugin[]) ?? [],\n    themes: options?.themes ?? themes,\n  });\n}\n\n/**\n * The set of app options that {@link createApp} will provide defaults for\n * if they are not passed in explicitly.\n *\n * @public\n */\nexport type OptionalAppOptions = {\n  /**\n   * A set of icons to override the default icons with.\n   *\n   * The override is applied for each icon individually.\n   *\n   * @public\n   */\n  icons?: Partial<AppIcons> & {\n    [key in string]: IconComponent;\n  };\n\n  /**\n   * A set of themes that override all of the default app themes.\n   *\n   * If this option is provided none of the default themes will be used.\n   *\n   * @public\n   */\n  themes?: (Partial<AppTheme> & Omit<AppTheme, 'theme'>)[]; // TODO: simplify once AppTheme is updated\n\n  /**\n   * A set of components to override the default components with.\n   *\n   * The override is applied for each icon individually.\n   *\n   * @public\n   */\n  components?: Partial<AppComponents>;\n};\n","/*\n * Copyright 2021 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { stringifyEntityRef } from '@backstage/catalog-model';\nimport { StorageApi } from '@backstage/core-plugin-api';\nimport { isArray, isString } from 'lodash';\n\n/**\n * Migrate the starred entities from the old format (entity:<kind>:<namespace>:<name>) from the\n * old storage location (/settings/starredEntities) to entity references in the new location\n * (/starredEntities/entityRefs).\n *\n * This will only be executed once since the old location is cleared.\n *\n * @param storageApi - the StorageApi to migrate\n */\nexport async function performMigrationToTheNewBucket({\n  storageApi,\n}: {\n  storageApi: StorageApi;\n}) {\n  const source = storageApi.forBucket('settings');\n  const target = storageApi.forBucket('starredEntities');\n\n  const oldStarredEntities = source.snapshot('starredEntities').value;\n\n  if (!isArray(oldStarredEntities)) {\n    // nothing to do\n    return;\n  }\n  const targetEntities = new Set(\n    target.snapshot<string[]>('entityRefs').value ?? [],\n  );\n\n  oldStarredEntities\n    .filter(isString)\n    // extract the old format 'entity:<kind>:<namespace>:<name>'\n    .map(old => old.split(':'))\n    // check if the format is valid\n    .filter(split => split.length === 4 && split[0] === 'entity')\n    // convert to entity references\n    .map(([_, kind, namespace, name]) =>\n      stringifyEntityRef({ kind, namespace, name }),\n    )\n    .forEach(e => targetEntities.add(e));\n\n  await target.set('entityRefs', Array.from(targetEntities));\n\n  await source.remove('starredEntities');\n}\n","/*\n * Copyright 2021 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { StorageApi } from '@backstage/core-plugin-api';\nimport { StarredEntitiesApi } from '@backstage/plugin-catalog-react';\nimport { Observable } from '@backstage/types';\nimport ObservableImpl from 'zen-observable';\nimport { performMigrationToTheNewBucket } from './migration';\n\n/**\n * Default implementation of the StarredEntitiesApi that is backed by the StorageApi.\n *\n * @public\n */\nexport class DefaultStarredEntitiesApi implements StarredEntitiesApi {\n  private readonly settingsStore: StorageApi;\n  private starredEntities: Set<string>;\n\n  constructor(opts: { storageApi: StorageApi }) {\n    // no need to await. The updated content will be caught by the observe$\n    performMigrationToTheNewBucket(opts).then();\n\n    this.settingsStore = opts.storageApi.forBucket('starredEntities');\n\n    this.starredEntities = new Set(\n      this.settingsStore.snapshot<string[]>('entityRefs').value ?? [],\n    );\n\n    this.settingsStore.observe$<string[]>('entityRefs').subscribe({\n      next: next => {\n        this.starredEntities = new Set(next.value ?? []);\n        this.notifyChanges();\n      },\n    });\n  }\n\n  async toggleStarred(entityRef: string): Promise<void> {\n    if (this.starredEntities.has(entityRef)) {\n      this.starredEntities.delete(entityRef);\n    } else {\n      this.starredEntities.add(entityRef);\n    }\n\n    await this.settingsStore.set(\n      'entityRefs',\n      Array.from(this.starredEntities),\n    );\n  }\n\n  starredEntitie$(): Observable<Set<string>> {\n    return this.observable;\n  }\n\n  private readonly subscribers = new Set<\n    ZenObservable.SubscriptionObserver<Set<string>>\n  >();\n\n  private readonly observable = new ObservableImpl<Set<string>>(subscriber => {\n    // forward the the latest value\n    subscriber.next(new Set(this.starredEntities));\n\n    this.subscribers.add(subscriber);\n    return () => {\n      this.subscribers.delete(subscriber);\n    };\n  });\n\n  private notifyChanges() {\n    for (const subscription of this.subscribers) {\n      subscription.next(new Set(this.starredEntities));\n    }\n  }\n}\n","/*\n * Copyright 2021 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React, { ReactNode } from 'react';\nimport {\n  Box,\n  Chip,\n  Divider,\n  ListItem,\n  ListItemIcon,\n  ListItemText,\n  makeStyles,\n} from '@material-ui/core';\nimport { Link } from '@backstage/core-components';\nimport { useAnalytics } from '@backstage/core-plugin-api';\nimport {\n  IndexableDocument,\n  ResultHighlight,\n} from '@backstage/plugin-search-common';\nimport { HighlightedSearchResultText } from '@backstage/plugin-search-react';\n\nconst useStyles = makeStyles({\n  flexContainer: {\n    flexWrap: 'wrap',\n  },\n  itemText: {\n    width: '100%',\n    wordBreak: 'break-all',\n    marginBottom: '1rem',\n  },\n});\n\n/**\n * Props for {@link CatalogSearchResultListItem}.\n *\n * @public\n */\nexport interface CatalogSearchResultListItemProps {\n  icon?: ReactNode;\n  result: IndexableDocument;\n  highlight?: ResultHighlight;\n  rank?: number;\n}\n\n/** @public */\nexport function CatalogSearchResultListItem(\n  props: CatalogSearchResultListItemProps,\n) {\n  const result = props.result as any;\n\n  const classes = useStyles();\n  const analytics = useAnalytics();\n  const handleClick = () => {\n    analytics.captureEvent('discover', result.title, {\n      attributes: { to: result.location },\n      value: props.rank,\n    });\n  };\n\n  return (\n    <Link noTrack to={result.location} onClick={handleClick}>\n      <ListItem alignItems=\"flex-start\">\n        {props.icon && <ListItemIcon>{props.icon}</ListItemIcon>}\n        <div className={classes.flexContainer}>\n          <ListItemText\n            className={classes.itemText}\n            primaryTypographyProps={{ variant: 'h6' }}\n            primary={\n              props.highlight?.fields.title ? (\n                <HighlightedSearchResultText\n                  text={props.highlight.fields.title}\n                  preTag={props.highlight.preTag}\n                  postTag={props.highlight.postTag}\n                />\n              ) : (\n                result.title\n              )\n            }\n            secondary={\n              props.highlight?.fields.text ? (\n                <HighlightedSearchResultText\n                  text={props.highlight.fields.text}\n                  preTag={props.highlight.preTag}\n                  postTag={props.highlight.postTag}\n                />\n              ) : (\n                result.text\n              )\n            }\n          />\n          <Box>\n            {result.kind && (\n              <Chip label={`Kind: ${result.kind}`} size=\"small\" />\n            )}\n            {result.lifecycle && (\n              <Chip label={`Lifecycle: ${result.lifecycle}`} size=\"small\" />\n            )}\n          </Box>\n        </div>\n      </ListItem>\n      <Divider component=\"li\" />\n    </Link>\n  );\n}\n","/*\n * Copyright 2021 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  createPermission,\n  ResourcePermission,\n} from '@backstage/plugin-permission-common';\n\n/**\n * Permission resource type which corresponds to catalog entities.\n *\n * {@link https://backstage.io/docs/features/software-catalog/software-catalog-overview}\n * @alpha\n */\nexport const RESOURCE_TYPE_CATALOG_ENTITY = 'catalog-entity';\n\n/**\n * Convenience type for catalog entity\n * {@link @backstage/plugin-permission-common#ResourcePermission}s.\n * @alpha\n */\nexport type CatalogEntityPermission = ResourcePermission<\n  typeof RESOURCE_TYPE_CATALOG_ENTITY\n>;\n\n/**\n * This permission is used to authorize actions that involve reading one or more\n * entities from the catalog.\n *\n * If this permission is not authorized, it will appear that the entity does not\n * exist in the catalog — both in the frontend and in API responses.\n * @alpha\n */\nexport const catalogEntityReadPermission = createPermission({\n  name: 'catalog.entity.read',\n  attributes: {\n    action: 'read',\n  },\n  resourceType: RESOURCE_TYPE_CATALOG_ENTITY,\n});\n\n/**\n * This permission is used to authorize actions that involve creating a new\n * catalog entity. This includes registering an existing component into the\n * catalog.\n * @alpha\n */\nexport const catalogEntityCreatePermission = createPermission({\n  name: 'catalog.entity.create',\n  attributes: {\n    action: 'create',\n  },\n});\n\n/**\n * This permission is used to designate actions that involve removing one or\n * more entities from the catalog.\n * @alpha\n */\nexport const catalogEntityDeletePermission = createPermission({\n  name: 'catalog.entity.delete',\n  attributes: {\n    action: 'delete',\n  },\n  resourceType: RESOURCE_TYPE_CATALOG_ENTITY,\n});\n\n/**\n * This permission is used to designate refreshing one or more entities from the\n * catalog.\n * @alpha\n */\nexport const catalogEntityRefreshPermission = createPermission({\n  name: 'catalog.entity.refresh',\n  attributes: {\n    action: 'update',\n  },\n  resourceType: RESOURCE_TYPE_CATALOG_ENTITY,\n});\n\n/**\n * This permission is used to designate actions that involve reading one or more\n * locations from the catalog.\n *\n * If this permission is not authorized, it will appear that the location does\n * not exist in the catalog — both in the frontend and in API responses.\n * @alpha\n */\nexport const catalogLocationReadPermission = createPermission({\n  name: 'catalog.location.read',\n  attributes: {\n    action: 'read',\n  },\n});\n\n/**\n * This permission is used to designate actions that involve creating catalog\n * locations.\n * @alpha\n */\nexport const catalogLocationCreatePermission = createPermission({\n  name: 'catalog.location.create',\n  attributes: {\n    action: 'create',\n  },\n});\n\n/**\n * This permission is used to designate actions that involve deleting locations\n * from the catalog.\n * @alpha\n */\nexport const catalogLocationDeletePermission = createPermission({\n  name: 'catalog.location.delete',\n  attributes: {\n    action: 'delete',\n  },\n});\n\n/**\n * List of all catalog permissions.\n * @alpha\n */\nexport const catalogPermissions = [\n  catalogEntityReadPermission,\n  catalogEntityCreatePermission,\n  catalogEntityDeletePermission,\n  catalogEntityRefreshPermission,\n  catalogLocationReadPermission,\n  catalogLocationCreatePermission,\n  catalogLocationDeletePermission,\n];\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React from 'react';\nimport { ListItemIcon, ListItemText, MenuItem } from '@material-ui/core';\nimport CancelIcon from '@material-ui/icons/Cancel';\n\ntype VisibleType = 'visible' | 'hidden' | 'disable';\n\nexport type UnregisterEntityOptions = {\n  disableUnregister: boolean | VisibleType;\n};\n\ninterface UnregisterEntityProps {\n  unregisterEntityOptions?: UnregisterEntityOptions;\n  isUnregisterAllowed: boolean;\n  onUnregisterEntity: () => void;\n  onClose: () => void;\n}\n\nexport function UnregisterEntity(props: UnregisterEntityProps) {\n  const {\n    unregisterEntityOptions,\n    isUnregisterAllowed,\n    onUnregisterEntity,\n    onClose,\n  } = props;\n\n  const isBoolean =\n    typeof unregisterEntityOptions?.disableUnregister === 'boolean';\n\n  const isDisabled =\n    (!isUnregisterAllowed ||\n      (isBoolean\n        ? !!unregisterEntityOptions?.disableUnregister\n        : unregisterEntityOptions?.disableUnregister === 'disable')) ??\n    false;\n\n  let unregisterButton = <></>;\n\n  if (unregisterEntityOptions?.disableUnregister !== 'hidden') {\n    unregisterButton = (\n      <MenuItem\n        onClick={() => {\n          onClose();\n          onUnregisterEntity();\n        }}\n        disabled={isDisabled}\n      >\n        <ListItemIcon>\n          <CancelIcon fontSize=\"small\" />\n        </ListItemIcon>\n        <ListItemText primary=\"Unregister entity\" />\n      </MenuItem>\n    );\n  }\n\n  return <>{unregisterButton}</>;\n}\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  Divider,\n  IconButton,\n  ListItemIcon,\n  ListItemText,\n  MenuItem,\n  MenuList,\n  Popover,\n} from '@material-ui/core';\nimport { makeStyles } from '@material-ui/core/styles';\nimport BugReportIcon from '@material-ui/icons/BugReport';\nimport MoreVert from '@material-ui/icons/MoreVert';\nimport FileCopyTwoToneIcon from '@material-ui/icons/FileCopyTwoTone';\nimport React, { useCallback, useState } from 'react';\nimport { IconComponent } from '@backstage/core-plugin-api';\nimport { useEntityPermission } from '@backstage/plugin-catalog-react';\nimport { catalogEntityDeletePermission } from '@backstage/plugin-catalog-common';\nimport { BackstageTheme } from '@backstage/theme';\nimport { UnregisterEntity, UnregisterEntityOptions } from './UnregisterEntity';\nimport { useApi, alertApiRef } from '@backstage/core-plugin-api';\n\n/** @public */\nexport type EntityContextMenuClassKey = 'button';\n\nconst useStyles = makeStyles(\n  (theme: BackstageTheme) => {\n    return {\n      button: {\n        color: theme.page.fontColor,\n      },\n    };\n  },\n  { name: 'PluginCatalogEntityContextMenu' },\n);\n\n// NOTE(freben): Intentionally not exported at this point, since it's part of\n// the unstable extra context menu items concept below\ninterface ExtraContextMenuItem {\n  title: string;\n  Icon: IconComponent;\n  onClick: () => void;\n}\n\ninterface EntityContextMenuProps {\n  UNSTABLE_extraContextMenuItems?: ExtraContextMenuItem[];\n  UNSTABLE_contextMenuOptions?: UnregisterEntityOptions;\n  onUnregisterEntity: () => void;\n  onInspectEntity: () => void;\n}\n\nexport function EntityContextMenu(props: EntityContextMenuProps) {\n  const {\n    UNSTABLE_extraContextMenuItems,\n    UNSTABLE_contextMenuOptions,\n    onUnregisterEntity,\n    onInspectEntity,\n  } = props;\n  const [anchorEl, setAnchorEl] = useState<HTMLButtonElement>();\n  const classes = useStyles();\n  const unregisterPermission = useEntityPermission(\n    catalogEntityDeletePermission,\n  );\n  const isAllowed = unregisterPermission.allowed;\n\n  const onOpen = (event: React.SyntheticEvent<HTMLButtonElement>) => {\n    setAnchorEl(event.currentTarget);\n  };\n\n  const onClose = () => {\n    setAnchorEl(undefined);\n  };\n\n  const alertApi = useApi(alertApiRef);\n\n  const copyToClipboard = useCallback(() => {\n    navigator.clipboard\n      .writeText(window.location.toString())\n      .then(() => alertApi.post({ message: 'Copied!', severity: 'info' }));\n  }, [alertApi]);\n\n  const extraItems = UNSTABLE_extraContextMenuItems && [\n    ...UNSTABLE_extraContextMenuItems.map(item => (\n      <MenuItem\n        key={item.title}\n        onClick={() => {\n          onClose();\n          item.onClick();\n        }}\n      >\n        <ListItemIcon>\n          <item.Icon fontSize=\"small\" />\n        </ListItemIcon>\n        <ListItemText primary={item.title} />\n      </MenuItem>\n    )),\n    <Divider key=\"the divider is here!\" />,\n  ];\n\n  return (\n    <>\n      <IconButton\n        aria-label=\"more\"\n        aria-controls=\"long-menu\"\n        aria-haspopup=\"true\"\n        aria-expanded={!!anchorEl}\n        role=\"button\"\n        onClick={onOpen}\n        data-testid=\"menu-button\"\n        className={classes.button}\n        id=\"long-menu\"\n      >\n        <MoreVert />\n      </IconButton>\n      <Popover\n        open={Boolean(anchorEl)}\n        onClose={onClose}\n        anchorEl={anchorEl}\n        anchorOrigin={{ vertical: 'bottom', horizontal: 'right' }}\n        transformOrigin={{ vertical: 'top', horizontal: 'right' }}\n        aria-labelledby=\"long-menu\"\n      >\n        <MenuList>\n          {extraItems}\n          <UnregisterEntity\n            unregisterEntityOptions={UNSTABLE_contextMenuOptions}\n            isUnregisterAllowed={isAllowed}\n            onUnregisterEntity={onUnregisterEntity}\n            onClose={onClose}\n          />\n          <MenuItem\n            onClick={() => {\n              onClose();\n              onInspectEntity();\n            }}\n          >\n            <ListItemIcon>\n              <BugReportIcon fontSize=\"small\" />\n            </ListItemIcon>\n            <ListItemText primary=\"Inspect entity\" />\n          </MenuItem>\n          <MenuItem\n            onClick={() => {\n              onClose();\n              copyToClipboard();\n            }}\n          >\n            <ListItemIcon>\n              <FileCopyTwoToneIcon fontSize=\"small\" />\n            </ListItemIcon>\n            <ListItemText primary=\"Copy entity URL\" />\n          </MenuItem>\n        </MenuList>\n      </Popover>\n    </>\n  );\n}\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  Entity,\n  DEFAULT_NAMESPACE,\n  RELATION_OWNED_BY,\n} from '@backstage/catalog-model';\nimport {\n  Content,\n  Header,\n  HeaderLabel,\n  Link,\n  Page,\n  Progress,\n  RoutedTabs,\n  WarningPanel,\n} from '@backstage/core-components';\nimport {\n  attachComponentData,\n  IconComponent,\n  useElementFilter,\n  useRouteRefParams,\n} from '@backstage/core-plugin-api';\nimport {\n  EntityRefLinks,\n  entityRouteRef,\n  FavoriteEntity,\n  getEntityRelations,\n  InspectEntityDialog,\n  UnregisterEntityDialog,\n  useAsyncEntity,\n} from '@backstage/plugin-catalog-react';\nimport { Box, TabProps } from '@material-ui/core';\nimport { Alert } from '@material-ui/lab';\nimport React, { useEffect, useState } from 'react';\nimport { useLocation, useNavigate } from 'react-router';\nimport { EntityContextMenu } from '../EntityContextMenu/EntityContextMenu';\n\n/** @public */\nexport type EntityLayoutRouteProps = {\n  path: string;\n  title: string;\n  children: JSX.Element;\n  if?: (entity: Entity) => boolean;\n  tabProps?: TabProps<React.ElementType, { component?: React.ElementType }>;\n};\n\nconst dataKey = 'plugin.catalog.entityLayoutRoute';\n\nconst Route: (props: EntityLayoutRouteProps) => null = () => null;\nattachComponentData(Route, dataKey, true);\nattachComponentData(Route, 'core.gatherMountPoints', true); // This causes all mount points that are discovered within this route to use the path of the route itself\n\nfunction EntityLayoutTitle(props: {\n  title: string;\n  entity: Entity | undefined;\n}) {\n  const { entity, title } = props;\n  return (\n    <Box display=\"inline-flex\" alignItems=\"center\" height=\"1em\" maxWidth=\"100%\">\n      <Box\n        component=\"span\"\n        textOverflow=\"ellipsis\"\n        whiteSpace=\"nowrap\"\n        overflow=\"hidden\"\n      >\n        {title}\n      </Box>\n      {entity && <FavoriteEntity entity={entity} />}\n    </Box>\n  );\n}\n\nfunction headerProps(\n  paramKind: string | undefined,\n  paramNamespace: string | undefined,\n  paramName: string | undefined,\n  entity: Entity | undefined,\n): { headerTitle: string; headerType: string } {\n  const kind = paramKind ?? entity?.kind ?? '';\n  const namespace = paramNamespace ?? entity?.metadata.namespace ?? '';\n  const name =\n    entity?.metadata.title ?? paramName ?? entity?.metadata.name ?? '';\n  return {\n    headerTitle: `${name}${\n      namespace && namespace !== DEFAULT_NAMESPACE ? ` in ${namespace}` : ''\n    }`,\n    headerType: (() => {\n      let t = kind.toLocaleLowerCase('en-US');\n      if (entity && entity.spec && 'type' in entity.spec) {\n        t += ' — ';\n        t += (entity.spec as { type: string }).type.toLocaleLowerCase('en-US');\n      }\n      return t;\n    })(),\n  };\n}\n\nfunction EntityLabels(props: { entity: Entity }) {\n  const { entity } = props;\n  const ownedByRelations = getEntityRelations(entity, RELATION_OWNED_BY);\n  return (\n    <>\n      {ownedByRelations.length > 0 && (\n        <HeaderLabel\n          label=\"Owner\"\n          value={\n            <EntityRefLinks\n              entityRefs={ownedByRelations}\n              defaultKind=\"Group\"\n              color=\"inherit\"\n            />\n          }\n        />\n      )}\n      {entity.spec?.lifecycle && (\n        <HeaderLabel label=\"Lifecycle\" value={entity.spec.lifecycle} />\n      )}\n    </>\n  );\n}\n\n// NOTE(freben): Intentionally not exported at this point, since it's part of\n// the unstable extra context menu items concept below\ninterface ExtraContextMenuItem {\n  title: string;\n  Icon: IconComponent;\n  onClick: () => void;\n}\n\ntype VisibleType = 'visible' | 'hidden' | 'disable';\n\n// NOTE(blam): Intentionally not exported at this point, since it's part of\n// unstable context menu option, eg: disable the unregister entity menu\ninterface EntityContextMenuOptions {\n  disableUnregister: boolean | VisibleType;\n}\n\n/** @public */\nexport interface EntityLayoutProps {\n  UNSTABLE_extraContextMenuItems?: ExtraContextMenuItem[];\n  UNSTABLE_contextMenuOptions?: EntityContextMenuOptions;\n  children?: React.ReactNode;\n  NotFoundComponent?: React.ReactNode;\n}\n\n/**\n * EntityLayout is a compound component, which allows you to define a layout for\n * entities using a sub-navigation mechanism.\n *\n * Consists of two parts: EntityLayout and EntityLayout.Route\n *\n * @example\n * ```jsx\n * <EntityLayout>\n *   <EntityLayout.Route path=\"/example\" title=\"Example tab\">\n *     <div>This is rendered under /example/anything-here route</div>\n *   </EntityLayout.Route>\n * </EntityLayout>\n * ```\n *\n * @public\n */\nexport const EntityLayout = (props: EntityLayoutProps) => {\n  const {\n    UNSTABLE_extraContextMenuItems,\n    UNSTABLE_contextMenuOptions,\n    children,\n    NotFoundComponent,\n  } = props;\n  const { kind, namespace, name } = useRouteRefParams(entityRouteRef);\n  const { entity, loading, error } = useAsyncEntity();\n  const location = useLocation();\n  const routes = useElementFilter(\n    children,\n    elements =>\n      elements\n        .selectByComponentData({\n          key: dataKey,\n          withStrictError:\n            'Child of EntityLayout must be an EntityLayout.Route',\n        })\n        .getElements<EntityLayoutRouteProps>() // all nodes, element data, maintain structure or not?\n        .flatMap(({ props: elementProps }) => {\n          if (!entity) {\n            return [];\n          } else if (elementProps.if && !elementProps.if(entity)) {\n            return [];\n          }\n\n          return [\n            {\n              path: elementProps.path,\n              title: elementProps.title,\n              children: elementProps.children,\n              tabProps: elementProps.tabProps,\n            },\n          ];\n        }),\n    [entity],\n  );\n\n  const { headerTitle, headerType } = headerProps(\n    kind,\n    namespace,\n    name,\n    entity,\n  );\n\n  const [confirmationDialogOpen, setConfirmationDialogOpen] = useState(false);\n  const [inspectionDialogOpen, setInspectionDialogOpen] = useState(false);\n  const navigate = useNavigate();\n  const cleanUpAfterRemoval = async () => {\n    setConfirmationDialogOpen(false);\n    setInspectionDialogOpen(false);\n    navigate('/');\n  };\n\n  // Make sure to close the dialog if the user clicks links in it that navigate\n  // to another entity.\n  useEffect(() => {\n    setConfirmationDialogOpen(false);\n    setInspectionDialogOpen(false);\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [location.pathname]);\n\n  return (\n    <Page themeId={entity?.spec?.type?.toString() ?? 'home'}>\n      <Header\n        title={<EntityLayoutTitle title={headerTitle} entity={entity!} />}\n        pageTitleOverride={headerTitle}\n        type={headerType}\n      >\n        {entity && (\n          <>\n            <EntityLabels entity={entity} />\n            <EntityContextMenu\n              UNSTABLE_extraContextMenuItems={UNSTABLE_extraContextMenuItems}\n              UNSTABLE_contextMenuOptions={UNSTABLE_contextMenuOptions}\n              onUnregisterEntity={() => setConfirmationDialogOpen(true)}\n              onInspectEntity={() => setInspectionDialogOpen(true)}\n            />\n          </>\n        )}\n      </Header>\n\n      {loading && <Progress />}\n\n      {entity && <RoutedTabs routes={routes} />}\n\n      {error && (\n        <Content>\n          <Alert severity=\"error\">{error.toString()}</Alert>\n        </Content>\n      )}\n\n      {!loading && !error && !entity && (\n        <Content>\n          {NotFoundComponent ? (\n            NotFoundComponent\n          ) : (\n            <WarningPanel title=\"Entity not found\">\n              There is no {kind} with the requested{' '}\n              <Link to=\"https://backstage.io/docs/features/software-catalog/references\">\n                kind, namespace, and name\n              </Link>\n              .\n            </WarningPanel>\n          )}\n        </Content>\n      )}\n\n      <UnregisterEntityDialog\n        open={confirmationDialogOpen}\n        entity={entity!}\n        onConfirm={cleanUpAfterRemoval}\n        onClose={() => setConfirmationDialogOpen(false)}\n      />\n      <InspectEntityDialog\n        open={inspectionDialogOpen}\n        entity={entity!}\n        onClose={() => setInspectionDialogOpen(false)}\n      />\n    </Page>\n  );\n};\n\nEntityLayout.Route = Route;\n","/*\n * Copyright 2021 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { Entity } from '@backstage/catalog-model';\nimport { catalogApiRef } from '@backstage/plugin-catalog-react';\nimport { Button, Dialog, DialogActions, DialogTitle } from '@material-ui/core';\nimport React, { useState } from 'react';\nimport { alertApiRef, useApi } from '@backstage/core-plugin-api';\nimport { assertError } from '@backstage/errors';\n\ninterface DeleteEntityDialogProps {\n  open: boolean;\n  onClose: () => any;\n  onConfirm: () => any;\n  entity: Entity;\n}\n\nexport function DeleteEntityDialog(props: DeleteEntityDialogProps) {\n  const { open, onClose, onConfirm, entity } = props;\n  const [busy, setBusy] = useState(false);\n  const catalogApi = useApi(catalogApiRef);\n  const alertApi = useApi(alertApiRef);\n\n  const onDelete = async () => {\n    setBusy(true);\n    try {\n      const uid = entity.metadata.uid;\n      await catalogApi.removeEntityByUid(uid!);\n      onConfirm();\n    } catch (err) {\n      assertError(err);\n      alertApi.post({ message: err.message });\n    } finally {\n      setBusy(false);\n    }\n  };\n\n  return (\n    <Dialog open={open} onClose={onClose}>\n      <DialogTitle id=\"responsive-dialog-title\">\n        Are you sure you want to delete this entity?\n      </DialogTitle>\n      <DialogActions>\n        <Button\n          variant=\"contained\"\n          color=\"secondary\"\n          disabled={busy}\n          onClick={onDelete}\n        >\n          Delete\n        </Button>\n        <Button onClick={onClose} color=\"primary\">\n          Cancel\n        </Button>\n      </DialogActions>\n    </Dialog>\n  );\n}\n","/*\n * Copyright 2021 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { Entity } from '@backstage/catalog-model';\nimport { useEntity } from '@backstage/plugin-catalog-react';\nimport { Alert } from '@material-ui/lab';\nimport React, { useState } from 'react';\nimport { useNavigate } from 'react-router';\nimport { DeleteEntityDialog } from './DeleteEntityDialog';\nimport { useRouteRef } from '@backstage/core-plugin-api';\nimport { rootRouteRef } from '../../routes';\n\n/**\n * Returns true if the given entity has the orphan annotation given by the\n * catalog.\n *\n * @public\n */\nexport function isOrphan(entity: Entity): boolean {\n  return entity?.metadata?.annotations?.['backstage.io/orphan'] === 'true';\n}\n\n/**\n * Displays a warning alert if the entity is marked as orphan with the ability\n * to delete said entity.\n *\n * @public\n */\nexport function EntityOrphanWarning() {\n  const navigate = useNavigate();\n  const catalogLink = useRouteRef(rootRouteRef);\n  const [confirmationDialogOpen, setConfirmationDialogOpen] = useState(false);\n  const { entity } = useEntity();\n\n  const cleanUpAfterRemoval = async () => {\n    setConfirmationDialogOpen(false);\n    navigate(catalogLink());\n  };\n\n  return (\n    <>\n      <Alert severity=\"warning\" onClick={() => setConfirmationDialogOpen(true)}>\n        This entity is not referenced by any location and is therefore not\n        receiving updates. Click here to delete.\n      </Alert>\n      <DeleteEntityDialog\n        open={confirmationDialogOpen}\n        entity={entity!}\n        onConfirm={cleanUpAfterRemoval}\n        onClose={() => setConfirmationDialogOpen(false)}\n      />\n    </>\n  );\n}\n","/*\n * Copyright 2021 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  Entity,\n  AlphaEntity,\n  stringifyEntityRef,\n  EntityStatusItem,\n} from '@backstage/catalog-model';\nimport {\n  catalogApiRef,\n  EntityRefLink,\n  useEntity,\n} from '@backstage/plugin-catalog-react';\nimport { Box } from '@material-ui/core';\nimport React from 'react';\nimport { ResponseErrorPanel } from '@backstage/core-components';\nimport {\n  CatalogApi,\n  ENTITY_STATUS_CATALOG_PROCESSING_TYPE,\n} from '@backstage/catalog-client';\nimport { useApi, ApiHolder } from '@backstage/core-plugin-api';\nimport useAsync from 'react-use/lib/useAsync';\nimport { SerializedError } from '@backstage/errors';\n\nconst errorFilter = (i: EntityStatusItem) =>\n  i.error &&\n  i.level === 'error' &&\n  i.type === ENTITY_STATUS_CATALOG_PROCESSING_TYPE;\n\ninterface GetOwnAndAncestorsErrorsResponse {\n  items: {\n    errors: SerializedError[];\n    entity: Entity;\n  }[];\n}\n\nasync function getOwnAndAncestorsErrors(\n  entityRef: string,\n  catalogApi: CatalogApi,\n): Promise<GetOwnAndAncestorsErrorsResponse> {\n  const ancestors = await catalogApi.getEntityAncestors({ entityRef });\n  const items = ancestors.items\n    .map(item => {\n      const statuses = (item.entity as AlphaEntity).status?.items ?? [];\n      const errors = statuses\n        .filter(errorFilter)\n        .map(e => e.error)\n        .filter((e): e is SerializedError => Boolean(e));\n      return { errors: errors, entity: item.entity };\n    })\n    .filter(item => item.errors.length > 0);\n  return { items };\n}\n\n/**\n * Returns true if the given entity has any processing errors on it.\n *\n * @public\n */\nexport async function hasCatalogProcessingErrors(\n  entity: Entity,\n  context: { apis: ApiHolder },\n) {\n  const catalogApi = context.apis.get(catalogApiRef);\n  if (!catalogApi) {\n    throw new Error(`No implementation available for ${catalogApiRef}`);\n  }\n\n  const errors = await getOwnAndAncestorsErrors(\n    stringifyEntityRef(entity),\n    catalogApi,\n  );\n  return errors.items.length > 0;\n}\n\n/**\n * Displays a list of errors from the ancestors of the current entity.\n *\n * @public\n */\nexport function EntityProcessingErrorsPanel() {\n  const { entity } = useEntity();\n  const entityRef = stringifyEntityRef(entity);\n  const catalogApi = useApi(catalogApiRef);\n  const { loading, error, value } = useAsync(async () => {\n    return getOwnAndAncestorsErrors(entityRef, catalogApi);\n  }, [entityRef, catalogApi]);\n\n  if (error) {\n    return (\n      <Box mb={1}>\n        <ResponseErrorPanel error={error} />\n      </Box>\n    );\n  }\n\n  if (loading || !value) {\n    return null;\n  }\n\n  return (\n    <>\n      {value.items.map((ancestorError, index) => (\n        <Box key={index} mb={1}>\n          {stringifyEntityRef(entity) !==\n            stringifyEntityRef(ancestorError.entity) && (\n            <Box p={1}>\n              The error below originates from{' '}\n              <EntityRefLink entityRef={ancestorError.entity} />\n            </Box>\n          )}\n          {ancestorError.errors.map((e, i) => (\n            <ResponseErrorPanel key={i} error={e} />\n          ))}\n        </Box>\n      ))}\n    </>\n  );\n}\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { Entity } from '@backstage/catalog-model';\nimport { useAsyncEntity } from '@backstage/plugin-catalog-react';\nimport React, { ReactNode, ReactElement } from 'react';\nimport {\n  attachComponentData,\n  useApiHolder,\n  useElementFilter,\n  ApiHolder,\n} from '@backstage/core-plugin-api';\nimport useAsync from 'react-use/lib/useAsync';\n\nconst ENTITY_SWITCH_KEY = 'core.backstage.entitySwitch';\n\n/** @public */\nexport interface EntitySwitchCaseProps {\n  if?: (\n    entity: Entity,\n    context: { apis: ApiHolder },\n  ) => boolean | Promise<boolean>;\n  children: ReactNode;\n}\n\nconst EntitySwitchCaseComponent = (_props: EntitySwitchCaseProps) => null;\n\nattachComponentData(EntitySwitchCaseComponent, ENTITY_SWITCH_KEY, true);\n\ninterface EntitySwitchCase {\n  if?: (\n    entity: Entity,\n    context: { apis: ApiHolder },\n  ) => boolean | Promise<boolean>;\n  children: JSX.Element;\n}\n\ntype SwitchCaseResult = {\n  if: boolean | Promise<boolean>;\n  children: JSX.Element;\n};\n\n/**\n * Props for the {@link EntitySwitch} component.\n * @public\n */\nexport interface EntitySwitchProps {\n  children: ReactNode;\n}\n\n/** @public */\nexport const EntitySwitch = (props: EntitySwitchProps) => {\n  const { entity, loading } = useAsyncEntity();\n  const apis = useApiHolder();\n  const results = useElementFilter(\n    props.children,\n    collection =>\n      collection\n        .selectByComponentData({\n          key: ENTITY_SWITCH_KEY,\n          withStrictError: 'Child of EntitySwitch is not an EntitySwitch.Case',\n        })\n        .getElements()\n        .flatMap<SwitchCaseResult>((element: ReactElement) => {\n          // Nothing is rendered while loading\n          if (loading) {\n            return [];\n          }\n\n          const { if: condition, children: elementsChildren } =\n            element.props as EntitySwitchCase;\n\n          // If the entity is missing or there is an error, render the default page\n          if (!entity) {\n            return [\n              {\n                if: condition === undefined,\n                children: elementsChildren,\n              },\n            ];\n          }\n          return [\n            {\n              if: condition?.(entity, { apis }) ?? true,\n              children: elementsChildren,\n            },\n          ];\n        }),\n    [apis, entity, loading],\n  );\n  const hasAsyncCases = results.some(\n    r => typeof r.if === 'object' && 'then' in r.if,\n  );\n\n  if (hasAsyncCases) {\n    return <AsyncEntitySwitch results={results} />;\n  }\n\n  return results.find(r => r.if)?.children ?? null;\n};\n\nfunction AsyncEntitySwitch({ results }: { results: SwitchCaseResult[] }) {\n  const { loading, value } = useAsync(async () => {\n    const promises = results.map(\n      async ({ if: condition, children: output }) => {\n        try {\n          if (await condition) {\n            return output;\n          }\n        } catch {\n          /* ignored */\n        }\n\n        return null;\n      },\n    );\n    return (await Promise.all(promises)).find(Boolean) ?? null;\n  }, [results]);\n\n  if (loading || !value) {\n    return null;\n  }\n\n  return value;\n}\n\nEntitySwitch.Case = EntitySwitchCaseComponent;\n","/*\n * Copyright 2021 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { CatalogFilterLayout } from '@backstage/plugin-catalog-react';\n\n/**\n * @public\n * @deprecated Use `CatalogFilterLayout` from `@backstage/plugin-catalog-react` instead.\n */\nexport const FilteredEntityLayout = CatalogFilterLayout as (props: {\n  children: React.ReactNode;\n}) => JSX.Element;\n\n/**\n * @public\n * @deprecated Use `CatalogFilterLayout.Filters` from `@backstage/plugin-catalog-react` instead.\n */\nexport const FilterContainer = CatalogFilterLayout.Filters;\n\n/**\n * @public\n * @deprecated Use `CatalogFilterLayout.Content` from `@backstage/plugin-catalog-react` instead.\n */\nexport const EntityListContainer = CatalogFilterLayout.Content;\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { CatalogClient } from '@backstage/catalog-client';\nimport { Entity } from '@backstage/catalog-model';\nimport {\n  catalogApiRef,\n  entityRouteRef,\n  starredEntitiesApiRef,\n} from '@backstage/plugin-catalog-react';\nimport { createComponentRouteRef, viewTechDocRouteRef } from './routes';\nimport {\n  createApiFactory,\n  createComponentExtension,\n  createPlugin,\n  createRoutableExtension,\n  discoveryApiRef,\n  fetchApiRef,\n  storageApiRef,\n} from '@backstage/core-plugin-api';\nimport { DefaultStarredEntitiesApi } from './apis';\nimport { AboutCardProps } from './components/AboutCard';\nimport { DefaultCatalogPageProps } from './components/CatalogPage';\nimport { DependencyOfComponentsCardProps } from './components/DependencyOfComponentsCard';\nimport { DependsOnComponentsCardProps } from './components/DependsOnComponentsCard';\nimport { DependsOnResourcesCardProps } from './components/DependsOnResourcesCard';\nimport { HasComponentsCardProps } from './components/HasComponentsCard';\nimport { HasResourcesCardProps } from './components/HasResourcesCard';\nimport { HasSubcomponentsCardProps } from './components/HasSubcomponentsCard';\nimport { HasSystemsCardProps } from './components/HasSystemsCard';\nimport { RelatedEntitiesCardProps } from './components/RelatedEntitiesCard';\nimport { rootRouteRef } from './routes';\nimport { CatalogInputPluginOptions, CatalogPluginOptions } from './options';\n\n/** @public */\nexport const catalogPlugin = createPlugin({\n  id: 'catalog',\n  apis: [\n    createApiFactory({\n      api: catalogApiRef,\n      deps: {\n        discoveryApi: discoveryApiRef,\n        fetchApi: fetchApiRef,\n      },\n      factory: ({ discoveryApi, fetchApi }) =>\n        new CatalogClient({ discoveryApi, fetchApi }),\n    }),\n    createApiFactory({\n      api: starredEntitiesApiRef,\n      deps: { storageApi: storageApiRef },\n      factory: ({ storageApi }) =>\n        new DefaultStarredEntitiesApi({ storageApi }),\n    }),\n  ],\n  routes: {\n    catalogIndex: rootRouteRef,\n    catalogEntity: entityRouteRef,\n  },\n  externalRoutes: {\n    createComponent: createComponentRouteRef,\n    viewTechDoc: viewTechDocRouteRef,\n  },\n  __experimentalConfigure(\n    options?: CatalogInputPluginOptions,\n  ): CatalogPluginOptions {\n    const defaultOptions = {\n      createButtonTitle: 'Create',\n    };\n    return { ...defaultOptions, ...options };\n  },\n});\n\n/** @public */\nexport const CatalogIndexPage: (props: DefaultCatalogPageProps) => JSX.Element =\n  catalogPlugin.provide(\n    createRoutableExtension({\n      name: 'CatalogIndexPage',\n      component: () =>\n        import('./components/CatalogPage').then(m => m.CatalogPage),\n      mountPoint: rootRouteRef,\n    }),\n  );\n\n/** @public */\nexport const CatalogEntityPage: () => JSX.Element = catalogPlugin.provide(\n  createRoutableExtension({\n    name: 'CatalogEntityPage',\n    component: () =>\n      import('./components/CatalogEntityPage').then(m => m.CatalogEntityPage),\n    mountPoint: entityRouteRef,\n  }),\n);\n\n/** @public */\nexport const EntityAboutCard: (props: AboutCardProps) => JSX.Element =\n  catalogPlugin.provide(\n    createComponentExtension({\n      name: 'EntityAboutCard',\n      component: {\n        lazy: () => import('./components/AboutCard').then(m => m.AboutCard),\n      },\n    }),\n  );\n\n/** @public */\nexport const EntityLinksCard = catalogPlugin.provide(\n  createComponentExtension({\n    name: 'EntityLinksCard',\n    component: {\n      lazy: () =>\n        import('./components/EntityLinksCard').then(m => m.EntityLinksCard),\n    },\n  }),\n);\n\n/** @public */\nexport const EntityHasSystemsCard: (props: HasSystemsCardProps) => JSX.Element =\n  catalogPlugin.provide(\n    createComponentExtension({\n      name: 'EntityHasSystemsCard',\n      component: {\n        lazy: () =>\n          import('./components/HasSystemsCard').then(m => m.HasSystemsCard),\n      },\n    }),\n  );\n\n/** @public */\nexport const EntityHasComponentsCard: (\n  props: HasComponentsCardProps,\n) => JSX.Element = catalogPlugin.provide(\n  createComponentExtension({\n    name: 'EntityHasComponentsCard',\n    component: {\n      lazy: () =>\n        import('./components/HasComponentsCard').then(m => m.HasComponentsCard),\n    },\n  }),\n);\n\n/** @public */\nexport const EntityHasSubcomponentsCard: (\n  props: HasSubcomponentsCardProps,\n) => JSX.Element = catalogPlugin.provide(\n  createComponentExtension({\n    name: 'EntityHasSubcomponentsCard',\n    component: {\n      lazy: () =>\n        import('./components/HasSubcomponentsCard').then(\n          m => m.HasSubcomponentsCard,\n        ),\n    },\n  }),\n);\n\n/** @public */\nexport const EntityHasResourcesCard: (\n  props: HasResourcesCardProps,\n) => JSX.Element = catalogPlugin.provide(\n  createComponentExtension({\n    name: 'EntityHasResourcesCard',\n    component: {\n      lazy: () =>\n        import('./components/HasResourcesCard').then(m => m.HasResourcesCard),\n    },\n  }),\n);\n\n/** @public */\nexport const EntityDependsOnComponentsCard: (\n  props: DependsOnComponentsCardProps,\n) => JSX.Element = catalogPlugin.provide(\n  createComponentExtension({\n    name: 'EntityDependsOnComponentsCard',\n    component: {\n      lazy: () =>\n        import('./components/DependsOnComponentsCard').then(\n          m => m.DependsOnComponentsCard,\n        ),\n    },\n  }),\n);\n\n/** @public */\nexport const EntityDependencyOfComponentsCard: (\n  props: DependencyOfComponentsCardProps,\n) => JSX.Element = catalogPlugin.provide(\n  createComponentExtension({\n    name: 'EntityDependencyOfComponentsCard',\n    component: {\n      lazy: () =>\n        import('./components/DependencyOfComponentsCard').then(\n          m => m.DependencyOfComponentsCard,\n        ),\n    },\n  }),\n);\n\n/** @public */\nexport const EntityDependsOnResourcesCard: (\n  props: DependsOnResourcesCardProps,\n) => JSX.Element = catalogPlugin.provide(\n  createComponentExtension({\n    name: 'EntityDependsOnResourcesCard',\n    component: {\n      lazy: () =>\n        import('./components/DependsOnResourcesCard').then(\n          m => m.DependsOnResourcesCard,\n        ),\n    },\n  }),\n);\n\n/** @public */\nexport const RelatedEntitiesCard: <T extends Entity>(\n  props: RelatedEntitiesCardProps<T>,\n) => JSX.Element = catalogPlugin.provide(\n  createComponentExtension({\n    name: 'RelatedEntitiesCard',\n    component: {\n      lazy: () =>\n        import('./components/RelatedEntitiesCard').then(\n          m => m.RelatedEntitiesCard,\n        ),\n    },\n  }),\n);\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { CompoundEntityRef } from '@backstage/catalog-model';\nimport { Config } from '@backstage/config';\nimport {\n  scmIntegrationsApiRef,\n  ScmIntegrationsApi,\n} from '@backstage/integration-react';\nimport {\n  AnyApiFactory,\n  configApiRef,\n  createApiFactory,\n  DiscoveryApi,\n  discoveryApiRef,\n  IdentityApi,\n  identityApiRef,\n} from '@backstage/core-plugin-api';\nimport {\n  SyncResult,\n  TechDocsApi,\n  techdocsApiRef,\n  TechDocsStorageApi,\n  techdocsStorageApiRef,\n} from '@backstage/plugin-techdocs-react';\n\n// TODO: Export type from plugin-techdocs and import this here\n// import { ParsedEntityId } from '@backstage/plugin-techdocs'\n\n/**\n * Note: Override TechDocs API to use local mkdocs server instead of techdocs-backend.\n */\n\nclass TechDocsDevStorageApi implements TechDocsStorageApi {\n  public configApi: Config;\n  public discoveryApi: DiscoveryApi;\n  public identityApi: IdentityApi;\n\n  constructor({\n    configApi,\n    discoveryApi,\n    identityApi,\n  }: {\n    configApi: Config;\n    discoveryApi: DiscoveryApi;\n    identityApi: IdentityApi;\n  }) {\n    this.configApi = configApi;\n    this.discoveryApi = discoveryApi;\n    this.identityApi = identityApi;\n  }\n\n  async getApiOrigin() {\n    return await this.discoveryApi.getBaseUrl('techdocs');\n  }\n\n  async getStorageUrl() {\n    return `${await this.discoveryApi.getBaseUrl('techdocs')}/static/docs`;\n  }\n\n  async getBuilder() {\n    return this.configApi.getString('techdocs.builder');\n  }\n\n  async getEntityDocs(_entityId: CompoundEntityRef, path: string) {\n    const apiOrigin = await this.getApiOrigin();\n    // Irrespective of the entity, use mkdocs server to find the file for the path.\n    const url = `${apiOrigin}/${path}`;\n\n    const request = await fetch(\n      `${url.endsWith('/') ? url : `${url}/`}index.html`,\n    );\n\n    if (request.status === 404) {\n      throw new Error('Page not found');\n    }\n\n    return request.text();\n  }\n\n  async syncEntityDocs(_: CompoundEntityRef): Promise<SyncResult> {\n    // this is just stub of this function as we don't need to check if docs are up to date,\n    // we always want to retrigger a new build\n    return 'cached';\n  }\n\n  // Used by transformer to modify the request to assets (CSS, Image) from inside the HTML.\n  async getBaseUrl(\n    oldBaseUrl: string,\n    _entityId: CompoundEntityRef,\n    path: string,\n  ): Promise<string> {\n    const apiOrigin = await this.getApiOrigin();\n    return new URL(oldBaseUrl, `${apiOrigin}/${path}`).toString();\n  }\n}\n\nclass TechDocsDevApi implements TechDocsApi {\n  public configApi: Config;\n  public discoveryApi: DiscoveryApi;\n  public identityApi: IdentityApi;\n\n  constructor({\n    configApi,\n    discoveryApi,\n    identityApi,\n  }: {\n    configApi: Config;\n    discoveryApi: DiscoveryApi;\n    identityApi: IdentityApi;\n  }) {\n    this.configApi = configApi;\n    this.discoveryApi = discoveryApi;\n    this.identityApi = identityApi;\n  }\n\n  async getApiOrigin() {\n    return await this.discoveryApi.getBaseUrl('techdocs');\n  }\n\n  async getEntityMetadata(_entityId: any) {\n    return {\n      apiVersion: 'backstage.io/v1alpha1',\n      kind: 'Component',\n      metadata: {\n        name: 'local',\n      },\n      spec: {\n        owner: 'test',\n        lifecycle: 'experimental',\n      },\n    };\n  }\n\n  async getTechDocsMetadata(_entityId: CompoundEntityRef) {\n    return {\n      site_name: 'Live preview environment',\n      site_description: '',\n    };\n  }\n}\n\nexport const apis: AnyApiFactory[] = [\n  createApiFactory({\n    api: techdocsStorageApiRef,\n    deps: {\n      configApi: configApiRef,\n      discoveryApi: discoveryApiRef,\n      identityApi: identityApiRef,\n    },\n    factory: ({ configApi, discoveryApi, identityApi }) =>\n      new TechDocsDevStorageApi({\n        configApi,\n        discoveryApi,\n        identityApi,\n      }),\n  }),\n  createApiFactory({\n    api: techdocsApiRef,\n    deps: {\n      configApi: configApiRef,\n      discoveryApi: discoveryApiRef,\n      identityApi: identityApiRef,\n    },\n    factory: ({ configApi, discoveryApi, identityApi }) =>\n      new TechDocsDevApi({\n        configApi,\n        discoveryApi,\n        identityApi,\n      }),\n  }),\n  createApiFactory({\n    api: scmIntegrationsApiRef,\n    deps: { configApi: configApiRef },\n    factory: ({ configApi }) => ScmIntegrationsApi.fromConfig(configApi),\n  }),\n];\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { defaultConfigLoader } from '@backstage/core-app-api';\n\nconst PRODUCTION_CONFIG = {\n  backend: {\n    baseUrl: 'http://localhost:3000',\n  },\n  techdocs: {\n    builder: 'external',\n  },\n};\n\nconst DEVELOPMENT_CONFIG = {\n  backend: {\n    baseUrl: 'http://localhost:7007',\n  },\n  techdocs: {\n    builder: 'external',\n  },\n};\n\nasync function isProductionServe() {\n  const res = await fetch('/.detect');\n  if (!res.ok) {\n    return false;\n  }\n  const text = await res.text();\n  return text.trim() === 'techdocs-cli-server';\n}\n\nexport async function configLoader() {\n  const defaultConfigs = await defaultConfigLoader();\n  const isProduction = await isProductionServe();\n\n  return [\n    ...defaultConfigs,\n    {\n      context: 'detected',\n      data: isProduction ? PRODUCTION_CONFIG : DEVELOPMENT_CONFIG,\n    },\n  ];\n}\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React from 'react';\nimport { makeStyles } from '@material-ui/core';\n\nconst useStyles = makeStyles({\n  svg: {\n    width: 'auto',\n    height: 30,\n  },\n  path: {\n    fill: '#7df3e1',\n  },\n});\nconst LogoFull = () => {\n  const classes = useStyles();\n\n  return (\n    <svg\n      className={classes.svg}\n      xmlns=\"http://www.w3.org/2000/svg\"\n      viewBox=\"0 0 2079.95 456.05\"\n    >\n      <path\n        className={classes.path}\n        d=\"M302.9,180a80.62,80.62,0,0,0,13.44-10.37c.8-.77,1.55-1.54,2.31-2.31a81.89,81.89,0,0,0,7.92-9.37,62.37,62.37,0,0,0,6.27-10.77,48.6,48.6,0,0,0,4.36-16.4c1.49-19.39-10-38.67-35.62-54.22L198.42,14,78.16,129.22l-78.29,75,108.6,65.9a111.6,111.6,0,0,0,57.76,16.42c24.92,0,48.8-8.8,66.42-25.69,19.16-18.36,25.52-42.12,13.7-61.87a49.69,49.69,0,0,0-6.8-8.87,89.78,89.78,0,0,0,19.28,2.15H259a85.09,85.09,0,0,0,31-5.79A80.88,80.88,0,0,0,302.9,180Zm-100.59,59.8c-19.32,18.51-50.4,21.24-75.7,5.9l-75.13-45.6,67.44-64.65,76.42,46.39C222.88,198.57,221.36,221.6,202.31,239.84Zm8.94-82.21L140.6,114.74,205,53l69.37,42.11c25.94,15.73,29.31,37.05,10.55,55A60.71,60.71,0,0,1,211.25,157.63Zm29.86,190c-19.57,18.75-46.17,29.08-74.88,29.08a123.84,123.84,0,0,1-64.11-18.19L-.13,296.51v24.67l108.6,65.91a111.6,111.6,0,0,0,57.76,16.42c24.92,0,48.8-8.81,66.42-25.69,12.88-12.34,20-27.13,19.68-41.49v-1.79A87.85,87.85,0,0,1,241.11,347.67Zm0-39c-19.57,18.76-46.17,29.09-74.88,29.09a123.84,123.84,0,0,1-64.11-18.19L-.13,257.52V282.2l108.6,65.91a111.59,111.59,0,0,0,57.76,16.41c24.92,0,48.8-8.8,66.42-25.68,12.88-12.35,20-27.13,19.68-41.5v-1.79A86.86,86.86,0,0,1,241.11,308.68Zm0-39c-19.57,18.76-46.17,29.09-74.88,29.09a123.84,123.84,0,0,1-64.11-18.19L-.13,218.54v24.68l108.6,65.91a111.59,111.59,0,0,0,57.76,16.41c24.92,0,48.8-8.8,66.42-25.69,12.88-12.34,20-27.12,19.68-41.49v-1.82A87.14,87.14,0,0,1,241.11,269.7Zm83.69,25.74a94.16,94.16,0,0,1-60.19,25.86h0V348a81.6,81.6,0,0,0,51.73-22.37c14-13.38,21.15-28.11,21-42.64v-2.2A95.14,95.14,0,0,1,324.8,295.44Zm-83.69,91.21c-19.57,18.75-46.17,29.09-74.88,29.09a123.76,123.76,0,0,1-64.11-18.2L-.13,335.49v24.67l108.6,65.91a111.6,111.6,0,0,0,57.76,16.42c24.92,0,48.8-8.81,66.42-25.69,12.88-12.34,20-27.13,19.68-41.49v-1.79A87.35,87.35,0,0,1,241.11,386.65Zm85.75-210.21c-.68.69-1.35,1.38-2.06,2.05a99.19,99.19,0,0,1-22.23,15.69,94.53,94.53,0,0,1-26.24,8.71,97.84,97.84,0,0,1-14.16,1.57c.5,1.61.9,3.25,1.25,4.9a52.7,52.7,0,0,1,1.13,12V231h.05A84.48,84.48,0,0,0,290,225.47a80.83,80.83,0,0,0,26.38-16.82c.81-.77,1.51-1.56,2.27-2.34a82,82,0,0,0,7.92-9.38,62.85,62.85,0,0,0,6.29-10.78,48.5,48.5,0,0,0,4.32-16.44c.09-1.23.2-2.47.19-3.7v-2c-.72,1-1.48,2.06-2.26,3.09A98,98,0,0,1,326.86,176.44Zm0,77.92c-.68.7-1.3,1.41-2,2.1a94.09,94.09,0,0,1-60.19,25.85h0V309h0a81.65,81.65,0,0,0,51.73-22.37,73.51,73.51,0,0,0,16.48-22.49,48.56,48.56,0,0,0,4.32-16.44c.09-1.24.2-2.48.19-3.71v-2.2c-.74,1.08-1.47,2.16-2.27,3.22A95.81,95.81,0,0,1,326.82,254.36Zm0-39c-.68.7-1.3,1.41-2,2.1a92.22,92.22,0,0,1-10.62,8.65,93.53,93.53,0,0,1-11.63,7,95.63,95.63,0,0,1-37.94,10.18h-.05l0,26.67h0a81.63,81.63,0,0,0,51.73-22.37c.81-.77,1.51-1.56,2.27-2.34a82,82,0,0,0,7.92-9.38,63.16,63.16,0,0,0,6.29-10.77,48.55,48.55,0,0,0,4.32-16.45c.09-1.23.2-2.47.19-3.7v-2.2c-.74,1.08-1.47,2.16-2.27,3.22A98.19,98.19,0,0,1,326.82,215.38Zm241-88.84q7.94,0,17.09.17t18.12,1a139.3,139.3,0,0,1,16.74,2.57,42.78,42.78,0,0,1,13.3,5.14,64.27,64.27,0,0,1,20.54,19.89Q662,168,662,186.54q0,19.54-9.49,33.78t-27.1,21.09v.68q22.78,4.82,34.87,20.58t12.08,38.4a72.62,72.62,0,0,1-4.83,26.06,65.29,65.29,0,0,1-14.33,22.46,71.57,71.57,0,0,1-23.47,15.78q-14,6-32.28,6H478.38V126.54Zm9,105.27q28,0,40.21-9.78t12.26-29.31q0-13-4.14-20.58a29.47,29.47,0,0,0-11.4-11.66A45,45,0,0,0,597,155.17a161.2,161.2,0,0,0-20.19-1.2h-65.6v77.84Zm16.57,112.13q21.74,0,34-11.66T639.59,300q0-12-4.48-19.88a34.85,34.85,0,0,0-11.91-12.52,50.14,50.14,0,0,0-17.09-6.52,105,105,0,0,0-20-1.88H511.17v84.7Zm274.79,26.74q-7.61,4.45-21.06,4.46-11.4,0-18.12-6.34t-6.74-20.75a70.17,70.17,0,0,1-28.13,20.75,97.87,97.87,0,0,1-57.65,3.6,53.51,53.51,0,0,1-18.82-8.58A41.19,41.19,0,0,1,705,348.56q-4.65-9.42-4.66-22.8,0-15.09,5.18-24.69a44.92,44.92,0,0,1,13.64-15.6,62.63,62.63,0,0,1,19.33-9.09q10.88-3.08,22.27-5.14,12.08-2.4,23-3.6a128,128,0,0,0,19.16-3.43c5.53-1.48,9.89-3.65,13.12-6.51s4.83-7,4.83-12.52q0-9.6-3.62-15.43a24.94,24.94,0,0,0-9.32-8.92,38.38,38.38,0,0,0-12.78-4.11,96.54,96.54,0,0,0-14-1q-18.63,0-31.07,7T736.6,249.29H707.26q.69-16.46,6.9-27.77a52.21,52.21,0,0,1,16.57-18.35,70,70,0,0,1,23.65-10.11A125.51,125.51,0,0,1,782.86,190a168.63,168.63,0,0,1,24,1.72,63.26,63.26,0,0,1,21.58,7A41.23,41.23,0,0,1,844,213.59q5.87,9.57,5.87,25v91q0,10.26,1.21,15.05t8.11,4.79a35.57,35.57,0,0,0,9-1.37Zm-47.64-90.87c-3.69,2.74-8.52,4.72-14.5,6s-12.26,2.27-18.82,3.07-13.17,1.71-19.85,2.73a73.7,73.7,0,0,0-18,4.94,32.62,32.62,0,0,0-12.94,9.73q-5,6.32-5,17.23a23.31,23.31,0,0,0,2.94,12.11,24.11,24.11,0,0,0,7.59,8,32,32,0,0,0,10.88,4.44,60.94,60.94,0,0,0,13.11,1.36q14.5,0,24.86-3.92a52.49,52.49,0,0,0,16.91-9.9,39.1,39.1,0,0,0,9.67-13,32.53,32.53,0,0,0,3.11-13.14ZM1002.07,225q-11.05-9.25-29.69-9.26-15.89,0-26.58,5.83A47.29,47.29,0,0,0,928.71,237a64.66,64.66,0,0,0-9.15,22.12A119.83,119.83,0,0,0,916.8,285a98.22,98.22,0,0,0,2.93,24,64.18,64.18,0,0,0,9.15,20.74,46.2,46.2,0,0,0,16.23,14.58q10,5.49,23.82,5.48,21.75,0,34-11.31t15-31.89h30q-4.83,32.91-24.68,50.75t-54,17.83q-20.37,0-36.07-6.52A69.86,69.86,0,0,1,907,350.11a79.92,79.92,0,0,1-15.88-28.63A118.64,118.64,0,0,1,885.73,285a129.41,129.41,0,0,1,5.18-37.21,85.63,85.63,0,0,1,15.71-30.17A73.46,73.46,0,0,1,933,197.35Q948.91,190,970,190a108.54,108.54,0,0,1,28.48,3.6,69.59,69.59,0,0,1,23.48,11.15,61,61,0,0,1,16.74,19q6.55,11.49,8.29,27.26h-30.38Q1013.11,234.21,1002.07,225Zm109.77-98.41v145l81.47-77.49h39.36l-70.77,64.46,75.95,112.82h-37.29l-61.1-92.59-27.62,25.38v67.21H1082.5V126.54Zm170.54,205.22a31.07,31.07,0,0,0,10.87,10.63,49,49,0,0,0,15.19,5.66,87.06,87.06,0,0,0,17.44,1.71,109.18,109.18,0,0,0,14.5-1,53.22,53.22,0,0,0,14-3.78,26.27,26.27,0,0,0,10.53-8q4.14-5.32,4.14-13.55,0-11.31-8.63-17.14a73.69,73.69,0,0,0-21.58-9.43q-12.94-3.6-28.13-6.52a146,146,0,0,1-28.14-8.23A58.16,58.16,0,0,1,1261,267.13q-8.64-9.6-8.63-26.75,0-13.38,6-23a49.26,49.26,0,0,1,15.53-15.61,71.76,71.76,0,0,1,21.4-8.91A99.41,99.41,0,0,1,1319,190a141.31,141.31,0,0,1,28,2.58,64.85,64.85,0,0,1,22.62,8.91,46.16,46.16,0,0,1,15.7,17.15q5.87,10.8,6.91,26.91h-29.35q-.69-8.57-4.48-14.23a29.36,29.36,0,0,0-9.67-9.08,44.16,44.16,0,0,0-12.94-5,67.68,67.68,0,0,0-14.33-1.54,87.29,87.29,0,0,0-13.29,1,45.28,45.28,0,0,0-12.26,3.6,24.49,24.49,0,0,0-9,6.86q-3.46,4.29-3.46,11.14a16.32,16.32,0,0,0,5.36,12.52,42.75,42.75,0,0,0,13.63,8.23,120,120,0,0,0,18.64,5.48q10.37,2.24,20.72,4.63,11,2.4,21.57,5.83A70.74,70.74,0,0,1,1382,284.1a44.55,44.55,0,0,1,13.12,14.23q5,8.58,5,21.26,0,16.13-6.73,26.75a52.5,52.5,0,0,1-17.61,17.14,73.89,73.89,0,0,1-24.51,9.09,146.3,146.3,0,0,1-27.1,2.57,126.24,126.24,0,0,1-28.31-3.09A69.56,69.56,0,0,1,1272,361.94a51.74,51.74,0,0,1-16.57-18.52q-6.21-11.49-6.9-27.95h29.34A32.65,32.65,0,0,0,1282.38,331.76Zm226.46-137.67v25.72h-35.56V329.88a31.37,31.37,0,0,0,.87,8.23,8.42,8.42,0,0,0,3.28,4.8,14.61,14.61,0,0,0,6.73,2.23,99.19,99.19,0,0,0,11.22.51h13.46v25.72H1486.4a105.8,105.8,0,0,1-19.5-1.55,28.65,28.65,0,0,1-13.12-5.65,24.09,24.09,0,0,1-7.42-11.66q-2.43-7.54-2.42-19.89V219.81h-30.38V194.09h30.38V140.94h29.34v53.15ZM1699.4,370.68q-7.61,4.45-21.06,4.46-11.4,0-18.12-6.34t-6.74-20.75a70.17,70.17,0,0,1-28.13,20.75,97.87,97.87,0,0,1-57.65,3.6,53.51,53.51,0,0,1-18.82-8.58,41.19,41.19,0,0,1-12.6-15.26q-4.65-9.42-4.66-22.8,0-15.09,5.18-24.69a44.92,44.92,0,0,1,13.64-15.6,62.63,62.63,0,0,1,19.33-9.09q10.88-3.08,22.27-5.14,12.07-2.4,23-3.6a128,128,0,0,0,19.16-3.43c5.53-1.48,9.89-3.65,13.12-6.51s4.83-7,4.83-12.52q0-9.6-3.62-15.43a24.94,24.94,0,0,0-9.32-8.92,38.38,38.38,0,0,0-12.78-4.11,96.54,96.54,0,0,0-14-1q-18.63,0-31.07,7t-13.46,26.57h-29.34q.67-16.46,6.9-27.77A52.21,52.21,0,0,1,1562,203.17a70,70,0,0,1,23.65-10.11,125.51,125.51,0,0,1,28.48-3.09,168.63,168.63,0,0,1,24,1.72,63.26,63.26,0,0,1,21.58,7,41.23,41.23,0,0,1,15.53,14.89q5.87,9.57,5.87,25v91q0,10.26,1.21,15.05t8.11,4.79a35.57,35.57,0,0,0,9-1.37Zm-47.64-90.87c-3.69,2.74-8.52,4.72-14.5,6s-12.26,2.27-18.82,3.07-13.17,1.71-19.85,2.73a73.7,73.7,0,0,0-17.95,4.94,32.62,32.62,0,0,0-12.94,9.73q-5,6.32-5,17.23a23.31,23.31,0,0,0,2.94,12.11,24.11,24.11,0,0,0,7.59,8,32,32,0,0,0,10.88,4.44,60.94,60.94,0,0,0,13.11,1.36q14.51,0,24.86-3.92a52.49,52.49,0,0,0,16.91-9.9,39.1,39.1,0,0,0,9.67-13,32.53,32.53,0,0,0,3.11-13.14Zm208.85,141.62q-20,21.6-62.83,21.6a122.11,122.11,0,0,1-25.37-2.74,78,78,0,0,1-23.48-8.92,54.41,54.41,0,0,1-17.43-16.11q-6.91-10-7.6-24.35h29.35a21.47,21.47,0,0,0,5,13.38,36.67,36.67,0,0,0,11.4,8.91,55.52,55.52,0,0,0,14.67,5,79.51,79.51,0,0,0,15.19,1.55q14.49,0,24.51-5A46,46,0,0,0,1840.59,401a56.53,56.53,0,0,0,9.49-21.09,117.46,117.46,0,0,0,2.94-27.09V341.19h-.7q-7.59,16.46-23,24.18a71.8,71.8,0,0,1-32.63,7.71q-20,0-34.86-7.2A72.88,72.88,0,0,1,1737,346.51a82.13,82.13,0,0,1-15-28.46,116.62,116.62,0,0,1-5-34.47,133.92,133.92,0,0,1,4.14-32.4A88.17,88.17,0,0,1,1735,221a75.49,75.49,0,0,1,25.55-22.29q15.87-8.75,39-8.75a66.21,66.21,0,0,1,31.07,7.38,52.13,52.13,0,0,1,22.09,22.11h.35V194.09h27.61V356.28Q1880.63,399.83,1860.61,421.43Zm-37.46-79.72a47.94,47.94,0,0,0,16.4-15.78,71.89,71.89,0,0,0,9.15-22.11,106.77,106.77,0,0,0,2.93-24.69,96.71,96.71,0,0,0-2.76-23,64,64,0,0,0-8.8-20.4,45.76,45.76,0,0,0-15.71-14.57q-9.66-5.49-23.47-5.49-14.16,0-24.17,5.32a46.77,46.77,0,0,0-16.4,14.23,60.14,60.14,0,0,0-9.32,20.57,99.69,99.69,0,0,0-2.93,24.35,120.63,120.63,0,0,0,2.42,24,67.5,67.5,0,0,0,8.28,21.77,46.37,46.37,0,0,0,15.54,15.78q9.66,6,24.16,6T1823.15,341.71Zm228,18.34q-20,15.09-50.41,15.09-21.4,0-37.11-6.86a73.16,73.16,0,0,1-26.41-19.2,81.52,81.52,0,0,1-16-29.49,141.12,141.12,0,0,1-6-37.38,106.1,106.1,0,0,1,6.21-37A88.56,88.56,0,0,1,1938.8,216a79.09,79.09,0,0,1,26.58-19.2A81.66,81.66,0,0,1,1999,190q23.82,0,39.53,9.78a78,78,0,0,1,25.2,24.86,98.18,98.18,0,0,1,13.12,32.91,140.6,140.6,0,0,1,2.93,34h-133.6a70,70,0,0,0,2.76,22.12,49.9,49.9,0,0,0,10,18.51A49.1,49.1,0,0,0,1976.6,345q10.7,4.82,25.2,4.8,18.65,0,30.55-8.57t15.71-26.06h29Q2071.18,345,2051.17,360.05Zm-7.08-113.84a50,50,0,0,0-10.7-16,53.1,53.1,0,0,0-56.62-10.63,47.48,47.48,0,0,0-15.71,10.81,51.69,51.69,0,0,0-10.35,15.94,60.18,60.18,0,0,0-4.49,19.37h102.53A59.47,59.47,0,0,0,2044.09,246.21ZM302.9,180a80.62,80.62,0,0,0,13.44-10.37c.8-.77,1.55-1.54,2.31-2.31a81.89,81.89,0,0,0,7.92-9.37,62.37,62.37,0,0,0,6.27-10.77,48.6,48.6,0,0,0,4.36-16.4c1.49-19.39-10-38.67-35.62-54.22L198.42,14,78.16,129.22l-78.29,75,108.6,65.9a111.6,111.6,0,0,0,57.76,16.42c24.92,0,48.8-8.8,66.42-25.69,19.16-18.36,25.52-42.12,13.7-61.87a49.69,49.69,0,0,0-6.8-8.87,89.78,89.78,0,0,0,19.28,2.15H259a85.09,85.09,0,0,0,31-5.79A80.88,80.88,0,0,0,302.9,180Zm-100.59,59.8c-19.32,18.51-50.4,21.24-75.7,5.9l-75.13-45.6,67.44-64.65,76.42,46.39C222.88,198.57,221.36,221.6,202.31,239.84Zm8.94-82.21L140.6,114.74,205,53l69.37,42.11c25.94,15.73,29.31,37.05,10.55,55A60.71,60.71,0,0,1,211.25,157.63Zm29.86,190c-19.57,18.75-46.17,29.08-74.88,29.08a123.84,123.84,0,0,1-64.11-18.19L-.13,296.51v24.67l108.6,65.91a111.6,111.6,0,0,0,57.76,16.42c24.92,0,48.8-8.81,66.42-25.69,12.88-12.34,20-27.13,19.68-41.49v-1.79A87.85,87.85,0,0,1,241.11,347.67Zm0-39c-19.57,18.76-46.17,29.09-74.88,29.09a123.84,123.84,0,0,1-64.11-18.19L-.13,257.52V282.2l108.6,65.91a111.59,111.59,0,0,0,57.76,16.41c24.92,0,48.8-8.8,66.42-25.68,12.88-12.35,20-27.13,19.68-41.5v-1.79A86.86,86.86,0,0,1,241.11,308.68Zm0-39c-19.57,18.76-46.17,29.09-74.88,29.09a123.84,123.84,0,0,1-64.11-18.19L-.13,218.54v24.68l108.6,65.91a111.59,111.59,0,0,0,57.76,16.41c24.92,0,48.8-8.8,66.42-25.69,12.88-12.34,20-27.12,19.68-41.49v-1.82A87.14,87.14,0,0,1,241.11,269.7Zm83.69,25.74a94.16,94.16,0,0,1-60.19,25.86h0V348a81.6,81.6,0,0,0,51.73-22.37c14-13.38,21.15-28.11,21-42.64v-2.2A95.14,95.14,0,0,1,324.8,295.44Zm-83.69,91.21c-19.57,18.75-46.17,29.09-74.88,29.09a123.76,123.76,0,0,1-64.11-18.2L-.13,335.49v24.67l108.6,65.91a111.6,111.6,0,0,0,57.76,16.42c24.92,0,48.8-8.81,66.42-25.69,12.88-12.34,20-27.13,19.68-41.49v-1.79A87.35,87.35,0,0,1,241.11,386.65Zm85.75-210.21c-.68.69-1.35,1.38-2.06,2.05a99.19,99.19,0,0,1-22.23,15.69,94.53,94.53,0,0,1-26.24,8.71,97.84,97.84,0,0,1-14.16,1.57c.5,1.61.9,3.25,1.25,4.9a52.7,52.7,0,0,1,1.13,12V231h.05A84.48,84.48,0,0,0,290,225.47a80.83,80.83,0,0,0,26.38-16.82c.81-.77,1.51-1.56,2.27-2.34a82,82,0,0,0,7.92-9.38,62.85,62.85,0,0,0,6.29-10.78,48.5,48.5,0,0,0,4.32-16.44c.09-1.23.2-2.47.19-3.7v-2c-.72,1-1.48,2.06-2.26,3.09A98,98,0,0,1,326.86,176.44Zm0,77.92c-.68.7-1.3,1.41-2,2.1a94.09,94.09,0,0,1-60.19,25.85h0V309h0a81.65,81.65,0,0,0,51.73-22.37,73.51,73.51,0,0,0,16.48-22.49,48.56,48.56,0,0,0,4.32-16.44c.09-1.24.2-2.48.19-3.71v-2.2c-.74,1.08-1.47,2.16-2.27,3.22A95.81,95.81,0,0,1,326.82,254.36Zm0-39c-.68.7-1.3,1.41-2,2.1a92.22,92.22,0,0,1-10.62,8.65,93.53,93.53,0,0,1-11.63,7,95.63,95.63,0,0,1-37.94,10.18h-.05l0,26.67h0a81.63,81.63,0,0,0,51.73-22.37c.81-.77,1.51-1.56,2.27-2.34a82,82,0,0,0,7.92-9.38,63.16,63.16,0,0,0,6.29-10.77,48.55,48.55,0,0,0,4.32-16.45c.09-1.23.2-2.47.19-3.7v-2.2c-.74,1.08-1.47,2.16-2.27,3.22A98.19,98.19,0,0,1,326.82,215.38Z\"\n      />\n    </svg>\n  );\n};\n\nexport default LogoFull;\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React from 'react';\nimport { makeStyles } from '@material-ui/core';\n\nconst useStyles = makeStyles({\n  svg: {\n    width: 'auto',\n    height: 28,\n  },\n  path: {\n    fill: '#7df3e1',\n  },\n});\n\nconst LogoIcon = () => {\n  const classes = useStyles();\n\n  return (\n    <svg\n      className={classes.svg}\n      xmlns=\"http://www.w3.org/2000/svg\"\n      viewBox=\"0 0 337.46 428.5\"\n    >\n      <path\n        className={classes.path}\n        d=\"M303,166.05a80.69,80.69,0,0,0,13.45-10.37c.79-.77,1.55-1.53,2.3-2.3a83.12,83.12,0,0,0,7.93-9.38A63.69,63.69,0,0,0,333,133.23a48.58,48.58,0,0,0,4.35-16.4c1.49-19.39-10-38.67-35.62-54.22L198.56,0,78.3,115.23,0,190.25l108.6,65.91a111.59,111.59,0,0,0,57.76,16.41c24.92,0,48.8-8.8,66.42-25.69,19.16-18.36,25.52-42.12,13.7-61.87a49.22,49.22,0,0,0-6.8-8.87A89.17,89.17,0,0,0,259,178.29h.15a85.08,85.08,0,0,0,31-5.79A80.88,80.88,0,0,0,303,166.05ZM202.45,225.86c-19.32,18.51-50.4,21.23-75.7,5.9L51.61,186.15l67.45-64.64,76.41,46.38C223,184.58,221.49,207.61,202.45,225.86Zm8.93-82.22-70.65-42.89L205.14,39,274.51,81.1c25.94,15.72,29.31,37,10.55,55A60.69,60.69,0,0,1,211.38,143.64Zm29.86,190c-19.57,18.75-46.17,29.09-74.88,29.09a123.73,123.73,0,0,1-64.1-18.2L0,282.52v24.67L108.6,373.1a111.6,111.6,0,0,0,57.76,16.42c24.92,0,48.8-8.81,66.42-25.69,12.88-12.34,20-27.13,19.68-41.49v-1.79A87.27,87.27,0,0,1,241.24,333.68Zm0-39c-19.57,18.75-46.17,29.08-74.88,29.08a123.81,123.81,0,0,1-64.1-18.19L0,243.53v24.68l108.6,65.91a111.6,111.6,0,0,0,57.76,16.42c24.92,0,48.8-8.81,66.42-25.69,12.88-12.34,20-27.13,19.68-41.5v-1.78A87.27,87.27,0,0,1,241.24,294.7Zm0-39c-19.57,18.76-46.17,29.09-74.88,29.09a123.81,123.81,0,0,1-64.1-18.19L0,204.55v24.68l108.6,65.91a111.59,111.59,0,0,0,57.76,16.41c24.92,0,48.8-8.8,66.42-25.68,12.88-12.35,20-27.13,19.68-41.5v-1.82A86.09,86.09,0,0,1,241.24,255.71Zm83.7,25.74a94.15,94.15,0,0,1-60.2,25.86h0V334a81.6,81.6,0,0,0,51.74-22.37c14-13.38,21.14-28.11,21-42.64v-2.19A94.92,94.92,0,0,1,324.94,281.45Zm-83.7,91.21c-19.57,18.76-46.17,29.09-74.88,29.09a123.73,123.73,0,0,1-64.1-18.2L0,321.5v24.68l108.6,65.9a111.6,111.6,0,0,0,57.76,16.42c24.92,0,48.8-8.8,66.42-25.69,12.88-12.34,20-27.13,19.68-41.49v-1.79A86.29,86.29,0,0,1,241.24,372.66ZM327,162.45c-.68.69-1.35,1.38-2.05,2.06a94.37,94.37,0,0,1-10.64,8.65,91.35,91.35,0,0,1-11.6,7,94.53,94.53,0,0,1-26.24,8.71,97.69,97.69,0,0,1-14.16,1.57c.5,1.61.9,3.25,1.25,4.9a53.27,53.27,0,0,1,1.14,12V217h.05a84.41,84.41,0,0,0,25.35-5.55,81,81,0,0,0,26.39-16.82c.8-.77,1.5-1.56,2.26-2.34a82.08,82.08,0,0,0,7.93-9.38A63.76,63.76,0,0,0,333,172.17a48.55,48.55,0,0,0,4.32-16.45c.09-1.23.2-2.47.19-3.7V150q-1.08,1.54-2.25,3.09A96.73,96.73,0,0,1,327,162.45Zm0,77.92c-.69.7-1.31,1.41-2,2.1a94.2,94.2,0,0,1-60.2,25.86h0l0,26.67h0a81.6,81.6,0,0,0,51.74-22.37A73.51,73.51,0,0,0,333,250.13a48.56,48.56,0,0,0,4.32-16.44c.09-1.24.2-2.47.19-3.71v-2.19c-.74,1.07-1.46,2.15-2.27,3.21A95.68,95.68,0,0,1,327,240.37Zm0-39c-.69.7-1.31,1.41-2,2.1a93.18,93.18,0,0,1-10.63,8.65,91.63,91.63,0,0,1-11.63,7,95.47,95.47,0,0,1-37.94,10.18h0V256h0a81.65,81.65,0,0,0,51.74-22.37c.8-.77,1.5-1.56,2.26-2.34a82.08,82.08,0,0,0,7.93-9.38A63.76,63.76,0,0,0,333,211.15a48.56,48.56,0,0,0,4.32-16.44c.09-1.24.2-2.48.19-3.71v-2.2c-.74,1.08-1.46,2.16-2.27,3.22A95.68,95.68,0,0,1,327,201.39Z\"\n      />\n    </svg>\n  );\n};\n\nexport default LogoIcon;\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React, { PropsWithChildren } from 'react';\n\nimport { Link, makeStyles } from '@material-ui/core';\nimport LibraryBooks from '@material-ui/icons/LibraryBooks';\nimport LogoFull from './LogoFull';\nimport LogoIcon from './LogoIcon';\n\nimport {\n  Sidebar,\n  SidebarItem,\n  SidebarPage,\n  sidebarConfig,\n  SidebarDivider,\n  useSidebarOpenState,\n} from '@backstage/core-components';\nimport { NavLink } from 'react-router-dom';\n\nconst useSidebarLogoStyles = makeStyles({\n  root: {\n    width: sidebarConfig.drawerWidthClosed,\n    height: 3 * sidebarConfig.logoHeight,\n    display: 'flex',\n    flexFlow: 'row nowrap',\n    alignItems: 'center',\n    marginBottom: -14,\n  },\n  link: {\n    width: sidebarConfig.drawerWidthClosed,\n    marginLeft: 24,\n  },\n});\n\nconst SidebarLogo = () => {\n  const classes = useSidebarLogoStyles();\n  const { isOpen } = useSidebarOpenState();\n\n  return (\n    <div className={classes.root}>\n      <Link\n        component={NavLink}\n        to=\"/docs/default/component/local/\"\n        underline=\"none\"\n        className={classes.link}\n      >\n        {isOpen ? <LogoFull /> : <LogoIcon />}\n      </Link>\n    </div>\n  );\n};\n\nexport const Root = ({ children }: PropsWithChildren<{}>) => (\n  <SidebarPage>\n    <Sidebar>\n      <SidebarLogo />\n      <SidebarDivider />\n      {/* Global nav, not org-specific */}\n      <SidebarItem\n        icon={LibraryBooks}\n        to=\"/docs/default/component/local\"\n        text=\"Docs Preview\"\n      />\n      {/* End global nav */}\n    </Sidebar>\n    {children}\n  </SidebarPage>\n);\n","/*\n * Copyright 2021 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React, { useState } from 'react';\n\nimport { Theme, makeStyles } from '@material-ui/core';\n\nimport { Box, Tooltip, IconButton } from '@material-ui/core';\nimport LightIcon from '@material-ui/icons/Brightness7';\nimport DarkIcon from '@material-ui/icons/Brightness4';\n\nimport { appThemeApiRef, useApi } from '@backstage/core-plugin-api';\n\nimport {\n  TechDocsReaderPage,\n  TechDocsReaderPageHeader,\n  TechDocsReaderPageContent,\n} from '@backstage/plugin-techdocs';\n\nconst useStyles = makeStyles((theme: Theme) => ({\n  headerIcon: {\n    color: theme.palette.common.white,\n    width: '32px',\n    height: '32px',\n  },\n  content: {\n    backgroundColor: theme.palette.background.default,\n  },\n  contentToolbar: {\n    display: 'flex',\n    justifyContent: 'flex-end',\n    padding: 0,\n  },\n}));\n\nenum Themes {\n  LIGHT = 'light',\n  DARK = 'dark',\n}\n\nexport const TechDocsThemeToggle = () => {\n  const appThemeApi = useApi(appThemeApiRef);\n  const classes = useStyles();\n  const [theme, setTheme] = useState<Themes>(\n    appThemeApi.getActiveThemeId() === Themes.DARK ? Themes.DARK : Themes.LIGHT,\n  );\n\n  const themes = {\n    [Themes.LIGHT]: {\n      icon: DarkIcon,\n      title: 'Dark theme',\n    },\n    [Themes.DARK]: {\n      icon: LightIcon,\n      title: 'Light theme',\n    },\n  };\n\n  const { title, icon: Icon } = themes[theme];\n\n  const handleSetTheme = () => {\n    setTheme(prevTheme => {\n      const newTheme = prevTheme === Themes.LIGHT ? Themes.DARK : Themes.LIGHT;\n      appThemeApi.setActiveThemeId(newTheme);\n      return newTheme;\n    });\n  };\n\n  return (\n    <Box display=\"flex\" alignItems=\"center\" mr={2}>\n      <Tooltip title={title} arrow>\n        <IconButton size=\"small\" onClick={handleSetTheme}>\n          <Icon className={classes.headerIcon} />\n        </IconButton>\n      </Tooltip>\n    </Box>\n  );\n};\n\nconst DefaultTechDocsPage = () => {\n  return (\n    <TechDocsReaderPage>\n      <TechDocsReaderPageHeader />\n      <TechDocsReaderPageContent withSearch={false} />\n    </TechDocsReaderPage>\n  );\n};\n\nexport const techDocsPage = <DefaultTechDocsPage />;\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React from 'react';\nimport { Navigate, Route } from 'react-router';\n\nimport {\n  DefaultTechDocsHome,\n  TechDocsIndexPage,\n  TechDocsReaderPage,\n  techdocsPlugin,\n} from '@backstage/plugin-techdocs';\nimport {\n  createTechDocsAddonExtension,\n  TechDocsAddons,\n  TechDocsAddonLocations,\n} from '@backstage/plugin-techdocs-react';\nimport { createApp } from '@backstage/app-defaults';\nimport { FlatRoutes } from '@backstage/core-app-api';\nimport { CatalogEntityPage } from '@backstage/plugin-catalog';\n\nimport { apis } from './apis';\nimport * as plugins from './plugins';\nimport { configLoader } from './config';\nimport { Root } from './components/Root';\nimport { techDocsPage, TechDocsThemeToggle } from './components/TechDocsPage';\n\nconst app = createApp({\n  apis,\n  configLoader,\n  plugins: Object.values(plugins),\n});\n\nconst AppProvider = app.getProvider();\nconst AppRouter = app.getRouter();\n\nconst ThemeToggleAddon = techdocsPlugin.provide(\n  createTechDocsAddonExtension({\n    name: 'ThemeToggleAddon',\n    component: TechDocsThemeToggle,\n    location: TechDocsAddonLocations.Header,\n  }),\n);\n\nconst routes = (\n  <FlatRoutes>\n    <Navigate key=\"/\" to=\"/docs/default/component/local/\" />\n    {/* we need this route as TechDocs header links relies on it */}\n    <Route\n      path=\"/catalog/:namespace/:kind/:name\"\n      element={<CatalogEntityPage />}\n    />\n    <Route path=\"/docs\" element={<TechDocsIndexPage />}>\n      <DefaultTechDocsHome />\n    </Route>\n    <Route\n      path=\"/docs/:namespace/:kind/:name/*\"\n      element={<TechDocsReaderPage />}\n    >\n      {techDocsPage}\n      <TechDocsAddons>\n        <ThemeToggleAddon />\n      </TechDocsAddons>\n    </Route>\n  </FlatRoutes>\n);\n\nconst App = () => (\n  <AppProvider>\n    <AppRouter>\n      <Root>{routes}</Root>\n    </AppRouter>\n  </AppProvider>\n);\n\nexport default App;\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport '@backstage/cli/asset-types';\nimport React from 'react';\nimport ReactDOM from 'react-dom';\nimport App from './App';\n\nReactDOM.render(<App />, document.getElementById('root'));\n","/*\n * Copyright 2021 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n// https://github.com/zloirock/core-js/issues/86#issuecomment-115759028\nfunction getGlobalObject() {\n  if (typeof window !== 'undefined' && window.Math === Math) {\n    return window;\n  }\n  if (typeof self !== 'undefined' && self.Math === Math) {\n    return self;\n  }\n  // eslint-disable-next-line no-new-func\n  return Function('return this')();\n}\n\nconst globalObject = getGlobalObject();\n\nconst makeKey = (id: string) => `__@backstage/${id}__`;\n\n/**\n * Serializes access to a global singleton value, with the first caller creating the value.\n *\n * @public\n */\nexport function getOrCreateGlobalSingleton<T>(\n  id: string,\n  supplier: () => T,\n): T {\n  const key = makeKey(id);\n\n  let value = globalObject[key];\n  if (value) {\n    return value;\n  }\n\n  value = supplier();\n  globalObject[key] = value;\n  return value;\n}\n","/*\n * Copyright 2021 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { createContext, useContext, Context } from 'react';\nimport { getOrCreateGlobalSingleton } from './globalObject';\nimport { createVersionedValueMap, VersionedValue } from './VersionedValue';\n\n/**\n * Get the existing or create a new versioned React context that's\n * stored inside a global singleton.\n *\n * @param key - A key that uniquely identifies the context.\n * @public\n * @example\n *\n * ```ts\n * const MyContext = createVersionedContext<{ 1: string }>('my-context');\n *\n * const MyContextProvider = ({children}) => (\n *   <MyContext.Provider value={createVersionedValueMap({ 1: 'value-for-version-1' })}>\n *     {children}\n *   <MyContext.Provider>\n * )\n * ```\n */\nexport function createVersionedContext<\n  Versions extends { [version in number]: unknown },\n>(key: string): Context<VersionedValue<Versions> | undefined> {\n  return getOrCreateGlobalSingleton(key, () =>\n    createContext<VersionedValue<Versions> | undefined>(undefined),\n  );\n}\n\n/**\n * A hook that simplifies the consumption of a versioned contexts that's\n * stored inside a global singleton.\n *\n * @param key - A key that uniquely identifies the context.\n * @public\n * @example\n *\n * ```ts\n * const versionedHolder = useVersionedContext<{ 1: string }>('my-context');\n *\n * if (!versionedHolder) {\n *   throw new Error('My context is not available!')\n * }\n *\n * const myValue = versionedHolder.atVersion(1);\n *\n * // ...\n * ```\n */\nexport function useVersionedContext<\n  Versions extends { [version in number]: unknown },\n>(key: string): VersionedValue<Versions> | undefined {\n  return useContext(createVersionedContext<Versions>(key));\n}\n\n/**\n * Creates a helper for writing tests towards multiple different\n * combinations of versions provided from a context.\n *\n * @param key - A key that uniquely identifies the context.\n * @public\n * @example\n *\n * ```ts\n * const context = createVersionedContextForTesting('my-context');\n *\n * afterEach(() => {\n *   context.reset();\n * });\n *\n * it('should work when provided with version 1', () => {\n *   context.set({1: 'value-for-version-1'})\n *\n *   // ...\n * })\n * ```\n */\nexport function createVersionedContextForTesting(key: string) {\n  return {\n    set(versions: { [version in number]: unknown }) {\n      (globalThis as any)[`__@backstage/${key}__`] = createContext(\n        createVersionedValueMap(versions),\n      );\n    },\n    reset() {\n      delete (globalThis as any)[`__@backstage/${key}__`];\n    },\n  };\n}\n","/*\n * Copyright 2021 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/**\n * The versioned value interface is a container for a set of values that\n * can be looked up by version. It is intended to be used as a container\n * for values that can be versioned independently of package versions.\n *\n * @public\n */\nexport type VersionedValue<Versions extends { [version: number]: unknown }> = {\n  atVersion<Version extends keyof Versions>(\n    version: Version,\n  ): Versions[Version] | undefined;\n};\n\n/**\n * Creates a container for a map of versioned values that implements VersionedValue.\n *\n * @public\n */\nexport function createVersionedValueMap<\n  Versions extends { [version: number]: unknown },\n>(versions: Versions): VersionedValue<Versions> {\n  Object.freeze(versions);\n  return {\n    atVersion(version) {\n      return versions[version];\n    },\n  };\n}\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { CatalogApi } from '@backstage/catalog-client';\nimport { createApiRef } from '@backstage/core-plugin-api';\n\n/**\n * The API reference for the {@link @backstage/catalog-client#CatalogApi}.\n * @public\n */\nexport const catalogApiRef = createApiRef<CatalogApi>({\n  id: 'plugin.catalog.service',\n});\n","/*\n * Copyright 2021 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { ApiRef, createApiRef } from '@backstage/core-plugin-api';\nimport { Observable } from '@backstage/types';\n\n/**\n * An API to store starred entities\n *\n * @public\n */\nexport const starredEntitiesApiRef: ApiRef<StarredEntitiesApi> = createApiRef({\n  id: 'catalog-react.starred-entities',\n});\n\n/**\n * An API to store and retrieve starred entities\n *\n * @public\n */\nexport interface StarredEntitiesApi {\n  /**\n   * Toggle the star state of the entity\n   *\n   * @param entityRef - an entity reference to toggle\n   */\n  toggleStarred(entityRef: string): Promise<void>;\n\n  /**\n   * Observe the set of starred entity references.\n   */\n  starredEntitie$(): Observable<Set<string>>;\n}\n","/*\n * Copyright 2021 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { Observable } from '@backstage/types';\nimport ObservableImpl from 'zen-observable';\nimport { StarredEntitiesApi } from './StarredEntitiesApi';\n\n/**\n * An in-memory mock implementation of the StarredEntitiesApi.\n *\n * @public\n */\nexport class MockStarredEntitiesApi implements StarredEntitiesApi {\n  private readonly starredEntities = new Set<string>();\n  private readonly subscribers = new Set<\n    ZenObservable.SubscriptionObserver<Set<string>>\n  >();\n\n  private readonly observable = new ObservableImpl<Set<string>>(subscriber => {\n    subscriber.next(new Set(this.starredEntities));\n\n    this.subscribers.add(subscriber);\n    return () => {\n      this.subscribers.delete(subscriber);\n    };\n  });\n\n  async toggleStarred(entityRef: string): Promise<void> {\n    if (!this.starredEntities.delete(entityRef)) {\n      this.starredEntities.add(entityRef);\n    }\n\n    for (const subscription of this.subscribers) {\n      subscription.next(new Set(this.starredEntities));\n    }\n  }\n\n  starredEntitie$(): Observable<Set<string>> {\n    return this.observable;\n  }\n}\n","/*\n * Copyright 2021 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React, { useState } from 'react';\nimport {\n  Box,\n  Button,\n  Drawer,\n  Grid,\n  Typography,\n  useMediaQuery,\n  useTheme,\n} from '@material-ui/core';\nimport FilterListIcon from '@material-ui/icons/FilterList';\nimport { BackstageTheme } from '@backstage/theme';\n\n/** @public */\nexport const Filters = (props: { children: React.ReactNode }) => {\n  const isMidSizeScreen = useMediaQuery<BackstageTheme>(theme =>\n    theme.breakpoints.down('md'),\n  );\n  const theme = useTheme<BackstageTheme>();\n  const [filterDrawerOpen, setFilterDrawerOpen] = useState<boolean>(false);\n\n  return isMidSizeScreen ? (\n    <>\n      <Button\n        style={{ marginTop: theme.spacing(1), marginLeft: theme.spacing(1) }}\n        onClick={() => setFilterDrawerOpen(true)}\n        startIcon={<FilterListIcon />}\n      >\n        Filters\n      </Button>\n      <Drawer\n        open={filterDrawerOpen}\n        onClose={() => setFilterDrawerOpen(false)}\n        anchor=\"left\"\n        disableAutoFocus\n        keepMounted\n        variant=\"temporary\"\n      >\n        <Box m={2}>\n          <Typography\n            variant=\"h6\"\n            component=\"h2\"\n            style={{ marginBottom: theme.spacing(1) }}\n          >\n            Filters\n          </Typography>\n          {props.children}\n        </Box>\n      </Drawer>\n    </>\n  ) : (\n    <Grid item lg={2}>\n      {props.children}\n    </Grid>\n  );\n};\n\n/** @public */\nexport const Content = (props: { children: React.ReactNode }) => {\n  return (\n    <Grid item xs={12} lg={10}>\n      {props.children}\n    </Grid>\n  );\n};\n\n/** @public */\nexport const CatalogFilterLayout = (props: { children: React.ReactNode }) => {\n  return (\n    <Grid container style={{ position: 'relative' }}>\n      {props.children}\n    </Grid>\n  );\n};\n\nCatalogFilterLayout.Filters = Filters;\nCatalogFilterLayout.Content = Content;\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { Entity, DEFAULT_NAMESPACE } from '@backstage/catalog-model';\nimport { createRouteRef } from '@backstage/core-plugin-api';\nimport { getOrCreateGlobalSingleton } from '@backstage/version-bridge';\n\n/**\n * A stable route ref that points to the catalog page for an individual entity.\n *\n * This `RouteRef` can be imported and used directly, and does not need to be referenced\n * via an `ExternalRouteRef`.\n *\n * If you want to replace the `EntityPage` from `@backstage/catalog-plugin` in your app,\n * you need to use the `entityRouteRef` as the mount point instead of your own.\n * @public\n */\nexport const entityRouteRef = getOrCreateGlobalSingleton(\n  'catalog:entity-route-ref',\n  () =>\n    createRouteRef({\n      id: 'catalog:entity',\n      params: ['namespace', 'kind', 'name'],\n    }),\n);\n\n/**\n * Utility function to get suitable route params for entityRoute, given an\n * @public\n */\nexport function entityRouteParams(entity: Entity) {\n  return {\n    kind: entity.kind.toLocaleLowerCase('en-US'),\n    namespace:\n      entity.metadata.namespace?.toLocaleLowerCase('en-US') ??\n      DEFAULT_NAMESPACE,\n    name: entity.metadata.name,\n  } as const;\n}\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  Entity,\n  CompoundEntityRef,\n  DEFAULT_NAMESPACE,\n} from '@backstage/catalog-model';\n\n/**\n * @param defaultNamespace - if set to false then namespace is never omitted,\n * if set to string which matches namespace of entity then omitted\n *\n * @public */\nexport function humanizeEntityRef(\n  entityRef: Entity | CompoundEntityRef,\n  opts?: {\n    defaultKind?: string;\n    defaultNamespace?: string | false;\n  },\n) {\n  const defaultKind = opts?.defaultKind;\n  let kind;\n  let namespace;\n  let name;\n\n  if ('metadata' in entityRef) {\n    kind = entityRef.kind;\n    namespace = entityRef.metadata.namespace;\n    name = entityRef.metadata.name;\n  } else {\n    kind = entityRef.kind;\n    namespace = entityRef.namespace;\n    name = entityRef.name;\n  }\n\n  if (namespace === undefined || namespace === '') {\n    namespace = DEFAULT_NAMESPACE;\n  }\n  if (opts?.defaultNamespace !== undefined) {\n    if (opts?.defaultNamespace === namespace) {\n      namespace = undefined;\n    }\n  } else if (namespace === DEFAULT_NAMESPACE) {\n    namespace = undefined;\n  }\n\n  kind = kind.toLocaleLowerCase('en-US');\n  kind =\n    defaultKind && defaultKind.toLocaleLowerCase('en-US') === kind\n      ? undefined\n      : kind;\n  return `${kind ? `${kind}:` : ''}${namespace ? `${namespace}/` : ''}${name}`;\n}\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  Entity,\n  CompoundEntityRef,\n  DEFAULT_NAMESPACE,\n  parseEntityRef,\n} from '@backstage/catalog-model';\nimport React, { forwardRef } from 'react';\nimport { entityRouteRef } from '../../routes';\nimport { humanizeEntityRef } from './humanize';\nimport { Link, LinkProps } from '@backstage/core-components';\nimport { useRouteRef } from '@backstage/core-plugin-api';\nimport { Tooltip } from '@material-ui/core';\n\n/**\n * Props for {@link EntityRefLink}.\n *\n * @public\n */\nexport type EntityRefLinkProps = {\n  entityRef: Entity | CompoundEntityRef | string;\n  defaultKind?: string;\n  title?: string;\n  children?: React.ReactNode;\n} & Omit<LinkProps, 'to'>;\n\n/**\n * Shows a clickable link to an entity.\n *\n * @public\n */\nexport const EntityRefLink = forwardRef<any, EntityRefLinkProps>(\n  (props, ref) => {\n    const { entityRef, defaultKind, title, children, ...linkProps } = props;\n    const entityRoute = useRouteRef(entityRouteRef);\n\n    let kind;\n    let namespace;\n    let name;\n\n    if (typeof entityRef === 'string') {\n      const parsed = parseEntityRef(entityRef);\n      kind = parsed.kind;\n      namespace = parsed.namespace;\n      name = parsed.name;\n    } else if ('metadata' in entityRef) {\n      kind = entityRef.kind;\n      namespace = entityRef.metadata.namespace;\n      name = entityRef.metadata.name;\n    } else {\n      kind = entityRef.kind;\n      namespace = entityRef.namespace;\n      name = entityRef.name;\n    }\n\n    kind = kind.toLocaleLowerCase('en-US');\n    namespace = namespace?.toLocaleLowerCase('en-US') ?? DEFAULT_NAMESPACE;\n\n    const routeParams = { kind, namespace, name };\n    const formattedEntityRefTitle = humanizeEntityRef(\n      { kind, namespace, name },\n      { defaultKind },\n    );\n\n    const link = (\n      <Link {...linkProps} ref={ref} to={entityRoute(routeParams)}>\n        {children}\n        {!children && (title ?? formattedEntityRefTitle)}\n      </Link>\n    );\n\n    return title ? (\n      <Tooltip title={formattedEntityRefTitle}>{link}</Tooltip>\n    ) : (\n      link\n    );\n  },\n) as (props: EntityRefLinkProps) => JSX.Element;\n","/*\n * Copyright 2022 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport {\n  Entity,\n  CompoundEntityRef,\n  parseEntityRef,\n} from '@backstage/catalog-model';\nimport React from 'react';\nimport { EntityRefLink } from './EntityRefLink';\nimport { ErrorPanel, LinkProps, Progress } from '@backstage/core-components';\nimport useAsync from 'react-use/lib/useAsync';\nimport { catalogApiRef } from '../../api';\nimport { useApi } from '@backstage/core-plugin-api';\n\n/**\n * Props for {@link FetchedEntityRefLinks}.\n *\n * @public\n */\nexport type FetchedEntityRefLinksProps<\n  TRef extends string | CompoundEntityRef | Entity,\n> = {\n  defaultKind?: string;\n  entityRefs: TRef[];\n  getTitle(entity: Entity): string | undefined;\n} & Omit<LinkProps, 'to'>;\n\n/**\n * Shows a list of clickable links to entities with auto-fetching of entities\n * for customising a displayed text via title attribute.\n *\n * @public\n */\nexport function FetchedEntityRefLinks<\n  TRef extends string | CompoundEntityRef | Entity,\n>(props: FetchedEntityRefLinksProps<TRef>) {\n  const { entityRefs, defaultKind, getTitle, ...linkProps } = props;\n\n  const catalogApi = useApi(catalogApiRef);\n\n  const {\n    value: entities = new Array<Entity>(),\n    loading,\n    error,\n  } = useAsync(async () => {\n    const refs = entityRefs.reduce((acc, current) => {\n      return 'metadata' in current ? acc : [...acc, parseEntityRef(current)];\n    }, new Array<CompoundEntityRef>());\n\n    const pureEntities = entityRefs.filter(\n      ref => 'metadata' in ref,\n    ) as Array<Entity>;\n\n    return refs.length > 0\n      ? [\n          ...(\n            await catalogApi.getEntities({\n              filter: refs.map(ref => ({\n                kind: ref.kind,\n                'metadata.namespace': ref.namespace,\n                'metadata.name': ref.name,\n              })),\n            })\n          ).items,\n          ...pureEntities,\n        ]\n      : pureEntities;\n  }, [entityRefs]);\n\n  if (loading) {\n    return <Progress />;\n  }\n\n  if (error) {\n    return <ErrorPanel error={error} />;\n  }\n\n  return (\n    <>\n      {entities.map((r: Entity, i) => {\n        return (\n          <React.Fragment key={i}>\n            {i > 0 && ', '}\n            <EntityRefLink\n              {...linkProps}\n              defaultKind={defaultKind}\n              entityRef={r}\n              title={getTitle(r as Entity)}\n            />\n          </React.Fragment>\n        );\n      })}\n    </>\n  );\n}\n","/*\n * Copyright 2022 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport { Entity, CompoundEntityRef } from '@backstage/catalog-model';\nimport React from 'react';\nimport { EntityRefLink } from './EntityRefLink';\nimport { LinkProps } from '@backstage/core-components';\nimport { FetchedEntityRefLinks } from './FetchedEntityRefLinks';\n\n/**\n * Props for {@link EntityRefLink}.\n *\n * @public\n */\nexport type EntityRefLinksProps<\n  TRef extends string | CompoundEntityRef | Entity,\n> = (\n  | {\n      defaultKind?: string;\n      entityRefs: TRef[];\n      fetchEntities?: false;\n      getTitle?(entity: TRef): string | undefined;\n    }\n  | {\n      defaultKind?: string;\n      entityRefs: TRef[];\n      fetchEntities: true;\n      getTitle(entity: Entity): string | undefined;\n    }\n) &\n  Omit<LinkProps, 'to'>;\n\n/**\n * Shows a list of clickable links to entities.\n *\n * @public\n */\nexport function EntityRefLinks<\n  TRef extends string | CompoundEntityRef | Entity,\n>(props: EntityRefLinksProps<TRef>) {\n  const { entityRefs, defaultKind, fetchEntities, getTitle, ...linkProps } =\n    props;\n\n  if (fetchEntities) {\n    return (\n      <FetchedEntityRefLinks\n        {...linkProps}\n        defaultKind={defaultKind}\n        entityRefs={entityRefs}\n        getTitle={getTitle}\n      />\n    );\n  }\n\n  return (\n    <>\n      {entityRefs.map((r: TRef, i: number) => {\n        return (\n          <React.Fragment key={i}>\n            {i > 0 && ', '}\n            <EntityRefLink\n              {...linkProps}\n              defaultKind={defaultKind}\n              entityRef={r}\n              title={getTitle ? getTitle(r) : undefined}\n            />\n          </React.Fragment>\n        );\n      })}\n    </>\n  );\n}\n","/*\n * Copyright 2021 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { Entity } from '@backstage/catalog-model';\nimport { EntityFilter } from '../types';\n\nexport function reduceCatalogFilters(\n  filters: EntityFilter[],\n): Record<string, string | symbol | (string | symbol)[]> {\n  return filters.reduce((compoundFilter, filter) => {\n    return {\n      ...compoundFilter,\n      ...(filter.getCatalogFilters ? filter.getCatalogFilters() : {}),\n    };\n  }, {} as Record<string, string | symbol | (string | symbol)[]>);\n}\n\nexport function reduceEntityFilters(\n  filters: EntityFilter[],\n): (entity: Entity) => boolean {\n  return (entity: Entity) =>\n    filters.every(\n      filter => !filter.filterEntity || filter.filterEntity(entity),\n    );\n}\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  Entity,\n  CompoundEntityRef,\n  parseEntityRef,\n} from '@backstage/catalog-model';\n\n// TODO(freben): This should be returning entity refs instead\n/**\n * Get the related entity references.\n *\n * @public\n */\nexport function getEntityRelations(\n  entity: Entity | undefined,\n  relationType: string,\n  filter?: { kind: string },\n): CompoundEntityRef[] {\n  let entityNames =\n    entity?.relations\n      ?.filter(r => r.type === relationType)\n      .map(r => parseEntityRef(r.targetRef)) || [];\n\n  if (filter?.kind) {\n    entityNames = entityNames.filter(\n      e =>\n        e.kind.toLocaleLowerCase('en-US') ===\n        filter.kind.toLocaleLowerCase('en-US'),\n    );\n  }\n\n  return entityNames;\n}\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  ANNOTATION_SOURCE_LOCATION,\n  Entity,\n  parseLocationRef,\n} from '@backstage/catalog-model';\nimport { ScmIntegrationRegistry } from '@backstage/integration';\n\n/** @public */\nexport type EntitySourceLocation = {\n  locationTargetUrl: string;\n  integrationType?: string;\n};\n\n/** @public */\nexport function getEntitySourceLocation(\n  entity: Entity,\n  scmIntegrationsApi: ScmIntegrationRegistry,\n): EntitySourceLocation | undefined {\n  const sourceLocation =\n    entity.metadata.annotations?.[ANNOTATION_SOURCE_LOCATION];\n\n  if (!sourceLocation) {\n    return undefined;\n  }\n\n  try {\n    const sourceLocationRef = parseLocationRef(sourceLocation);\n    const integration = scmIntegrationsApi.byUrl(sourceLocationRef.target);\n    return {\n      locationTargetUrl: sourceLocationRef.target,\n      integrationType: integration?.type,\n    };\n  } catch {\n    return undefined;\n  }\n}\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  Entity,\n  getCompoundEntityRef,\n  RELATION_MEMBER_OF,\n  RELATION_OWNED_BY,\n  stringifyEntityRef,\n} from '@backstage/catalog-model';\nimport { getEntityRelations } from './getEntityRelations';\n\n/**\n * Returns true if the `owner` argument is a direct owner on the `entity` argument.\n *\n * @alpha\n * @remarks\n *\n * Note that this ownership is not the same as using the claims in the auth-resolver, it only will take into account ownership as expressed by direct entity relations.\n * It doesn't know anything about the additional groups that a user might belong to which the claims contain.\n */\nexport function isOwnerOf(owner: Entity, entity: Entity) {\n  const possibleOwners = new Set(\n    [\n      ...getEntityRelations(owner, RELATION_MEMBER_OF, { kind: 'group' }),\n      ...(owner ? [getCompoundEntityRef(owner)] : []),\n    ].map(stringifyEntityRef),\n  );\n\n  const owners = getEntityRelations(entity, RELATION_OWNED_BY).map(\n    stringifyEntityRef,\n  );\n\n  for (const ownerItem of owners) {\n    if (possibleOwners.has(ownerItem)) {\n      return true;\n    }\n  }\n\n  return false;\n}\n","/*\n * Copyright 2021 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  AlphaEntity,\n  Entity,\n  RELATION_OWNED_BY,\n} from '@backstage/catalog-model';\nimport { humanizeEntityRef } from './components/EntityRefLink';\nimport { EntityFilter, UserListFilterKind } from './types';\nimport { getEntityRelations } from './utils';\n\n/**\n * Filter entities based on Kind.\n * @public\n */\nexport class EntityKindFilter implements EntityFilter {\n  constructor(readonly value: string) {}\n\n  getCatalogFilters(): Record<string, string | string[]> {\n    return { kind: this.value };\n  }\n\n  toQueryValue(): string {\n    return this.value;\n  }\n}\n\n/**\n * Filters entities based on type\n * @public\n */\nexport class EntityTypeFilter implements EntityFilter {\n  constructor(readonly value: string | string[]) {}\n\n  // Simplify `string | string[]` for consumers, always returns an array\n  getTypes(): string[] {\n    return Array.isArray(this.value) ? this.value : [this.value];\n  }\n\n  getCatalogFilters(): Record<string, string | string[]> {\n    return { 'spec.type': this.getTypes() };\n  }\n\n  toQueryValue(): string[] {\n    return this.getTypes();\n  }\n}\n\n/**\n * Filters entities based on tag.\n * @public\n */\nexport class EntityTagFilter implements EntityFilter {\n  constructor(readonly values: string[]) {}\n\n  filterEntity(entity: Entity): boolean {\n    return this.values.every(v => (entity.metadata.tags ?? []).includes(v));\n  }\n\n  toQueryValue(): string[] {\n    return this.values;\n  }\n}\n\n/**\n * Filters entities where the text matches spec, title or tags.\n * @public\n */\nexport class EntityTextFilter implements EntityFilter {\n  constructor(readonly value: string) {}\n\n  filterEntity(entity: Entity): boolean {\n    const words = this.toUpperArray(this.value.split(/\\s/));\n    const exactMatch = this.toUpperArray([entity.metadata.tags]);\n    const partialMatch = this.toUpperArray([\n      entity.metadata.name,\n      entity.metadata.title,\n    ]);\n\n    for (const word of words) {\n      if (\n        exactMatch.every(m => m !== word) &&\n        partialMatch.every(m => !m.includes(word))\n      ) {\n        return false;\n      }\n    }\n\n    return true;\n  }\n\n  private toUpperArray(\n    value: Array<string | string[] | undefined>,\n  ): Array<string> {\n    return value\n      .flat()\n      .filter((m): m is string => Boolean(m))\n      .map(m => m.toLocaleUpperCase('en-US'));\n  }\n}\n\n/**\n * Filter matching entities that are owned by group.\n * @public\n */\nexport class EntityOwnerFilter implements EntityFilter {\n  constructor(readonly values: string[]) {}\n\n  filterEntity(entity: Entity): boolean {\n    return this.values.some(v =>\n      getEntityRelations(entity, RELATION_OWNED_BY).some(\n        o => humanizeEntityRef(o, { defaultKind: 'group' }) === v,\n      ),\n    );\n  }\n\n  toQueryValue(): string[] {\n    return this.values;\n  }\n}\n\n/**\n * Filters entities on lifecycle.\n * @public\n */\nexport class EntityLifecycleFilter implements EntityFilter {\n  constructor(readonly values: string[]) {}\n\n  filterEntity(entity: Entity): boolean {\n    return this.values.some(v => entity.spec?.lifecycle === v);\n  }\n\n  toQueryValue(): string[] {\n    return this.values;\n  }\n}\n\n/**\n * Filters entities based on whatever the user has starred or owns them.\n * @public\n */\nexport class UserListFilter implements EntityFilter {\n  constructor(\n    readonly value: UserListFilterKind,\n    readonly isOwnedEntity: (entity: Entity) => boolean,\n    readonly isStarredEntity: (entity: Entity) => boolean,\n  ) {}\n\n  filterEntity(entity: Entity): boolean {\n    switch (this.value) {\n      case 'owned':\n        return this.isOwnedEntity(entity);\n      case 'starred':\n        return this.isStarredEntity(entity);\n      default:\n        return true;\n    }\n  }\n\n  toQueryValue(): string {\n    return this.value;\n  }\n}\n\n/**\n * Filters entities based if it is an orphan or not.\n * @public\n */\nexport class EntityOrphanFilter implements EntityFilter {\n  constructor(readonly value: boolean) {}\n  filterEntity(entity: Entity): boolean {\n    const orphan = entity.metadata.annotations?.['backstage.io/orphan'];\n    return orphan !== undefined && this.value.toString() === orphan;\n  }\n}\n\n/**\n * Filters entities based on if it has errors or not.\n * @public\n */\nexport class EntityErrorFilter implements EntityFilter {\n  constructor(readonly value: boolean) {}\n  filterEntity(entity: Entity): boolean {\n    const error =\n      ((entity as AlphaEntity)?.status?.items?.length as number) > 0;\n    return error !== undefined && this.value === error;\n  }\n}\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport { Entity } from '@backstage/catalog-model';\nimport {\n  createVersionedContext,\n  createVersionedValueMap,\n  useVersionedContext,\n} from '@backstage/version-bridge';\nimport React, { ReactNode } from 'react';\n\n/** @public */\nexport type EntityLoadingStatus<TEntity extends Entity = Entity> = {\n  entity?: TEntity;\n  loading: boolean;\n  error?: Error;\n  refresh?: VoidFunction;\n};\n\n// This context has support for multiple concurrent versions of this package.\n// It is currently used in parallel with the old context in order to provide\n// a smooth transition, but will eventually be the only context we use.\nconst NewEntityContext = createVersionedContext<{ 1: EntityLoadingStatus }>(\n  'entity-context',\n);\n\n/**\n * Properties for the AsyncEntityProvider component.\n *\n * @public\n */\nexport interface AsyncEntityProviderProps {\n  children: ReactNode;\n  entity?: Entity;\n  loading: boolean;\n  error?: Error;\n  refresh?: VoidFunction;\n}\n\n/**\n * Provides a loaded entity to be picked up by the `useEntity` hook.\n *\n * @public\n */\nexport const AsyncEntityProvider = ({\n  children,\n  entity,\n  loading,\n  error,\n  refresh,\n}: AsyncEntityProviderProps) => {\n  const value = { entity, loading, error, refresh };\n  // We provide both the old and the new context, since\n  // consumers might be doing things like `useContext(EntityContext)`\n  return (\n    <NewEntityContext.Provider value={createVersionedValueMap({ 1: value })}>\n      {children}\n    </NewEntityContext.Provider>\n  );\n};\n\n/**\n * Properties for the EntityProvider component.\n *\n * @public\n */\nexport interface EntityProviderProps {\n  children: ReactNode;\n  entity?: Entity;\n}\n\n/**\n * Provides an entity to be picked up by the `useEntity` hook.\n *\n * @public\n */\nexport const EntityProvider = (props: EntityProviderProps) => (\n  <AsyncEntityProvider\n    entity={props.entity}\n    loading={!Boolean(props.entity)}\n    error={undefined}\n    refresh={undefined}\n    children={props.children}\n  />\n);\n\n/**\n * Grab the current entity from the context, throws if the entity has not yet been loaded\n * or is not available.\n *\n * @public\n */\nexport function useEntity<TEntity extends Entity = Entity>(): {\n  entity: TEntity;\n} {\n  const versionedHolder = useVersionedContext<{ 1: EntityLoadingStatus }>(\n    'entity-context',\n  );\n\n  if (!versionedHolder) {\n    throw new Error('Entity context is not available');\n  }\n\n  const value = versionedHolder.atVersion(1);\n  if (!value) {\n    throw new Error('EntityContext v1 not available');\n  }\n\n  if (!value.entity) {\n    throw new Error(\n      'useEntity hook is being called outside of an EntityLayout where the entity has not been loaded. If this is intentional, please use useAsyncEntity instead.',\n    );\n  }\n\n  return { entity: value.entity as TEntity };\n}\n\n/**\n * Grab the current entity from the context, provides loading state and errors, and the ability to refresh.\n *\n * @public\n */\nexport function useAsyncEntity<\n  TEntity extends Entity = Entity,\n>(): EntityLoadingStatus<TEntity> {\n  const versionedHolder = useVersionedContext<{ 1: EntityLoadingStatus }>(\n    'entity-context',\n  );\n\n  if (!versionedHolder) {\n    throw new Error('Entity context is not available');\n  }\n  const value = versionedHolder.atVersion(1);\n  if (!value) {\n    throw new Error('EntityContext v1 not available');\n  }\n\n  const { entity, loading, error, refresh } = value;\n  return { entity: entity as TEntity, loading, error, refresh };\n}\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { Entity } from '@backstage/catalog-model';\nimport { compact, isEqual } from 'lodash';\nimport qs from 'qs';\nimport React, {\n  createContext,\n  PropsWithChildren,\n  useCallback,\n  useContext,\n  useMemo,\n  useState,\n} from 'react';\nimport { useLocation } from 'react-router';\nimport useAsyncFn from 'react-use/lib/useAsyncFn';\nimport useDebounce from 'react-use/lib/useDebounce';\nimport useMountedState from 'react-use/lib/useMountedState';\nimport { catalogApiRef } from '../api';\nimport {\n  EntityErrorFilter,\n  EntityKindFilter,\n  EntityLifecycleFilter,\n  EntityOrphanFilter,\n  EntityOwnerFilter,\n  EntityTagFilter,\n  EntityTextFilter,\n  EntityTypeFilter,\n  UserListFilter,\n} from '../filters';\nimport { EntityFilter } from '../types';\nimport { reduceCatalogFilters, reduceEntityFilters } from '../utils';\nimport { useApi } from '@backstage/core-plugin-api';\n\n/** @public */\nexport type DefaultEntityFilters = {\n  kind?: EntityKindFilter;\n  type?: EntityTypeFilter;\n  user?: UserListFilter;\n  owners?: EntityOwnerFilter;\n  lifecycles?: EntityLifecycleFilter;\n  tags?: EntityTagFilter;\n  text?: EntityTextFilter;\n  orphan?: EntityOrphanFilter;\n  error?: EntityErrorFilter;\n};\n\n/** @public */\nexport type EntityListContextProps<\n  EntityFilters extends DefaultEntityFilters = DefaultEntityFilters,\n> = {\n  /**\n   * The currently registered filters, adhering to the shape of DefaultEntityFilters or an extension\n   * of that default (to add custom filter types).\n   */\n  filters: EntityFilters;\n\n  /**\n   * The resolved list of catalog entities, after all filters are applied.\n   */\n  entities: Entity[];\n\n  /**\n   * The resolved list of catalog entities, after _only catalog-backend_ filters are applied.\n   */\n  backendEntities: Entity[];\n\n  /**\n   * Update one or more of the registered filters. Optional filters can be set to `undefined` to\n   * reset the filter.\n   */\n  updateFilters: (\n    filters:\n      | Partial<EntityFilters>\n      | ((prevFilters: EntityFilters) => Partial<EntityFilters>),\n  ) => void;\n\n  /**\n   * Filter values from query parameters.\n   */\n  queryParameters: Partial<Record<keyof EntityFilters, string | string[]>>;\n\n  loading: boolean;\n  error?: Error;\n};\n\n/**\n * Creates new context for entity listing and filtering.\n * @public\n */\nexport const EntityListContext = createContext<\n  EntityListContextProps<any> | undefined\n>(undefined);\n\ntype OutputState<EntityFilters extends DefaultEntityFilters> = {\n  appliedFilters: EntityFilters;\n  entities: Entity[];\n  backendEntities: Entity[];\n};\n\n/**\n * Provides entities and filters for a catalog listing.\n * @public\n */\nexport const EntityListProvider = <EntityFilters extends DefaultEntityFilters>({\n  children,\n}: PropsWithChildren<{}>) => {\n  const isMounted = useMountedState();\n  const catalogApi = useApi(catalogApiRef);\n  const [requestedFilters, setRequestedFilters] = useState<EntityFilters>(\n    {} as EntityFilters,\n  );\n\n  // We use react-router's useLocation hook so updates from external sources trigger an update to\n  // the queryParameters in outputState. Updates from this hook use replaceState below and won't\n  // trigger a useLocation change; this would instead come from an external source, such as a manual\n  // update of the URL or two catalog sidebar links with different catalog filters.\n  const location = useLocation();\n  const queryParameters = useMemo(\n    () =>\n      (qs.parse(location.search, {\n        ignoreQueryPrefix: true,\n      }).filters ?? {}) as Record<string, string | string[]>,\n    [location],\n  );\n\n  const [outputState, setOutputState] = useState<OutputState<EntityFilters>>(\n    () => {\n      return {\n        appliedFilters: {} as EntityFilters,\n        entities: [],\n        backendEntities: [],\n      };\n    },\n  );\n\n  // The main async filter worker. Note that while it has a lot of dependencies\n  // in terms of its implementation, the triggering only happens (debounced)\n  // based on the requested filters changing.\n  const [{ loading, error }, refresh] = useAsyncFn(\n    async () => {\n      const compacted = compact(Object.values(requestedFilters));\n      const entityFilter = reduceEntityFilters(compacted);\n      const backendFilter = reduceCatalogFilters(compacted);\n      const previousBackendFilter = reduceCatalogFilters(\n        compact(Object.values(outputState.appliedFilters)),\n      );\n\n      const queryParams = Object.keys(requestedFilters).reduce(\n        (params, key) => {\n          const filter: EntityFilter | undefined =\n            requestedFilters[key as keyof EntityFilters];\n          if (filter?.toQueryValue) {\n            params[key] = filter.toQueryValue();\n          }\n          return params;\n        },\n        {} as Record<string, string | string[]>,\n      );\n\n      // TODO(mtlewis): currently entities will never be requested unless\n      // there's at least one filter, we should allow an initial request\n      // to happen with no filters.\n      if (!isEqual(previousBackendFilter, backendFilter)) {\n        // TODO(timbonicus): should limit fields here, but would need filter\n        // fields + table columns\n        const response = await catalogApi.getEntities({\n          filter: backendFilter,\n        });\n        setOutputState({\n          appliedFilters: requestedFilters,\n          backendEntities: response.items,\n          entities: response.items.filter(entityFilter),\n        });\n      } else {\n        setOutputState({\n          appliedFilters: requestedFilters,\n          backendEntities: outputState.backendEntities,\n          entities: outputState.backendEntities.filter(entityFilter),\n        });\n      }\n\n      if (isMounted()) {\n        const oldParams = qs.parse(location.search, {\n          ignoreQueryPrefix: true,\n        });\n        const newParams = qs.stringify(\n          { ...oldParams, filters: queryParams },\n          { addQueryPrefix: true, arrayFormat: 'repeat' },\n        );\n        const newUrl = `${window.location.pathname}${newParams}`;\n        // We use direct history manipulation since useSearchParams and\n        // useNavigate in react-router-dom cause unnecessary extra rerenders.\n        // Also make sure to replace the state rather than pushing, since we\n        // don't want there to be back/forward slots for every single filter\n        // change.\n        window.history?.replaceState(null, document.title, newUrl);\n      }\n    },\n    [catalogApi, queryParameters, requestedFilters, outputState],\n    { loading: true },\n  );\n\n  // Slight debounce on the refresh, since (especially on page load) several\n  // filters will be calling this in rapid succession.\n  useDebounce(refresh, 10, [requestedFilters]);\n\n  const updateFilters = useCallback(\n    (\n      update:\n        | Partial<EntityFilter>\n        | ((prevFilters: EntityFilters) => Partial<EntityFilters>),\n    ) => {\n      setRequestedFilters(prevFilters => {\n        const newFilters =\n          typeof update === 'function' ? update(prevFilters) : update;\n        return { ...prevFilters, ...newFilters };\n      });\n    },\n    [],\n  );\n\n  const value = useMemo(\n    () => ({\n      filters: outputState.appliedFilters,\n      entities: outputState.entities,\n      backendEntities: outputState.backendEntities,\n      updateFilters,\n      queryParameters,\n      loading,\n      error,\n    }),\n    [outputState, updateFilters, queryParameters, loading, error],\n  );\n\n  return (\n    <EntityListContext.Provider value={value}>\n      {children}\n    </EntityListContext.Provider>\n  );\n};\n\n/**\n * Hook for interacting with the entity list context provided by the {@link EntityListProvider}.\n * @public\n */\nexport function useEntityList<\n  EntityFilters extends DefaultEntityFilters = DefaultEntityFilters,\n>(): EntityListContextProps<EntityFilters> {\n  const context = useContext(EntityListContext);\n  if (!context)\n    throw new Error('useEntityList must be used within EntityListProvider');\n  return context;\n}\n","/*\n * Copyright 2021 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { useEffect, useMemo, useRef, useState } from 'react';\nimport useAsync from 'react-use/lib/useAsync';\nimport isEqual from 'lodash/isEqual';\nimport sortBy from 'lodash/sortBy';\nimport { useApi } from '@backstage/core-plugin-api';\nimport { catalogApiRef } from '../api';\nimport { useEntityList } from './useEntityListProvider';\nimport { EntityTypeFilter } from '../filters';\n\n/**\n * A hook built on top of `useEntityList` for enabling selection of valid `spec.type` values\n * based on the selected EntityKindFilter.\n * @public\n */\nexport function useEntityTypeFilter(): {\n  loading: boolean;\n  error?: Error;\n  availableTypes: string[];\n  selectedTypes: string[];\n  setSelectedTypes: (types: string[]) => void;\n} {\n  const catalogApi = useApi(catalogApiRef);\n  const {\n    filters: { kind: kindFilter, type: typeFilter },\n    queryParameters: { type: typeParameter },\n    updateFilters,\n  } = useEntityList();\n\n  const flattenedQueryTypes = useMemo(\n    () => [typeParameter].flat().filter(Boolean) as string[],\n    [typeParameter],\n  );\n\n  const [selectedTypes, setSelectedTypes] = useState(\n    flattenedQueryTypes.length\n      ? flattenedQueryTypes\n      : typeFilter?.getTypes() ?? [],\n  );\n\n  // Set selected types on query parameter updates; this happens at initial page load and from\n  // external updates to the page location.\n  useEffect(() => {\n    if (flattenedQueryTypes.length) {\n      setSelectedTypes(flattenedQueryTypes);\n    }\n  }, [flattenedQueryTypes]);\n\n  const [availableTypes, setAvailableTypes] = useState<string[]>([]);\n  const kind = useMemo(() => kindFilter?.value, [kindFilter]);\n\n  // Load all valid spec.type values straight from the catalogApi, paying attention to only the\n  // kind filter for a complete list.\n  const {\n    error,\n    loading,\n    value: facets,\n  } = useAsync(async () => {\n    if (kind) {\n      const items = await catalogApi\n        .getEntityFacets({\n          filter: { kind },\n          facets: ['spec.type'],\n        })\n        .then(response => response.facets['spec.type'] || []);\n      return items;\n    }\n    return [];\n  }, [kind, catalogApi]);\n\n  const facetsRef = useRef(facets);\n  useEffect(() => {\n    const oldFacets = facetsRef.current;\n    facetsRef.current = facets;\n    // Delay processing hook until kind and facets load updates have settled to generate list of types;\n    // This prevents resetting the type filter due to saved type value from query params not matching the\n    // empty set of type values while values are still being loaded; also only run this hook on changes\n    // to facets\n    if (loading || !kind || oldFacets === facets || !facets) {\n      return;\n    }\n\n    // Sort by facet count descending, so the most common types appear on top\n    const newTypes = [\n      ...new Set(\n        sortBy(facets, f => -f.count).map(f =>\n          f.value.toLocaleLowerCase('en-US'),\n        ),\n      ),\n    ];\n    setAvailableTypes(newTypes);\n\n    // Update type filter to only valid values when the list of available types has changed\n    const stillValidTypes = selectedTypes.filter(value =>\n      newTypes.includes(value),\n    );\n    if (!isEqual(selectedTypes, stillValidTypes)) {\n      setSelectedTypes(stillValidTypes);\n    }\n  }, [loading, kind, selectedTypes, setSelectedTypes, facets]);\n\n  useEffect(() => {\n    updateFilters({\n      type: selectedTypes.length\n        ? new EntityTypeFilter(selectedTypes)\n        : undefined,\n    });\n  }, [selectedTypes, updateFilters]);\n\n  return {\n    loading,\n    error,\n    availableTypes,\n    selectedTypes,\n    setSelectedTypes,\n  };\n}\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport { Entity, parseEntityRef } from '@backstage/catalog-model';\nimport { useApi } from '@backstage/core-plugin-api';\nimport { chunk, groupBy } from 'lodash';\nimport useAsync from 'react-use/lib/useAsync';\nimport { catalogApiRef } from '../api';\n\nconst BATCH_SIZE = 20;\n\n/** @public */\nexport function useRelatedEntities(\n  entity: Entity,\n  relationFilter: { type?: string; kind?: string },\n): {\n  entities: Entity[] | undefined;\n  loading: boolean;\n  error: Error | undefined;\n} {\n  const filterByTypeLower = relationFilter?.type?.toLocaleLowerCase('en-US');\n  const filterByKindLower = relationFilter?.kind?.toLocaleLowerCase('en-US');\n\n  const catalogApi = useApi(catalogApiRef);\n  const {\n    loading,\n    value: entities,\n    error,\n  } = useAsync(async () => {\n    const relations = entity.relations\n      ?.map(r => ({ type: r.type, target: parseEntityRef(r.targetRef) }))\n      .filter(\n        r =>\n          (!filterByTypeLower ||\n            r.type.toLocaleLowerCase('en-US') === filterByTypeLower) &&\n          (!filterByKindLower || r.target.kind === filterByKindLower),\n      );\n\n    if (!relations) {\n      return [];\n    }\n\n    // Group the relations by kind and namespace to reduce the size of the request query string.\n    // Without this grouping, the kind and namespace would need to be specified for each relation, e.g.\n    // `filter=kind=component,namespace=default,name=example1&filter=kind=component,namespace=default,name=example2`\n    // with grouping, we can generate a query a string like\n    // `filter=kind=component,namespace=default,name=example1,example2`\n    const relationsByKindAndNamespace = Object.values(\n      groupBy(relations, ({ target }) => {\n        return `${target.kind}:${target.namespace}`.toLocaleLowerCase('en-US');\n      }),\n    );\n\n    // Split the names within each group into batches to further reduce the query string length.\n    const batchedRelationsByKindAndNamespace: {\n      kind: string;\n      namespace: string;\n      nameBatches: string[][];\n    }[] = [];\n    for (const rs of relationsByKindAndNamespace) {\n      batchedRelationsByKindAndNamespace.push({\n        // All relations in a group have the same kind and namespace, so its arbitrary which we pick\n        kind: rs[0].target.kind,\n        namespace: rs[0].target.namespace,\n        nameBatches: chunk(\n          rs.map(r => r.target.name),\n          BATCH_SIZE,\n        ),\n      });\n    }\n\n    const results = await Promise.all(\n      batchedRelationsByKindAndNamespace.flatMap(rs => {\n        return rs.nameBatches.map(names => {\n          return catalogApi.getEntities({\n            filter: {\n              kind: rs.kind,\n              'metadata.namespace': rs.namespace,\n              'metadata.name': names,\n            },\n          });\n        });\n      }),\n    );\n\n    return results.flatMap(r => r.items);\n  }, [entity, filterByTypeLower, filterByKindLower]);\n\n  return {\n    entities,\n    loading,\n    error,\n  };\n}\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  Entity,\n  CompoundEntityRef,\n  stringifyEntityRef,\n} from '@backstage/catalog-model';\nimport { useApi } from '@backstage/core-plugin-api';\nimport { useCallback } from 'react';\nimport useObservable from 'react-use/lib/useObservable';\nimport { starredEntitiesApiRef } from '../apis';\n\nfunction getEntityRef(\n  entityOrRef: Entity | CompoundEntityRef | string,\n): string {\n  return typeof entityOrRef === 'string'\n    ? entityOrRef\n    : stringifyEntityRef(entityOrRef);\n}\n\n/** @public */\nexport function useStarredEntities(): {\n  starredEntities: Set<string>;\n  toggleStarredEntity: (\n    entityOrRef: Entity | CompoundEntityRef | string,\n  ) => void;\n  isStarredEntity: (\n    entityOrRef: Entity | CompoundEntityRef | string,\n  ) => boolean;\n} {\n  const starredEntitiesApi = useApi(starredEntitiesApiRef);\n\n  const starredEntities = useObservable(\n    starredEntitiesApi.starredEntitie$(),\n    new Set<string>(),\n  );\n\n  const isStarredEntity = useCallback(\n    (entityOrRef: Entity | CompoundEntityRef | string) =>\n      starredEntities.has(getEntityRef(entityOrRef)),\n    [starredEntities],\n  );\n\n  const toggleStarredEntity = useCallback(\n    (entityOrRef: Entity | CompoundEntityRef | string) =>\n      starredEntitiesApi.toggleStarred(getEntityRef(entityOrRef)).then(),\n    [starredEntitiesApi],\n  );\n\n  return {\n    starredEntities,\n    toggleStarredEntity,\n    isStarredEntity,\n  };\n}\n","/*\n * Copyright 2021 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  Entity,\n  CompoundEntityRef,\n  stringifyEntityRef,\n} from '@backstage/catalog-model';\nimport { useApi } from '@backstage/core-plugin-api';\nimport { useCallback, useEffect, useState } from 'react';\nimport { starredEntitiesApiRef } from '../apis';\n\nfunction getEntityRef(\n  entityOrRef: Entity | CompoundEntityRef | string,\n): string {\n  return typeof entityOrRef === 'string'\n    ? entityOrRef\n    : stringifyEntityRef(entityOrRef);\n}\n\n/** @public */\nexport function useStarredEntity(\n  entityOrRef: Entity | CompoundEntityRef | string,\n): {\n  toggleStarredEntity: () => void;\n  isStarredEntity: boolean;\n} {\n  const starredEntitiesApi = useApi(starredEntitiesApiRef);\n\n  const [isStarredEntity, setIsStarredEntity] = useState(false);\n\n  useEffect(() => {\n    const subscription = starredEntitiesApi.starredEntitie$().subscribe({\n      next(starredEntities: Set<string>) {\n        setIsStarredEntity(starredEntities.has(getEntityRef(entityOrRef)));\n      },\n    });\n\n    return () => {\n      subscription.unsubscribe();\n    };\n  }, [entityOrRef, starredEntitiesApi]);\n\n  const toggleStarredEntity = useCallback(\n    () => starredEntitiesApi.toggleStarred(getEntityRef(entityOrRef)).then(),\n    [entityOrRef, starredEntitiesApi],\n  );\n\n  return {\n    toggleStarredEntity,\n    isStarredEntity,\n  };\n}\n","/*\n * Copyright 2021 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  Entity,\n  RELATION_OWNED_BY,\n  stringifyEntityRef,\n} from '@backstage/catalog-model';\nimport { identityApiRef, useApi } from '@backstage/core-plugin-api';\nimport { useMemo } from 'react';\nimport useAsync from 'react-use/lib/useAsync';\nimport { getEntityRelations } from '../utils/getEntityRelations';\n\n/**\n * Returns a function that checks whether the currently signed-in user is an\n * owner of a given entity. When the hook is initially mounted, the loading\n * flag will be true and the results returned from the function will always be\n * false.\n *\n * @public\n *\n * @returns a function that checks if the signed in user owns an entity\n */\nexport function useEntityOwnership(): {\n  loading: boolean;\n  isOwnedEntity: (entity: Entity) => boolean;\n} {\n  const identityApi = useApi(identityApiRef);\n\n  // Trigger load only on mount\n  const { loading, value: refs } = useAsync(async () => {\n    const { ownershipEntityRefs } = await identityApi.getBackstageIdentity();\n    return ownershipEntityRefs;\n  }, []);\n\n  const isOwnedEntity = useMemo(() => {\n    const myOwnerRefs = new Set(refs ?? []);\n    return (entity: Entity) => {\n      const entityOwnerRefs = getEntityRelations(entity, RELATION_OWNED_BY).map(\n        stringifyEntityRef,\n      );\n      for (const ref of entityOwnerRefs) {\n        if (myOwnerRefs.has(ref)) {\n          return true;\n        }\n      }\n      return false;\n    };\n  }, [refs]);\n\n  return useMemo(() => ({ loading, isOwnedEntity }), [loading, isOwnedEntity]);\n}\n","/*\n * Copyright 2022 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { stringifyEntityRef } from '@backstage/catalog-model';\nimport { ResourcePermission } from '@backstage/plugin-permission-common';\nimport { usePermission } from '@backstage/plugin-permission-react';\nimport { useAsyncEntity } from './useEntity';\n\n/**\n * A thin wrapper around the\n * {@link @backstage/plugin-permission-react#usePermission} hook which uses the\n * current entity in context to make an authorization request for the given\n * {@link @backstage/plugin-catalog-common#CatalogEntityPermission}.\n *\n * Note: this hook blocks the permission request until the entity has loaded in\n * context. If you have the entityRef and need concurrent requests, use the\n * `usePermission` hook directly.\n * @alpha\n */\nexport function useEntityPermission(\n  // TODO(joeporpeglia) Replace with `CatalogEntityPermission` when the issue described in\n  // https://github.com/backstage/backstage/pull/10128 is fixed.\n  permission: ResourcePermission<'catalog-entity'>,\n): {\n  loading: boolean;\n  allowed: boolean;\n  error?: Error;\n} {\n  const {\n    entity,\n    loading: loadingEntity,\n    error: entityError,\n  } = useAsyncEntity();\n  const {\n    allowed,\n    loading: loadingPermission,\n    error: permissionError,\n  } = usePermission({\n    permission,\n    resourceRef: entity ? stringifyEntityRef(entity) : undefined,\n  });\n\n  if (loadingEntity || loadingPermission) {\n    return { loading: true, allowed: false };\n  }\n  if (entityError) {\n    return { loading: false, allowed: false, error: entityError };\n  }\n  return { loading: false, allowed, error: permissionError };\n}\n","/*\n * Copyright 2021 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { Select } from '@backstage/core-components';\nimport { alertApiRef, useApi } from '@backstage/core-plugin-api';\nimport { Box } from '@material-ui/core';\nimport capitalize from 'lodash/capitalize';\nimport sortBy from 'lodash/sortBy';\nimport React, { useEffect, useMemo, useRef, useState } from 'react';\nimport useAsync from 'react-use/lib/useAsync';\nimport { catalogApiRef } from '../../api';\nimport { EntityKindFilter } from '../../filters';\nimport { useEntityList } from '../../hooks';\n\nfunction useAvailableKinds() {\n  const catalogApi = useApi(catalogApiRef);\n\n  const [availableKinds, setAvailableKinds] = useState<string[]>([]);\n\n  const {\n    error,\n    loading,\n    value: facets,\n  } = useAsync(async () => {\n    const facet = 'kind';\n    const items = await catalogApi\n      .getEntityFacets({\n        facets: [facet],\n      })\n      .then(response => response.facets[facet] || []);\n\n    return items;\n  }, [catalogApi]);\n\n  const facetsRef = useRef(facets);\n  useEffect(() => {\n    const oldFacets = facetsRef.current;\n    facetsRef.current = facets;\n    // Delay processing hook until facets load updates have settled to generate list of kinds;\n    // This prevents resetting the kind filter due to saved kind value from query params not matching the\n    // empty set of kind values while values are still being loaded; also only run this hook on changes\n    // to facets\n    if (loading || oldFacets === facets || !facets) {\n      return;\n    }\n\n    const newKinds = [\n      ...new Set(\n        sortBy(facets, f => f.value).map(f =>\n          f.value.toLocaleLowerCase('en-US'),\n        ),\n      ),\n    ];\n\n    setAvailableKinds(newKinds);\n  }, [loading, facets, setAvailableKinds]);\n\n  return { loading, error, availableKinds };\n}\n\nfunction useEntityKindFilter(opts: { initialFilter: string }): {\n  loading: boolean;\n  error?: Error;\n  availableKinds: string[];\n  selectedKind: string;\n  setSelectedKind: (kind: string) => void;\n} {\n  const {\n    filters,\n    queryParameters: { kind: kindParameter },\n    updateFilters,\n  } = useEntityList();\n\n  const flattenedQueryKind = useMemo(\n    () => [kindParameter].flat()[0],\n    [kindParameter],\n  );\n\n  const [selectedKind, setSelectedKind] = useState(\n    flattenedQueryKind ?? filters.kind?.value ?? opts.initialFilter,\n  );\n\n  // Set selected kinds on query parameter updates; this happens at initial page load and from\n  // external updates to the page location.\n  useEffect(() => {\n    if (flattenedQueryKind) {\n      setSelectedKind(flattenedQueryKind);\n    }\n  }, [flattenedQueryKind]);\n\n  // Set selected kind from filters; this happens when the kind filter is\n  // updated from another component\n  useEffect(() => {\n    if (filters.kind?.value) {\n      setSelectedKind(filters.kind?.value);\n    }\n  }, [filters.kind]);\n\n  const { availableKinds, loading, error } = useAvailableKinds();\n\n  useEffect(() => {\n    updateFilters({\n      kind: selectedKind ? new EntityKindFilter(selectedKind) : undefined,\n    });\n  }, [selectedKind, updateFilters]);\n\n  return {\n    loading,\n    error,\n    availableKinds,\n    selectedKind,\n    setSelectedKind,\n  };\n}\n\n/**\n * Props for {@link EntityKindPicker}.\n *\n * @public\n */\nexport interface EntityKindPickerProps {\n  initialFilter?: string;\n  hidden?: boolean;\n}\n\n/** @public */\nexport const EntityKindPicker = (props: EntityKindPickerProps) => {\n  const { hidden, initialFilter = 'component' } = props;\n\n  const alertApi = useApi(alertApiRef);\n\n  const { error, availableKinds, selectedKind, setSelectedKind } =\n    useEntityKindFilter({\n      initialFilter: initialFilter,\n    });\n\n  useEffect(() => {\n    if (error) {\n      alertApi.post({\n        message: `Failed to load entity kinds`,\n        severity: 'error',\n      });\n    }\n  }, [error, alertApi]);\n\n  if (availableKinds?.length === 0 || error) return null;\n\n  const items = [\n    ...availableKinds.map((kind: string) => ({\n      value: kind,\n      label: capitalize(kind),\n    })),\n  ];\n\n  return hidden ? null : (\n    <Box pb={1} pt={1}>\n      <Select\n        label=\"Kind\"\n        items={items}\n        selected={selectedKind}\n        onChange={value => setSelectedKind(String(value))}\n      />\n    </Box>\n  );\n};\n","/*\n * Copyright 2021 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { Entity } from '@backstage/catalog-model';\nimport {\n  Box,\n  Checkbox,\n  FormControlLabel,\n  makeStyles,\n  TextField,\n  Typography,\n} from '@material-ui/core';\nimport CheckBoxIcon from '@material-ui/icons/CheckBox';\nimport CheckBoxOutlineBlankIcon from '@material-ui/icons/CheckBoxOutlineBlank';\nimport ExpandMoreIcon from '@material-ui/icons/ExpandMore';\nimport { Autocomplete } from '@material-ui/lab';\nimport React, { useEffect, useMemo, useState } from 'react';\nimport { useEntityList } from '../../hooks/useEntityListProvider';\nimport { EntityLifecycleFilter } from '../../filters';\n\n/** @public */\nexport type CatalogReactEntityLifecyclePickerClassKey = 'input';\n\nconst useStyles = makeStyles(\n  {\n    input: {},\n  },\n  {\n    name: 'CatalogReactEntityLifecyclePicker',\n  },\n);\n\nconst icon = <CheckBoxOutlineBlankIcon fontSize=\"small\" />;\nconst checkedIcon = <CheckBoxIcon fontSize=\"small\" />;\n\n/** @public */\nexport const EntityLifecyclePicker = () => {\n  const classes = useStyles();\n  const {\n    updateFilters,\n    backendEntities,\n    filters,\n    queryParameters: { lifecycles: lifecyclesParameter },\n  } = useEntityList();\n\n  const queryParamLifecycles = useMemo(\n    () => [lifecyclesParameter].flat().filter(Boolean) as string[],\n    [lifecyclesParameter],\n  );\n\n  const [selectedLifecycles, setSelectedLifecycles] = useState(\n    queryParamLifecycles.length\n      ? queryParamLifecycles\n      : filters.lifecycles?.values ?? [],\n  );\n\n  // Set selected lifecycles on query parameter updates; this happens at initial page load and from\n  // external updates to the page location.\n  useEffect(() => {\n    if (queryParamLifecycles.length) {\n      setSelectedLifecycles(queryParamLifecycles);\n    }\n  }, [queryParamLifecycles]);\n\n  useEffect(() => {\n    updateFilters({\n      lifecycles: selectedLifecycles.length\n        ? new EntityLifecycleFilter(selectedLifecycles)\n        : undefined,\n    });\n  }, [selectedLifecycles, updateFilters]);\n\n  const availableLifecycles = useMemo(\n    () =>\n      [\n        ...new Set(\n          backendEntities\n            .map((e: Entity) => e.spec?.lifecycle)\n            .filter(Boolean) as string[],\n        ),\n      ].sort(),\n    [backendEntities],\n  );\n\n  if (!availableLifecycles.length) return null;\n\n  return (\n    <Box pb={1} pt={1}>\n      <Typography variant=\"button\" component=\"label\">\n        Lifecycle\n        <Autocomplete\n          multiple\n          options={availableLifecycles}\n          value={selectedLifecycles}\n          onChange={(_: object, value: string[]) =>\n            setSelectedLifecycles(value)\n          }\n          renderOption={(option, { selected }) => (\n            <FormControlLabel\n              control={\n                <Checkbox\n                  icon={icon}\n                  checkedIcon={checkedIcon}\n                  checked={selected}\n                />\n              }\n              label={option}\n            />\n          )}\n          size=\"small\"\n          popupIcon={<ExpandMoreIcon data-testid=\"lifecycle-picker-expand\" />}\n          renderInput={params => (\n            <TextField\n              {...params}\n              className={classes.input}\n              variant=\"outlined\"\n            />\n          )}\n        />\n      </Typography>\n    </Box>\n  );\n};\n","/*\n * Copyright 2021 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { Entity, RELATION_OWNED_BY } from '@backstage/catalog-model';\nimport {\n  Box,\n  Checkbox,\n  FormControlLabel,\n  makeStyles,\n  TextField,\n  Typography,\n} from '@material-ui/core';\nimport CheckBoxIcon from '@material-ui/icons/CheckBox';\nimport CheckBoxOutlineBlankIcon from '@material-ui/icons/CheckBoxOutlineBlank';\nimport ExpandMoreIcon from '@material-ui/icons/ExpandMore';\nimport { Autocomplete } from '@material-ui/lab';\nimport React, { useEffect, useMemo, useState } from 'react';\nimport { useEntityList } from '../../hooks/useEntityListProvider';\nimport { EntityOwnerFilter } from '../../filters';\nimport { getEntityRelations } from '../../utils';\nimport { humanizeEntityRef } from '../EntityRefLink';\n\n/** @public */\nexport type CatalogReactEntityOwnerPickerClassKey = 'input';\n\nconst useStyles = makeStyles(\n  {\n    input: {},\n  },\n  {\n    name: 'CatalogReactEntityOwnerPicker',\n  },\n);\n\nconst icon = <CheckBoxOutlineBlankIcon fontSize=\"small\" />;\nconst checkedIcon = <CheckBoxIcon fontSize=\"small\" />;\n\n/** @public */\nexport const EntityOwnerPicker = () => {\n  const classes = useStyles();\n  const {\n    updateFilters,\n    backendEntities,\n    filters,\n    queryParameters: { owners: ownersParameter },\n  } = useEntityList();\n\n  const queryParamOwners = useMemo(\n    () => [ownersParameter].flat().filter(Boolean) as string[],\n    [ownersParameter],\n  );\n\n  const [selectedOwners, setSelectedOwners] = useState(\n    queryParamOwners.length ? queryParamOwners : filters.owners?.values ?? [],\n  );\n\n  // Set selected owners on query parameter updates; this happens at initial page load and from\n  // external updates to the page location.\n  useEffect(() => {\n    if (queryParamOwners.length) {\n      setSelectedOwners(queryParamOwners);\n    }\n  }, [queryParamOwners]);\n\n  useEffect(() => {\n    updateFilters({\n      owners: selectedOwners.length\n        ? new EntityOwnerFilter(selectedOwners)\n        : undefined,\n    });\n  }, [selectedOwners, updateFilters]);\n\n  const availableOwners = useMemo(\n    () =>\n      [\n        ...new Set(\n          backendEntities\n            .flatMap((e: Entity) =>\n              getEntityRelations(e, RELATION_OWNED_BY).map(o =>\n                humanizeEntityRef(o, { defaultKind: 'group' }),\n              ),\n            )\n            .filter(Boolean) as string[],\n        ),\n      ].sort(),\n    [backendEntities],\n  );\n\n  if (!availableOwners.length) return null;\n\n  return (\n    <Box pb={1} pt={1}>\n      <Typography variant=\"button\" component=\"label\">\n        Owner\n        <Autocomplete\n          multiple\n          options={availableOwners}\n          value={selectedOwners}\n          onChange={(_: object, value: string[]) => setSelectedOwners(value)}\n          renderOption={(option, { selected }) => (\n            <FormControlLabel\n              control={\n                <Checkbox\n                  icon={icon}\n                  checkedIcon={checkedIcon}\n                  checked={selected}\n                />\n              }\n              label={option}\n            />\n          )}\n          size=\"small\"\n          popupIcon={<ExpandMoreIcon data-testid=\"owner-picker-expand\" />}\n          renderInput={params => (\n            <TextField\n              {...params}\n              className={classes.input}\n              variant=\"outlined\"\n            />\n          )}\n        />\n      </Typography>\n    </Box>\n  );\n};\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  FormControl,\n  IconButton,\n  Input,\n  InputAdornment,\n  makeStyles,\n  Toolbar,\n} from '@material-ui/core';\nimport Clear from '@material-ui/icons/Clear';\nimport Search from '@material-ui/icons/Search';\nimport React, { useState } from 'react';\nimport useDebounce from 'react-use/lib/useDebounce';\nimport { useEntityList } from '../../hooks/useEntityListProvider';\nimport { EntityTextFilter } from '../../filters';\n\n/** @public */\nexport type CatalogReactEntitySearchBarClassKey = 'searchToolbar' | 'input';\n\nconst useStyles = makeStyles(\n  _theme => ({\n    searchToolbar: {\n      paddingLeft: 0,\n      paddingRight: 0,\n    },\n    input: {},\n  }),\n  {\n    name: 'CatalogReactEntitySearchBar',\n  },\n);\n\n/**\n * Renders search bar for filtering the entity list.\n * @public\n */\nexport const EntitySearchBar = () => {\n  const classes = useStyles();\n\n  const { filters, updateFilters } = useEntityList();\n  const [search, setSearch] = useState(filters.text?.value ?? '');\n\n  useDebounce(\n    () => {\n      updateFilters({\n        text: search.length ? new EntityTextFilter(search) : undefined,\n      });\n    },\n    250,\n    [search, updateFilters],\n  );\n\n  return (\n    <Toolbar className={classes.searchToolbar}>\n      <FormControl>\n        <Input\n          aria-label=\"search\"\n          id=\"input-with-icon-adornment\"\n          className={classes.input}\n          placeholder=\"Search\"\n          autoComplete=\"off\"\n          onChange={event => setSearch(event.target.value)}\n          value={search}\n          startAdornment={\n            <InputAdornment position=\"start\">\n              <Search />\n            </InputAdornment>\n          }\n          endAdornment={\n            <InputAdornment position=\"end\">\n              <IconButton\n                aria-label=\"clear search\"\n                onClick={() => setSearch('')}\n                edge=\"end\"\n                disabled={search.length === 0}\n              >\n                <Clear />\n              </IconButton>\n            </InputAdornment>\n          }\n        />\n      </FormControl>\n    </Toolbar>\n  );\n};\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  Entity,\n  CompoundEntityRef,\n  RELATION_OWNED_BY,\n  RELATION_PART_OF,\n} from '@backstage/catalog-model';\nimport { OverflowTooltip, TableColumn } from '@backstage/core-components';\nimport React from 'react';\nimport { getEntityRelations } from '../../utils';\nimport {\n  EntityRefLink,\n  EntityRefLinks,\n  humanizeEntityRef,\n} from '../EntityRefLink';\n\n/** @public */\nexport const columnFactories = Object.freeze({\n  createEntityRefColumn<T extends Entity>(options: {\n    defaultKind?: string;\n  }): TableColumn<T> {\n    const { defaultKind } = options;\n    function formatContent(entity: T): string {\n      return (\n        entity.metadata?.title ||\n        humanizeEntityRef(entity, {\n          defaultKind,\n        })\n      );\n    }\n\n    return {\n      title: 'Name',\n      highlight: true,\n      customFilterAndSearch(filter, entity) {\n        // TODO: We could implement this more efficiently, like searching over\n        // each field that is displayed individually (kind, namespace, name).\n        // but that might confuse the user as it will behave different than a\n        // simple text search.\n        // Another alternative would be to cache the values. But writing them\n        // into the entity feels bad too.\n        return formatContent(entity).includes(filter);\n      },\n      customSort(entity1, entity2) {\n        // TODO: We could implement this more efficiently by comparing field by field.\n        // This has similar issues as above.\n        return formatContent(entity1).localeCompare(formatContent(entity2));\n      },\n      render: entity => (\n        <EntityRefLink\n          entityRef={entity}\n          defaultKind={defaultKind}\n          title={entity.metadata?.title}\n        />\n      ),\n    };\n  },\n  createEntityRelationColumn<T extends Entity>(options: {\n    title: string;\n    relation: string;\n    defaultKind?: string;\n    filter?: { kind: string };\n  }): TableColumn<T> {\n    const { title, relation, defaultKind, filter: entityFilter } = options;\n\n    function getRelations(entity: T): CompoundEntityRef[] {\n      return getEntityRelations(entity, relation, entityFilter);\n    }\n\n    function formatContent(entity: T): string {\n      return getRelations(entity)\n        .map(r => humanizeEntityRef(r, { defaultKind }))\n        .join(', ');\n    }\n\n    return {\n      title,\n      customFilterAndSearch(filter, entity) {\n        return formatContent(entity).includes(filter);\n      },\n      customSort(entity1, entity2) {\n        return formatContent(entity1).localeCompare(formatContent(entity2));\n      },\n      render: entity => {\n        return (\n          <EntityRefLinks\n            entityRefs={getRelations(entity)}\n            defaultKind={defaultKind}\n          />\n        );\n      },\n    };\n  },\n  createOwnerColumn<T extends Entity>(): TableColumn<T> {\n    return this.createEntityRelationColumn({\n      title: 'Owner',\n      relation: RELATION_OWNED_BY,\n      defaultKind: 'group',\n    });\n  },\n  createDomainColumn<T extends Entity>(): TableColumn<T> {\n    return this.createEntityRelationColumn({\n      title: 'Domain',\n      relation: RELATION_PART_OF,\n      defaultKind: 'domain',\n      filter: {\n        kind: 'domain',\n      },\n    });\n  },\n  createSystemColumn<T extends Entity>(): TableColumn<T> {\n    return this.createEntityRelationColumn({\n      title: 'System',\n      relation: RELATION_PART_OF,\n      defaultKind: 'system',\n      filter: {\n        kind: 'system',\n      },\n    });\n  },\n  createMetadataDescriptionColumn<T extends Entity>(): TableColumn<T> {\n    return {\n      title: 'Description',\n      field: 'metadata.description',\n      render: entity => (\n        <OverflowTooltip\n          text={entity.metadata.description}\n          placement=\"bottom-start\"\n          line={2}\n        />\n      ),\n    };\n  },\n  createSpecLifecycleColumn<T extends Entity>(): TableColumn<T> {\n    return {\n      title: 'Lifecycle',\n      field: 'spec.lifecycle',\n    };\n  },\n  createSpecTypeColumn<T extends Entity>(): TableColumn<T> {\n    return {\n      title: 'Type',\n      field: 'spec.type',\n    };\n  },\n});\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { ComponentEntity, SystemEntity } from '@backstage/catalog-model';\nimport { TableColumn } from '@backstage/core-components';\nimport { columnFactories } from './columns';\n\nexport const systemEntityColumns: TableColumn<SystemEntity>[] = [\n  columnFactories.createEntityRefColumn({ defaultKind: 'system' }),\n  columnFactories.createDomainColumn(),\n  columnFactories.createOwnerColumn(),\n  columnFactories.createMetadataDescriptionColumn(),\n];\n\nexport const componentEntityColumns: TableColumn<ComponentEntity>[] = [\n  columnFactories.createEntityRefColumn({ defaultKind: 'component' }),\n  columnFactories.createSystemColumn(),\n  columnFactories.createOwnerColumn(),\n  columnFactories.createSpecTypeColumn(),\n  columnFactories.createSpecLifecycleColumn(),\n  columnFactories.createMetadataDescriptionColumn(),\n];\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { Entity } from '@backstage/catalog-model';\nimport { makeStyles } from '@material-ui/core';\nimport React, { ReactNode } from 'react';\nimport { columnFactories } from './columns';\nimport { componentEntityColumns, systemEntityColumns } from './presets';\nimport {\n  InfoCardVariants,\n  Table,\n  TableColumn,\n} from '@backstage/core-components';\n\n/**\n * Props for {@link EntityTable}.\n *\n * @public\n */\nexport interface EntityTableProps<T extends Entity> {\n  title: string;\n  variant?: InfoCardVariants;\n  entities: T[];\n  emptyContent?: ReactNode;\n  columns: TableColumn<T>[];\n}\n\nconst useStyles = makeStyles(theme => ({\n  empty: {\n    padding: theme.spacing(2),\n    display: 'flex',\n    justifyContent: 'center',\n  },\n}));\n\n/**\n * A general entity table component, that can be used for composing more\n * specific entity tables.\n *\n * @public\n */\nexport const EntityTable = <T extends Entity>(props: EntityTableProps<T>) => {\n  const {\n    entities,\n    title,\n    emptyContent,\n    variant = 'gridItem',\n    columns,\n  } = props;\n\n  const classes = useStyles();\n  const tableStyle: React.CSSProperties = {\n    minWidth: '0',\n    width: '100%',\n  };\n\n  if (variant === 'gridItem') {\n    tableStyle.height = 'calc(100% - 10px)';\n  }\n\n  return (\n    <Table<T>\n      columns={columns}\n      title={title}\n      style={tableStyle}\n      emptyContent={\n        emptyContent && <div className={classes.empty}>{emptyContent}</div>\n      }\n      options={{\n        // TODO: Toolbar padding if off compared to other cards, should be: padding: 16px 24px;\n        search: false,\n        paging: false,\n        actionsColumnIndex: -1,\n        padding: 'dense',\n        draggable: false,\n      }}\n      data={entities}\n    />\n  );\n};\n\nEntityTable.columns = columnFactories;\n\nEntityTable.systemEntityColumns = systemEntityColumns;\n\nEntityTable.componentEntityColumns = componentEntityColumns;\n","/*\n * Copyright 2021 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  Box,\n  Checkbox,\n  FormControlLabel,\n  makeStyles,\n  TextField,\n  Typography,\n} from '@material-ui/core';\nimport CheckBoxIcon from '@material-ui/icons/CheckBox';\nimport CheckBoxOutlineBlankIcon from '@material-ui/icons/CheckBoxOutlineBlank';\nimport ExpandMoreIcon from '@material-ui/icons/ExpandMore';\nimport { Autocomplete } from '@material-ui/lab';\nimport React, { useEffect, useMemo, useState } from 'react';\nimport { useEntityList } from '../../hooks/useEntityListProvider';\nimport { EntityTagFilter } from '../../filters';\nimport { useApi } from '@backstage/core-plugin-api';\nimport useAsync from 'react-use/lib/useAsync';\nimport { catalogApiRef } from '../../api';\n\n/** @public */\nexport type CatalogReactEntityTagPickerClassKey = 'input';\n\nconst useStyles = makeStyles(\n  {\n    input: {},\n  },\n  {\n    name: 'CatalogReactEntityTagPicker',\n  },\n);\n\nconst icon = <CheckBoxOutlineBlankIcon fontSize=\"small\" />;\nconst checkedIcon = <CheckBoxIcon fontSize=\"small\" />;\n\n/** @public */\nexport type EntityTagPickerProps = {\n  showCounts?: boolean;\n};\n\n/** @public */\nexport const EntityTagPicker = (props: EntityTagPickerProps) => {\n  const classes = useStyles();\n  const {\n    updateFilters,\n    filters,\n    queryParameters: { tags: tagsParameter },\n  } = useEntityList();\n\n  const catalogApi = useApi(catalogApiRef);\n  const { value: availableTags } = useAsync(async () => {\n    const facet = 'metadata.tags';\n    const { facets } = await catalogApi.getEntityFacets({\n      facets: [facet],\n      filter: filters.kind?.getCatalogFilters(),\n    });\n\n    return Object.fromEntries(\n      facets[facet].map(({ value, count }) => [value, count]),\n    );\n  }, [filters.kind]);\n\n  const queryParamTags = useMemo(\n    () => [tagsParameter].flat().filter(Boolean) as string[],\n    [tagsParameter],\n  );\n\n  const [selectedTags, setSelectedTags] = useState(\n    queryParamTags.length ? queryParamTags : filters.tags?.values ?? [],\n  );\n\n  // Set selected tags on query parameter updates; this happens at initial page load and from\n  // external updates to the page location.\n  useEffect(() => {\n    if (queryParamTags.length) {\n      setSelectedTags(queryParamTags);\n    }\n  }, [queryParamTags]);\n\n  useEffect(() => {\n    updateFilters({\n      tags: selectedTags.length ? new EntityTagFilter(selectedTags) : undefined,\n    });\n  }, [selectedTags, updateFilters]);\n\n  if (!Object.keys(availableTags ?? {}).length) return null;\n\n  return (\n    <Box pb={1} pt={1}>\n      <Typography variant=\"button\" component=\"label\">\n        Tags\n        <Autocomplete\n          multiple\n          options={Object.keys(availableTags ?? {})}\n          value={selectedTags}\n          onChange={(_: object, value: string[]) => setSelectedTags(value)}\n          renderOption={(option, { selected }) => (\n            <FormControlLabel\n              control={\n                <Checkbox\n                  icon={icon}\n                  checkedIcon={checkedIcon}\n                  checked={selected}\n                />\n              }\n              label={\n                props.showCounts\n                  ? `${option} (${availableTags?.[option]})`\n                  : option\n              }\n            />\n          )}\n          size=\"small\"\n          popupIcon={<ExpandMoreIcon data-testid=\"tag-picker-expand\" />}\n          renderInput={params => (\n            <TextField\n              {...params}\n              className={classes.input}\n              variant=\"outlined\"\n            />\n          )}\n        />\n      </Typography>\n    </Box>\n  );\n};\n","/*\n * Copyright 2021 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React, { useEffect } from 'react';\nimport capitalize from 'lodash/capitalize';\nimport { Box } from '@material-ui/core';\nimport { useEntityTypeFilter } from '../../hooks/useEntityTypeFilter';\n\nimport { alertApiRef, useApi } from '@backstage/core-plugin-api';\nimport { Select } from '@backstage/core-components';\n\n/**\n * Props for {@link EntityTypePicker}.\n *\n * @public\n */\nexport interface EntityTypePickerProps {\n  initialFilter?: string;\n  hidden?: boolean;\n}\n\n/** @public */\nexport const EntityTypePicker = (props: EntityTypePickerProps) => {\n  const { hidden, initialFilter } = props;\n  const alertApi = useApi(alertApiRef);\n  const { error, availableTypes, selectedTypes, setSelectedTypes } =\n    useEntityTypeFilter();\n\n  useEffect(() => {\n    if (error) {\n      alertApi.post({\n        message: `Failed to load entity types`,\n        severity: 'error',\n      });\n    }\n    if (initialFilter) {\n      setSelectedTypes([initialFilter]);\n    }\n  }, [error, alertApi, initialFilter, setSelectedTypes]);\n\n  if (availableTypes.length === 0 || error) return null;\n\n  const items = [\n    { value: 'all', label: 'All' },\n    ...availableTypes.map((type: string) => ({\n      value: type,\n      label: capitalize(type),\n    })),\n  ];\n\n  return hidden ? null : (\n    <Box pb={1} pt={1}>\n      <Select\n        label=\"Type\"\n        items={items}\n        selected={(items.length > 1 ? selectedTypes[0] : undefined) ?? 'all'}\n        onChange={value =>\n          setSelectedTypes(value === 'all' ? [] : [String(value)])\n        }\n      />\n    </Box>\n  );\n};\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { Entity } from '@backstage/catalog-model';\nimport { IconButton, Tooltip, withStyles } from '@material-ui/core';\nimport Star from '@material-ui/icons/Star';\nimport StarBorder from '@material-ui/icons/StarBorder';\nimport React, { ComponentProps } from 'react';\nimport { useStarredEntity } from '../../hooks/useStarredEntity';\n\n/** @public */\nexport type FavoriteEntityProps = ComponentProps<typeof IconButton> & {\n  entity: Entity;\n};\n\nconst YellowStar = withStyles({\n  root: {\n    color: '#f3ba37',\n  },\n})(Star);\n\n/**\n * IconButton for showing if a current entity is starred and adding/removing it from the favorite entities\n * @param props - MaterialUI IconButton props extended by required `entity` prop\n * @public\n */\nexport const FavoriteEntity = (props: FavoriteEntityProps) => {\n  const { toggleStarredEntity, isStarredEntity } = useStarredEntity(\n    props.entity,\n  );\n  return (\n    <IconButton\n      aria-label=\"favorite\"\n      color=\"inherit\"\n      {...props}\n      onClick={() => toggleStarredEntity()}\n    >\n      <Tooltip\n        title={isStarredEntity ? 'Remove from favorites' : 'Add to favorites'}\n      >\n        {isStarredEntity ? <YellowStar /> : <StarBorder />}\n      </Tooltip>\n    </IconButton>\n  );\n};\n","/*\n * Copyright 2022 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { parseEntityRef } from '@backstage/catalog-model';\nimport { useApp } from '@backstage/core-plugin-api';\nimport WorkIcon from '@material-ui/icons/Work';\nimport React from 'react';\n\nconst DEFAULT_ICON = WorkIcon;\n\nfunction getKind(\n  kind: string | undefined,\n  entityRef: string | undefined,\n): string | undefined {\n  if (kind) {\n    return kind.toLocaleLowerCase('en-US');\n  }\n\n  if (entityRef) {\n    try {\n      return parseEntityRef(entityRef).kind.toLocaleLowerCase('en-US');\n    } catch {\n      return undefined;\n    }\n  }\n\n  return undefined;\n}\n\nfunction useIcon(kind: string | undefined, entityRef: string | undefined) {\n  const app = useApp();\n\n  const actualKind = getKind(kind, entityRef);\n  if (!actualKind) {\n    return DEFAULT_ICON;\n  }\n\n  const icon = app.getSystemIcon(`kind:${actualKind}`);\n  return icon || DEFAULT_ICON;\n}\n\nexport function EntityKindIcon(props: {\n  kind?: string;\n  entityRef?: string;\n  x?: number;\n  y?: number;\n  width?: number;\n  height?: number;\n  className?: string;\n}) {\n  const { kind, entityRef, ...otherProps } = props;\n  const Icon = useIcon(kind, entityRef);\n  return <Icon {...otherProps} />;\n}\n","/*\n * Copyright 2022 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  Entity,\n  DEFAULT_NAMESPACE,\n  stringifyEntityRef,\n} from '@backstage/catalog-model';\nimport {\n  DependencyGraph,\n  DependencyGraphTypes,\n  Link,\n  Progress,\n  ResponseErrorPanel,\n} from '@backstage/core-components';\nimport { useApi, useRouteRef } from '@backstage/core-plugin-api';\nimport { Box, DialogContentText, makeStyles } from '@material-ui/core';\nimport classNames from 'classnames';\nimport React, { useLayoutEffect, useRef, useState } from 'react';\nimport { useNavigate } from 'react-router';\nimport useAsync from 'react-use/lib/useAsync';\nimport { catalogApiRef } from '../../../api';\nimport { humanizeEntityRef } from '../../EntityRefLink';\nimport { entityRouteRef } from '../../../routes';\nimport { EntityKindIcon } from './EntityKindIcon';\n\nconst useStyles = makeStyles(theme => ({\n  node: {\n    fill: theme.palette.grey[300],\n    stroke: theme.palette.grey[300],\n    '&.primary': {\n      fill: theme.palette.primary.light,\n      stroke: theme.palette.primary.light,\n    },\n    '&.secondary': {\n      fill: theme.palette.secondary.light,\n      stroke: theme.palette.secondary.light,\n    },\n  },\n  text: {\n    fill: theme.palette.getContrastText(theme.palette.grey[300]),\n    '&.primary': {\n      fill: theme.palette.primary.contrastText,\n    },\n    '&.secondary': {\n      fill: theme.palette.secondary.contrastText,\n    },\n    '&.focused': {\n      fontWeight: 'bold',\n    },\n  },\n  clickable: {\n    cursor: 'pointer',\n  },\n}));\n\ntype NodeType = Entity & { root: boolean };\n\nfunction useAncestry(root: Entity): {\n  loading: boolean;\n  error?: Error;\n  nodes: DependencyGraphTypes.DependencyNode<NodeType>[];\n  edges: DependencyGraphTypes.DependencyEdge[];\n} {\n  const catalogClient = useApi(catalogApiRef);\n  const entityRef = stringifyEntityRef(root);\n\n  const { loading, error, value } = useAsync(async () => {\n    const response = await catalogClient.getEntityAncestors({ entityRef });\n    const nodes = new Array<DependencyGraphTypes.DependencyNode<NodeType>>();\n    const edges = new Array<DependencyGraphTypes.DependencyEdge>();\n    for (const current of response.items) {\n      const currentRef = stringifyEntityRef(current.entity);\n      const isRootNode = currentRef === response.rootEntityRef;\n      nodes.push({ id: currentRef, root: isRootNode, ...current.entity });\n      for (const parentRef of current.parentEntityRefs) {\n        edges.push({ from: currentRef, to: parentRef });\n      }\n    }\n    return { nodes, edges };\n  }, [entityRef]);\n\n  return {\n    loading,\n    error,\n    nodes: value?.nodes || [],\n    edges: value?.edges || [],\n  };\n}\n\nfunction CustomNode({ node }: DependencyGraphTypes.RenderNodeProps<NodeType>) {\n  const classes = useStyles();\n  const navigate = useNavigate();\n  const entityRoute = useRouteRef(entityRouteRef);\n  const [width, setWidth] = useState(0);\n  const [height, setHeight] = useState(0);\n  const idRef = useRef<SVGTextElement | null>(null);\n\n  useLayoutEffect(() => {\n    // set the width to the length of the ID\n    if (idRef.current) {\n      let { height: renderedHeight, width: renderedWidth } =\n        idRef.current.getBBox();\n      renderedHeight = Math.round(renderedHeight);\n      renderedWidth = Math.round(renderedWidth);\n      if (renderedHeight !== height || renderedWidth !== width) {\n        setWidth(renderedWidth);\n        setHeight(renderedHeight);\n      }\n    }\n  }, [width, height]);\n\n  const padding = 10;\n  const iconSize = height;\n  const paddedIconWidth = iconSize + padding;\n  const paddedWidth = paddedIconWidth + width + padding * 2;\n  const paddedHeight = height + padding * 2;\n\n  const displayTitle =\n    node.metadata.title ||\n    (node.kind && node.metadata.name && node.metadata.namespace\n      ? humanizeEntityRef({\n          kind: node.kind,\n          name: node.metadata.name,\n          namespace: node.metadata.namespace || '',\n        })\n      : node.id);\n\n  const onClick = () => {\n    navigate(\n      entityRoute({\n        kind: node.kind,\n        namespace: node.metadata.namespace || DEFAULT_NAMESPACE,\n        name: node.metadata.name,\n      }),\n    );\n  };\n\n  return (\n    <g onClick={onClick} className={classes.clickable}>\n      <rect\n        className={classNames(\n          classes.node,\n          node.root ? 'secondary' : 'primary',\n        )}\n        width={paddedWidth}\n        height={paddedHeight}\n        rx={10}\n      />\n      <EntityKindIcon\n        kind={node.kind}\n        y={padding}\n        x={padding}\n        width={iconSize}\n        height={iconSize}\n        className={classNames(\n          classes.text,\n          node.root ? 'secondary' : 'primary',\n        )}\n      />\n      <text\n        ref={idRef}\n        className={classNames(\n          classes.text,\n          node.root ? 'secondary' : 'primary',\n        )}\n        y={paddedHeight / 2}\n        x={paddedIconWidth + (width + padding * 2) / 2}\n        textAnchor=\"middle\"\n        alignmentBaseline=\"middle\"\n      >\n        {displayTitle}\n      </text>\n    </g>\n  );\n}\n\nexport function AncestryPage(props: { entity: Entity }) {\n  const { loading, error, nodes, edges } = useAncestry(props.entity);\n  if (loading) {\n    return <Progress />;\n  } else if (error) {\n    return <ResponseErrorPanel error={error} />;\n  }\n\n  return (\n    <>\n      <DialogContentText variant=\"h2\">Ancestry</DialogContentText>\n      <DialogContentText gutterBottom>\n        This is the ancestry of entities above the current one - as in, the\n        chain(s) of entities down to the current one, where{' '}\n        <Link to=\"https://backstage.io/docs/features/software-catalog/life-of-an-entity\">\n          processors emitted\n        </Link>{' '}\n        child entities that ultimately led to the current one existing. Note\n        that this is a completely different mechanism from relations.\n      </DialogContentText>\n      <Box mt={4}>\n        <DependencyGraph\n          nodes={nodes}\n          edges={edges}\n          renderNode={CustomNode}\n          direction={DependencyGraphTypes.Direction.BOTTOM_TOP}\n          zoom=\"enable-on-click\"\n        />\n      </Box>\n    </>\n  );\n}\n","/*\n * Copyright 2022 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { Link } from '@backstage/core-components';\nimport {\n  Box,\n  Card,\n  CardContent,\n  ListItem,\n  ListItemIcon,\n  ListItemText as MuiListItemText,\n  ListSubheader as MuiListSubheader,\n  makeStyles,\n  Typography,\n} from '@material-ui/core';\nimport HelpOutlineIcon from '@material-ui/icons/HelpOutline';\nimport React from 'react';\n\nconst useStyles = makeStyles(theme => ({\n  root: {\n    display: 'flex',\n    flexDirection: 'column',\n  },\n  marginTop: {\n    marginTop: theme.spacing(2),\n  },\n  helpIcon: {\n    marginLeft: theme.spacing(1),\n    color: theme.palette.text.disabled,\n  },\n  monospace: {\n    fontFamily: 'monospace',\n  },\n}));\n\nexport function ListItemText(props: {\n  primary: React.ReactNode;\n  secondary?: React.ReactNode;\n}) {\n  const classes = useStyles();\n  return (\n    <MuiListItemText\n      {...props}\n      primaryTypographyProps={{ className: classes.monospace }}\n      secondaryTypographyProps={{ className: classes.monospace }}\n    />\n  );\n}\n\nexport function ListSubheader(props: { children?: React.ReactNode }) {\n  const classes = useStyles();\n  return (\n    <MuiListSubheader className={classes.monospace}>\n      {props.children}\n    </MuiListSubheader>\n  );\n}\n\nexport function Container(props: {\n  title: React.ReactNode;\n  helpLink?: string;\n  children: React.ReactNode;\n}) {\n  return (\n    <Box mt={2}>\n      <Card variant=\"outlined\">\n        <CardContent>\n          <Typography variant=\"h6\" gutterBottom>\n            {props.title}\n            {props.helpLink && <HelpIcon to={props.helpLink} />}\n          </Typography>\n          {props.children}\n        </CardContent>\n      </Card>\n    </Box>\n  );\n}\n\n// Extracts a link from a value, if possible\nfunction findLink(value: string): string | undefined {\n  if (value.match(/^url:https?:\\/\\//)) {\n    return value.slice('url:'.length);\n  }\n  if (value.match(/^https?:\\/\\//)) {\n    return value;\n  }\n  return undefined;\n}\n\nexport function KeyValueListItem(props: {\n  indent?: boolean;\n  entry: [string, string];\n}) {\n  const [key, value] = props.entry;\n  const link = findLink(value);\n\n  return (\n    <ListItem>\n      {props.indent && <ListItemIcon />}\n      <ListItemText\n        primary={key}\n        secondary={link ? <Link to={link}>{value}</Link> : value}\n      />\n    </ListItem>\n  );\n}\n\nexport function HelpIcon(props: { to: string }) {\n  const classes = useStyles();\n  return (\n    <Link to={props.to} className={classes.helpIcon}>\n      <HelpOutlineIcon fontSize=\"inherit\" />\n    </Link>\n  );\n}\n","/*\n * Copyright 2022 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  Entity,\n  ANNOTATION_LOCATION,\n  ANNOTATION_ORIGIN_LOCATION,\n  stringifyEntityRef,\n} from '@backstage/catalog-model';\nimport { Progress, ResponseErrorPanel } from '@backstage/core-components';\nimport { useApi } from '@backstage/core-plugin-api';\nimport {\n  DialogContentText,\n  List,\n  ListItem,\n  ListItemIcon,\n  makeStyles,\n} from '@material-ui/core';\nimport { Alert } from '@material-ui/lab';\nimport React from 'react';\nimport useAsync from 'react-use/lib/useAsync';\nimport { catalogApiRef } from '../../../api';\nimport { EntityRefLink } from '../../EntityRefLink';\nimport { KeyValueListItem, ListItemText } from './common';\nimport { EntityKindIcon } from './EntityKindIcon';\n\nconst useStyles = makeStyles({\n  root: {\n    display: 'flex',\n    flexDirection: 'column',\n  },\n});\n\nfunction useColocated(entity: Entity): {\n  loading: boolean;\n  error?: Error;\n  location?: string;\n  originLocation?: string;\n  colocatedEntities?: Entity[];\n} {\n  const catalogApi = useApi(catalogApiRef);\n  const currentEntityRef = stringifyEntityRef(entity);\n  const location = entity.metadata.annotations?.[ANNOTATION_LOCATION];\n  const origin = entity.metadata.annotations?.[ANNOTATION_ORIGIN_LOCATION];\n\n  const { loading, error, value } = useAsync(async () => {\n    if (!location && !origin) {\n      return [];\n    }\n    const response = await catalogApi.getEntities({\n      filter: [\n        ...(location\n          ? [{ [`metadata.annotations.${ANNOTATION_LOCATION}`]: location }]\n          : []),\n        ...(origin\n          ? [{ [`metadata.annotations.${ANNOTATION_ORIGIN_LOCATION}`]: origin }]\n          : []),\n      ],\n    });\n    return response.items;\n  }, [location, origin]);\n\n  return {\n    loading,\n    error,\n    location,\n    originLocation: origin,\n    colocatedEntities: value?.filter(\n      colocated => stringifyEntityRef(colocated) !== currentEntityRef,\n    ),\n  };\n}\n\nfunction EntityList(props: { entities: Entity[]; header?: [string, string] }) {\n  return (\n    <List dense>\n      {props.header && <KeyValueListItem key=\"header\" entry={props.header} />}\n      {props.entities.map(entity => (\n        <ListItem key={stringifyEntityRef(entity)}>\n          <ListItemIcon>\n            <EntityKindIcon kind={entity.kind} />\n          </ListItemIcon>\n          <ListItemText primary={<EntityRefLink entityRef={entity} />} />\n        </ListItem>\n      ))}\n    </List>\n  );\n}\n\nfunction Contents(props: { entity: Entity }) {\n  const { entity } = props;\n\n  const { loading, error, location, originLocation, colocatedEntities } =\n    useColocated(entity);\n  if (loading) {\n    return <Progress />;\n  } else if (error) {\n    return <ResponseErrorPanel error={error} />;\n  }\n\n  if (!location && !originLocation) {\n    return (\n      <Alert severity=\"warning\">Entity had no location information.</Alert>\n    );\n  } else if (!colocatedEntities?.length) {\n    return (\n      <Alert severity=\"info\">\n        There were no other entities on this location.\n      </Alert>\n    );\n  }\n\n  if (location === originLocation) {\n    return <EntityList entities={colocatedEntities} />;\n  }\n\n  const atLocation = colocatedEntities.filter(\n    e => e.metadata.annotations?.[ANNOTATION_LOCATION] === location,\n  );\n  const atOrigin = colocatedEntities.filter(\n    e =>\n      e.metadata.annotations?.[ANNOTATION_ORIGIN_LOCATION] === originLocation,\n  );\n\n  return (\n    <>\n      {atLocation.length > 0 && (\n        <EntityList\n          entities={atLocation}\n          header={['At the same location', location!]}\n        />\n      )}\n      {atOrigin.length > 0 && (\n        <EntityList\n          entities={atOrigin}\n          header={['At the same origin', originLocation!]}\n        />\n      )}\n    </>\n  );\n}\n\nexport function ColocatedPage(props: { entity: Entity }) {\n  const classes = useStyles();\n  return (\n    <>\n      <DialogContentText variant=\"h2\">Colocated</DialogContentText>\n      <DialogContentText>\n        These are the entities that are colocated with this entity - as in, they\n        originated from the same data source (e.g. came from the same YAML\n        file), or from the same origin (e.g. the originally registered URL).\n      </DialogContentText>\n      <div className={classes.root}>\n        <Contents entity={props.entity} />\n      </div>\n    </>\n  );\n}\n","/*\n * Copyright 2022 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { JsonObject } from '@backstage/types';\n\nexport function sortKeys(data: JsonObject): JsonObject {\n  // we could do something custom, but lexicographical sorting is actually a\n  // good choice at least for the default set of keys\n  return Object.fromEntries(\n    [...Object.entries(data)].sort((a, b) => (a[0] < b[0] ? -1 : 1)),\n  );\n}\n","/*\n * Copyright 2022 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { Entity } from '@backstage/catalog-model';\nimport { CodeSnippet } from '@backstage/core-components';\nimport { DialogContentText } from '@material-ui/core';\nimport React from 'react';\nimport { sortKeys } from './util';\n\nexport function JsonPage(props: { entity: Entity }) {\n  return (\n    <>\n      <DialogContentText variant=\"h2\">Entity as JSON</DialogContentText>\n      <DialogContentText>\n        This is the raw entity data as received from the catalog, on JSON form.\n      </DialogContentText>\n      <DialogContentText>\n        <div style={{ fontSize: '75%' }} data-testid=\"code-snippet\">\n          <CodeSnippet\n            text={JSON.stringify(sortKeys(props.entity), undefined, 2)}\n            language=\"json\"\n            showCopyCodeButton\n          />\n        </div>\n      </DialogContentText>\n    </>\n  );\n}\n","/*\n * Copyright 2022 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { AlphaEntity } from '@backstage/catalog-model';\nimport {\n  Box,\n  DialogContentText,\n  List,\n  ListItem,\n  ListItemIcon,\n  makeStyles,\n  Typography,\n} from '@material-ui/core';\nimport groupBy from 'lodash/groupBy';\nimport sortBy from 'lodash/sortBy';\nimport React from 'react';\nimport { EntityRefLink } from '../../EntityRefLink';\nimport {\n  Container,\n  HelpIcon,\n  KeyValueListItem,\n  ListItemText,\n  ListSubheader,\n} from './common';\nimport { EntityKindIcon } from './EntityKindIcon';\n\nconst useStyles = makeStyles({\n  root: {\n    display: 'flex',\n    flexDirection: 'column',\n  },\n});\n\nexport function OverviewPage(props: { entity: AlphaEntity }) {\n  const classes = useStyles();\n  const {\n    apiVersion,\n    kind,\n    metadata,\n    spec,\n    relations = [],\n    status = {},\n  } = props.entity;\n\n  const groupedRelations = groupBy(\n    sortBy(relations, r => r.targetRef),\n    'type',\n  );\n\n  return (\n    <>\n      <DialogContentText variant=\"h2\">Overview</DialogContentText>\n      <div className={classes.root}>\n        <Container title=\"Identity\">\n          <List dense>\n            <ListItem>\n              <ListItemText primary=\"apiVersion\" secondary={apiVersion} />\n            </ListItem>\n            <ListItem>\n              <ListItemText primary=\"kind\" secondary={kind} />\n            </ListItem>\n            {spec?.type && (\n              <ListItem>\n                <ListItemText primary=\"spec.type\" secondary={spec.type} />\n              </ListItem>\n            )}\n            {metadata.uid && (\n              <ListItem>\n                <ListItemText primary=\"uid\" secondary={metadata.uid} />\n              </ListItem>\n            )}\n            {metadata.etag && (\n              <ListItem>\n                <ListItemText primary=\"etag\" secondary={metadata.etag} />\n              </ListItem>\n            )}\n          </List>\n        </Container>\n\n        <Container title=\"Metadata\">\n          {!!Object.keys(metadata.annotations || {}).length && (\n            <List\n              dense\n              subheader={\n                <ListSubheader>\n                  Annotations\n                  <HelpIcon to=\"https://backstage.io/docs/features/software-catalog/well-known-annotations\" />\n                </ListSubheader>\n              }\n            >\n              {Object.entries(metadata.annotations!).map(entry => (\n                <KeyValueListItem key={entry[0]} indent entry={entry} />\n              ))}\n            </List>\n          )}\n          {!!Object.keys(metadata.labels || {}).length && (\n            <List dense subheader={<ListSubheader>Labels</ListSubheader>}>\n              {Object.entries(metadata.labels!).map(entry => (\n                <KeyValueListItem key={entry[0]} indent entry={entry} />\n              ))}\n            </List>\n          )}\n          {!!metadata.tags?.length && (\n            <List dense subheader={<ListSubheader>Tags</ListSubheader>}>\n              {metadata.tags.map((tag, index) => (\n                <ListItem key={`${tag}-${index}`}>\n                  <ListItemIcon />\n                  <ListItemText primary={tag} />\n                </ListItem>\n              ))}\n            </List>\n          )}\n        </Container>\n\n        {!!relations.length && (\n          <Container\n            title=\"Relations\"\n            helpLink=\"https://backstage.io/docs/features/software-catalog/well-known-relations\"\n          >\n            {Object.entries(groupedRelations).map(\n              ([type, groupRelations], index) => (\n                <div key={index}>\n                  <List dense subheader={<ListSubheader>{type}</ListSubheader>}>\n                    {groupRelations.map(group => (\n                      <ListItem key={group.targetRef}>\n                        <ListItemIcon>\n                          <EntityKindIcon entityRef={group.targetRef} />\n                        </ListItemIcon>\n                        <ListItemText\n                          primary={\n                            <EntityRefLink entityRef={group.targetRef} />\n                          }\n                        />\n                      </ListItem>\n                    ))}\n                  </List>\n                </div>\n              ),\n            )}\n          </Container>\n        )}\n\n        {!!status.items?.length && (\n          <Container\n            title=\"Status\"\n            helpLink=\"https://backstage.io/docs/features/software-catalog/well-known-statuses\"\n          >\n            {status.items.map((item, index) => (\n              <div key={index}>\n                <Typography>\n                  {item.level}: {item.type}\n                </Typography>\n                <Box ml={2}>{item.message}</Box>\n              </div>\n            ))}\n          </Container>\n        )}\n      </div>\n    </>\n  );\n}\n","/*\n * Copyright 2022 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { Entity } from '@backstage/catalog-model';\nimport { CodeSnippet } from '@backstage/core-components';\nimport DialogContentText from '@material-ui/core/DialogContentText';\nimport React from 'react';\nimport YAML from 'yaml';\nimport { sortKeys } from './util';\n\nexport function YamlPage(props: { entity: Entity }) {\n  return (\n    <>\n      <DialogContentText variant=\"h2\">Entity as YAML</DialogContentText>\n      <DialogContentText>\n        This is the raw entity data as received from the catalog, on YAML form.\n      </DialogContentText>\n      <DialogContentText>\n        <div style={{ fontSize: '75%' }} data-testid=\"code-snippet\">\n          <CodeSnippet\n            text={YAML.stringify(sortKeys(props.entity))}\n            language=\"yaml\"\n            showCopyCodeButton\n          />\n        </div>\n      </DialogContentText>\n    </>\n  );\n}\n","/*\n * Copyright 2022 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { Entity } from '@backstage/catalog-model';\nimport {\n  Box,\n  Button,\n  Dialog,\n  DialogActions,\n  DialogContent,\n  DialogTitle,\n  makeStyles,\n  Tab,\n  Tabs,\n} from '@material-ui/core';\nimport React, { useEffect } from 'react';\nimport { AncestryPage } from './components/AncestryPage';\nimport { ColocatedPage } from './components/ColocatedPage';\nimport { JsonPage } from './components/JsonPage';\nimport { OverviewPage } from './components/OverviewPage';\nimport { YamlPage } from './components/YamlPage';\n\nconst useStyles = makeStyles(theme => ({\n  fullHeightDialog: {\n    height: 'calc(100% - 64px)',\n  },\n  root: {\n    display: 'flex',\n    flexGrow: 1,\n    width: '100%',\n    backgroundColor: theme.palette.background.paper,\n  },\n  tabs: {\n    borderRight: `1px solid ${theme.palette.divider}`,\n    flexShrink: 0,\n  },\n  tabContents: {\n    flexGrow: 1,\n    overflowX: 'auto',\n  },\n}));\n\nfunction TabPanel(props: {\n  children?: React.ReactNode;\n  index: number;\n  value: number;\n}) {\n  const { children, value, index, ...other } = props;\n  const classes = useStyles();\n  return (\n    <div\n      role=\"tabpanel\"\n      hidden={value !== index}\n      id={`vertical-tabpanel-${index}`}\n      aria-labelledby={`vertical-tab-${index}`}\n      className={classes.tabContents}\n      {...other}\n    >\n      {value === index && (\n        <Box pl={3} pr={3}>\n          {children}\n        </Box>\n      )}\n    </div>\n  );\n}\n\nfunction a11yProps(index: number) {\n  return {\n    id: `vertical-tab-${index}`,\n    'aria-controls': `vertical-tabpanel-${index}`,\n  };\n}\n\n/**\n * A dialog that lets users inspect the low level details of their entities.\n *\n * @public\n */\nexport function InspectEntityDialog(props: {\n  open: boolean;\n  entity: Entity;\n  onClose: () => void;\n}) {\n  const classes = useStyles();\n  const [activeTab, setActiveTab] = React.useState(0);\n\n  useEffect(() => {\n    setActiveTab(0);\n  }, [props.open]);\n\n  if (!props.entity) {\n    return null;\n  }\n\n  return (\n    <Dialog\n      fullWidth\n      maxWidth=\"xl\"\n      open={props.open}\n      onClose={props.onClose}\n      aria-labelledby=\"entity-inspector-dialog-title\"\n      PaperProps={{ className: classes.fullHeightDialog }}\n    >\n      <DialogTitle id=\"entity-inspector-dialog-title\">\n        Entity Inspector\n      </DialogTitle>\n      <DialogContent dividers>\n        <div className={classes.root}>\n          <Tabs\n            orientation=\"vertical\"\n            variant=\"scrollable\"\n            value={activeTab}\n            onChange={(_, newValue) => setActiveTab(newValue)}\n            aria-label=\"Inspector options\"\n            className={classes.tabs}\n          >\n            <Tab label=\"Overview\" {...a11yProps(0)} />\n            <Tab label=\"Ancestry\" {...a11yProps(1)} />\n            <Tab label=\"Colocated\" {...a11yProps(2)} />\n            <Tab label=\"Raw JSON\" {...a11yProps(3)} />\n            <Tab label=\"Raw YAML\" {...a11yProps(4)} />\n          </Tabs>\n\n          <TabPanel value={activeTab} index={0}>\n            <OverviewPage entity={props.entity} />\n          </TabPanel>\n          <TabPanel value={activeTab} index={1}>\n            <AncestryPage entity={props.entity} />\n          </TabPanel>\n          <TabPanel value={activeTab} index={2}>\n            <ColocatedPage entity={props.entity} />\n          </TabPanel>\n          <TabPanel value={activeTab} index={3}>\n            <JsonPage entity={props.entity} />\n          </TabPanel>\n          <TabPanel value={activeTab} index={4}>\n            <YamlPage entity={props.entity} />\n          </TabPanel>\n        </div>\n      </DialogContent>\n      <DialogActions>\n        <Button onClick={props.onClose} color=\"primary\">\n          Close\n        </Button>\n      </DialogActions>\n    </Dialog>\n  );\n}\n","/*\n * Copyright 2021 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  Entity,\n  CompoundEntityRef,\n  getCompoundEntityRef,\n  ANNOTATION_ORIGIN_LOCATION,\n} from '@backstage/catalog-model';\nimport { catalogApiRef } from '../../api';\nimport { useCallback } from 'react';\nimport useAsync from 'react-use/lib/useAsync';\nimport { useApi } from '@backstage/core-plugin-api';\n\n/**\n * Each distinct state that the dialog can be in at any given time.\n */\nexport type UseUnregisterEntityDialogState =\n  | {\n      type: 'loading';\n    }\n  | {\n      type: 'error';\n      error: Error;\n    }\n  | {\n      type: 'bootstrap';\n      location: string;\n      deleteEntity: () => Promise<void>;\n    }\n  | {\n      type: 'unregister';\n      location: string;\n      colocatedEntities: CompoundEntityRef[];\n      unregisterLocation: () => Promise<void>;\n      deleteEntity: () => Promise<void>;\n    }\n  | {\n      type: 'only-delete';\n      deleteEntity: () => Promise<void>;\n    };\n\n/**\n * Houses the main logic for unregistering entities and their locations.\n */\nexport function useUnregisterEntityDialogState(\n  entity: Entity,\n): UseUnregisterEntityDialogState {\n  const catalogApi = useApi(catalogApiRef);\n  const locationRef = entity.metadata.annotations?.[ANNOTATION_ORIGIN_LOCATION];\n  const uid = entity.metadata.uid;\n  const isBootstrap = locationRef === 'bootstrap:bootstrap';\n\n  // Load the prerequisite data: what entities that are colocated with us, and\n  // what location that spawned us\n  const prerequisites = useAsync(async () => {\n    const locationPromise = catalogApi.getLocationByRef(locationRef!);\n\n    let colocatedEntitiesPromise: Promise<Entity[]>;\n    if (!locationRef) {\n      colocatedEntitiesPromise = Promise.resolve([]);\n    } else {\n      const locationAnnotationFilter = `metadata.annotations.${ANNOTATION_ORIGIN_LOCATION}`;\n      colocatedEntitiesPromise = catalogApi\n        .getEntities({\n          filter: { [locationAnnotationFilter]: locationRef },\n          fields: [\n            'kind',\n            'metadata.uid',\n            'metadata.name',\n            'metadata.namespace',\n          ],\n        })\n        .then(response => response.items);\n    }\n\n    return Promise.all([locationPromise, colocatedEntitiesPromise]).then(\n      ([location, colocatedEntities]) => ({\n        location,\n        colocatedEntities,\n      }),\n    );\n  }, [catalogApi, entity]);\n\n  // Unregisters the underlying location which will remove all of the entities that are spawned from\n  // it. Can only ever be called when the prerequisites have finished loading successfully, and if\n  // there was a matching location.\n  const unregisterLocation = useCallback(\n    async function unregisterLocationFn() {\n      const { location } = prerequisites.value!;\n      await catalogApi.removeLocationById(location!.id);\n    },\n    [catalogApi, prerequisites],\n  );\n\n  // Just removes the entity, without affecting locations in any way.\n  const deleteEntity = useCallback(\n    async function deleteEntityFn() {\n      await catalogApi.removeEntityByUid(uid!);\n    },\n    [catalogApi, uid],\n  );\n\n  // If this is a bootstrap location entity, don't even block on loading\n  // prerequisites. We know that all that we will do is to offer to remove the\n  // entity, and that doesn't require anything from the prerequisites.\n  if (isBootstrap) {\n    return { type: 'bootstrap', location: locationRef!, deleteEntity };\n  }\n\n  // Return early if prerequisites still loading or failing\n  const { loading, error, value } = prerequisites;\n  if (loading) {\n    return { type: 'loading' };\n  } else if (error) {\n    return { type: 'error', error };\n  }\n\n  const { location, colocatedEntities } = value!;\n  if (!location) {\n    return { type: 'only-delete', deleteEntity };\n  }\n  return {\n    type: 'unregister',\n    location: locationRef!,\n    colocatedEntities: colocatedEntities.map(getCompoundEntityRef),\n    unregisterLocation,\n    deleteEntity,\n  };\n}\n","/*\n * Copyright 2021 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { Entity } from '@backstage/catalog-model';\nimport { EntityRefLink } from '../EntityRefLink';\nimport {\n  Box,\n  Button,\n  Dialog,\n  DialogActions,\n  DialogContent,\n  DialogContentText,\n  DialogTitle,\n  Divider,\n  makeStyles,\n} from '@material-ui/core';\nimport Alert from '@material-ui/lab/Alert';\nimport React, { useCallback, useState } from 'react';\nimport { useUnregisterEntityDialogState } from './useUnregisterEntityDialogState';\n\nimport { alertApiRef, configApiRef, useApi } from '@backstage/core-plugin-api';\nimport { Progress, ResponseErrorPanel } from '@backstage/core-components';\nimport { assertError } from '@backstage/errors';\n\nconst useStyles = makeStyles({\n  advancedButton: {\n    fontSize: '0.7em',\n  },\n});\n\nconst Contents = ({\n  entity,\n  onConfirm,\n}: {\n  entity: Entity;\n  onConfirm: () => any;\n}) => {\n  const alertApi = useApi(alertApiRef);\n  const configApi = useApi(configApiRef);\n  const classes = useStyles();\n  const state = useUnregisterEntityDialogState(entity);\n  const [showDelete, setShowDelete] = useState(false);\n  const [busy, setBusy] = useState(false);\n  const appTitle = configApi.getOptionalString('app.title') ?? 'Backstage';\n\n  const onUnregister = useCallback(\n    async function onUnregisterFn() {\n      if ('unregisterLocation' in state) {\n        setBusy(true);\n        try {\n          await state.unregisterLocation();\n          onConfirm();\n        } catch (err) {\n          assertError(err);\n          alertApi.post({ message: err.message });\n        } finally {\n          setBusy(false);\n        }\n      }\n    },\n    [alertApi, onConfirm, state],\n  );\n\n  const onDelete = useCallback(\n    async function onDeleteFn() {\n      if ('deleteEntity' in state) {\n        setBusy(true);\n        try {\n          await state.deleteEntity();\n          onConfirm();\n        } catch (err) {\n          assertError(err);\n          alertApi.post({ message: err.message });\n        } finally {\n          setBusy(false);\n        }\n      }\n    },\n    [alertApi, onConfirm, state],\n  );\n\n  if (state.type === 'loading') {\n    return <Progress />;\n  }\n\n  if (state.type === 'error') {\n    return <ResponseErrorPanel error={state.error} />;\n  }\n\n  if (state.type === 'bootstrap') {\n    return (\n      <>\n        <Alert severity=\"info\">\n          You cannot unregister this entity, since it originates from a\n          protected Backstage configuration (location \"{state.location}\"). If\n          you believe this is in error, please contact the {appTitle}{' '}\n          integrator.\n        </Alert>\n\n        <Box marginTop={2}>\n          {!showDelete && (\n            <Button\n              variant=\"text\"\n              size=\"small\"\n              color=\"primary\"\n              className={classes.advancedButton}\n              onClick={() => setShowDelete(true)}\n            >\n              Advanced Options\n            </Button>\n          )}\n\n          {showDelete && (\n            <>\n              <DialogContentText>\n                You have the option to delete the entity itself from the\n                catalog. Note that this should only be done if you know that the\n                catalog file has been deleted at, or moved from, its origin\n                location. If that is not the case, the entity will reappear\n                shortly as the next refresh round is performed by the catalog.\n              </DialogContentText>\n              <Button\n                variant=\"contained\"\n                color=\"secondary\"\n                disabled={busy}\n                onClick={onDelete}\n              >\n                Delete Entity\n              </Button>\n            </>\n          )}\n        </Box>\n      </>\n    );\n  }\n\n  if (state.type === 'only-delete') {\n    return (\n      <>\n        <DialogContentText>\n          This entity does not seem to originate from a registered location. You\n          therefore only have the option to delete it outright from the catalog.\n        </DialogContentText>\n        <Button\n          variant=\"contained\"\n          color=\"secondary\"\n          disabled={busy}\n          onClick={onDelete}\n        >\n          Delete Entity\n        </Button>\n      </>\n    );\n  }\n\n  if (state.type === 'unregister') {\n    return (\n      <>\n        <DialogContentText>\n          This action will unregister the following entities:\n        </DialogContentText>\n        <DialogContentText component=\"ul\">\n          {state.colocatedEntities.map(e => (\n            <li key={`${e.kind}:${e.namespace}/${e.name}`}>\n              <EntityRefLink entityRef={e} />\n            </li>\n          ))}\n        </DialogContentText>\n        <DialogContentText>\n          Located at the following location:\n        </DialogContentText>\n        <DialogContentText component=\"ul\">\n          <li>{state.location}</li>\n        </DialogContentText>\n        <DialogContentText>\n          To undo, just re-register the entity in {appTitle}.\n        </DialogContentText>\n        <Box marginTop={2}>\n          <Button\n            variant=\"contained\"\n            color=\"secondary\"\n            disabled={busy}\n            onClick={onUnregister}\n          >\n            Unregister Location\n          </Button>\n          {!showDelete && (\n            <Box component=\"span\" marginLeft={2}>\n              <Button\n                variant=\"text\"\n                size=\"small\"\n                color=\"primary\"\n                className={classes.advancedButton}\n                onClick={() => setShowDelete(true)}\n              >\n                Advanced Options\n              </Button>\n            </Box>\n          )}\n        </Box>\n\n        {showDelete && (\n          <>\n            <Box paddingTop={4} paddingBottom={4}>\n              <Divider />\n            </Box>\n            <DialogContentText>\n              You also have the option to delete the entity itself from the\n              catalog. Note that this should only be done if you know that the\n              catalog file has been deleted at, or moved from, its origin\n              location. If that is not the case, the entity will reappear\n              shortly as the next refresh round is performed by the catalog.\n            </DialogContentText>\n            <Button\n              variant=\"contained\"\n              color=\"secondary\"\n              disabled={busy}\n              onClick={onDelete}\n            >\n              Delete Entity\n            </Button>\n          </>\n        )}\n      </>\n    );\n  }\n\n  return <Alert severity=\"error\">Internal error: Unknown state</Alert>;\n};\n\n/** @public */\nexport type UnregisterEntityDialogProps = {\n  open: boolean;\n  onConfirm: () => any;\n  onClose: () => any;\n  entity: Entity;\n};\n\n/** @public */\nexport const UnregisterEntityDialog = (props: UnregisterEntityDialogProps) => {\n  const { open, onConfirm, onClose, entity } = props;\n  return (\n    <Dialog open={open} onClose={onClose}>\n      <DialogTitle id=\"responsive-dialog-title\">\n        Are you sure you want to unregister this entity?\n      </DialogTitle>\n      <DialogContent>\n        <Contents entity={entity} onConfirm={onConfirm} />\n      </DialogContent>\n      <DialogActions>\n        <Button onClick={onClose} color=\"primary\">\n          Cancel\n        </Button>\n      </DialogActions>\n    </Dialog>\n  );\n};\n","/*\n * Copyright 2021 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  configApiRef,\n  IconComponent,\n  useApi,\n} from '@backstage/core-plugin-api';\nimport {\n  Card,\n  List,\n  ListItemIcon,\n  ListItemSecondaryAction,\n  ListItemText,\n  makeStyles,\n  MenuItem,\n  Theme,\n  Typography,\n} from '@material-ui/core';\nimport SettingsIcon from '@material-ui/icons/Settings';\nimport StarIcon from '@material-ui/icons/Star';\nimport { compact } from 'lodash';\nimport React, { Fragment, useEffect, useMemo, useState } from 'react';\nimport { UserListFilter } from '../../filters';\nimport {\n  useEntityList,\n  useStarredEntities,\n  useEntityOwnership,\n} from '../../hooks';\nimport { UserListFilterKind } from '../../types';\nimport { reduceEntityFilters } from '../../utils';\n\n/** @public */\nexport type CatalogReactUserListPickerClassKey =\n  | 'root'\n  | 'title'\n  | 'listIcon'\n  | 'menuItem'\n  | 'groupWrapper';\n\nconst useStyles = makeStyles<Theme>(\n  theme => ({\n    root: {\n      backgroundColor: 'rgba(0, 0, 0, .11)',\n      boxShadow: 'none',\n      margin: theme.spacing(1, 0, 1, 0),\n    },\n    title: {\n      margin: theme.spacing(1, 0, 0, 1),\n      textTransform: 'uppercase',\n      fontSize: 12,\n      fontWeight: 'bold',\n    },\n    listIcon: {\n      minWidth: 30,\n      color: theme.palette.text.primary,\n    },\n    menuItem: {\n      minHeight: theme.spacing(6),\n    },\n    groupWrapper: {\n      margin: theme.spacing(1, 1, 2, 1),\n    },\n  }),\n  {\n    name: 'CatalogReactUserListPicker',\n  },\n);\n\nexport type ButtonGroup = {\n  name: string;\n  items: {\n    id: 'owned' | 'starred' | 'all';\n    label: string;\n    icon?: IconComponent;\n  }[];\n};\n\nfunction getFilterGroups(orgName: string | undefined): ButtonGroup[] {\n  return [\n    {\n      name: 'Personal',\n      items: [\n        {\n          id: 'owned',\n          label: 'Owned',\n          icon: SettingsIcon,\n        },\n        {\n          id: 'starred',\n          label: 'Starred',\n          icon: StarIcon,\n        },\n      ],\n    },\n    {\n      name: orgName ?? 'Company',\n      items: [\n        {\n          id: 'all',\n          label: 'All',\n        },\n      ],\n    },\n  ];\n}\n\n/** @public */\nexport type UserListPickerProps = {\n  initialFilter?: UserListFilterKind;\n  availableFilters?: UserListFilterKind[];\n};\n\n/** @public */\nexport const UserListPicker = (props: UserListPickerProps) => {\n  const { initialFilter, availableFilters } = props;\n  const classes = useStyles();\n  const configApi = useApi(configApiRef);\n  const orgName = configApi.getOptionalString('organization.name') ?? 'Company';\n  const {\n    filters,\n    updateFilters,\n    backendEntities,\n    queryParameters: { kind: kindParameter, user: userParameter },\n    loading: loadingBackendEntities,\n  } = useEntityList();\n\n  // Remove group items that aren't in availableFilters and exclude\n  // any now-empty groups.\n  const userAndGroupFilterIds = ['starred', 'all'];\n  const filterGroups = getFilterGroups(orgName)\n    .map(filterGroup => ({\n      ...filterGroup,\n      items: filterGroup.items.filter(({ id }) =>\n        // TODO: avoid hardcoding kinds here\n        ['group', 'user'].some(kind => kind === kindParameter)\n          ? userAndGroupFilterIds.includes(id)\n          : !availableFilters || availableFilters.includes(id),\n      ),\n    }))\n    .filter(({ items }) => !!items.length);\n\n  const { isStarredEntity } = useStarredEntities();\n  const { isOwnedEntity, loading: loadingEntityOwnership } =\n    useEntityOwnership();\n\n  const loading = loadingBackendEntities || loadingEntityOwnership;\n\n  // Static filters; used for generating counts of potentially unselected kinds\n  const ownedFilter = useMemo(\n    () => new UserListFilter('owned', isOwnedEntity, isStarredEntity),\n    [isOwnedEntity, isStarredEntity],\n  );\n  const starredFilter = useMemo(\n    () => new UserListFilter('starred', isOwnedEntity, isStarredEntity),\n    [isOwnedEntity, isStarredEntity],\n  );\n\n  const queryParamUserFilter = useMemo(\n    () => [userParameter].flat()[0],\n    [userParameter],\n  );\n\n  const [selectedUserFilter, setSelectedUserFilter] = useState(\n    queryParamUserFilter ?? initialFilter,\n  );\n\n  // To show proper counts for each section, apply all other frontend filters _except_ the user\n  // filter that's controlled by this picker.\n  const entitiesWithoutUserFilter = useMemo(\n    () =>\n      backendEntities.filter(\n        reduceEntityFilters(\n          compact(Object.values({ ...filters, user: undefined })),\n        ),\n      ),\n    [filters, backendEntities],\n  );\n\n  const filterCounts = useMemo<Record<string, number>>(\n    () => ({\n      all: entitiesWithoutUserFilter.length,\n      starred: entitiesWithoutUserFilter.filter(entity =>\n        starredFilter.filterEntity(entity),\n      ).length,\n      owned: entitiesWithoutUserFilter.filter(entity =>\n        ownedFilter.filterEntity(entity),\n      ).length,\n    }),\n    [entitiesWithoutUserFilter, starredFilter, ownedFilter],\n  );\n\n  // Set selected user filter on query parameter updates; this happens at initial page load and from\n  // external updates to the page location.\n  useEffect(() => {\n    if (queryParamUserFilter) {\n      setSelectedUserFilter(queryParamUserFilter as UserListFilterKind);\n    }\n  }, [queryParamUserFilter]);\n\n  useEffect(() => {\n    if (\n      !loading &&\n      !!selectedUserFilter &&\n      selectedUserFilter !== 'all' &&\n      filterCounts[selectedUserFilter] === 0\n    ) {\n      setSelectedUserFilter('all');\n    }\n  }, [loading, filterCounts, selectedUserFilter, setSelectedUserFilter]);\n\n  useEffect(() => {\n    updateFilters({\n      user: selectedUserFilter\n        ? new UserListFilter(\n            selectedUserFilter as UserListFilterKind,\n            isOwnedEntity,\n            isStarredEntity,\n          )\n        : undefined,\n    });\n  }, [selectedUserFilter, isOwnedEntity, isStarredEntity, updateFilters]);\n\n  return (\n    <Card className={classes.root}>\n      {filterGroups.map(group => (\n        <Fragment key={group.name}>\n          <Typography\n            variant=\"subtitle2\"\n            component=\"span\"\n            className={classes.title}\n          >\n            {group.name}\n          </Typography>\n          <Card className={classes.groupWrapper}>\n            <List disablePadding dense role=\"menu\" aria-label={group.name}>\n              {group.items.map(item => (\n                <MenuItem\n                  role=\"none presentation\"\n                  key={item.id}\n                  button\n                  divider\n                  onClick={() => setSelectedUserFilter(item.id)}\n                  selected={item.id === filters.user?.value}\n                  className={classes.menuItem}\n                  disabled={filterCounts[item.id] === 0}\n                  data-testid={`user-picker-${item.id}`}\n                  tabIndex={0}\n                  ContainerProps={{ role: 'menuitem' }}\n                >\n                  {item.icon && (\n                    <ListItemIcon className={classes.listIcon}>\n                      <item.icon fontSize=\"small\" />\n                    </ListItemIcon>\n                  )}\n                  <ListItemText>\n                    <Typography variant=\"body1\">{item.label} </Typography>\n                  </ListItemText>\n                  <ListItemSecondaryAction>\n                    {filterCounts[item.id] ?? '-'}\n                  </ListItemSecondaryAction>\n                </MenuItem>\n              ))}\n            </List>\n          </Card>\n        </Fragment>\n      ))}\n    </Card>\n  );\n};\n","/*\n * Copyright 2022 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { EntityErrorFilter, EntityOrphanFilter } from '../../filters';\nimport {\n  Box,\n  Checkbox,\n  FormControlLabel,\n  makeStyles,\n  TextField,\n  Typography,\n} from '@material-ui/core';\nimport CheckBoxIcon from '@material-ui/icons/CheckBox';\nimport CheckBoxOutlineBlankIcon from '@material-ui/icons/CheckBoxOutlineBlank';\nimport ExpandMoreIcon from '@material-ui/icons/ExpandMore';\nimport React, { useState } from 'react';\nimport { useEntityList } from '../../hooks';\nimport { Autocomplete } from '@material-ui/lab';\n\n/** @public */\nexport type CatalogReactEntityProcessingStatusPickerClassKey = 'input';\n\nconst useStyles = makeStyles(\n  {\n    input: {},\n  },\n  {\n    name: 'CatalogReactEntityProcessingStatusPickerPicker',\n  },\n);\n\nconst icon = <CheckBoxOutlineBlankIcon fontSize=\"small\" />;\nconst checkedIcon = <CheckBoxIcon fontSize=\"small\" />;\n\n/** @public */\nexport const EntityProcessingStatusPicker = () => {\n  const classes = useStyles();\n  const { updateFilters } = useEntityList();\n\n  const [selectedAdvancedItems, setSelectedAdvancedItems] = useState<string[]>(\n    [],\n  );\n\n  function orphanChange(value: boolean) {\n    updateFilters({\n      orphan: value ? new EntityOrphanFilter(value) : undefined,\n    });\n  }\n\n  function errorChange(value: boolean) {\n    updateFilters({\n      error: value ? new EntityErrorFilter(value) : undefined,\n    });\n  }\n\n  const availableAdvancedItems = ['Is Orphan', 'Has Error'];\n\n  return (\n    <Box pb={1} pt={1}>\n      <Typography variant=\"button\" component=\"label\">\n        Processing Status\n        <Autocomplete\n          multiple\n          options={availableAdvancedItems}\n          value={selectedAdvancedItems}\n          onChange={(_: object, value: string[]) => {\n            setSelectedAdvancedItems(value);\n            orphanChange(value.includes('Is Orphan'));\n            errorChange(value.includes('Has Error'));\n          }}\n          renderOption={(option, { selected }) => (\n            <FormControlLabel\n              control={\n                <Checkbox\n                  icon={icon}\n                  checkedIcon={checkedIcon}\n                  checked={selected}\n                />\n              }\n              label={option}\n            />\n          )}\n          size=\"small\"\n          popupIcon={\n            <ExpandMoreIcon data-testid=\"processing-status-picker-expand\" />\n          }\n          renderInput={params => (\n            <TextField\n              {...params}\n              className={classes.input}\n              variant=\"outlined\"\n            />\n          )}\n        />\n      </Typography>\n    </Box>\n  );\n};\n","/*\n * Copyright 2021 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React, {\n  PropsWithChildren,\n  useCallback,\n  useMemo,\n  useState,\n} from 'react';\nimport {\n  DefaultEntityFilters,\n  EntityListContext,\n  EntityListContextProps,\n} from '../hooks/useEntityListProvider';\n\n/** @public */\nexport const MockEntityListContextProvider = ({\n  children,\n  value,\n}: PropsWithChildren<{\n  value?: Partial<EntityListContextProps>;\n}>) => {\n  // Provides a default implementation that stores filter state, for testing components that\n  // reflect filter state.\n  const [filters, setFilters] = useState<DefaultEntityFilters>(\n    value?.filters ?? {},\n  );\n\n  const updateFilters = useCallback(\n    (\n      update:\n        | Partial<DefaultEntityFilters>\n        | ((\n            prevFilters: DefaultEntityFilters,\n          ) => Partial<DefaultEntityFilters>),\n    ) => {\n      setFilters(prevFilters => {\n        const newFilters =\n          typeof update === 'function' ? update(prevFilters) : update;\n        return { ...prevFilters, ...newFilters };\n      });\n    },\n    [],\n  );\n\n  // Memoize the default values since pickers have useEffect triggers on these; naively defaulting\n  // below with `?? <X>` breaks referential equality on subsequent updates.\n  const defaultValues = useMemo(\n    () => ({\n      entities: [],\n      backendEntities: [],\n      queryParameters: {},\n    }),\n    [],\n  );\n\n  const resolvedValue: EntityListContextProps = useMemo(\n    () => ({\n      entities: value?.entities ?? defaultValues.entities,\n      backendEntities: value?.backendEntities ?? defaultValues.backendEntities,\n      updateFilters: value?.updateFilters ?? updateFilters,\n      filters,\n      loading: value?.loading ?? false,\n      queryParameters: value?.queryParameters ?? defaultValues.queryParameters,\n      error: value?.error,\n    }),\n    [value, defaultValues, filters, updateFilters],\n  );\n\n  return (\n    <EntityListContext.Provider value={resolvedValue}>\n      {children}\n    </EntityListContext.Provider>\n  );\n};\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { useElementFilter } from '@backstage/core-plugin-api';\nimport { Grid, makeStyles, Typography } from '@material-ui/core';\nimport React from 'react';\n\nconst useStyles = makeStyles(theme => ({\n  value: {\n    fontWeight: 'bold',\n    overflow: 'hidden',\n    lineHeight: '24px',\n    wordBreak: 'break-word',\n  },\n  label: {\n    color: theme.palette.text.secondary,\n    textTransform: 'uppercase',\n    fontSize: '10px',\n    fontWeight: 'bold',\n    letterSpacing: 0.5,\n    overflow: 'hidden',\n    whiteSpace: 'nowrap',\n  },\n}));\n\n/**\n * Props for {@link AboutField}.\n *\n * @public\n */\nexport interface AboutFieldProps {\n  label: string;\n  value?: string;\n  gridSizes?: Record<string, number>;\n  children?: React.ReactNode;\n}\n\n/** @public */\nexport function AboutField(props: AboutFieldProps) {\n  const { label, value, gridSizes, children } = props;\n  const classes = useStyles();\n\n  const childElements = useElementFilter(children, c => c.getElements());\n\n  // Content is either children or a string prop `value`\n  const content =\n    childElements.length > 0 ? (\n      childElements\n    ) : (\n      <Typography variant=\"body2\" className={classes.value}>\n        {value || `unknown`}\n      </Typography>\n    );\n  return (\n    <Grid item {...gridSizes}>\n      <Typography variant=\"h2\" className={classes.label}>\n        {label}\n      </Typography>\n      {content}\n    </Grid>\n  );\n}\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  Entity,\n  getEntitySourceLocation,\n  RELATION_OWNED_BY,\n  RELATION_PART_OF,\n} from '@backstage/catalog-model';\nimport {\n  EntityRefLinks,\n  getEntityRelations,\n} from '@backstage/plugin-catalog-react';\nimport { JsonArray } from '@backstage/types';\nimport { Chip, Grid, makeStyles, Typography } from '@material-ui/core';\nimport React from 'react';\nimport { AboutField } from './AboutField';\nimport { LinksGridList } from '../EntityLinksCard/LinksGridList';\n\nconst useStyles = makeStyles({\n  description: {\n    wordBreak: 'break-word',\n  },\n});\n\n/**\n * Props for {@link AboutContent}.\n *\n * @public\n */\nexport interface AboutContentProps {\n  entity: Entity;\n}\n\nfunction getLocationTargetHref(\n  target: string,\n  type: string,\n  entitySourceLocation: {\n    type: string;\n    target: string;\n  },\n): string {\n  if (type === 'url' || target.includes('://')) {\n    return target;\n  }\n\n  const srcLocationUrl =\n    entitySourceLocation.type === 'file'\n      ? `file://${entitySourceLocation.target}`\n      : entitySourceLocation.target;\n\n  if (type === 'file' || entitySourceLocation.type === 'file') {\n    return new URL(target, srcLocationUrl).href;\n  }\n\n  return srcLocationUrl;\n}\n\n/** @public */\nexport function AboutContent(props: AboutContentProps) {\n  const { entity } = props;\n  const classes = useStyles();\n  const isSystem = entity.kind.toLocaleLowerCase('en-US') === 'system';\n  const isResource = entity.kind.toLocaleLowerCase('en-US') === 'resource';\n  const isComponent = entity.kind.toLocaleLowerCase('en-US') === 'component';\n  const isAPI = entity.kind.toLocaleLowerCase('en-US') === 'api';\n  const isTemplate = entity.kind.toLocaleLowerCase('en-US') === 'template';\n  const isLocation = entity.kind.toLocaleLowerCase('en-US') === 'location';\n  const isGroup = entity.kind.toLocaleLowerCase('en-US') === 'group';\n\n  const partOfSystemRelations = getEntityRelations(entity, RELATION_PART_OF, {\n    kind: 'system',\n  });\n  const partOfComponentRelations = getEntityRelations(\n    entity,\n    RELATION_PART_OF,\n    {\n      kind: 'component',\n    },\n  );\n  const partOfDomainRelations = getEntityRelations(entity, RELATION_PART_OF, {\n    kind: 'domain',\n  });\n  const ownedByRelations = getEntityRelations(entity, RELATION_OWNED_BY);\n\n  let entitySourceLocation:\n    | {\n        type: string;\n        target: string;\n      }\n    | undefined;\n  try {\n    entitySourceLocation = getEntitySourceLocation(entity);\n  } catch (e) {\n    entitySourceLocation = undefined;\n  }\n\n  return (\n    <Grid container>\n      <AboutField label=\"Description\" gridSizes={{ xs: 12 }}>\n        <Typography variant=\"body2\" paragraph className={classes.description}>\n          {entity?.metadata?.description || 'No description'}\n        </Typography>\n      </AboutField>\n      <AboutField\n        label=\"Owner\"\n        value=\"No Owner\"\n        gridSizes={{ xs: 12, sm: 6, lg: 4 }}\n      >\n        {ownedByRelations.length > 0 && (\n          <EntityRefLinks entityRefs={ownedByRelations} defaultKind=\"group\" />\n        )}\n      </AboutField>\n      {(isSystem || partOfDomainRelations.length > 0) && (\n        <AboutField\n          label=\"Domain\"\n          value=\"No Domain\"\n          gridSizes={{ xs: 12, sm: 6, lg: 4 }}\n        >\n          {partOfDomainRelations.length > 0 && (\n            <EntityRefLinks\n              entityRefs={partOfDomainRelations}\n              defaultKind=\"domain\"\n            />\n          )}\n        </AboutField>\n      )}\n      {(isAPI ||\n        isComponent ||\n        isResource ||\n        partOfSystemRelations.length > 0) && (\n        <AboutField\n          label=\"System\"\n          value=\"No System\"\n          gridSizes={{ xs: 12, sm: 6, lg: 4 }}\n        >\n          {partOfSystemRelations.length > 0 && (\n            <EntityRefLinks\n              entityRefs={partOfSystemRelations}\n              defaultKind=\"system\"\n            />\n          )}\n        </AboutField>\n      )}\n      {isComponent && partOfComponentRelations.length > 0 && (\n        <AboutField\n          label=\"Parent Component\"\n          value=\"No Parent Component\"\n          gridSizes={{ xs: 12, sm: 6, lg: 4 }}\n        >\n          <EntityRefLinks\n            entityRefs={partOfComponentRelations}\n            defaultKind=\"component\"\n          />\n        </AboutField>\n      )}\n      {(isAPI ||\n        isComponent ||\n        isResource ||\n        isTemplate ||\n        isGroup ||\n        isLocation ||\n        typeof entity?.spec?.type === 'string') && (\n        <AboutField\n          label=\"Type\"\n          value={entity?.spec?.type as string}\n          gridSizes={{ xs: 12, sm: 6, lg: 4 }}\n        />\n      )}\n      {(isAPI ||\n        isComponent ||\n        typeof entity?.spec?.lifecycle === 'string') && (\n        <AboutField\n          label=\"Lifecycle\"\n          value={entity?.spec?.lifecycle as string}\n          gridSizes={{ xs: 12, sm: 6, lg: 4 }}\n        />\n      )}\n      <AboutField\n        label=\"Tags\"\n        value=\"No Tags\"\n        gridSizes={{ xs: 12, sm: 6, lg: 4 }}\n      >\n        {(entity?.metadata?.tags || []).map(t => (\n          <Chip key={t} size=\"small\" label={t} />\n        ))}\n      </AboutField>\n      {isLocation && (entity?.spec?.targets || entity?.spec?.target) && (\n        <AboutField label=\"Targets\" gridSizes={{ xs: 12 }}>\n          <LinksGridList\n            cols={1}\n            items={((entity.spec.targets as JsonArray) || [entity.spec.target])\n              .map(target => target as string)\n              .map(target => ({\n                text: target,\n                href: getLocationTargetHref(\n                  target,\n                  (entity?.spec?.type || 'unknown') as string,\n                  entitySourceLocation!,\n                ),\n              }))}\n          />\n        </AboutField>\n      )}\n    </Grid>\n  );\n}\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  ANNOTATION_EDIT_URL,\n  ANNOTATION_LOCATION,\n  DEFAULT_NAMESPACE,\n  stringifyEntityRef,\n} from '@backstage/catalog-model';\nimport {\n  HeaderIconLinkRow,\n  IconLinkVerticalProps,\n  InfoCardVariants,\n  Link,\n} from '@backstage/core-components';\nimport { alertApiRef, useApi, useRouteRef } from '@backstage/core-plugin-api';\nimport {\n  ScmIntegrationIcon,\n  scmIntegrationsApiRef,\n} from '@backstage/integration-react';\nimport {\n  catalogApiRef,\n  getEntitySourceLocation,\n  useEntity,\n} from '@backstage/plugin-catalog-react';\nimport {\n  Card,\n  CardContent,\n  CardHeader,\n  Divider,\n  IconButton,\n  makeStyles,\n} from '@material-ui/core';\nimport CachedIcon from '@material-ui/icons/Cached';\nimport DocsIcon from '@material-ui/icons/Description';\nimport EditIcon from '@material-ui/icons/Edit';\nimport React, { useCallback } from 'react';\nimport { viewTechDocRouteRef } from '../../routes';\nimport { AboutContent } from './AboutContent';\n\nconst useStyles = makeStyles({\n  gridItemCard: {\n    display: 'flex',\n    flexDirection: 'column',\n    height: 'calc(100% - 10px)', // for pages without content header\n    marginBottom: '10px',\n  },\n  fullHeightCard: {\n    display: 'flex',\n    flexDirection: 'column',\n    height: '100%',\n  },\n  gridItemCardContent: {\n    flex: 1,\n  },\n  fullHeightCardContent: {\n    flex: 1,\n  },\n});\n\n/**\n * Props for {@link EntityAboutCard}.\n *\n * @public\n */\nexport interface AboutCardProps {\n  variant?: InfoCardVariants;\n}\n\n/**\n * Exported publicly via the EntityAboutCard\n */\nexport function AboutCard(props: AboutCardProps) {\n  const { variant } = props;\n  const classes = useStyles();\n  const { entity } = useEntity();\n  const scmIntegrationsApi = useApi(scmIntegrationsApiRef);\n  const catalogApi = useApi(catalogApiRef);\n  const alertApi = useApi(alertApiRef);\n  const viewTechdocLink = useRouteRef(viewTechDocRouteRef);\n\n  const entitySourceLocation = getEntitySourceLocation(\n    entity,\n    scmIntegrationsApi,\n  );\n  const entityMetadataEditUrl =\n    entity.metadata.annotations?.[ANNOTATION_EDIT_URL];\n\n  const viewInSource: IconLinkVerticalProps = {\n    label: 'View Source',\n    disabled: !entitySourceLocation,\n    icon: <ScmIntegrationIcon type={entitySourceLocation?.integrationType} />,\n    href: entitySourceLocation?.locationTargetUrl,\n  };\n  const viewInTechDocs: IconLinkVerticalProps = {\n    label: 'View TechDocs',\n    disabled:\n      !entity.metadata.annotations?.['backstage.io/techdocs-ref'] ||\n      !viewTechdocLink,\n    icon: <DocsIcon />,\n    href:\n      viewTechdocLink &&\n      viewTechdocLink({\n        namespace: entity.metadata.namespace || DEFAULT_NAMESPACE,\n        kind: entity.kind,\n        name: entity.metadata.name,\n      }),\n  };\n\n  let cardClass = '';\n  if (variant === 'gridItem') {\n    cardClass = classes.gridItemCard;\n  } else if (variant === 'fullHeight') {\n    cardClass = classes.fullHeightCard;\n  }\n\n  let cardContentClass = '';\n  if (variant === 'gridItem') {\n    cardContentClass = classes.gridItemCardContent;\n  } else if (variant === 'fullHeight') {\n    cardContentClass = classes.fullHeightCardContent;\n  }\n\n  const entityLocation = entity.metadata.annotations?.[ANNOTATION_LOCATION];\n  // Limiting the ability to manually refresh to the less expensive locations\n  const allowRefresh =\n    entityLocation?.startsWith('url:') || entityLocation?.startsWith('file:');\n  const refreshEntity = useCallback(async () => {\n    await catalogApi.refreshEntity(stringifyEntityRef(entity));\n    alertApi.post({ message: 'Refresh scheduled', severity: 'info' });\n  }, [catalogApi, alertApi, entity]);\n\n  return (\n    <Card className={cardClass}>\n      <CardHeader\n        title=\"About\"\n        action={\n          <>\n            {allowRefresh && (\n              <IconButton\n                aria-label=\"Refresh\"\n                title=\"Schedule entity refresh\"\n                onClick={refreshEntity}\n              >\n                <CachedIcon />\n              </IconButton>\n            )}\n            <IconButton\n              component={Link}\n              aria-label=\"Edit\"\n              disabled={!entityMetadataEditUrl}\n              title=\"Edit Metadata\"\n              to={entityMetadataEditUrl ?? '#'}\n            >\n              <EditIcon />\n            </IconButton>\n          </>\n        }\n        subheader={<HeaderIconLinkRow links={[viewInSource, viewInTechDocs]} />}\n      />\n      <Divider />\n      <CardContent className={cardContentClass}>\n        <AboutContent entity={entity} />\n      </CardContent>\n    </Card>\n  );\n}\n","/*\n * Copyright 2021 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React, { useEffect, useState, useMemo } from 'react';\nimport {\n  capitalize,\n  createStyles,\n  InputBase,\n  makeStyles,\n  MenuItem,\n  Select,\n  Theme,\n} from '@material-ui/core';\nimport {\n  catalogApiRef,\n  EntityKindFilter,\n  useEntityList,\n} from '@backstage/plugin-catalog-react';\nimport useAsync from 'react-use/lib/useAsync';\nimport { useApi } from '@backstage/core-plugin-api';\n\nconst useStyles = makeStyles((theme: Theme) =>\n  createStyles({\n    root: {\n      ...theme.typography.h4,\n    },\n  }),\n);\n\n/**\n * Props for {@link CatalogKindHeader}.\n *\n * @public\n */\nexport interface CatalogKindHeaderProps {\n  /**\n   * Entity kinds to show in the dropdown; by default all kinds are fetched from the catalog and\n   * displayed.\n   */\n  allowedKinds?: string[];\n  /**\n   * The initial kind to select; defaults to 'component'. A kind filter entered directly in the\n   * query parameter will override this value.\n   */\n  initialFilter?: string;\n}\n\n/** @public */\nexport function CatalogKindHeader(props: CatalogKindHeaderProps) {\n  const { initialFilter = 'component', allowedKinds } = props;\n  const classes = useStyles();\n  const catalogApi = useApi(catalogApiRef);\n  const { value: allKinds } = useAsync(async () => {\n    return await catalogApi\n      .getEntityFacets({ facets: ['kind'] })\n      .then(response => response.facets.kind?.map(f => f.value).sort() || []);\n  });\n  const {\n    filters,\n    updateFilters,\n    queryParameters: { kind: kindParameter },\n  } = useEntityList();\n\n  const queryParamKind = useMemo(\n    () => [kindParameter].flat()[0]?.toLocaleLowerCase('en-US'),\n    [kindParameter],\n  );\n  const [selectedKind, setSelectedKind] = useState(\n    queryParamKind ?? initialFilter,\n  );\n\n  // Set selected kind from filters; this happens when the kind filter is\n  // updated from another component\n  useEffect(() => {\n    if (filters.kind?.value) {\n      setSelectedKind(filters.kind?.value);\n    }\n  }, [filters.kind]);\n\n  useEffect(() => {\n    updateFilters({\n      kind: selectedKind ? new EntityKindFilter(selectedKind) : undefined,\n    });\n  }, [selectedKind, updateFilters]);\n\n  // Set selected Kind on query parameter updates; this happens at initial page load and from\n  // external updates to the page location.\n  useEffect(() => {\n    if (queryParamKind) {\n      setSelectedKind(queryParamKind);\n    }\n  }, [queryParamKind]);\n\n  // Before allKinds is loaded, or when a kind is entered manually in the URL, selectedKind may not\n  // be present in allKinds. It should still be shown in the dropdown, but may not have the nice\n  // enforced casing from the catalog-backend. This makes a key/value record for the Select options,\n  // including selectedKind if it's unknown - but allows the selectedKind to get clobbered by the\n  // more proper catalog kind if it exists.\n  const availableKinds = [capitalize(selectedKind)].concat(\n    allKinds?.filter(k =>\n      allowedKinds\n        ? allowedKinds.some(\n            a => a.toLocaleLowerCase('en-US') === k.toLocaleLowerCase('en-US'),\n          )\n        : true,\n    ) ?? [],\n  );\n  const options = availableKinds.sort().reduce((acc, kind) => {\n    acc[kind.toLocaleLowerCase('en-US')] = kind;\n    return acc;\n  }, {} as Record<string, string>);\n\n  return (\n    <Select\n      input={<InputBase value={selectedKind} />}\n      value={selectedKind}\n      onChange={e => setSelectedKind(e.target.value as string)}\n      classes={classes}\n    >\n      {Object.keys(options).map(kind => (\n        <MenuItem value={kind} key={kind}>\n          {`${options[kind]}s`}\n        </MenuItem>\n      ))}\n    </Select>\n  );\n}\n","/*\n * Copyright 2021 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport React from 'react';\nimport {\n  humanizeEntityRef,\n  EntityRefLink,\n  EntityRefLinks,\n} from '@backstage/plugin-catalog-react';\nimport { Chip } from '@material-ui/core';\nimport { CatalogTableRow } from './types';\nimport { OverflowTooltip, TableColumn } from '@backstage/core-components';\nimport { Entity } from '@backstage/catalog-model';\nimport { JsonArray } from '@backstage/types';\n\n// The columnFactories symbol is not directly exported, but through the\n// CatalogTable.columns field.\n/** @public */\nexport const columnFactories = Object.freeze({\n  createNameColumn(options?: {\n    defaultKind?: string;\n  }): TableColumn<CatalogTableRow> {\n    function formatContent(entity: Entity): string {\n      return (\n        entity.metadata?.title ||\n        humanizeEntityRef(entity, {\n          defaultKind: options?.defaultKind,\n        })\n      );\n    }\n\n    return {\n      title: 'Name',\n      field: 'resolved.name',\n      highlight: true,\n      customSort({ entity: entity1 }, { entity: entity2 }) {\n        // TODO: We could implement this more efficiently by comparing field by field.\n        // This has similar issues as above.\n        return formatContent(entity1).localeCompare(formatContent(entity2));\n      },\n      render: ({ entity }) => (\n        <EntityRefLink\n          entityRef={entity}\n          defaultKind={options?.defaultKind || 'Component'}\n          title={entity.metadata?.title}\n        />\n      ),\n    };\n  },\n  createSystemColumn(): TableColumn<CatalogTableRow> {\n    return {\n      title: 'System',\n      field: 'resolved.partOfSystemRelationTitle',\n      render: ({ resolved }) => (\n        <EntityRefLinks\n          entityRefs={resolved.partOfSystemRelations}\n          defaultKind=\"system\"\n        />\n      ),\n    };\n  },\n  createOwnerColumn(): TableColumn<CatalogTableRow> {\n    return {\n      title: 'Owner',\n      field: 'resolved.ownedByRelationsTitle',\n      render: ({ resolved }) => (\n        <EntityRefLinks\n          entityRefs={resolved.ownedByRelations}\n          defaultKind=\"group\"\n        />\n      ),\n    };\n  },\n  createSpecTargetsColumn(): TableColumn<CatalogTableRow> {\n    return {\n      title: 'Targets',\n      field: 'entity.spec.targets',\n      render: ({ entity }) => (\n        <>\n          {(entity?.spec?.targets || entity?.spec?.target) && (\n            <OverflowTooltip\n              text={(\n                (entity!.spec!.targets as JsonArray) || [entity.spec.target]\n              ).join(', ')}\n              placement=\"bottom-start\"\n            />\n          )}\n        </>\n      ),\n    };\n  },\n  createSpecTypeColumn(): TableColumn<CatalogTableRow> {\n    return {\n      title: 'Type',\n      field: 'entity.spec.type',\n      hidden: true,\n      width: 'auto',\n    };\n  },\n  createSpecLifecycleColumn(): TableColumn<CatalogTableRow> {\n    return {\n      title: 'Lifecycle',\n      field: 'entity.spec.lifecycle',\n    };\n  },\n  createMetadataDescriptionColumn(): TableColumn<CatalogTableRow> {\n    return {\n      title: 'Description',\n      field: 'entity.metadata.description',\n      render: ({ entity }) => (\n        <OverflowTooltip\n          text={entity.metadata.description}\n          placement=\"bottom-start\"\n        />\n      ),\n      width: 'auto',\n    };\n  },\n  createTagsColumn(): TableColumn<CatalogTableRow> {\n    return {\n      title: 'Tags',\n      field: 'entity.metadata.tags',\n      cellStyle: {\n        padding: '0px 16px 0px 20px',\n      },\n      render: ({ entity }) => (\n        <>\n          {entity.metadata.tags &&\n            entity.metadata.tags.map(t => (\n              <Chip\n                key={t}\n                label={t}\n                size=\"small\"\n                variant=\"outlined\"\n                style={{ marginBottom: '0px' }}\n              />\n            ))}\n        </>\n      ),\n      width: 'auto',\n    };\n  },\n  createTitleColumn(options?: {\n    hidden?: boolean;\n  }): TableColumn<CatalogTableRow> {\n    return {\n      title: 'Title',\n      field: 'entity.metadata.title',\n      hidden: options?.hidden,\n      searchable: true,\n    };\n  },\n  createLabelColumn(\n    key: string,\n    options?: { title?: string; defaultValue?: string },\n  ): TableColumn<CatalogTableRow> {\n    return {\n      title: options?.title || 'Label',\n      field: 'entity.metadata.labels',\n      cellStyle: {\n        padding: '0px 16px 0px 20px',\n      },\n      render: ({ entity }: { entity: Entity }) => {\n        const labels: Record<string, string> | undefined =\n          entity.metadata?.labels;\n        const specifiedLabelValue =\n          (labels && labels[key]) || options?.defaultValue;\n        return (\n          <>\n            {specifiedLabelValue && (\n              <Chip\n                key={specifiedLabelValue}\n                label={specifiedLabelValue}\n                size=\"small\"\n                variant=\"outlined\"\n              />\n            )}\n          </>\n        );\n      },\n      width: 'auto',\n    };\n  },\n});\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport {\n  ANNOTATION_EDIT_URL,\n  ANNOTATION_VIEW_URL,\n  RELATION_OWNED_BY,\n  RELATION_PART_OF,\n} from '@backstage/catalog-model';\nimport {\n  CodeSnippet,\n  Table,\n  TableColumn,\n  TableProps,\n  WarningPanel,\n} from '@backstage/core-components';\nimport {\n  getEntityRelations,\n  humanizeEntityRef,\n  useEntityList,\n  useStarredEntities,\n} from '@backstage/plugin-catalog-react';\nimport { Typography } from '@material-ui/core';\nimport { withStyles } from '@material-ui/core/styles';\nimport Edit from '@material-ui/icons/Edit';\nimport OpenInNew from '@material-ui/icons/OpenInNew';\nimport Star from '@material-ui/icons/Star';\nimport StarBorder from '@material-ui/icons/StarBorder';\nimport { capitalize } from 'lodash';\nimport React, { ReactNode, useMemo } from 'react';\nimport { columnFactories } from './columns';\nimport { CatalogTableRow } from './types';\n\n/**\n * Props for {@link CatalogTable}.\n *\n * @public\n */\nexport interface CatalogTableProps {\n  columns?: TableColumn<CatalogTableRow>[];\n  actions?: TableProps<CatalogTableRow>['actions'];\n  tableOptions?: TableProps<CatalogTableRow>['options'];\n  emptyContent?: ReactNode;\n  subtitle?: string;\n}\n\nconst YellowStar = withStyles({\n  root: {\n    color: '#f3ba37',\n  },\n})(Star);\n\n/** @public */\nexport const CatalogTable = (props: CatalogTableProps) => {\n  const { columns, actions, tableOptions, subtitle, emptyContent } = props;\n  const { isStarredEntity, toggleStarredEntity } = useStarredEntities();\n  const { loading, error, entities, filters } = useEntityList();\n\n  const defaultColumns: TableColumn<CatalogTableRow>[] = useMemo(() => {\n    return [\n      columnFactories.createTitleColumn({ hidden: true }),\n      columnFactories.createNameColumn({ defaultKind: filters.kind?.value }),\n      ...createEntitySpecificColumns(),\n      columnFactories.createMetadataDescriptionColumn(),\n      columnFactories.createTagsColumn(),\n    ];\n\n    function createEntitySpecificColumns(): TableColumn<CatalogTableRow>[] {\n      switch (filters.kind?.value) {\n        case 'user':\n          return [];\n        case 'domain':\n        case 'system':\n          return [columnFactories.createOwnerColumn()];\n        case 'group':\n        case 'template':\n          return [columnFactories.createSpecTypeColumn()];\n        case 'location':\n          return [\n            columnFactories.createSpecTypeColumn(),\n            columnFactories.createSpecTargetsColumn(),\n          ];\n        default:\n          return [\n            columnFactories.createSystemColumn(),\n            columnFactories.createOwnerColumn(),\n            columnFactories.createSpecTypeColumn(),\n            columnFactories.createSpecLifecycleColumn(),\n          ];\n      }\n    }\n  }, [filters.kind?.value]);\n\n  const showTypeColumn = filters.type === undefined;\n  // TODO(timbonicus): remove the title from the CatalogTable once using EntitySearchBar\n  const titlePreamble = capitalize(filters.user?.value ?? 'all');\n\n  if (error) {\n    return (\n      <div>\n        <WarningPanel\n          severity=\"error\"\n          title=\"Could not fetch catalog entities.\"\n        >\n          <CodeSnippet language=\"text\" text={error.toString()} />\n        </WarningPanel>\n      </div>\n    );\n  }\n\n  const defaultActions: TableProps<CatalogTableRow>['actions'] = [\n    ({ entity }) => {\n      const url = entity.metadata.annotations?.[ANNOTATION_VIEW_URL];\n      const title = 'View';\n\n      return {\n        icon: () => (\n          <>\n            <Typography variant=\"srOnly\">{title}</Typography>\n            <OpenInNew fontSize=\"small\" />\n          </>\n        ),\n        tooltip: title,\n        disabled: !url,\n        onClick: () => {\n          if (!url) return;\n          window.open(url, '_blank');\n        },\n      };\n    },\n    ({ entity }) => {\n      const url = entity.metadata.annotations?.[ANNOTATION_EDIT_URL];\n      const title = 'Edit';\n\n      return {\n        icon: () => (\n          <>\n            <Typography variant=\"srOnly\">{title}</Typography>\n            <Edit fontSize=\"small\" />\n          </>\n        ),\n        tooltip: title,\n        disabled: !url,\n        onClick: () => {\n          if (!url) return;\n          window.open(url, '_blank');\n        },\n      };\n    },\n    ({ entity }) => {\n      const isStarred = isStarredEntity(entity);\n      const title = isStarred ? 'Remove from favorites' : 'Add to favorites';\n\n      return {\n        cellStyle: { paddingLeft: '1em' },\n        icon: () => (\n          <>\n            <Typography variant=\"srOnly\">{title}</Typography>\n            {isStarred ? <YellowStar /> : <StarBorder />}\n          </>\n        ),\n        tooltip: title,\n        onClick: () => toggleStarredEntity(entity),\n      };\n    },\n  ];\n\n  const rows = entities.map(entity => {\n    const partOfSystemRelations = getEntityRelations(entity, RELATION_PART_OF, {\n      kind: 'system',\n    });\n    const ownedByRelations = getEntityRelations(entity, RELATION_OWNED_BY);\n\n    return {\n      entity,\n      resolved: {\n        name: humanizeEntityRef(entity, {\n          defaultKind: 'Component',\n        }),\n        ownedByRelationsTitle: ownedByRelations\n          .map(r => humanizeEntityRef(r, { defaultKind: 'group' }))\n          .join(', '),\n        ownedByRelations,\n        partOfSystemRelationTitle: partOfSystemRelations\n          .map(r =>\n            humanizeEntityRef(r, {\n              defaultKind: 'system',\n            }),\n          )\n          .join(', '),\n        partOfSystemRelations,\n      },\n    };\n  });\n\n  const typeColumn = (columns || defaultColumns).find(c => c.title === 'Type');\n  if (typeColumn) {\n    typeColumn.hidden = !showTypeColumn;\n  }\n  const showPagination = rows.length > 20;\n\n  return (\n    <Table<CatalogTableRow>\n      isLoading={loading}\n      columns={columns || defaultColumns}\n      options={{\n        paging: showPagination,\n        pageSize: 20,\n        actionsColumnIndex: -1,\n        loadingType: 'linear',\n        showEmptyDataSourceMessage: !loading,\n        padding: 'dense',\n        pageSizeOptions: [20, 50, 100],\n        ...tableOptions,\n      }}\n      title={`${titlePreamble} (${entities.length})`}\n      data={rows}\n      actions={actions || defaultActions}\n      subtitle={subtitle}\n      emptyContent={emptyContent}\n    />\n  );\n};\n\nCatalogTable.columns = columnFactories;\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { makeStyles, Box, Typography } from '@material-ui/core';\nimport LanguageIcon from '@material-ui/icons/Language';\nimport React from 'react';\nimport { Link } from '@backstage/core-components';\nimport { IconComponent } from '@backstage/core-plugin-api';\n\nconst useStyles = makeStyles({\n  svgIcon: {\n    display: 'inline-block',\n    '& svg': {\n      display: 'inline-block',\n      fontSize: 'inherit',\n      verticalAlign: 'baseline',\n    },\n  },\n});\n\nexport function IconLink(props: {\n  href: string;\n  text?: string;\n  Icon?: IconComponent;\n}) {\n  const { href, text, Icon } = props;\n  const classes = useStyles();\n\n  return (\n    <Box display=\"flex\">\n      <Box mr={1} className={classes.svgIcon}>\n        <Typography component=\"div\">\n          {Icon ? <Icon /> : <LanguageIcon />}\n        </Typography>\n      </Box>\n      <Box flexGrow=\"1\">\n        <Link to={href} target=\"_blank\" rel=\"noopener\">\n          {text || href}\n        </Link>\n      </Box>\n    </Box>\n  );\n}\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { Theme, useMediaQuery } from '@material-ui/core';\nimport { Breakpoint, ColumnBreakpoints } from './types';\n\nconst colDefaults: ColumnBreakpoints = {\n  xs: 1,\n  sm: 1,\n  md: 1,\n  lg: 2,\n  xl: 3,\n};\n\nexport function useDynamicColumns(\n  cols: ColumnBreakpoints | number | undefined,\n): number {\n  const matches: (Breakpoint | null)[] = [\n    useMediaQuery((theme: Theme) => theme.breakpoints.up('xl')) ? 'xl' : null,\n    useMediaQuery((theme: Theme) => theme.breakpoints.up('lg')) ? 'lg' : null,\n    useMediaQuery((theme: Theme) => theme.breakpoints.up('md')) ? 'md' : null,\n    useMediaQuery((theme: Theme) => theme.breakpoints.up('sm')) ? 'sm' : null,\n    useMediaQuery((theme: Theme) => theme.breakpoints.up('xs')) ? 'xs' : null,\n  ];\n\n  let numOfCols = 1;\n\n  if (typeof cols === 'number') {\n    numOfCols = cols;\n  } else {\n    const breakpoint = matches.find(k => k !== null) ?? 'xs';\n    numOfCols = cols?.[breakpoint] ?? colDefaults[breakpoint];\n  }\n\n  return numOfCols;\n}\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { ImageList, ImageListItem } from '@material-ui/core';\nimport React from 'react';\nimport { IconLink } from './IconLink';\nimport { ColumnBreakpoints } from './types';\nimport { useDynamicColumns } from './useDynamicColumns';\nimport { IconComponent } from '@backstage/core-plugin-api';\n\nexport interface LinksGridListItem {\n  href: string;\n  text?: string;\n  Icon?: IconComponent;\n}\n\ninterface LinksGridListProps {\n  items: LinksGridListItem[];\n  cols?: ColumnBreakpoints | number;\n}\n\nexport function LinksGridList(props: LinksGridListProps) {\n  const { items, cols = undefined } = props;\n  const numOfCols = useDynamicColumns(cols);\n\n  return (\n    <ImageList rowHeight=\"auto\" cols={numOfCols}>\n      {items.map(({ text, href, Icon }, i) => (\n        <ImageListItem key={i}>\n          <IconLink href={href} text={text ?? href} Icon={Icon} />\n        </ImageListItem>\n      ))}\n    </ImageList>\n  );\n}\n","/*\n * Copyright 2021 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  createExternalRouteRef,\n  createRouteRef,\n} from '@backstage/core-plugin-api';\n\nexport const createComponentRouteRef = createExternalRouteRef({\n  id: 'create-component',\n  optional: true,\n});\n\nexport const viewTechDocRouteRef = createExternalRouteRef({\n  id: 'view-techdoc',\n  optional: true,\n  params: ['namespace', 'kind', 'name'],\n});\n\nexport const rootRouteRef = createRouteRef({\n  id: 'catalog',\n});\n","/*\n * Copyright 2021 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { JsonPrimitive } from '@backstage/types';\nimport { ResourcePermission } from '.';\nimport { Permission } from './permission';\n\n/**\n * A request with a UUID identifier, so that batched responses can be matched up with the original\n * requests.\n * @public\n */\nexport type IdentifiedPermissionMessage<T> = T & { id: string };\n\n/**\n * A batch of request or response items.\n * @public\n */\nexport type PermissionMessageBatch<T> = {\n  items: IdentifiedPermissionMessage<T>[];\n};\n\n/**\n * The result of an authorization request.\n * @public\n */\nexport enum AuthorizeResult {\n  /**\n   * The authorization request is denied.\n   */\n  DENY = 'DENY',\n  /**\n   * The authorization request is allowed.\n   */\n  ALLOW = 'ALLOW',\n  /**\n   * The authorization request is allowed if the provided conditions are met.\n   */\n  CONDITIONAL = 'CONDITIONAL',\n}\n\n/**\n * A definitive decision returned by the {@link @backstage/plugin-permission-node#PermissionPolicy}.\n *\n * @remarks\n *\n * This indicates that the policy unconditionally allows (or denies) the request.\n *\n * @public\n */\nexport type DefinitivePolicyDecision = {\n  result: AuthorizeResult.ALLOW | AuthorizeResult.DENY;\n};\n\n/**\n * A conditional decision returned by the {@link @backstage/plugin-permission-node#PermissionPolicy}.\n *\n * @remarks\n *\n * This indicates that the policy allows authorization for the request, given that the returned\n * conditions hold when evaluated. The conditions will be evaluated by the corresponding plugin\n * which knows about the referenced permission rules.\n *\n * @public\n */\nexport type ConditionalPolicyDecision = {\n  result: AuthorizeResult.CONDITIONAL;\n  pluginId: string;\n  resourceType: string;\n  conditions: PermissionCriteria<PermissionCondition>;\n};\n\n/**\n * A decision returned by the {@link @backstage/plugin-permission-node#PermissionPolicy}.\n *\n * @public\n */\nexport type PolicyDecision =\n  | DefinitivePolicyDecision\n  | ConditionalPolicyDecision;\n\n/**\n * A condition returned with a CONDITIONAL authorization response.\n *\n * Conditions are a reference to a rule defined by a plugin, and parameters to apply the rule. For\n * example, a rule might be `isOwner` from the catalog-backend, and params may be a list of entity\n * claims from a identity token.\n * @public\n */\nexport type PermissionCondition<\n  TResourceType extends string = string,\n  TParams extends PermissionRuleParams = PermissionRuleParams,\n> = {\n  resourceType: TResourceType;\n  rule: string;\n  params?: TParams;\n};\n\n/**\n * Utility type to represent an array with 1 or more elements.\n * @ignore\n */\ntype NonEmptyArray<T> = [T, ...T[]];\n\n/**\n * Represents a logical AND for the provided criteria.\n * @public\n */\nexport type AllOfCriteria<TQuery> = {\n  allOf: NonEmptyArray<PermissionCriteria<TQuery>>;\n};\n\n/**\n * Represents a logical OR for the provided criteria.\n * @public\n */\nexport type AnyOfCriteria<TQuery> = {\n  anyOf: NonEmptyArray<PermissionCriteria<TQuery>>;\n};\n\n/**\n * Represents a negation of the provided criteria.\n * @public\n */\nexport type NotCriteria<TQuery> = {\n  not: PermissionCriteria<TQuery>;\n};\n\n/**\n * Composes several {@link PermissionCondition}s as criteria with a nested AND/OR structure.\n * @public\n */\nexport type PermissionCriteria<TQuery> =\n  | AllOfCriteria<TQuery>\n  | AnyOfCriteria<TQuery>\n  | NotCriteria<TQuery>\n  | TQuery;\n\n/**\n * A parameter to a permission rule.\n *\n * @public\n */\nexport type PermissionRuleParam = undefined | JsonPrimitive | JsonPrimitive[];\n\n/**\n * Types that can be used as parameters to permission rules.\n *\n * @public\n */\nexport type PermissionRuleParams =\n  | undefined\n  | Record<string, PermissionRuleParam>;\n\n/**\n * An individual request sent to the permission backend.\n * @public\n */\nexport type EvaluatePermissionRequest = {\n  permission: Permission;\n  resourceRef?: string;\n};\n\n/**\n * A batch of requests sent to the permission backend.\n * @public\n */\nexport type EvaluatePermissionRequestBatch =\n  PermissionMessageBatch<EvaluatePermissionRequest>;\n\n/**\n * An individual response from the permission backend.\n *\n * @remarks\n *\n * This response type is an alias of {@link PolicyDecision} to maintain separation between the\n * {@link @backstage/plugin-permission-node#PermissionPolicy} interface and the permission backend\n * api. They may diverge at some point in the future. The response\n *\n * @public\n */\nexport type EvaluatePermissionResponse = PolicyDecision;\n\n/**\n * A batch of responses from the permission backend.\n * @public\n */\nexport type EvaluatePermissionResponseBatch =\n  PermissionMessageBatch<EvaluatePermissionResponse>;\n\n/**\n * Request object for {@link PermissionEvaluator.authorize}. If a {@link ResourcePermission}\n * is provided, it must include a corresponding `resourceRef`.\n * @public\n */\nexport type AuthorizePermissionRequest =\n  | {\n      permission: Exclude<Permission, ResourcePermission>;\n      resourceRef?: never;\n    }\n  | { permission: ResourcePermission; resourceRef: string };\n\n/**\n * Response object for {@link PermissionEvaluator.authorize}.\n * @public\n */\nexport type AuthorizePermissionResponse = DefinitivePolicyDecision;\n\n/**\n * Request object for {@link PermissionEvaluator.authorizeConditional}.\n * @public\n */\nexport type QueryPermissionRequest = {\n  permission: ResourcePermission;\n  resourceRef?: never;\n};\n\n/**\n * Response object for {@link PermissionEvaluator.authorizeConditional}.\n * @public\n */\nexport type QueryPermissionResponse = PolicyDecision;\n\n/**\n * A client interacting with the permission backend can implement this evaluator interface.\n *\n * @public\n */\nexport interface PermissionEvaluator {\n  /**\n   * Evaluates {@link Permission | Permissions} and returns a definitive decision.\n   */\n  authorize(\n    requests: AuthorizePermissionRequest[],\n    options?: EvaluatorRequestOptions,\n  ): Promise<AuthorizePermissionResponse[]>;\n\n  /**\n   * Evaluates {@link ResourcePermission | ResourcePermissions} and returns both definitive and\n   * conditional decisions, depending on the configured\n   * {@link @backstage/plugin-permission-node#PermissionPolicy}. This method is useful when the\n   * caller needs more control over the processing of conditional decisions. For example, a plugin\n   * backend may want to use {@link PermissionCriteria | conditions} in a database query instead of\n   * evaluating each resource in memory.\n   */\n  authorizeConditional(\n    requests: QueryPermissionRequest[],\n    options?: EvaluatorRequestOptions,\n  ): Promise<QueryPermissionResponse[]>;\n}\n\n/**\n * Options for {@link PermissionEvaluator} requests.\n * The Backstage identity token should be defined if available.\n * @public\n */\nexport type EvaluatorRequestOptions = {\n  token?: string;\n};\n","/*\n * Copyright 2021 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  AuthorizePermissionRequest,\n  AuthorizePermissionResponse,\n  DefinitivePolicyDecision,\n  EvaluatorRequestOptions,\n  Permission,\n  PermissionAuthorizer,\n  PermissionEvaluator,\n  QueryPermissionRequest,\n  QueryPermissionResponse,\n  ResourcePermission,\n} from '../types';\n\n/**\n * Check if the two parameters are equivalent permissions.\n * @public\n */\nexport function isPermission<T extends Permission>(\n  permission: Permission,\n  comparedPermission: T,\n): permission is T {\n  return permission.name === comparedPermission.name;\n}\n\n/**\n * Check if a given permission is a {@link ResourcePermission}. When\n * `resourceType` is supplied as the second parameter, also checks if\n * the permission has the specified resource type.\n * @public\n */\nexport function isResourcePermission<T extends string = string>(\n  permission: Permission,\n  resourceType?: T,\n): permission is ResourcePermission<T> {\n  if (!('resourceType' in permission)) {\n    return false;\n  }\n\n  return !resourceType || permission.resourceType === resourceType;\n}\n\n/**\n * Check if a given permission is related to a create action.\n * @public\n */\nexport function isCreatePermission(permission: Permission) {\n  return permission.attributes.action === 'create';\n}\n\n/**\n * Check if a given permission is related to a read action.\n * @public\n */\nexport function isReadPermission(permission: Permission) {\n  return permission.attributes.action === 'read';\n}\n\n/**\n * Check if a given permission is related to an update action.\n * @public\n */\nexport function isUpdatePermission(permission: Permission) {\n  return permission.attributes.action === 'update';\n}\n\n/**\n * Check if a given permission is related to a delete action.\n * @public\n */\nexport function isDeletePermission(permission: Permission) {\n  return permission.attributes.action === 'delete';\n}\n\n/**\n * Convert {@link PermissionAuthorizer} to {@link PermissionEvaluator}.\n *\n * @public\n */\nexport function toPermissionEvaluator(\n  permissionAuthorizer: PermissionAuthorizer,\n): PermissionEvaluator {\n  return {\n    authorize: async (\n      requests: AuthorizePermissionRequest[],\n      options?: EvaluatorRequestOptions,\n    ): Promise<AuthorizePermissionResponse[]> => {\n      const response = await permissionAuthorizer.authorize(requests, options);\n\n      return response as DefinitivePolicyDecision[];\n    },\n    authorizeConditional(\n      requests: QueryPermissionRequest[],\n      options?: EvaluatorRequestOptions,\n    ): Promise<QueryPermissionResponse[]> {\n      const parsedRequests =\n        requests as unknown as AuthorizePermissionRequest[];\n      return permissionAuthorizer.authorize(parsedRequests, options);\n    },\n  };\n}\n","/*\n * Copyright 2022 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  BasicPermission,\n  Permission,\n  PermissionAttributes,\n  ResourcePermission,\n} from '../types';\n\n/**\n * Utility function for creating a valid {@link ResourcePermission}, inferring\n * the appropriate type and resource type parameter.\n *\n * @public\n */\nexport function createPermission<TResourceType extends string>(input: {\n  name: string;\n  attributes: PermissionAttributes;\n  resourceType: TResourceType;\n}): ResourcePermission<TResourceType>;\n/**\n * Utility function for creating a valid {@link BasicPermission}.\n *\n * @public\n */\nexport function createPermission(input: {\n  name: string;\n  attributes: PermissionAttributes;\n}): BasicPermission;\nexport function createPermission({\n  name,\n  attributes,\n  resourceType,\n}: {\n  name: string;\n  attributes: PermissionAttributes;\n  resourceType?: string;\n}): Permission {\n  if (resourceType) {\n    return {\n      type: 'resource',\n      name,\n      attributes,\n      resourceType,\n    };\n  }\n\n  return {\n    type: 'basic',\n    name,\n    attributes,\n  };\n}\n","/*\n * Copyright 2021 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { Config } from '@backstage/config';\nimport { ResponseError } from '@backstage/errors';\nimport fetch from 'cross-fetch';\nimport * as uuid from 'uuid';\nimport { z } from 'zod';\nimport {\n  AuthorizeResult,\n  PermissionMessageBatch,\n  PermissionCriteria,\n  PermissionCondition,\n  PermissionEvaluator,\n  QueryPermissionRequest,\n  AuthorizePermissionRequest,\n  EvaluatorRequestOptions,\n  AuthorizePermissionResponse,\n  QueryPermissionResponse,\n} from './types/api';\nimport { DiscoveryApi } from './types/discovery';\nimport { AuthorizeRequestOptions } from './types/permission';\n\nconst permissionCriteriaSchema: z.ZodSchema<\n  PermissionCriteria<PermissionCondition>\n> = z.lazy(() =>\n  z\n    .object({\n      rule: z.string(),\n      resourceType: z.string(),\n      params: z.record(z.any()),\n    })\n    .or(z.object({ anyOf: z.array(permissionCriteriaSchema).nonempty() }))\n    .or(z.object({ allOf: z.array(permissionCriteriaSchema).nonempty() }))\n    .or(z.object({ not: permissionCriteriaSchema })),\n);\n\nconst authorizePermissionResponseSchema: z.ZodSchema<AuthorizePermissionResponse> =\n  z.object({\n    result: z\n      .literal(AuthorizeResult.ALLOW)\n      .or(z.literal(AuthorizeResult.DENY)),\n  });\n\nconst queryPermissionResponseSchema: z.ZodSchema<QueryPermissionResponse> =\n  z.union([\n    z.object({\n      result: z\n        .literal(AuthorizeResult.ALLOW)\n        .or(z.literal(AuthorizeResult.DENY)),\n    }),\n    z.object({\n      result: z.literal(AuthorizeResult.CONDITIONAL),\n      pluginId: z.string(),\n      resourceType: z.string(),\n      conditions: permissionCriteriaSchema,\n    }),\n  ]);\n\nconst responseSchema = <T>(\n  itemSchema: z.ZodSchema<T>,\n  ids: Set<string>,\n): z.ZodSchema<PermissionMessageBatch<T>> =>\n  z.object({\n    items: z\n      .array(\n        z.intersection(\n          z.object({\n            id: z.string(),\n          }),\n          itemSchema,\n        ),\n      )\n      .refine(\n        items =>\n          items.length === ids.size && items.every(({ id }) => ids.has(id)),\n        {\n          message: 'Items in response do not match request',\n        },\n      ),\n  });\n\n/**\n * An isomorphic client for requesting authorization for Backstage permissions.\n * @public\n */\nexport class PermissionClient implements PermissionEvaluator {\n  private readonly enabled: boolean;\n  private readonly discovery: DiscoveryApi;\n\n  constructor(options: { discovery: DiscoveryApi; config: Config }) {\n    this.discovery = options.discovery;\n    this.enabled =\n      options.config.getOptionalBoolean('permission.enabled') ?? false;\n  }\n\n  /**\n   * {@inheritdoc PermissionEvaluator.authorize}\n   */\n  async authorize(\n    requests: AuthorizePermissionRequest[],\n    options?: EvaluatorRequestOptions,\n  ): Promise<AuthorizePermissionResponse[]> {\n    return this.makeRequest(\n      requests,\n      authorizePermissionResponseSchema,\n      options,\n    );\n  }\n\n  /**\n   * {@inheritdoc PermissionEvaluator.authorizeConditional}\n   */\n  async authorizeConditional(\n    queries: QueryPermissionRequest[],\n    options?: EvaluatorRequestOptions,\n  ): Promise<QueryPermissionResponse[]> {\n    return this.makeRequest(queries, queryPermissionResponseSchema, options);\n  }\n\n  private async makeRequest<TQuery, TResult>(\n    queries: TQuery[],\n    itemSchema: z.ZodSchema<TResult>,\n    options?: AuthorizeRequestOptions,\n  ) {\n    if (!this.enabled) {\n      return queries.map(_ => ({ result: AuthorizeResult.ALLOW as const }));\n    }\n\n    const request: PermissionMessageBatch<TQuery> = {\n      items: queries.map(query => ({\n        id: uuid.v4(),\n        ...query,\n      })),\n    };\n\n    const permissionApi = await this.discovery.getBaseUrl('permission');\n    const response = await fetch(`${permissionApi}/authorize`, {\n      method: 'POST',\n      body: JSON.stringify(request),\n      headers: {\n        ...this.getAuthorizationHeader(options?.token),\n        'content-type': 'application/json',\n      },\n    });\n    if (!response.ok) {\n      throw await ResponseError.fromResponse(response);\n    }\n\n    const responseBody = await response.json();\n\n    const parsedResponse = responseSchema(\n      itemSchema,\n      new Set(request.items.map(({ id }) => id)),\n    ).parse(responseBody);\n\n    const responsesById = parsedResponse.items.reduce((acc, r) => {\n      acc[r.id] = r;\n      return acc;\n    }, {} as Record<string, z.infer<typeof itemSchema>>);\n\n    return request.items.map(query => responsesById[query.id]);\n  }\n\n  private getAuthorizationHeader(token?: string): Record<string, string> {\n    return token ? { Authorization: `Bearer ${token}` } : {};\n  }\n}\n","/*\n * Copyright 2021 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  EvaluatePermissionRequest,\n  EvaluatePermissionResponse,\n} from '@backstage/plugin-permission-common';\nimport { ApiRef, createApiRef } from '@backstage/core-plugin-api';\n\n/**\n * This API is used by various frontend utilities that allow developers to implement authorization within their frontend\n * plugins. A plugin developer will likely not have to interact with this API or its implementations directly, but\n * rather with the aforementioned utility components/hooks.\n * @public\n */\nexport type PermissionApi = {\n  authorize(\n    request: EvaluatePermissionRequest,\n  ): Promise<EvaluatePermissionResponse>;\n};\n\n/**\n * A Backstage ApiRef for the Permission API. See https://backstage.io/docs/api/utility-apis for more information on\n * Backstage ApiRefs.\n * @public\n */\nexport const permissionApiRef: ApiRef<PermissionApi> = createApiRef({\n  id: 'plugin.permission.api',\n});\n","/*\n * Copyright 2021 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { DiscoveryApi, IdentityApi } from '@backstage/core-plugin-api';\nimport { PermissionApi } from './PermissionApi';\nimport {\n  AuthorizePermissionRequest,\n  AuthorizePermissionResponse,\n  PermissionClient,\n} from '@backstage/plugin-permission-common';\nimport { Config } from '@backstage/config';\n\n/**\n * The default implementation of the PermissionApi, which simply calls the authorize method of the given\n * {@link @backstage/plugin-permission-common#PermissionClient}.\n * @public\n */\nexport class IdentityPermissionApi implements PermissionApi {\n  private constructor(\n    private readonly permissionClient: PermissionClient,\n    private readonly identityApi: IdentityApi,\n  ) {}\n\n  static create(options: {\n    config: Config;\n    discovery: DiscoveryApi;\n    identity: IdentityApi;\n  }) {\n    const { config, discovery, identity } = options;\n    const permissionClient = new PermissionClient({ discovery, config });\n    return new IdentityPermissionApi(permissionClient, identity);\n  }\n\n  async authorize(\n    request: AuthorizePermissionRequest,\n  ): Promise<AuthorizePermissionResponse> {\n    const response = await this.permissionClient.authorize(\n      [request],\n      await this.identityApi.getCredentials(),\n    );\n    return response[0];\n  }\n}\n","/*\n * Copyright 2021 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { useApi } from '@backstage/core-plugin-api';\nimport { permissionApiRef } from '../apis';\nimport {\n  AuthorizeResult,\n  isResourcePermission,\n  Permission,\n  ResourcePermission,\n} from '@backstage/plugin-permission-common';\nimport useSWR from 'swr';\n\n/** @public */\nexport type AsyncPermissionResult = {\n  loading: boolean;\n  allowed: boolean;\n  error?: Error;\n};\n\n/**\n * React hook utility for authorization. Given either a non-resource\n * {@link @backstage/plugin-permission-common#Permission} or a\n * {@link @backstage/plugin-permission-common#ResourcePermission} and an\n * optional resourceRef, it will return whether or not access is allowed (for\n * the given resource, if resourceRef is provided). See\n * {@link @backstage/plugin-permission-common/PermissionClient#authorize} for\n * more details.\n *\n * The resourceRef field is optional to allow calling this hook with an\n * entity that might be loading asynchronously, but when resourceRef is not\n * supplied, the value of `allowed` will always be false.\n *\n * Note: This hook uses stale-while-revalidate to help avoid flicker in UI\n * elements that would be conditionally rendered based on the `allowed` result\n * of this hook.\n * @public\n */\nexport function usePermission(\n  input:\n    | {\n        permission: Exclude<Permission, ResourcePermission>;\n        resourceRef?: never;\n      }\n    | {\n        permission: ResourcePermission;\n        resourceRef: string | undefined;\n      },\n): AsyncPermissionResult {\n  const permissionApi = useApi(permissionApiRef);\n  const { data, error } = useSWR(input, async (args: typeof input) => {\n    // We could make the resourceRef parameter required to avoid this check, but\n    // it would make using this hook difficult in situations where the entity\n    // must be asynchronously loaded, so instead we short-circuit to a deny when\n    // no resourceRef is supplied, on the assumption that the resourceRef is\n    // still loading outside the hook.\n    if (isResourcePermission(args.permission) && !args.resourceRef) {\n      return AuthorizeResult.DENY;\n    }\n\n    const { result } = await permissionApi.authorize(args);\n    return result;\n  });\n\n  if (error) {\n    return { error, loading: false, allowed: false };\n  }\n  if (data === undefined) {\n    return { loading: true, allowed: false };\n  }\n  return { loading: false, allowed: data === AuthorizeResult.ALLOW };\n}\n","/*\n * Copyright 2021 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React, { ReactElement, ReactNode } from 'react';\nimport { Route } from 'react-router';\nimport { useApp } from '@backstage/core-plugin-api';\nimport { usePermission } from '../hooks';\nimport {\n  isResourcePermission,\n  Permission,\n  ResourcePermission,\n} from '@backstage/plugin-permission-common';\n\n/**\n * Returns a React Router Route which only renders the element when authorized. If unauthorized, the Route will render a\n * NotFoundErrorPage (see {@link @backstage/core-app-api#AppComponents}).\n *\n * @public\n * @deprecated This component no longer works with the most recent version of `@backstage/core-app-api` and react-router v6, use {@link RequirePermission} instead.\n */\nexport const PermissionedRoute = (\n  props: {\n    caseSensitive?: boolean;\n    children?: ReactNode;\n    element?: ReactElement | null;\n    path?: string;\n    errorComponent?: ReactElement | null;\n  } & (\n    | {\n        permission: Exclude<Permission, ResourcePermission>;\n        resourceRef?: never;\n      }\n    | {\n        permission: ResourcePermission;\n        resourceRef: string | undefined;\n      }\n  ),\n) => {\n  const { permission, resourceRef, errorComponent, ...otherProps } = props;\n\n  const permissionResult = usePermission(\n    isResourcePermission(permission)\n      ? { permission, resourceRef }\n      : { permission },\n  );\n  const app = useApp();\n  const { NotFoundErrorPage } = app.getComponents();\n\n  let shownElement: ReactElement | null | undefined =\n    errorComponent === undefined ? <NotFoundErrorPage /> : errorComponent;\n\n  if (permissionResult.loading) {\n    shownElement = null;\n  } else if (permissionResult.allowed) {\n    shownElement = props.element;\n  }\n\n  return <Route {...otherProps} element={shownElement} />;\n};\n","/*\n * Copyright 2021 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React, { ReactNode } from 'react';\nimport { useApp } from '@backstage/core-plugin-api';\nimport { usePermission } from '../hooks';\nimport {\n  isResourcePermission,\n  Permission,\n  ResourcePermission,\n} from '@backstage/plugin-permission-common';\n\n/**\n * Properties for {@link RequirePermission}\n *\n * @public\n */\nexport type RequirePermissionProps = (\n  | {\n      permission: Exclude<Permission, ResourcePermission>;\n      resourceRef?: never;\n    }\n  | {\n      permission: ResourcePermission;\n      resourceRef: string | undefined;\n    }\n) & {\n  /**\n   * The error page to be displayed if the user is not allowed access.\n   *\n   * Defaults to the `NotFoundErrorPage` app component.\n   */\n  errorPage?: ReactNode;\n  children: ReactNode;\n};\n\n/**\n * A boundary that only renders its child elements if the user has the specified permission.\n *\n * While loading, nothing will be rendered. If the user does not have\n * permission, the `errorPage` element will be rendered, falling back\n * to the `NotFoundErrorPage` app component if no `errorPage` is provider.\n *\n * @public\n */\nexport function RequirePermission(\n  props: RequirePermissionProps,\n): JSX.Element | null {\n  const { permission, resourceRef } = props;\n  const permissionResult = usePermission(\n    isResourcePermission(permission)\n      ? { permission, resourceRef }\n      : { permission },\n  );\n  const app = useApp();\n\n  if (permissionResult.loading) {\n    return null;\n  } else if (permissionResult.allowed) {\n    return <>{props.children}</>;\n  }\n\n  if (props.errorPage) {\n    return <>{props.errorPage}</>;\n  }\n  // If no explicit error element is provided, the not found page is used as fallback.\n  const { NotFoundErrorPage } = app.getComponents();\n  return <NotFoundErrorPage />;\n}\n","/*\n * Copyright 2022 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { SearchQuery, SearchResultSet } from '@backstage/plugin-search-common';\nimport { createApiRef } from '@backstage/core-plugin-api';\n\n/**\n * @public\n */\nexport const searchApiRef = createApiRef<SearchApi>({\n  id: 'plugin.search.queryservice',\n});\n\n/**\n * @public\n */\nexport interface SearchApi {\n  query(query: SearchQuery): Promise<SearchResultSet>;\n}\n\n/**\n * @public\n *\n * Search Api Mock that can be used in tests and storybooks\n */\nexport class MockSearchApi implements SearchApi {\n  constructor(public mockedResults?: SearchResultSet) {}\n\n  query(): Promise<SearchResultSet> {\n    return Promise.resolve(this.mockedResults || { results: [] });\n  }\n}\n","/*\n * Copyright 2022 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React, { useMemo } from 'react';\nimport { makeStyles } from '@material-ui/core';\n\nconst useStyles = makeStyles(\n  () => ({\n    highlight: {},\n  }),\n  { name: 'BackstageHighlightedSearchResultText' },\n);\n\n/**\n * Props for {@link HighlightedSearchResultText}.\n *\n * @public\n */\nexport type HighlightedSearchResultTextProps = {\n  text: string;\n  preTag: string;\n  postTag: string;\n};\n\n/**\n * @public\n */\nexport const HighlightedSearchResultText = ({\n  text,\n  preTag,\n  postTag,\n}: HighlightedSearchResultTextProps) => {\n  const classes = useStyles();\n  const terms = useMemo(\n    () => text.split(new RegExp(`(${preTag}.+?${postTag})`)),\n    [postTag, preTag, text],\n  );\n  return (\n    <>\n      {terms.map((t, idx) =>\n        t.includes(preTag) ? (\n          <mark className={classes.highlight} key={idx}>\n            {t.replace(new RegExp(`${preTag}|${postTag}`, 'g'), '')}\n          </mark>\n        ) : (\n          t\n        ),\n      )}\n    </>\n  );\n};\n","/*\n * Copyright 2022 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { isEqual } from 'lodash';\nimport React, {\n  PropsWithChildren,\n  useCallback,\n  useContext,\n  useEffect,\n  useState,\n} from 'react';\nimport useAsync, { AsyncState } from 'react-use/lib/useAsync';\nimport usePrevious from 'react-use/lib/usePrevious';\n\nimport {\n  createVersionedContext,\n  createVersionedValueMap,\n} from '@backstage/version-bridge';\nimport { JsonObject } from '@backstage/types';\nimport { AnalyticsContext, useApi } from '@backstage/core-plugin-api';\nimport { SearchResultSet } from '@backstage/plugin-search-common';\n\nimport { searchApiRef } from '../api';\n\n/**\n *\n * @public\n */\nexport type SearchContextValue = {\n  result: AsyncState<SearchResultSet>;\n  setTerm: React.Dispatch<React.SetStateAction<string>>;\n  setTypes: React.Dispatch<React.SetStateAction<string[]>>;\n  setFilters: React.Dispatch<React.SetStateAction<JsonObject>>;\n  setPageLimit: React.Dispatch<React.SetStateAction<number | undefined>>;\n  setPageCursor: React.Dispatch<React.SetStateAction<string | undefined>>;\n  fetchNextPage?: React.DispatchWithoutAction;\n  fetchPreviousPage?: React.DispatchWithoutAction;\n} & SearchContextState;\n\n/**\n *\n * @public\n */\nexport type SearchContextState = {\n  term: string;\n  types: string[];\n  filters: JsonObject;\n  pageLimit?: number;\n  pageCursor?: string;\n};\n\nconst SearchContext = createVersionedContext<{\n  1: SearchContextValue;\n}>('search-context');\n\n/**\n * @public\n *\n * React hook which provides the search context\n */\nexport const useSearch = () => {\n  const context = useContext(SearchContext);\n  if (!context) {\n    throw new Error('useSearch must be used within a SearchContextProvider');\n  }\n\n  const value = context.atVersion(1);\n  if (!value) {\n    throw new Error('No SearchContext v1 found');\n  }\n  return value;\n};\n\n/**\n * @public\n *\n * React hook which checks for an existing search context\n */\nexport const useSearchContextCheck = () => {\n  const context = useContext(SearchContext);\n  return context !== undefined;\n};\n\n/**\n * The initial state of `SearchContextProvider`.\n *\n */\nconst searchInitialState: SearchContextState = {\n  term: '',\n  types: [],\n  filters: {},\n  pageLimit: undefined,\n  pageCursor: undefined,\n};\n\nconst useSearchContextValue = (\n  initialValue: SearchContextState = searchInitialState,\n) => {\n  const searchApi = useApi(searchApiRef);\n\n  const [term, setTerm] = useState<string>(initialValue.term);\n  const [types, setTypes] = useState<string[]>(initialValue.types);\n  const [filters, setFilters] = useState<JsonObject>(initialValue.filters);\n  const [pageLimit, setPageLimit] = useState<number | undefined>(\n    initialValue.pageLimit,\n  );\n  const [pageCursor, setPageCursor] = useState<string | undefined>(\n    initialValue.pageCursor,\n  );\n\n  const prevTerm = usePrevious(term);\n  const prevFilters = usePrevious(filters);\n\n  const result = useAsync(\n    () =>\n      searchApi.query({\n        term,\n        types,\n        filters,\n        pageLimit,\n        pageCursor,\n      }),\n    [term, types, filters, pageLimit, pageCursor],\n  );\n\n  const hasNextPage =\n    !result.loading && !result.error && result.value?.nextPageCursor;\n  const hasPreviousPage =\n    !result.loading && !result.error && result.value?.previousPageCursor;\n\n  const fetchNextPage = useCallback(() => {\n    setPageCursor(result.value?.nextPageCursor);\n  }, [result.value?.nextPageCursor]);\n\n  const fetchPreviousPage = useCallback(() => {\n    setPageCursor(result.value?.previousPageCursor);\n  }, [result.value?.previousPageCursor]);\n\n  useEffect(() => {\n    // Any time a term is reset, we want to start from page 0.\n    // Only reset the term if it has been modified by the user at least once, the initial state must not reset the term.\n    if (prevTerm !== undefined && term !== prevTerm) {\n      setPageCursor(undefined);\n    }\n  }, [term, prevTerm, setPageCursor]);\n\n  useEffect(() => {\n    // Any time filters is reset, we want to start from page 0.\n    // Only reset the page if it has been modified by the user at least once, the initial state must not reset the page.\n    if (prevFilters !== undefined && !isEqual(filters, prevFilters)) {\n      setPageCursor(undefined);\n    }\n  }, [filters, prevFilters, setPageCursor]);\n\n  const value: SearchContextValue = {\n    result,\n    term,\n    setTerm,\n    types,\n    setTypes,\n    filters,\n    setFilters,\n    pageLimit,\n    setPageLimit,\n    pageCursor,\n    setPageCursor,\n    fetchNextPage: hasNextPage ? fetchNextPage : undefined,\n    fetchPreviousPage: hasPreviousPage ? fetchPreviousPage : undefined,\n  };\n\n  return value;\n};\n\nexport type LocalSearchContextProps = PropsWithChildren<{\n  initialState?: SearchContextState;\n}>;\n\nconst LocalSearchContext = (props: SearchContextProviderProps) => {\n  const { initialState, children } = props;\n  const value = useSearchContextValue(initialState);\n\n  return (\n    <AnalyticsContext\n      attributes={{ searchTypes: value.types.sort().join(',') }}\n    >\n      <SearchContext.Provider value={createVersionedValueMap({ 1: value })}>\n        {children}\n      </SearchContext.Provider>\n    </AnalyticsContext>\n  );\n};\n\n/**\n * Props for {@link SearchContextProvider}\n *\n * @public\n */\nexport type SearchContextProviderProps =\n  | PropsWithChildren<{\n      /**\n       * State initialized by a local context.\n       */\n      initialState?: SearchContextState;\n      /**\n       * Do not create an inheritance from the parent, as a new initial state must be defined in a local context.\n       */\n      inheritParentContextIfAvailable?: never;\n    }>\n  | PropsWithChildren<{\n      /**\n       * Does not accept initial state since it is already initialized by parent context.\n       */\n      initialState?: never;\n      /**\n       * If true, don't create a child context if there is a parent one already defined.\n       * @remarks Defaults to false.\n       */\n      inheritParentContextIfAvailable?: boolean;\n    }>;\n\n/**\n * @public\n * Search context provider which gives you access to shared state between search components\n */\nexport const SearchContextProvider = (props: SearchContextProviderProps) => {\n  const { initialState, inheritParentContextIfAvailable, children } = props;\n  const hasParentContext = useSearchContextCheck();\n\n  return hasParentContext && inheritParentContextIfAvailable ? (\n    <>{children}</>\n  ) : (\n    <LocalSearchContext initialState={initialState}>\n      {children}\n    </LocalSearchContext>\n  );\n};\n","/*\n * Copyright 2022 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React, { useEffect } from 'react';\nimport { useAnalytics } from '@backstage/core-plugin-api';\nimport { useSearch } from '../../context';\n\n/**\n * Capture search event on term change.\n */\nexport const TrackSearch = ({ children }: { children: React.ReactChild }) => {\n  const analytics = useAnalytics();\n  const { term } = useSearch();\n\n  useEffect(() => {\n    if (term) {\n      // Capture analytics search event with search term provided as value\n      analytics.captureEvent('search', term);\n    }\n  }, [analytics, term]);\n\n  return <>{children}</>;\n};\n","/*\n * Copyright 2022 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React, {\n  ChangeEvent,\n  KeyboardEvent,\n  useState,\n  useEffect,\n  useCallback,\n  forwardRef,\n  ComponentType,\n  ForwardRefExoticComponent,\n} from 'react';\nimport useDebounce from 'react-use/lib/useDebounce';\n\nimport {\n  InputBase,\n  InputBaseProps,\n  InputAdornment,\n  IconButton,\n} from '@material-ui/core';\nimport SearchIcon from '@material-ui/icons/Search';\nimport ClearButton from '@material-ui/icons/Clear';\n\nimport {\n  AnalyticsContext,\n  configApiRef,\n  useApi,\n} from '@backstage/core-plugin-api';\n\nimport { SearchContextProvider, useSearch } from '../../context';\nimport { TrackSearch } from '../SearchTracker';\n\nfunction withContext<T>(Component: ComponentType<T>) {\n  return forwardRef<unknown, T>((props, ref) => (\n    <SearchContextProvider inheritParentContextIfAvailable>\n      <Component {...props} ref={ref} />\n    </SearchContextProvider>\n  ));\n}\n\n/**\n * Props for {@link SearchBarBase}.\n *\n * @public\n */\nexport type SearchBarBaseProps = Omit<InputBaseProps, 'onChange'> & {\n  debounceTime?: number;\n  clearButton?: boolean;\n  onClear?: () => void;\n  onSubmit?: () => void;\n  onChange: (value: string) => void;\n};\n\n/**\n * All search boxes exported by the search plugin are based on the <SearchBarBase />,\n * and this one is based on the <InputBase /> component from Material UI.\n * Recommended if you don't use Search Provider or Search Context.\n *\n * @public\n */\nexport const SearchBarBase: ForwardRefExoticComponent<SearchBarBaseProps> =\n  withContext(\n    forwardRef((props, ref) => {\n      const {\n        onChange,\n        onKeyDown = () => {},\n        onClear = () => {},\n        onSubmit = () => {},\n        debounceTime = 200,\n        clearButton = true,\n        fullWidth = true,\n        value: defaultValue,\n        placeholder: defaultPlaceholder,\n        inputProps: defaultInputProps = {},\n        endAdornment: defaultEndAdornment,\n        ...rest\n      } = props;\n\n      const configApi = useApi(configApiRef);\n      const [value, setValue] = useState<string>('');\n\n      useEffect(() => {\n        setValue(prevValue =>\n          prevValue !== defaultValue ? String(defaultValue) : prevValue,\n        );\n      }, [defaultValue]);\n\n      useDebounce(() => onChange(value), debounceTime, [value]);\n\n      const handleChange = useCallback(\n        (e: ChangeEvent<HTMLInputElement>) => {\n          setValue(e.target.value);\n        },\n        [setValue],\n      );\n\n      const handleKeyDown = useCallback(\n        (e: KeyboardEvent<HTMLInputElement>) => {\n          if (onKeyDown) onKeyDown(e);\n          if (onSubmit && e.key === 'Enter') {\n            onSubmit();\n          }\n        },\n        [onKeyDown, onSubmit],\n      );\n\n      const handleClear = useCallback(() => {\n        onChange('');\n        if (onClear) {\n          onClear();\n        }\n      }, [onChange, onClear]);\n\n      const placeholder =\n        defaultPlaceholder ??\n        `Search in ${configApi.getOptionalString('app.title') || 'Backstage'}`;\n\n      const startAdornment = (\n        <InputAdornment position=\"start\">\n          <IconButton aria-label=\"Query\" size=\"small\" disabled>\n            <SearchIcon />\n          </IconButton>\n        </InputAdornment>\n      );\n\n      const endAdornment = (\n        <InputAdornment position=\"end\">\n          <IconButton aria-label=\"Clear\" size=\"small\" onClick={handleClear}>\n            <ClearButton />\n          </IconButton>\n        </InputAdornment>\n      );\n\n      return (\n        <TrackSearch>\n          <InputBase\n            data-testid=\"search-bar-next\"\n            ref={ref}\n            value={value}\n            placeholder={placeholder}\n            startAdornment={startAdornment}\n            endAdornment={clearButton ? endAdornment : defaultEndAdornment}\n            inputProps={{ 'aria-label': 'Search', ...defaultInputProps }}\n            fullWidth={fullWidth}\n            onChange={handleChange}\n            onKeyDown={handleKeyDown}\n            {...rest}\n          />\n        </TrackSearch>\n      );\n    }),\n  );\n\n/**\n * Props for {@link SearchBar}.\n *\n * @public\n */\nexport type SearchBarProps = Partial<SearchBarBaseProps>;\n\n/**\n * Recommended search bar when you use the Search Provider or Search Context.\n *\n * @public\n */\nexport const SearchBar: ForwardRefExoticComponent<SearchBarProps> = withContext(\n  forwardRef((props, ref) => {\n    const { value: initialValue = '', onChange, ...rest } = props;\n\n    const { term, setTerm } = useSearch();\n\n    useEffect(() => {\n      if (initialValue) {\n        setTerm(String(initialValue));\n      }\n    }, [initialValue, setTerm]);\n\n    const handleChange = useCallback(\n      (newValue: string) => {\n        if (onChange) {\n          onChange(newValue);\n        } else {\n          setTerm(newValue);\n        }\n      },\n      [onChange, setTerm],\n    );\n\n    return (\n      <AnalyticsContext\n        attributes={{ pluginId: 'search', extension: 'SearchBar' }}\n      >\n        <SearchBarBase\n          {...rest}\n          ref={ref}\n          value={term}\n          onChange={handleChange}\n        />\n      </AnalyticsContext>\n    );\n  }),\n);\n","/*\n * Copyright 2022 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React, { ChangeEvent, useCallback, useMemo } from 'react';\n\nimport { CircularProgress } from '@material-ui/core';\nimport {\n  Autocomplete,\n  AutocompleteProps,\n  AutocompleteChangeDetails,\n  AutocompleteChangeReason,\n  AutocompleteRenderInputParams,\n} from '@material-ui/lab';\n\nimport { SearchContextProvider, useSearch } from '../../context';\nimport { SearchBar, SearchBarProps } from '../SearchBar';\n\n/**\n * Props for {@link SearchAutocomplete}.\n *\n * @public\n */\nexport type SearchAutocompleteProps<Option> = Omit<\n  AutocompleteProps<Option, undefined, undefined, boolean>,\n  'renderInput' | 'disableClearable' | 'multiple'\n> & {\n  'data-testid'?: string;\n  inputPlaceholder?: SearchBarProps['placeholder'];\n  inputDebounceTime?: SearchBarProps['debounceTime'];\n};\n\n/**\n * Type for {@link SearchAutocomplete}.\n *\n * @public\n */\nexport type SearchAutocompleteComponent = <Option>(\n  props: SearchAutocompleteProps<Option>,\n) => JSX.Element;\n\nconst withContext = (\n  Component: SearchAutocompleteComponent,\n): SearchAutocompleteComponent => {\n  return props => (\n    <SearchContextProvider inheritParentContextIfAvailable>\n      <Component {...props} />\n    </SearchContextProvider>\n  );\n};\n\n/**\n * Recommended search autocomplete when you use the Search Provider or Search Context.\n *\n * @public\n */\nexport const SearchAutocomplete = withContext(\n  function SearchAutocompleteComponent<Option>(\n    props: SearchAutocompleteProps<Option>,\n  ) {\n    const {\n      loading,\n      value,\n      onChange = () => {},\n      options = [],\n      getOptionLabel = (option: Option) => String(option),\n      inputPlaceholder,\n      inputDebounceTime,\n      freeSolo = true,\n      fullWidth = true,\n      clearOnBlur = false,\n      'data-testid': dataTestId = 'search-autocomplete',\n      ...rest\n    } = props;\n\n    const { setTerm } = useSearch();\n\n    const getInputValue = useCallback(\n      (option?: null | string | Option) => {\n        if (!option) return '';\n        if (typeof option === 'string') return option;\n        return getOptionLabel(option);\n      },\n      [getOptionLabel],\n    );\n\n    const inputValue = useMemo(\n      () => getInputValue(value),\n      [value, getInputValue],\n    );\n\n    const handleChange = useCallback(\n      (\n        event: ChangeEvent<{}>,\n        option: null | string | Option,\n        reason: AutocompleteChangeReason,\n        details?: AutocompleteChangeDetails<Option>,\n      ) => {\n        setTerm(getInputValue(option));\n        onChange(event, option, reason, details);\n      },\n      [getInputValue, setTerm, onChange],\n    );\n\n    const renderInput = useCallback(\n      ({\n        InputProps: { ref, endAdornment },\n        InputLabelProps,\n        ...params\n      }: AutocompleteRenderInputParams) => (\n        <SearchBar\n          {...params}\n          ref={ref}\n          clearButton={false}\n          value={inputValue}\n          placeholder={inputPlaceholder}\n          debounceTime={inputDebounceTime}\n          endAdornment={\n            loading ? (\n              <CircularProgress\n                data-testid=\"search-autocomplete-progressbar\"\n                color=\"inherit\"\n                size={20}\n              />\n            ) : (\n              endAdornment\n            )\n          }\n        />\n      ),\n      [loading, inputValue, inputPlaceholder, inputDebounceTime],\n    );\n\n    return (\n      <Autocomplete\n        {...rest}\n        data-testid={dataTestId}\n        value={value}\n        onChange={handleChange}\n        options={options}\n        getOptionLabel={getOptionLabel}\n        renderInput={renderInput}\n        freeSolo={freeSolo}\n        fullWidth={fullWidth}\n        clearOnBlur={clearOnBlur}\n      />\n    );\n  },\n);\n","/*\n * Copyright 2022 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React, { ReactNode } from 'react';\nimport {\n  ListItemIcon,\n  ListItemText,\n  ListItemTextProps,\n} from '@material-ui/core';\n\n/**\n * Props for {@link SearchAutocompleteDefaultOption}.\n *\n * @public\n */\nexport type SearchAutocompleteDefaultOptionProps = {\n  icon?: ReactNode;\n  primaryText: ListItemTextProps['primary'];\n  primaryTextTypographyProps?: ListItemTextProps['primaryTypographyProps'];\n  secondaryText?: ListItemTextProps['secondary'];\n  secondaryTextTypographyProps?: ListItemTextProps['secondaryTypographyProps'];\n  disableTextTypography?: ListItemTextProps['disableTypography'];\n};\n\n/**\n * A default search autocomplete option component.\n *\n * @public\n */\nexport const SearchAutocompleteDefaultOption = ({\n  icon,\n  primaryText,\n  primaryTextTypographyProps,\n  secondaryText,\n  secondaryTextTypographyProps,\n  disableTextTypography,\n}: SearchAutocompleteDefaultOptionProps) => (\n  <>\n    {icon ? <ListItemIcon>{icon}</ListItemIcon> : null}\n    <ListItemText\n      primary={primaryText}\n      primaryTypographyProps={primaryTextTypographyProps}\n      secondary={secondaryText}\n      secondaryTypographyProps={secondaryTextTypographyProps}\n      disableTypography={disableTextTypography}\n    />\n  </>\n);\n","/*\n * Copyright 2022 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { useEffect, useRef } from 'react';\nimport useAsyncFn from 'react-use/lib/useAsyncFn';\nimport useDebounce from 'react-use/lib/useDebounce';\n\nimport { useSearch } from '../../context';\n\n/**\n * Utility hook for either asynchronously loading filter values from a given\n * function or synchronously providing a given list of default values.\n *\n * @public\n */\nexport const useAsyncFilterValues = (\n  fn: ((partial: string) => Promise<string[]>) | undefined,\n  inputValue: string,\n  defaultValues: string[] = [],\n  debounce: number = 250,\n) => {\n  const valuesMemo = useRef<Record<string, string[] | Promise<string[]>>>({});\n  const definiteFn = fn || (() => Promise.resolve([]));\n\n  const [state, callback] = useAsyncFn(definiteFn, [inputValue], {\n    loading: true,\n  });\n\n  // Do not invoke the given function more than necessary.\n  useDebounce(\n    () => {\n      // Performance optimization: only invoke the callback once per inputValue\n      // for the lifetime of the hook/component.\n      if (valuesMemo.current[inputValue] === undefined) {\n        valuesMemo.current[inputValue] = callback(inputValue).then(values => {\n          // Override the value for future immediate returns.\n          valuesMemo.current[inputValue] = values;\n          return values;\n        });\n      }\n    },\n    debounce,\n    [callback, inputValue],\n  );\n\n  // Immediately return the default values if they are provided.\n  if (defaultValues.length) {\n    return {\n      loading: false,\n      value: defaultValues,\n    };\n  }\n\n  // Immediately return a memoized value if it is set (and not a promise).\n  const possibleValue = valuesMemo.current[inputValue];\n  if (Array.isArray(possibleValue)) {\n    return {\n      loading: false,\n      value: possibleValue,\n    };\n  }\n\n  return state;\n};\n\n/**\n * Utility hook for applying a given default value to the search context.\n *\n * @public\n */\nexport const useDefaultFilterValue = (\n  name: string,\n  defaultValue?: string | string[] | null,\n) => {\n  const { setFilters } = useSearch();\n\n  useEffect(() => {\n    if (defaultValue && [defaultValue].flat().length > 0) {\n      setFilters(prevFilters => ({\n        ...prevFilters,\n        [name]: defaultValue,\n      }));\n    }\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, []);\n};\n","/*\n * Copyright 2022 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React, { ChangeEvent, useState } from 'react';\nimport { Chip, TextField } from '@material-ui/core';\nimport {\n  Autocomplete,\n  AutocompleteGetTagProps,\n  AutocompleteRenderInputParams,\n} from '@material-ui/lab';\n\nimport { useSearch } from '../../context';\nimport { useAsyncFilterValues, useDefaultFilterValue } from './hooks';\nimport { SearchFilterComponentProps } from './SearchFilter';\n\n/**\n * @public\n */\nexport type SearchAutocompleteFilterProps = SearchFilterComponentProps & {\n  filterSelectedOptions?: boolean;\n  limitTags?: number;\n  multiple?: boolean;\n};\n\n/**\n * @public\n */\nexport const AutocompleteFilter = (props: SearchAutocompleteFilterProps) => {\n  const {\n    className,\n    defaultValue,\n    name,\n    values: givenValues,\n    valuesDebounceMs,\n    label,\n    filterSelectedOptions,\n    limitTags,\n    multiple,\n  } = props;\n  const [inputValue, setInputValue] = useState<string>('');\n  useDefaultFilterValue(name, defaultValue);\n  const asyncValues =\n    typeof givenValues === 'function' ? givenValues : undefined;\n  const defaultValues =\n    typeof givenValues === 'function' ? undefined : givenValues;\n  const { value: values, loading } = useAsyncFilterValues(\n    asyncValues,\n    inputValue,\n    defaultValues,\n    valuesDebounceMs,\n  );\n  const { filters, setFilters } = useSearch();\n  const filterValue =\n    (filters[name] as string | string[] | undefined) || (multiple ? [] : null);\n\n  // Set new filter values on input change.\n  const handleChange = (\n    _: ChangeEvent<{}>,\n    newValue: string | string[] | null,\n  ) => {\n    setFilters(prevState => {\n      const { [name]: filter, ...others } = prevState;\n\n      if (newValue) {\n        return { ...others, [name]: newValue };\n      }\n      return { ...others };\n    });\n  };\n\n  // Provide the input field.\n  const renderInput = (params: AutocompleteRenderInputParams) => (\n    <TextField\n      {...params}\n      name=\"search\"\n      variant=\"outlined\"\n      label={label}\n      fullWidth\n    />\n  );\n\n  // Render tags as primary-colored chips.\n  const renderTags = (\n    tagValue: string[],\n    getTagProps: AutocompleteGetTagProps,\n  ) =>\n    tagValue.map((option: string, index: number) => (\n      <Chip label={option} color=\"primary\" {...getTagProps({ index })} />\n    ));\n\n  return (\n    <Autocomplete\n      filterSelectedOptions={filterSelectedOptions}\n      limitTags={limitTags}\n      multiple={multiple}\n      className={className}\n      id={`${multiple ? 'multi-' : ''}select-filter-${name}--select`}\n      options={values || []}\n      loading={loading}\n      value={filterValue}\n      onChange={handleChange}\n      onInputChange={(_, newValue) => setInputValue(newValue)}\n      renderInput={renderInput}\n      renderTags={renderTags}\n    />\n  );\n};\n","/*\n * Copyright 2022 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React, { ReactElement, ChangeEvent } from 'react';\nimport {\n  makeStyles,\n  FormControl,\n  FormControlLabel,\n  InputLabel,\n  Checkbox,\n  Select,\n  MenuItem,\n  FormLabel,\n} from '@material-ui/core';\n\nimport { useSearch } from '../../context';\nimport {\n  AutocompleteFilter,\n  SearchAutocompleteFilterProps,\n} from './SearchFilter.Autocomplete';\nimport { useAsyncFilterValues, useDefaultFilterValue } from './hooks';\n\nconst useStyles = makeStyles({\n  label: {\n    textTransform: 'capitalize',\n  },\n});\n\n/**\n * @public\n */\nexport type SearchFilterComponentProps = {\n  className?: string;\n  name: string;\n  label?: string;\n  /**\n   * Either an array of values directly, or an async function to return a list\n   * of values to be used in the filter. In the autocomplete filter, the last\n   * input value is provided as an input to allow values to be filtered. This\n   * function is debounced and values cached.\n   */\n  values?: string[] | ((partial: string) => Promise<string[]>);\n  defaultValue?: string[] | string | null;\n  /**\n   * Debounce time in milliseconds, used when values is an async callback.\n   * Defaults to 250ms.\n   */\n  valuesDebounceMs?: number;\n};\n\n/**\n * @public\n */\nexport type SearchFilterWrapperProps = SearchFilterComponentProps & {\n  component: (props: SearchFilterComponentProps) => ReactElement;\n  debug?: boolean;\n};\n\n/**\n * @public\n */\nexport const CheckboxFilter = (props: SearchFilterComponentProps) => {\n  const {\n    className,\n    defaultValue,\n    label,\n    name,\n    values: givenValues = [],\n    valuesDebounceMs,\n  } = props;\n  const classes = useStyles();\n  const { filters, setFilters } = useSearch();\n  useDefaultFilterValue(name, defaultValue);\n  const asyncValues =\n    typeof givenValues === 'function' ? givenValues : undefined;\n  const defaultValues =\n    typeof givenValues === 'function' ? undefined : givenValues;\n  const { value: values = [], loading } = useAsyncFilterValues(\n    asyncValues,\n    '',\n    defaultValues,\n    valuesDebounceMs,\n  );\n\n  const handleChange = (e: ChangeEvent<HTMLInputElement>) => {\n    const {\n      target: { value, checked },\n    } = e;\n\n    setFilters(prevFilters => {\n      const { [name]: filter, ...others } = prevFilters;\n      const rest = ((filter as string[]) || []).filter(i => i !== value);\n      const items = checked ? [...rest, value] : rest;\n      return items.length ? { ...others, [name]: items } : others;\n    });\n  };\n\n  return (\n    <FormControl\n      className={className}\n      disabled={loading}\n      fullWidth\n      data-testid=\"search-checkboxfilter-next\"\n    >\n      {label ? <FormLabel className={classes.label}>{label}</FormLabel> : null}\n      {values.map((value: string) => (\n        <FormControlLabel\n          key={value}\n          control={\n            <Checkbox\n              color=\"primary\"\n              tabIndex={-1}\n              inputProps={{ 'aria-labelledby': value }}\n              value={value}\n              name={value}\n              onChange={handleChange}\n              checked={((filters[name] as string[]) ?? []).includes(value)}\n            />\n          }\n          label={value}\n        />\n      ))}\n    </FormControl>\n  );\n};\n\n/**\n * @public\n */\nexport const SelectFilter = (props: SearchFilterComponentProps) => {\n  const {\n    className,\n    defaultValue,\n    label,\n    name,\n    values: givenValues,\n    valuesDebounceMs,\n  } = props;\n  const classes = useStyles();\n  useDefaultFilterValue(name, defaultValue);\n  const asyncValues =\n    typeof givenValues === 'function' ? givenValues : undefined;\n  const defaultValues =\n    typeof givenValues === 'function' ? undefined : givenValues;\n  const { value: values = [], loading } = useAsyncFilterValues(\n    asyncValues,\n    '',\n    defaultValues,\n    valuesDebounceMs,\n  );\n  const { filters, setFilters } = useSearch();\n\n  const handleChange = (e: ChangeEvent<{ value: unknown }>) => {\n    const {\n      target: { value },\n    } = e;\n\n    setFilters(prevFilters => {\n      const { [name]: filter, ...others } = prevFilters;\n      return value ? { ...others, [name]: value as string } : others;\n    });\n  };\n\n  return (\n    <FormControl\n      disabled={loading}\n      className={className}\n      variant=\"filled\"\n      fullWidth\n      data-testid=\"search-selectfilter-next\"\n    >\n      {label ? (\n        <InputLabel className={classes.label} margin=\"dense\">\n          {label}\n        </InputLabel>\n      ) : null}\n      <Select\n        variant=\"outlined\"\n        value={filters[name] || ''}\n        onChange={handleChange}\n      >\n        <MenuItem value=\"\">\n          <em>All</em>\n        </MenuItem>\n        {values.map((value: string) => (\n          <MenuItem key={value} value={value}>\n            {value}\n          </MenuItem>\n        ))}\n      </Select>\n    </FormControl>\n  );\n};\n\n/**\n * @public\n */\nconst SearchFilter = ({\n  component: Element,\n  ...props\n}: SearchFilterWrapperProps) => <Element {...props} />;\n\nSearchFilter.Checkbox = (\n  props: Omit<SearchFilterWrapperProps, 'component'> &\n    SearchFilterComponentProps,\n) => <SearchFilter {...props} component={CheckboxFilter} />;\n\nSearchFilter.Select = (\n  props: Omit<SearchFilterWrapperProps, 'component'> &\n    SearchFilterComponentProps,\n) => <SearchFilter {...props} component={SelectFilter} />;\n\n/**\n * A control surface for a given filter field name, rendered as an autocomplete\n * textfield. A hard-coded list of values may be provided, or an async function\n * which returns values may be provided instead.\n *\n * @public\n */\nSearchFilter.Autocomplete = (props: SearchAutocompleteFilterProps) => (\n  <SearchFilter {...props} component={AutocompleteFilter} />\n);\n\nexport { SearchFilter };\n","/*\n * Copyright 2022 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React from 'react';\nimport useAsync, { AsyncState } from 'react-use/lib/useAsync';\n\nimport {\n  EmptyState,\n  Progress,\n  ResponseErrorPanel,\n} from '@backstage/core-components';\nimport { AnalyticsContext, useApi } from '@backstage/core-plugin-api';\nimport { SearchQuery, SearchResultSet } from '@backstage/plugin-search-common';\n\nimport { useSearch } from '../../context';\nimport { searchApiRef } from '../../api';\n\n/**\n * Props for {@link SearchResultContext}\n * @public\n */\nexport type SearchResultContextProps = {\n  /**\n   * A child function that receives an asynchronous result set and returns a react element.\n   */\n  children: (state: AsyncState<SearchResultSet>) => JSX.Element | null;\n};\n\n/**\n * Provides context-based results to a child function.\n * @param props - see {@link SearchResultContextProps}.\n * @example\n * ```\n * <SearchResultContext>\n *   {({ loading, error, value }) => (\n *     <List>\n *       {value?.map(({ document }) => (\n *         <DefaultSearchResultListItem\n *           key={document.location}\n *           result={document}\n *         />\n *       ))}\n *     </List>\n *   )}\n * </SearchResultContext>\n * ```\n * @public\n */\nexport const SearchResultContext = (props: SearchResultContextProps) => {\n  const { children } = props;\n  const context = useSearch();\n  const state = context.result;\n  return children(state);\n};\n\n/**\n * Props for {@link SearchResultApi}\n * @public\n */\nexport type SearchResultApiProps = SearchResultContextProps & {\n  query: Partial<SearchQuery>;\n};\n\n/**\n * Request results through the search api and provide them to a child function.\n * @param props - see {@link SearchResultApiProps}.\n * @example\n * ```\n * <SearchResultApi>\n *   {({ loading, error, value }) => (\n *     <List>\n *       {value?.map(({ document }) => (\n *         <DefaultSearchResultListItem\n *           key={document.location}\n *           result={document}\n *         />\n *       ))}\n *     </List>\n *   )}\n * </SearchResultApi>\n * ```\n * @public\n */\nexport const SearchResultApi = (props: SearchResultApiProps) => {\n  const { query, children } = props;\n  const searchApi = useApi(searchApiRef);\n\n  const state = useAsync(() => {\n    const { term = '', types = [], filters = {}, ...rest } = query;\n    return searchApi.query({ ...rest, term, types, filters });\n  }, [query]);\n\n  return children(state);\n};\n\n/**\n * Props for {@link SearchResultState}\n * @public\n */\nexport type SearchResultStateProps = SearchResultContextProps &\n  Partial<SearchResultApiProps>;\n\n/**\n * Call a child render function passing a search state as an argument.\n * @remarks By default, results are taken from context, but when a \"query\" prop is set, results are requested from the search api.\n * @param props - see {@link SearchResultStateProps}.\n * @example\n * Consuming results from context:\n * ```\n * <SearchResultState>\n *   {({ loading, error, value }) => (\n *     <List>\n *       {value?.map(({ document }) => (\n *         <DefaultSearchResultListItem\n *           key={document.location}\n *           result={document}\n *         />\n *       ))}\n *     </List>\n *   )}\n * </SearchResultState>\n * ```\n * @example\n * Requesting results using the search api:\n * ```\n * <SearchResultState query={{ term: 'documentation' }}>\n *   {({ loading, error, value }) => (\n *     <List>\n *       {value?.map(({ document }) => (\n *         <DefaultSearchResultListItem\n *           key={document.location}\n *           result={document}\n *         />\n *       ))}\n *     </List>\n *   )}\n * </SearchResultState>\n * ```\n * @public\n */\nexport const SearchResultState = (props: SearchResultStateProps) => {\n  const { query, children } = props;\n\n  return query ? (\n    <SearchResultApi query={query}>{children}</SearchResultApi>\n  ) : (\n    <SearchResultContext>{children}</SearchResultContext>\n  );\n};\n\n/**\n * Props for {@link SearchResult}\n * @public\n */\nexport type SearchResultProps = Pick<SearchResultStateProps, 'query'> & {\n  children: (resultSet: SearchResultSet) => JSX.Element;\n};\n\n/**\n * Renders results from a parent search context or api.\n * @remarks default components for loading, error and empty variants are returned.\n * @param props - see {@link SearchResultProps}.\n * @public\n */\nexport const SearchResultComponent = (props: SearchResultProps) => {\n  const { query, children } = props;\n\n  return (\n    <SearchResultState query={query}>\n      {({ loading, error, value }) => {\n        if (loading) {\n          return <Progress />;\n        }\n\n        if (error) {\n          return (\n            <ResponseErrorPanel\n              title=\"Error encountered while fetching search results\"\n              error={error}\n            />\n          );\n        }\n\n        if (!value?.results.length) {\n          return (\n            <EmptyState missing=\"data\" title=\"Sorry, no results were found\" />\n          );\n        }\n\n        return children(value);\n      }}\n    </SearchResultState>\n  );\n};\n\n/**\n * A component returning the search result from a parent search context or api.\n * @param props - see {@link SearchResultProps}.\n * @public\n */\nexport const SearchResult = (props: SearchResultProps) => (\n  <AnalyticsContext\n    attributes={{\n      pluginId: 'search',\n      extension: 'SearchResult',\n    }}\n  >\n    <SearchResultComponent {...props} />\n  </AnalyticsContext>\n);\n","/*\n * Copyright 2022 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React from 'react';\n\nimport { Button, makeStyles } from '@material-ui/core';\nimport ArrowBackIosIcon from '@material-ui/icons/ArrowBackIos';\nimport ArrowForwardIosIcon from '@material-ui/icons/ArrowForwardIos';\n\nimport { useSearch } from '../../context';\n\nconst useStyles = makeStyles(theme => ({\n  root: {\n    display: 'flex',\n    justifyContent: 'space-between',\n    gap: theme.spacing(2),\n    margin: theme.spacing(2, 0),\n  },\n}));\n\n/**\n * @public\n */\nexport const SearchResultPager = () => {\n  const { fetchNextPage, fetchPreviousPage } = useSearch();\n  const classes = useStyles();\n\n  if (!fetchNextPage && !fetchPreviousPage) {\n    return <></>;\n  }\n\n  return (\n    <nav aria-label=\"pagination navigation\" className={classes.root}>\n      <Button\n        aria-label=\"previous page\"\n        disabled={!fetchPreviousPage}\n        onClick={fetchPreviousPage}\n        startIcon={<ArrowBackIosIcon />}\n      >\n        Previous\n      </Button>\n\n      <Button\n        aria-label=\"next page\"\n        disabled={!fetchNextPage}\n        onClick={fetchNextPage}\n        endIcon={<ArrowForwardIosIcon />}\n      >\n        Next\n      </Button>\n    </nav>\n  );\n};\n","/*\n * Copyright 2022 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React, {\n  ReactNode,\n  ChangeEvent,\n  MouseEvent,\n  useCallback,\n  useMemo,\n} from 'react';\nimport { TablePagination } from '@material-ui/core';\nimport { useSearch } from '../../context';\n\nconst encodePageCursor = (pageCursor: number): string => {\n  return Buffer.from(pageCursor.toString(), 'utf-8').toString('base64');\n};\n\nconst decodePageCursor = (pageCursor?: string): number => {\n  if (!pageCursor) return 0;\n  return Number(Buffer.from(pageCursor, 'base64').toString('utf-8'));\n};\n\n/**\n * A page limit option, this value must not be greater than 100.\n * @public\n */\nexport type SearchPaginationLimitOption<\n  Current extends number = 101,\n  Accumulator extends number[] = [],\n> = Accumulator['length'] extends Current\n  ? Accumulator[number]\n  : SearchPaginationLimitOption<\n      Current,\n      [...Accumulator, Accumulator['length']]\n    >;\n\n/**\n * A page limit text, this function is called with a \"\\{ from, to, page, count \\}\" object.\n * @public\n */\nexport type SearchPaginationLimitText = (params: {\n  from: number;\n  to: number;\n  page: number;\n  count: number;\n}) => ReactNode;\n\n/**\n * Props for {@link SearchPaginationBase}.\n * @public\n */\nexport type SearchPaginationBaseProps = {\n  /**\n   * The component class name.\n   */\n  className?: string;\n  /**\n   * The total number of results.\n   * For an unknown number of items, provide -1.\n   * Defaults to -1.\n   */\n  total?: number;\n  /**\n   * The cursor for the current page.\n   */\n  cursor?: string;\n  /**\n   * Callback fired when the current page cursor is changed.\n   */\n  onCursorChange?: (pageCursor: string) => void;\n  /**\n   * The limit of results per page.\n   * Set -1 to display all the results.\n   */\n  limit?: number;\n  /**\n   * Customize the results per page label.\n   * Defaults to \"Results per page:\".\n   */\n  limitLabel?: ReactNode;\n  /**\n   * Customize the results per page text.\n   * Defaults to \"(\\{ from, to, count \\}) =\\> count \\> 0 ? `of $\\{count\\}` : `$\\{from\\}-$\\{to\\}`\".\n   */\n  limitText?: SearchPaginationLimitText;\n  /**\n   * Options for setting how many results show per page.\n   * If less than two options are available, no select field will be displayed.\n   * Use -1 for the value with a custom label to show all the results.\n   * Defaults to [10, 25, 50, 100].\n   */\n  limitOptions?: SearchPaginationLimitOption[];\n  /**\n   * Callback fired when the number of results per page is changed.\n   */\n  onLimitChange?: (value: number) => void;\n};\n\n/**\n * A component with controls for search results pagination.\n * @param props - See {@link SearchPaginationBaseProps}.\n * @public\n */\nexport const SearchPaginationBase = (props: SearchPaginationBaseProps) => {\n  const {\n    total: count = -1,\n    cursor: pageCursor,\n    onCursorChange: onPageCursorChange,\n    limit: rowsPerPage = 25,\n    limitLabel: labelRowsPerPage = 'Results per page:',\n    limitText: labelDisplayedRows = ({ from, to }) =>\n      count > 0 ? `of ${count}` : `${from}-${to}`,\n    limitOptions: rowsPerPageOptions,\n    onLimitChange: onPageLimitChange,\n    ...rest\n  } = props;\n\n  const page = useMemo(() => decodePageCursor(pageCursor), [pageCursor]);\n\n  const handlePageChange = useCallback(\n    (_: MouseEvent<HTMLButtonElement> | null, newValue: number) => {\n      onPageCursorChange?.(encodePageCursor(newValue));\n    },\n    [onPageCursorChange],\n  );\n\n  const handleRowsPerPageChange = useCallback(\n    (e: ChangeEvent<HTMLTextAreaElement | HTMLInputElement>) => {\n      const newValue = e.target.value;\n      onPageLimitChange?.(parseInt(newValue, 10));\n    },\n    [onPageLimitChange],\n  );\n\n  return (\n    <TablePagination\n      {...rest}\n      component=\"div\"\n      count={count}\n      page={page}\n      onPageChange={handlePageChange}\n      rowsPerPage={rowsPerPage}\n      labelRowsPerPage={labelRowsPerPage}\n      labelDisplayedRows={labelDisplayedRows}\n      rowsPerPageOptions={rowsPerPageOptions}\n      onRowsPerPageChange={handleRowsPerPageChange}\n    />\n  );\n};\n\n/**\n * Props for {@link SearchPagination}.\n * @public\n */\nexport type SearchPaginationProps = Omit<\n  SearchPaginationBaseProps,\n  'pageLimit' | 'onPageLimitChange' | 'pageCursor' | 'onPageCursorChange'\n>;\n\n/**\n * A component for setting the search context page limit and cursor.\n * @param props - See {@link SearchPaginationProps}.\n * @public\n */\nexport const SearchPagination = (props: SearchPaginationProps) => {\n  const { pageLimit, setPageLimit, pageCursor, setPageCursor } = useSearch();\n\n  return (\n    <SearchPaginationBase\n      {...props}\n      limit={pageLimit}\n      onLimitChange={setPageLimit}\n      cursor={pageCursor}\n      onCursorChange={setPageCursor}\n    />\n  );\n};\n","/*\n * Copyright 2022 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React, { ReactNode } from 'react';\nimport { AnalyticsContext, useAnalytics } from '@backstage/core-plugin-api';\nimport {\n  ResultHighlight,\n  SearchDocument,\n} from '@backstage/plugin-search-common';\nimport { HighlightedSearchResultText } from '../HighlightedSearchResultText';\nimport {\n  ListItem,\n  ListItemIcon,\n  ListItemText,\n  Box,\n  Divider,\n} from '@material-ui/core';\nimport { Link } from '@backstage/core-components';\n\n/**\n * Props for {@link DefaultResultListItem}\n *\n * @public\n */\nexport type DefaultResultListItemProps = {\n  icon?: ReactNode;\n  secondaryAction?: ReactNode;\n  result: SearchDocument;\n  highlight?: ResultHighlight;\n  rank?: number;\n  lineClamp?: number;\n};\n\n/**\n * A default result list item.\n *\n * @public\n */\nexport const DefaultResultListItemComponent = ({\n  result,\n  highlight,\n  rank,\n  icon,\n  secondaryAction,\n  lineClamp = 5,\n}: DefaultResultListItemProps) => {\n  const analytics = useAnalytics();\n  const handleClick = () => {\n    analytics.captureEvent('discover', result.title, {\n      attributes: { to: result.location },\n      value: rank,\n    });\n  };\n\n  return (\n    <Link noTrack to={result.location} onClick={handleClick}>\n      <ListItem alignItems=\"center\">\n        {icon && <ListItemIcon>{icon}</ListItemIcon>}\n        <ListItemText\n          primaryTypographyProps={{ variant: 'h6' }}\n          primary={\n            highlight?.fields.title ? (\n              <HighlightedSearchResultText\n                text={highlight.fields.title}\n                preTag={highlight.preTag}\n                postTag={highlight.postTag}\n              />\n            ) : (\n              result.title\n            )\n          }\n          secondary={\n            <span\n              style={{\n                display: '-webkit-box',\n                WebkitBoxOrient: 'vertical',\n                WebkitLineClamp: lineClamp,\n                overflow: 'hidden',\n              }}\n            >\n              {highlight?.fields.text ? (\n                <HighlightedSearchResultText\n                  text={highlight.fields.text}\n                  preTag={highlight.preTag}\n                  postTag={highlight.postTag}\n                />\n              ) : (\n                result.text\n              )}\n            </span>\n          }\n        />\n        {secondaryAction && <Box alignItems=\"flex-end\">{secondaryAction}</Box>}\n      </ListItem>\n      <Divider />\n    </Link>\n  );\n};\n\n/**\n * @public\n */\nconst HigherOrderDefaultResultListItem = (\n  props: DefaultResultListItemProps,\n) => {\n  return (\n    <AnalyticsContext\n      attributes={{\n        pluginId: 'search',\n        extension: 'DefaultResultListItem',\n      }}\n    >\n      <DefaultResultListItemComponent {...props} />\n    </AnalyticsContext>\n  );\n};\n\nexport { HigherOrderDefaultResultListItem as DefaultResultListItem };\n","/*\n * Copyright 2022 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React, { ReactNode } from 'react';\n\nimport { List, ListItem, ListProps } from '@material-ui/core';\n\nimport {\n  EmptyState,\n  Progress,\n  ResponseErrorPanel,\n} from '@backstage/core-components';\nimport { AnalyticsContext } from '@backstage/core-plugin-api';\nimport { SearchQuery, SearchResult } from '@backstage/plugin-search-common';\n\nimport { DefaultResultListItem } from '../DefaultResultListItem';\nimport { SearchResultState } from '../SearchResult';\n\n/**\n * Props for {@link SearchResultListLayout}\n * @public\n */\nexport type SearchResultListLayoutProps = ListProps & {\n  /**\n   * Search results to be rendered as a list.\n   */\n  resultItems?: SearchResult[];\n  /**\n   * Function to customize how result items are rendered.\n   */\n  renderResultItem?: (\n    value: SearchResult,\n    index: number,\n    array: SearchResult[],\n  ) => JSX.Element | null;\n  /**\n   * If defined, will render a default error panel.\n   */\n  error?: Error;\n  /**\n   * If defined, will render a default loading progress.\n   */\n  loading?: boolean;\n  /**\n   * Optional component to render when no results. Default to <EmptyState /> component.\n   */\n  noResultsComponent?: ReactNode;\n};\n\n/**\n * Default layout for rendering search results in a list.\n * @param props - See {@link SearchResultListLayoutProps}.\n * @public\n */\nexport const SearchResultListLayout = (props: SearchResultListLayoutProps) => {\n  const {\n    loading,\n    error,\n    resultItems,\n    renderResultItem = resultItem => (\n      <DefaultResultListItem\n        key={resultItem.document.location}\n        result={resultItem.document}\n      />\n    ),\n    noResultsComponent = (\n      <EmptyState missing=\"data\" title=\"Sorry, no results were found\" />\n    ),\n    ...rest\n  } = props;\n\n  return (\n    <List {...rest}>\n      {loading ? <Progress /> : null}\n      {!loading && error ? (\n        <ResponseErrorPanel\n          title=\"Error encountered while fetching search results\"\n          error={error}\n        />\n      ) : null}\n      {!loading && !error && resultItems?.length\n        ? resultItems.map(renderResultItem)\n        : null}\n      {!loading && !error && !resultItems?.length ? (\n        <ListItem>{noResultsComponent}</ListItem>\n      ) : null}\n    </List>\n  );\n};\n\n/**\n * Props for {@link SearchResultList}.\n * @public\n */\nexport type SearchResultListProps = Omit<\n  SearchResultListLayoutProps,\n  'loading' | 'error' | 'resultItems'\n> & {\n  /**\n   * A search query used for requesting the results to be listed.\n   */\n  query: Partial<SearchQuery>;\n  /**\n   * Optional property to provide if component should not render the component when no results are found.\n   */\n  disableRenderingWithNoResults?: boolean;\n};\n\n/**\n * Given a query, search for results and render them as a list.\n * @param props - See {@link SearchResultListProps}.\n * @public\n */\nexport const SearchResultList = (props: SearchResultListProps) => {\n  const { query, disableRenderingWithNoResults, ...rest } = props;\n\n  return (\n    <AnalyticsContext\n      attributes={{\n        pluginId: 'search',\n        extension: 'SearchResultList',\n      }}\n    >\n      <SearchResultState query={query}>\n        {({ loading, error, value }) => {\n          if (!value?.results?.length && disableRenderingWithNoResults) {\n            return null;\n          }\n\n          return (\n            <SearchResultListLayout\n              {...rest}\n              loading={loading}\n              error={error}\n              resultItems={value?.results}\n            />\n          );\n        }}\n      </SearchResultState>\n    </AnalyticsContext>\n  );\n};\n","/*\n * Copyright 2022 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React, {\n  ChangeEvent,\n  PropsWithChildren,\n  ReactNode,\n  useCallback,\n  useState,\n} from 'react';\nimport qs from 'qs';\n\nimport {\n  makeStyles,\n  Theme,\n  List,\n  ListSubheader,\n  ListItem,\n  ListProps,\n  Menu,\n  MenuItem,\n  InputBase,\n  Select,\n  Chip,\n  Typography,\n  TypographyProps,\n} from '@material-ui/core';\nimport AddIcon from '@material-ui/icons/Add';\nimport ArrowRightIcon from '@material-ui/icons/ArrowForwardIos';\n\nimport { JsonValue } from '@backstage/types';\nimport {\n  EmptyState,\n  Link,\n  LinkProps,\n  Progress,\n  ResponseErrorPanel,\n} from '@backstage/core-components';\nimport { AnalyticsContext } from '@backstage/core-plugin-api';\nimport { SearchQuery, SearchResult } from '@backstage/plugin-search-common';\n\nimport { DefaultResultListItem } from '../DefaultResultListItem';\nimport { SearchResultState } from '../SearchResult';\n\nconst useStyles = makeStyles((theme: Theme) => ({\n  listSubheader: {\n    display: 'flex',\n    alignItems: 'center',\n  },\n  listSubheaderName: {\n    marginLeft: theme.spacing(1),\n    textTransform: 'uppercase',\n  },\n  listSubheaderChip: {\n    color: theme.palette.text.secondary,\n    margin: theme.spacing(0, 0, 0, 1.5),\n  },\n  listSubheaderFilter: {\n    display: 'flex',\n    color: theme.palette.text.secondary,\n    margin: theme.spacing(0, 0, 0, 1.5),\n  },\n  listSubheaderLink: {\n    marginLeft: 'auto',\n    display: 'flex',\n    alignItems: 'center',\n  },\n  listSubheaderLinkIcon: {\n    fontSize: 'inherit',\n    marginLeft: theme.spacing(0.5),\n  },\n}));\n\n/**\n * Props for {@link SearchResultGroupFilterFieldLayout}\n * @public\n */\nexport type SearchResultGroupFilterFieldLayoutProps = PropsWithChildren<{\n  label: string;\n  value?: JsonValue;\n  onDelete: () => void;\n}>;\n\n/**\n * Default layout for a search group filter field.\n * @param props - See {@link SearchResultGroupFilterFieldLayoutProps}.\n * @public\n */\nexport const SearchResultGroupFilterFieldLayout = (\n  props: SearchResultGroupFilterFieldLayoutProps,\n) => {\n  const classes = useStyles();\n  const { label, children, ...rest } = props;\n\n  return (\n    <Chip\n      {...rest}\n      className={classes.listSubheaderFilter}\n      variant=\"outlined\"\n      label={\n        <>\n          {label}: {children}\n        </>\n      }\n    />\n  );\n};\n\nconst NullIcon = () => null;\n\n/**\n * Common props for a result group filter field.\n * @public\n */\nexport type SearchResultGroupFilterFieldPropsWith<T> = T &\n  SearchResultGroupFilterFieldLayoutProps & {\n    onChange: (value: JsonValue) => void;\n  };\n\nconst useSearchResultGroupTextFilterStyles = makeStyles((theme: Theme) => ({\n  root: {\n    fontSize: 'inherit',\n    '&:focus': {\n      outline: 'none',\n      background: theme.palette.common.white,\n    },\n    '&:not(:focus)': {\n      cursor: 'pointer',\n      color: theme.palette.primary.main,\n      '&:hover': {\n        textDecoration: 'underline',\n      },\n    },\n  },\n}));\n\n/**\n * Props for {@link SearchResultGroupTextFilterField}.\n * @public\n */\nexport type SearchResultGroupTextFilterFieldProps =\n  SearchResultGroupFilterFieldPropsWith<{}>;\n\n/**\n * A text field that can be used as filter on search result groups.\n * @param props - See {@link SearchResultGroupTextFilterFieldProps}.\n * @example\n * ```\n * <SearchResultGroupTextFilterField\n *   id=\"lifecycle\"\n *   label=\"Lifecycle\"\n *   value={value}\n *   onChange={handleChangeFilter}\n *   onDelete={handleDeleteFilter}\n * />\n * ```\n * @public\n */\nexport const SearchResultGroupTextFilterField = (\n  props: SearchResultGroupTextFilterFieldProps,\n) => {\n  const classes = useSearchResultGroupTextFilterStyles();\n  const { label, value = 'None', onChange, onDelete } = props;\n\n  const handleChange = useCallback(\n    (e: ChangeEvent<HTMLInputElement>) => {\n      onChange(e.target.value);\n    },\n    [onChange],\n  );\n\n  return (\n    <SearchResultGroupFilterFieldLayout label={label} onDelete={onDelete}>\n      <Typography\n        role=\"textbox\"\n        component=\"span\"\n        className={classes.root}\n        onChange={handleChange}\n        contentEditable\n        suppressContentEditableWarning\n      >\n        {value}\n      </Typography>\n    </SearchResultGroupFilterFieldLayout>\n  );\n};\n\nconst useSearchResultGroupSelectFilterStyles = makeStyles((theme: Theme) => ({\n  root: {\n    fontSize: 'inherit',\n    '&:not(:focus)': {\n      cursor: 'pointer',\n      color: theme.palette.primary.main,\n      '&:hover': {\n        textDecoration: 'underline',\n      },\n    },\n    '&:focus': {\n      outline: 'none',\n    },\n    '&>div:first-child': {\n      padding: 0,\n    },\n  },\n}));\n\n/**\n * Props for {@link SearchResultGroupTextFilterField}.\n * @public\n */\nexport type SearchResultGroupSelectFilterFieldProps =\n  SearchResultGroupFilterFieldPropsWith<{\n    children: ReactNode;\n  }>;\n\n/**\n * A select field that can be used as filter on search result groups.\n * @param props - See {@link SearchResultGroupSelectFilterFieldProps}.\n * @example\n * ```\n * <SearchResultGroupSelectFilterField\n *   id=\"lifecycle\"\n *   label=\"Lifecycle\"\n *   value={filters.lifecycle}\n *   onChange={handleChangeFilter}\n *   onDelete={handleDeleteFilter}\n * >\n *   <MenuItem value=\"experimental\">Experimental</MenuItem>\n *   <MenuItem value=\"production\">Production</MenuItem>\n *  </SearchResultGroupSelectFilterField>\n * ```\n * @public\n */\nexport const SearchResultGroupSelectFilterField = (\n  props: SearchResultGroupSelectFilterFieldProps,\n) => {\n  const classes = useSearchResultGroupSelectFilterStyles();\n  const { label, value = 'none', onChange, onDelete, children } = props;\n\n  const handleChange = useCallback(\n    (e: ChangeEvent<{ value: unknown }>) => {\n      onChange(e.target.value as JsonValue);\n    },\n    [onChange],\n  );\n\n  return (\n    <SearchResultGroupFilterFieldLayout label={label} onDelete={onDelete}>\n      <Select\n        className={classes.root}\n        value={value}\n        onChange={handleChange}\n        input={<InputBase />}\n        IconComponent={NullIcon}\n      >\n        <MenuItem value=\"none\">None</MenuItem>\n        {children}\n      </Select>\n    </SearchResultGroupFilterFieldLayout>\n  );\n};\n\n/**\n * Props for {@link SearchResultGroupLayout}\n * @public\n */\nexport type SearchResultGroupLayoutProps<FilterOption> = ListProps & {\n  /**\n   * Icon that representing a result group.\n   */\n  icon: JSX.Element;\n  /**\n   * The results group title content, it could be a text or an element.\n   */\n  title: ReactNode;\n  /**\n   * Props for the results group title.\n   */\n  titleProps?: Partial<TypographyProps>;\n  /**\n   * The results group link content, it could be a text or an element.\n   */\n  link?: ReactNode;\n  /**\n   * Props for the results group link, the \"to\" prop defaults to \"/search\".\n   */\n  linkProps?: Partial<LinkProps>;\n  /**\n   * A generic filter options that is rendered on the \"Add filter\" dropdown.\n   */\n  filterOptions?: FilterOption[];\n  /**\n   * Function to customize how filter options are rendered.\n   * @remarks Defaults to a menu item where its value and label bounds to the option string.\n   */\n  renderFilterOption?: (\n    value: FilterOption,\n    index: number,\n    array: FilterOption[],\n  ) => JSX.Element | null;\n  /**\n   * A list of search filter keys, also known as filter field names.\n   */\n  filterFields?: string[];\n  /**\n   * Function to customize how filter chips are rendered.\n   */\n  renderFilterField?: (key: string) => JSX.Element | null;\n  /**\n   * Search results to be rendered as a group.\n   */\n  resultItems?: SearchResult[];\n  /**\n   * Function to customize how result items are rendered.\n   */\n  renderResultItem?: (\n    value: SearchResult,\n    index: number,\n    array: SearchResult[],\n  ) => JSX.Element | null;\n  /**\n   * If defined, will render a default error panel.\n   */\n  error?: Error;\n  /**\n   * If defined, will render a default loading progress.\n   */\n  loading?: boolean;\n  /**\n   * Optional component to render when no results. Default to <EmptyState /> component.\n   */\n  noResultsComponent?: ReactNode;\n};\n\n/**\n * Default layout for rendering search results in a group.\n * @param props - See {@link SearchResultGroupLayoutProps}.\n * @public\n */\nexport function SearchResultGroupLayout<FilterOption>(\n  props: SearchResultGroupLayoutProps<FilterOption>,\n) {\n  const classes = useStyles();\n  const [anchorEl, setAnchorEl] = useState<null | HTMLElement>(null);\n\n  const {\n    loading,\n    error,\n    icon,\n    title,\n    titleProps = {},\n    link = (\n      <>\n        See all\n        <ArrowRightIcon className={classes.listSubheaderLinkIcon} />\n      </>\n    ),\n    linkProps = {},\n    filterOptions,\n    renderFilterOption = filterOption => (\n      <MenuItem key={String(filterOption)} value={String(filterOption)}>\n        {filterOption}\n      </MenuItem>\n    ),\n    filterFields,\n    renderFilterField,\n    resultItems,\n    renderResultItem = resultItem => (\n      <DefaultResultListItem\n        key={resultItem.document.location}\n        result={resultItem.document}\n      />\n    ),\n    noResultsComponent = (\n      <EmptyState missing=\"data\" title=\"Sorry, no results were found\" />\n    ),\n    ...rest\n  } = props;\n\n  const handleClick = useCallback((e: React.MouseEvent<HTMLButtonElement>) => {\n    setAnchorEl(e.currentTarget);\n  }, []);\n\n  const handleClose = useCallback(() => {\n    setAnchorEl(null);\n  }, []);\n\n  return (\n    <List {...rest}>\n      <ListSubheader className={classes.listSubheader}>\n        {icon}\n        <Typography\n          className={classes.listSubheaderName}\n          component=\"strong\"\n          {...titleProps}\n        >\n          {title}\n        </Typography>\n        {filterOptions ? (\n          <Chip\n            className={classes.listSubheaderChip}\n            component=\"button\"\n            icon={<AddIcon />}\n            variant=\"outlined\"\n            label=\"Add filter\"\n            aria-controls=\"filters-menu\"\n            aria-haspopup=\"true\"\n            onClick={handleClick}\n          />\n        ) : null}\n        {filterOptions ? (\n          <Menu\n            id=\"filters-menu\"\n            anchorEl={anchorEl}\n            open={Boolean(anchorEl)}\n            onClose={handleClose}\n            onClick={handleClose}\n            keepMounted\n          >\n            {filterOptions.map(renderFilterOption)}\n          </Menu>\n        ) : null}\n        {filterFields?.map(\n          filterField => renderFilterField?.(filterField) ?? null,\n        )}\n        <Link className={classes.listSubheaderLink} to=\"/search\" {...linkProps}>\n          {link}\n        </Link>\n      </ListSubheader>\n      {loading ? <Progress /> : null}\n      {!loading && error ? (\n        <ResponseErrorPanel\n          title=\"Error encountered while fetching search results\"\n          error={error}\n        />\n      ) : null}\n      {!loading && !error && resultItems?.length\n        ? resultItems.map(renderResultItem)\n        : null}\n      {!loading && !error && !resultItems?.length ? (\n        <ListItem>{noResultsComponent}</ListItem>\n      ) : null}\n    </List>\n  );\n}\n\n/**\n * Props for {@link SearchResultGroup}.\n * @public\n */\nexport type SearchResultGroupProps<FilterOption> = Omit<\n  SearchResultGroupLayoutProps<FilterOption>,\n  'loading' | 'error' | 'resultItems' | 'filterFields'\n> & {\n  /**\n   * A search query used for requesting the results to be grouped.\n   */\n  query: Partial<SearchQuery>;\n  /**\n   * Optional property to provide if component should not render the group when no results are found.\n   */\n  disableRenderingWithNoResults?: boolean;\n};\n\n/**\n * Given a query, search for results and render them as a group.\n * @param props - See {@link SearchResultGroupProps}.\n * @public\n */\nexport function SearchResultGroup<FilterOption>(\n  props: SearchResultGroupProps<FilterOption>,\n) {\n  const {\n    query,\n    linkProps = {},\n    disableRenderingWithNoResults,\n    ...rest\n  } = props;\n\n  const to = `/search?${qs.stringify(\n    {\n      query: query.term,\n      types: query.types,\n      filters: query.filters,\n      pageCursor: query.pageCursor,\n    },\n    { arrayFormat: 'brackets' },\n  )}`;\n\n  return (\n    <AnalyticsContext\n      attributes={{\n        pluginId: 'search',\n        extension: 'SearchResultGroup',\n      }}\n    >\n      <SearchResultState query={query}>\n        {({ loading, error, value }) => {\n          if (!value?.results?.length && disableRenderingWithNoResults) {\n            return null;\n          }\n\n          return (\n            <SearchResultGroupLayout\n              {...rest}\n              loading={loading}\n              error={error}\n              linkProps={{ to, ...linkProps }}\n              resultItems={value?.results}\n              filterFields={Object.keys(query.filters ?? {})}\n            />\n          );\n        }}\n      </SearchResultState>\n    </AnalyticsContext>\n  );\n}\n","/*\n * Copyright 2022 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React, { useCallback } from 'react';\nimport { useOutlet } from 'react-router-dom';\n\nimport {\n  attachComponentData,\n  createReactExtension,\n  ElementCollection,\n  Extension,\n  useElementFilter,\n} from '@backstage/core-plugin-api';\n\nimport { TechDocsAddonLocations, TechDocsAddonOptions } from './types';\n\nexport const TECHDOCS_ADDONS_KEY = 'techdocs.addons.addon.v1';\n\n/**\n * Marks the `<TechDocsAddons>` registry component.\n * @public\n */\nexport const TECHDOCS_ADDONS_WRAPPER_KEY = 'techdocs.addons.wrapper.v1';\n\n/**\n * TechDocs Addon registry.\n * @public\n */\nexport const TechDocsAddons: React.ComponentType = () => null;\n\nattachComponentData(TechDocsAddons, TECHDOCS_ADDONS_WRAPPER_KEY, true);\n\nconst getDataKeyByName = (name: string) => {\n  return `${TECHDOCS_ADDONS_KEY}.${name.toLocaleLowerCase('en-US')}`;\n};\n\n/**\n * Create a TechDocs addon overload signature without props.\n * @public\n */\nexport function createTechDocsAddonExtension(\n  options: TechDocsAddonOptions,\n): Extension<() => JSX.Element | null>;\n\n/**\n * Create a TechDocs addon overload signature with props.\n * @public\n */\nexport function createTechDocsAddonExtension<TComponentProps>(\n  options: TechDocsAddonOptions<TComponentProps>,\n): Extension<(props: TComponentProps) => JSX.Element | null>;\n\n/**\n * Create a TechDocs addon implementation.\n * @public\n */\nexport function createTechDocsAddonExtension<TComponentProps>(\n  options: TechDocsAddonOptions<TComponentProps>,\n): Extension<(props: TComponentProps) => JSX.Element | null> {\n  const { name, component: TechDocsAddon } = options;\n  return createReactExtension({\n    name,\n    component: {\n      sync: (props: TComponentProps) => <TechDocsAddon {...props} />,\n    },\n    data: {\n      [TECHDOCS_ADDONS_KEY]: options,\n      [getDataKeyByName(name)]: true,\n    },\n  });\n}\n\nconst getTechDocsAddonByName = (\n  collection: ElementCollection,\n  key: string,\n): JSX.Element | undefined => {\n  return collection.selectByComponentData({ key }).getElements()[0];\n};\n\nconst getAllTechDocsAddons = (collection: ElementCollection) => {\n  return collection\n    .selectByComponentData({\n      key: TECHDOCS_ADDONS_WRAPPER_KEY,\n    })\n    .selectByComponentData({\n      key: TECHDOCS_ADDONS_KEY,\n    });\n};\n\nconst getAllTechDocsAddonsData = (collection: ElementCollection) => {\n  return collection\n    .selectByComponentData({\n      key: TECHDOCS_ADDONS_WRAPPER_KEY,\n    })\n    .findComponentData<TechDocsAddonOptions>({\n      key: TECHDOCS_ADDONS_KEY,\n    });\n};\n\n/**\n * hook to use addons in components\n * @public\n */\nexport const useTechDocsAddons = () => {\n  const node = useOutlet();\n  const collection = useElementFilter(node, getAllTechDocsAddons);\n  const options = useElementFilter(node, getAllTechDocsAddonsData);\n\n  const findAddonByData = useCallback(\n    (data: TechDocsAddonOptions | undefined) => {\n      if (!collection || !data) return null;\n      const nameKey = getDataKeyByName(data.name);\n      return getTechDocsAddonByName(collection, nameKey) ?? null;\n    },\n    [collection],\n  );\n\n  const renderComponentByName = useCallback(\n    (name: string) => {\n      const data = options.find(option => option.name === name);\n      return data ? findAddonByData(data) : null;\n    },\n    [options, findAddonByData],\n  );\n\n  const renderComponentsByLocation = useCallback(\n    (location: keyof typeof TechDocsAddonLocations) => {\n      const data = options.filter(option => option.location === location);\n      return data.length ? data.map(findAddonByData) : null;\n    },\n    [options, findAddonByData],\n  );\n\n  return { renderComponentByName, renderComponentsByLocation };\n};\n","/*\n * Copyright 2022 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { CompoundEntityRef } from '@backstage/catalog-model';\nimport { createApiRef } from '@backstage/core-plugin-api';\nimport { TechDocsEntityMetadata, TechDocsMetadata } from './types';\n\n/**\n * API to talk to techdocs-backend.\n *\n * @public\n */\nexport interface TechDocsApi {\n  getApiOrigin(): Promise<string>;\n  getTechDocsMetadata(entityId: CompoundEntityRef): Promise<TechDocsMetadata>;\n  getEntityMetadata(\n    entityId: CompoundEntityRef,\n  ): Promise<TechDocsEntityMetadata>;\n}\n\n/**\n * Utility API reference for the {@link TechDocsApi}.\n *\n * @public\n */\nexport const techdocsApiRef = createApiRef<TechDocsApi>({\n  id: 'plugin.techdocs.service',\n});\n\n/**\n * The outcome of a docs sync operation.\n *\n * @public\n */\nexport type SyncResult = 'cached' | 'updated';\n\n/**\n * API which talks to TechDocs storage to fetch files to render.\n *\n * @public\n */\nexport interface TechDocsStorageApi {\n  getApiOrigin(): Promise<string>;\n  getStorageUrl(): Promise<string>;\n  getBuilder(): Promise<string>;\n  getEntityDocs(entityId: CompoundEntityRef, path: string): Promise<string>;\n  syncEntityDocs(\n    entityId: CompoundEntityRef,\n    logHandler?: (line: string) => void,\n  ): Promise<SyncResult>;\n  getBaseUrl(\n    oldBaseUrl: string,\n    entityId: CompoundEntityRef,\n    path: string,\n  ): Promise<string>;\n}\n\n/**\n * Utility API reference for the {@link TechDocsStorageApi}.\n *\n * @public\n */\nexport const techdocsStorageApiRef = createApiRef<TechDocsStorageApi>({\n  id: 'plugin.techdocs.storageservice',\n});\n","/*\n * Copyright 2022 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { Config } from '@backstage/config';\nimport { CompoundEntityRef } from '@backstage/catalog-model';\n\n/**\n * Lower-case entity triplets by default, but allow override.\n *\n * @public\n */\nexport function toLowercaseEntityRefMaybe(\n  entityRef: CompoundEntityRef,\n  config: Config,\n): CompoundEntityRef {\n  if (config.getOptionalBoolean('techdocs.legacyUseCaseSensitiveTripletPaths'))\n    return entityRef;\n\n  entityRef.kind = entityRef.kind.toLocaleLowerCase();\n  entityRef.name = entityRef.name.toLocaleLowerCase();\n  entityRef.namespace = entityRef.namespace.toLocaleLowerCase();\n\n  return entityRef;\n}\n","/*\n * Copyright 2022 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React, {\n  Dispatch,\n  SetStateAction,\n  useContext,\n  useState,\n  memo,\n  ReactNode,\n} from 'react';\nimport useAsync, { AsyncState } from 'react-use/lib/useAsync';\n\nimport {\n  CompoundEntityRef,\n  stringifyEntityRef,\n} from '@backstage/catalog-model';\nimport {\n  createVersionedContext,\n  createVersionedValueMap,\n} from '@backstage/version-bridge';\n\nimport { configApiRef, useApi } from '@backstage/core-plugin-api';\n\nimport { techdocsApiRef } from './api';\nimport { TechDocsEntityMetadata, TechDocsMetadata } from './types';\n\nimport { toLowercaseEntityRefMaybe } from './helpers';\n\nconst areEntityRefsEqual = (\n  prevEntityRef: CompoundEntityRef,\n  nextEntityRef: CompoundEntityRef,\n) => {\n  return (\n    stringifyEntityRef(prevEntityRef) === stringifyEntityRef(nextEntityRef)\n  );\n};\n\n/**\n * @public type for the value of the TechDocsReaderPageContext\n */\nexport type TechDocsReaderPageValue = {\n  metadata: AsyncState<TechDocsMetadata>;\n  entityRef: CompoundEntityRef;\n  entityMetadata: AsyncState<TechDocsEntityMetadata>;\n  shadowRoot?: ShadowRoot;\n  setShadowRoot: Dispatch<SetStateAction<ShadowRoot | undefined>>;\n  title: string;\n  setTitle: Dispatch<SetStateAction<string>>;\n  subtitle: string;\n  setSubtitle: Dispatch<SetStateAction<string>>;\n  /**\n   * @deprecated property can be passed down directly to the `TechDocsReaderPageContent` instead.\n   */\n  onReady?: () => void;\n};\n\nconst defaultTechDocsReaderPageValue: TechDocsReaderPageValue = {\n  title: '',\n  subtitle: '',\n  setTitle: () => {},\n  setSubtitle: () => {},\n  setShadowRoot: () => {},\n  metadata: { loading: true },\n  entityMetadata: { loading: true },\n  entityRef: { kind: '', name: '', namespace: '' },\n};\n\nconst TechDocsReaderPageContext = createVersionedContext<{\n  1: TechDocsReaderPageValue;\n}>('techdocs-reader-page-context');\n\n/**\n * render function for {@link TechDocsReaderPageProvider}\n *\n * @public\n */\nexport type TechDocsReaderPageProviderRenderFunction = (\n  value: TechDocsReaderPageValue,\n) => JSX.Element;\n\n/**\n * Props for {@link TechDocsReaderPageProvider}\n *\n * @public\n */\nexport type TechDocsReaderPageProviderProps = {\n  entityRef: CompoundEntityRef;\n  children: TechDocsReaderPageProviderRenderFunction | ReactNode;\n};\n\n/**\n * A context to store the reader page state\n * @public\n */\nexport const TechDocsReaderPageProvider = memo(\n  ({ entityRef, children }: TechDocsReaderPageProviderProps) => {\n    const techdocsApi = useApi(techdocsApiRef);\n    const config = useApi(configApiRef);\n\n    const metadata = useAsync(async () => {\n      return techdocsApi.getTechDocsMetadata(entityRef);\n    }, [entityRef]);\n\n    const entityMetadata = useAsync(async () => {\n      return techdocsApi.getEntityMetadata(entityRef);\n    }, [entityRef]);\n\n    const [title, setTitle] = useState(defaultTechDocsReaderPageValue.title);\n    const [subtitle, setSubtitle] = useState(\n      defaultTechDocsReaderPageValue.subtitle,\n    );\n    const [shadowRoot, setShadowRoot] = useState<ShadowRoot | undefined>(\n      defaultTechDocsReaderPageValue.shadowRoot,\n    );\n\n    const value = {\n      metadata,\n      entityRef: toLowercaseEntityRefMaybe(entityRef, config),\n      entityMetadata,\n      shadowRoot,\n      setShadowRoot,\n      title,\n      setTitle,\n      subtitle,\n      setSubtitle,\n    };\n    const versionedValue = createVersionedValueMap({ 1: value });\n\n    return (\n      <TechDocsReaderPageContext.Provider value={versionedValue}>\n        {children instanceof Function ? children(value) : children}\n      </TechDocsReaderPageContext.Provider>\n    );\n  },\n  (prevProps, nextProps) => {\n    return areEntityRefsEqual(prevProps.entityRef, nextProps.entityRef);\n  },\n);\n\n/**\n * Hook used to get access to shared state between reader page components.\n * @public\n */\nexport const useTechDocsReaderPage = () => {\n  const versionedContext = useContext(TechDocsReaderPageContext);\n\n  if (versionedContext === undefined) {\n    return defaultTechDocsReaderPageValue;\n  }\n\n  const context = versionedContext.atVersion(1);\n  if (context === undefined) {\n    throw new Error('No context found for version 1.');\n  }\n\n  return context;\n};\n","/*\n * Copyright 2022 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { ComponentType } from 'react';\nimport { Entity } from '@backstage/catalog-model';\n\n/**\n * Metadata for TechDocs page\n *\n * @public\n */\nexport type TechDocsMetadata = {\n  site_name: string;\n  site_description: string;\n};\n\n/**\n * Metadata for TechDocs Entity\n *\n * @public\n */\nexport type TechDocsEntityMetadata = Entity & {\n  locationMetadata?: { type: string; target: string };\n};\n\n/**\n * Locations for which TechDocs addons may be declared and rendered.\n * @public\n */\nexport const TechDocsAddonLocations = Object.freeze({\n  /**\n   * These addons fill up the header from the right, on the same line as the\n   * title.\n   */\n  Header: 'Header',\n\n  /**\n   * These addons appear below the header and above all content; tooling addons\n   * can be inserted for convenience.\n   */\n  Subheader: 'Subheader',\n\n  /**\n   * These addons are items added to the settings menu list and are designed to make\n   * the reader experience customizable, for example accessibility options\n   */\n  Settings: 'Settings',\n\n  /**\n   * These addons appear left of the content and above the navigation.\n   */\n  PrimarySidebar: 'PrimarySidebar',\n\n  /**\n   * These addons appear right of the content and above the table of contents.\n   */\n  SecondarySidebar: 'SecondarySidebar',\n\n  /**\n   * A virtual location which allows mutation of all content within the shadow\n   * root by transforming DOM nodes. These addons should return null on render.\n   */\n  Content: 'Content',\n\n  /**\n   * todo(backstage/community): This is a proposed virtual location which would\n   * help implement a common addon pattern in which many instances of a given\n   * element in markdown would be dynamically replaced at render-time based on\n   * attributes provided on that element, for example:\n   *\n   * ```md\n   * ## For Fun\n   * <TechDocsAddon>CatGif</TechDocsAddon>\n   *\n   * ## Component Metadata\n   * <TechDocsAddon entityRef=\"default:component/some-component-name\">CatalogEntityCard</TechDocsAddon>\n   *\n   * ## System Metadata\n   * <TechDocsAddon entityRef=\"default:system/some-system-name\">CatalogEntityCard</TechDocsAddon>\n   * ```\n   *\n   * Could correspond to a TechDocs addon named `CatalogEntityCard` with\n   * location `TechDocsAddonLocations.COMPONENT`, whose `component` would be\n   * the react component that would be rendered in place of all instances of\n   * the markdown illustrated above.\n   *\n   * The `@backstage/plugin-techdocs-react` package would need to be updated to, in\n   * cases where such addons had been registered, find all instances of the\n   * the `<TechDocsAddon>` tag whose `textContent` corresponded with the name of the\n   * addon, then replace them with component instances of the addon component,\n   * passing any attributes from the tag as props to the component.\n   */\n  // Component: 'Component',\n} as const);\n\n/**\n * Options for creating a TechDocs addon.\n * @public\n */\nexport type TechDocsAddonOptions<TAddonProps = {}> = {\n  name: string;\n  location: keyof typeof TechDocsAddonLocations;\n  component: ComponentType<TAddonProps>;\n};\n","/*\n * Copyright 2022 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React, {\n  PropsWithChildren,\n  useState,\n  useEffect,\n  useCallback,\n} from 'react';\n\nimport { create } from 'jss';\nimport { StylesProvider, jssPreset } from '@material-ui/styles';\n\nimport { Progress } from '@backstage/core-components';\n\n/**\n * Name for the event dispatched when ShadowRoot styles are loaded.\n * @public\n */\nexport const SHADOW_DOM_STYLE_LOAD_EVENT = 'TECH_DOCS_SHADOW_DOM_STYLE_LOAD';\n\n/**\n * Dispatch style load event after all styles are loaded.\n * @param element - the ShadowRoot tree.\n */\nconst useShadowDomStylesEvents = (element: Element | null) => {\n  useEffect(() => {\n    if (!element) {\n      return () => {};\n    }\n\n    const styles = element.querySelectorAll<HTMLElement>(\n      'head > link[rel=\"stylesheet\"]',\n    );\n\n    let count = styles?.length ?? 0;\n    const event = new CustomEvent(SHADOW_DOM_STYLE_LOAD_EVENT);\n\n    if (!count) {\n      element.dispatchEvent(event);\n      return () => {};\n    }\n\n    const handleLoad = () => {\n      if (--count === 0) {\n        element.dispatchEvent(event);\n      }\n    };\n\n    styles?.forEach(style => {\n      style.addEventListener('load', handleLoad);\n    });\n\n    return () => {\n      styles?.forEach(style => {\n        style.removeEventListener('load', handleLoad);\n      });\n    };\n  }, [element]);\n};\n\n/**\n * Returns the style's loading state.\n *\n * @example\n * Here's an example that updates the sidebar position only after styles are calculated:\n * ```jsx\n * import {\n *   TechDocsShadowDom,\n *   useShadowDomStylesLoading,\n * } from '@backstage/plugin-techdocs-react';\n *\n * export const TechDocsReaderPageContent = () => {\n *   // ...\n *   const dom = useTechDocsReaderDom(entity);\n *   const isStyleLoading = useShadowDomStylesLoading(dom);\n *\n *   const updateSidebarPosition = useCallback(() => {\n *     //...\n *   }, [dom]);\n *\n *   useEffect(() => {\n *     if (!isStyleLoading) {\n *       updateSidebarPosition();\n *     }\n *   }, [isStyleLoading, updateSidebarPosition]);\n *\n *   const handleDomAppend = useCallback(\n *     (newShadowRoot: ShadowRoot) => {\n *       setShadowRoot(newShadowRoot);\n *     },\n *     [setShadowRoot],\n *   );\n *\n *   return <TechDocsShadowDom element={dom} onAppend={handleDomAppend} />;\n * };\n * ```\n *\n * @param element - which is the ShadowRoot tree.\n * @returns a boolean value, true if styles are being loaded.\n * @public\n */\nexport const useShadowDomStylesLoading = (element: Element | null) => {\n  const [loading, setLoading] = useState(false);\n\n  useEffect(() => {\n    if (!element) return () => {};\n\n    setLoading(true);\n\n    const style = (element as HTMLElement).style;\n\n    style.setProperty('opacity', '0');\n\n    const handleLoad = () => {\n      setLoading(false);\n      style.setProperty('opacity', '1');\n    };\n\n    element.addEventListener(SHADOW_DOM_STYLE_LOAD_EVENT, handleLoad);\n\n    return () => {\n      element.removeEventListener(SHADOW_DOM_STYLE_LOAD_EVENT, handleLoad);\n    };\n  }, [element]);\n\n  return loading;\n};\n\n/**\n * Props for {@link TechDocsShadowDom}.\n *\n * @remarks\n * If you want to use portals to render Material UI components in the Shadow DOM,\n * you must render these portals as children because this component wraps its children in a Material UI StylesProvider\n * to ensure that Material UI styles are applied.\n *\n * @public\n */\nexport type TechDocsShadowDomProps = PropsWithChildren<{\n  /**\n   * Element tree that is appended to ShadowRoot.\n   */\n  element: Element;\n  /**\n   * Callback called when the element tree is appended in ShadowRoot.\n   */\n  onAppend?: (shadowRoot: ShadowRoot) => void;\n}>;\n\n/**\n * Renders a tree of elements in a Shadow DOM.\n *\n * @remarks\n * Centers the styles loaded event to avoid having multiple locations setting the opacity style in Shadow DOM causing the screen to flash multiple times,\n * so if you want to know when Shadow DOM styles are computed, you can listen for the \"TECH_DOCS_SHADOW_DOM_STYLE_LOAD\" event dispatched by the element tree.\n *\n * @example\n * Here is an example using this component and also listening for styles loaded event:\n *```jsx\n * import {\n *   TechDocsShadowDom,\n *   SHADOW_DOM_STYLE_LOAD_EVENT,\n * } from '@backstage/plugin-techdocs-react';\n *\n * export const TechDocsReaderPageContent = ({ entity }: TechDocsReaderPageContentProps) => {\n *   // ...\n *   const dom = useTechDocsReaderDom(entity);\n *\n *   useEffect(() => {\n *     const updateSidebarPosition = () => {\n *       // ...\n *     };\n *     dom?.addEventListener(SHADOW_DOM_STYLE_LOAD_EVENT, updateSidebarPosition);\n *     return () => {\n *       dom?.removeEventListener(SHADOW_DOM_STYLE_LOAD_EVENT, updateSidebarPosition);\n *     };\n *   }, [dom]);\n *\n *   const handleDomAppend = useCallback(\n *     (newShadowRoot: ShadowRoot) => {\n *       setShadowRoot(newShadowRoot);\n *     },\n *     [setShadowRoot],\n *   );\n *\n *   return <TechDocsShadowDom element={dom} onAppend={handleDomAppend} />;\n * };\n * ```\n *\n * @param props - see {@link TechDocsShadowDomProps}.\n * @public\n */\nexport const TechDocsShadowDom = ({\n  element,\n  onAppend,\n  children,\n}: TechDocsShadowDomProps) => {\n  const [jss, setJss] = useState(\n    create({\n      ...jssPreset(),\n      insertionPoint: undefined,\n    }),\n  );\n\n  useShadowDomStylesEvents(element);\n  const loading = useShadowDomStylesLoading(element);\n\n  const ref = useCallback(\n    (shadowHost: HTMLDivElement) => {\n      if (!element || !shadowHost) return;\n\n      setJss(\n        create({\n          ...jssPreset(),\n          insertionPoint: element.querySelector('head') || undefined,\n        }),\n      );\n\n      let shadowRoot = shadowHost.shadowRoot;\n\n      if (!shadowRoot) {\n        shadowRoot = shadowHost.attachShadow({ mode: 'open' });\n      }\n\n      shadowRoot.replaceChildren(element);\n\n      if (typeof onAppend === 'function') {\n        onAppend(shadowRoot);\n      }\n    },\n    [element, onAppend],\n  );\n\n  return (\n    <>\n      {loading && <Progress />}\n      {/* The sheetsManager={new Map()} is needed in order to deduplicate the injection of CSS in the page. */}\n      <StylesProvider jss={jss} sheetsManager={new Map()}>\n        <div ref={ref} data-testid=\"techdocs-native-shadowroot\" />\n        {children}\n      </StylesProvider>\n    </>\n  );\n};\n","/*\n * Copyright 2022 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport { useState, useEffect, useMemo } from 'react';\nimport debounce from 'lodash/debounce';\nimport { useTechDocsReaderPage } from './context';\n\n/**\n * Hook for use within TechDocs addons that provides access to the underlying\n * shadow root of the current page, allowing the DOM within to be mutated.\n * @public\n */\nexport const useShadowRoot = () => {\n  const { shadowRoot } = useTechDocsReaderPage();\n  return shadowRoot;\n};\n\n/**\n * Convenience hook for use within TechDocs addons that provides access to\n * elements that match a given selector within the shadow root.\n *\n * @public\n */\nexport const useShadowRootElements = <\n  TReturnedElement extends HTMLElement = HTMLElement,\n>(\n  selectors: string[],\n): TReturnedElement[] => {\n  const shadowRoot = useShadowRoot();\n  if (!shadowRoot) return [];\n  return selectors\n    .map(selector => shadowRoot?.querySelectorAll<TReturnedElement>(selector))\n    .filter(nodeList => nodeList.length)\n    .map(nodeList => Array.from(nodeList))\n    .flat();\n};\n\nconst isValidSelection = (newSelection: Selection) => {\n  // Safari sets the selection rect to top zero\n  return (\n    newSelection.toString() &&\n    newSelection.rangeCount &&\n    newSelection.getRangeAt(0).getBoundingClientRect().top\n  );\n};\n\n/**\n * Hook for retreiving a selection within the ShadowRoot.\n * @public\n */\nexport const useShadowRootSelection = (wait: number = 0) => {\n  const shadowRoot = useShadowRoot();\n  const [selection, setSelection] = useState<Selection | null>(null);\n  const handleSelectionChange = useMemo(\n    () =>\n      debounce(() => {\n        const shadowDocument = shadowRoot as ShadowRoot &\n          Pick<Document, 'getSelection'>;\n        // Firefox and Safari don't implement getSelection for Shadow DOM\n        const newSelection = shadowDocument.getSelection\n          ? shadowDocument.getSelection()\n          : document.getSelection();\n\n        if (newSelection && isValidSelection(newSelection)) {\n          setSelection(newSelection);\n        } else {\n          setSelection(null);\n        }\n      }, wait),\n    [shadowRoot, setSelection, wait],\n  );\n\n  useEffect(() => {\n    window.document.addEventListener('selectionchange', handleSelectionChange);\n    return () =>\n      window.document.removeEventListener(\n        'selectionchange',\n        handleSelectionChange,\n      );\n  }, [handleSelectionChange]);\n\n  return selection;\n};\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React from 'react';\n\nimport { Entity, getCompoundEntityRef } from '@backstage/catalog-model';\n\nimport { TechDocsReaderPage } from './plugin';\nimport { TechDocsReaderPageSubheader } from './reader/components/TechDocsReaderPageSubheader';\nimport { TechDocsReaderPageContent } from './reader/components/TechDocsReaderPageContent';\n\ntype EntityPageDocsProps = { entity: Entity };\n\nexport const EntityPageDocs = ({ entity }: EntityPageDocsProps) => {\n  const entityRef = getCompoundEntityRef(entity);\n\n  return (\n    <TechDocsReaderPage entityRef={entityRef}>\n      <TechDocsReaderPageSubheader />\n      <TechDocsReaderPageContent withSearch={false} />\n    </TechDocsReaderPage>\n  );\n};\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React, { PropsWithChildren } from 'react';\nimport { Route, Routes, useRoutes } from 'react-router-dom';\n\nimport { Entity } from '@backstage/catalog-model';\nimport { useEntity } from '@backstage/plugin-catalog-react';\nimport { MissingAnnotationEmptyState } from '@backstage/core-components';\n\nimport { EntityPageDocs } from './EntityPageDocs';\nimport { TechDocsIndexPage } from './home/components/TechDocsIndexPage';\nimport { TechDocsReaderPage } from './reader/components/TechDocsReaderPage';\n\nconst TECHDOCS_ANNOTATION = 'backstage.io/techdocs-ref';\n\n/**\n * Helper that takes in entity and returns true/false if TechDocs is available for the entity\n *\n * @public\n */\nexport const isTechDocsAvailable = (entity: Entity) =>\n  Boolean(entity?.metadata?.annotations?.[TECHDOCS_ANNOTATION]);\n\n/**\n * Responsible for registering routes for TechDocs, TechDocs Homepage and separate TechDocs page\n *\n * @public\n */\nexport const Router = () => {\n  return (\n    <Routes>\n      <Route path=\"/\" element={<TechDocsIndexPage />} />\n      <Route\n        path=\"/:namespace/:kind/:name/*\"\n        element={<TechDocsReaderPage />}\n      />\n    </Routes>\n  );\n};\n\n/**\n * Responsible for registering route to view docs on Entity page\n *\n * @public\n */\nexport const EmbeddedDocsRouter = (props: PropsWithChildren<{}>) => {\n  const { children } = props;\n  const { entity } = useEntity();\n\n  // Using objects instead of <Route> elements, otherwise \"outlet\" will be null on sub-pages and add-ons won't render\n  const element = useRoutes([\n    {\n      path: '/*',\n      element: <EntityPageDocs entity={entity} />,\n      children: [\n        {\n          path: '*',\n          element: children,\n        },\n      ],\n    },\n  ]);\n\n  const projectId = entity.metadata.annotations?.[TECHDOCS_ANNOTATION];\n\n  if (!projectId) {\n    return <MissingAnnotationEmptyState annotation={TECHDOCS_ANNOTATION} />;\n  }\n\n  return element;\n};\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { CompoundEntityRef } from '@backstage/catalog-model';\nimport { Config } from '@backstage/config';\nimport {\n  DiscoveryApi,\n  FetchApi,\n  IdentityApi,\n} from '@backstage/core-plugin-api';\nimport { NotFoundError, ResponseError } from '@backstage/errors';\nimport {\n  TechDocsEntityMetadata,\n  TechDocsMetadata,\n} from '@backstage/plugin-techdocs-react';\nimport { EventSourcePolyfill } from 'event-source-polyfill';\nimport { SyncResult, TechDocsApi, TechDocsStorageApi } from './api';\n\n/**\n * API to talk to `techdocs-backend`.\n *\n * @public\n */\nexport class TechDocsClient implements TechDocsApi {\n  public configApi: Config;\n  public discoveryApi: DiscoveryApi;\n  private fetchApi: FetchApi;\n\n  constructor(options: {\n    configApi: Config;\n    discoveryApi: DiscoveryApi;\n    fetchApi: FetchApi;\n  }) {\n    this.configApi = options.configApi;\n    this.discoveryApi = options.discoveryApi;\n    this.fetchApi = options.fetchApi;\n  }\n\n  async getApiOrigin(): Promise<string> {\n    return await this.discoveryApi.getBaseUrl('techdocs');\n  }\n\n  /**\n   * Retrieve TechDocs metadata.\n   *\n   * When docs are built, we generate a techdocs_metadata.json and store it along with the generated\n   * static files. It includes necessary data about the docs site. This method requests techdocs-backend\n   * which retrieves the TechDocs metadata.\n   *\n   * @param entityId - Object containing entity data like name, namespace, etc.\n   */\n  async getTechDocsMetadata(\n    entityId: CompoundEntityRef,\n  ): Promise<TechDocsMetadata> {\n    const { kind, namespace, name } = entityId;\n\n    const apiOrigin = await this.getApiOrigin();\n    const requestUrl = `${apiOrigin}/metadata/techdocs/${namespace}/${kind}/${name}`;\n    const request = await this.fetchApi.fetch(`${requestUrl}`);\n    if (!request.ok) {\n      throw await ResponseError.fromResponse(request);\n    }\n\n    return await request.json();\n  }\n\n  /**\n   * Retrieve metadata about an entity.\n   *\n   * This method requests techdocs-backend which uses the catalog APIs to respond with filtered\n   * information required here.\n   *\n   * @param entityId - Object containing entity data like name, namespace, etc.\n   */\n  async getEntityMetadata(\n    entityId: CompoundEntityRef,\n  ): Promise<TechDocsEntityMetadata> {\n    const { kind, namespace, name } = entityId;\n\n    const apiOrigin = await this.getApiOrigin();\n    const requestUrl = `${apiOrigin}/metadata/entity/${namespace}/${kind}/${name}`;\n\n    const request = await this.fetchApi.fetch(`${requestUrl}`);\n    if (!request.ok) {\n      throw await ResponseError.fromResponse(request);\n    }\n\n    return await request.json();\n  }\n}\n\n/**\n * API which talks to TechDocs storage to fetch files to render.\n *\n * @public\n */\nexport class TechDocsStorageClient implements TechDocsStorageApi {\n  public configApi: Config;\n  public discoveryApi: DiscoveryApi;\n  public identityApi: IdentityApi;\n  private fetchApi: FetchApi;\n\n  constructor(options: {\n    configApi: Config;\n    discoveryApi: DiscoveryApi;\n    identityApi: IdentityApi;\n    fetchApi: FetchApi;\n  }) {\n    this.configApi = options.configApi;\n    this.discoveryApi = options.discoveryApi;\n    this.identityApi = options.identityApi;\n    this.fetchApi = options.fetchApi;\n  }\n\n  async getApiOrigin(): Promise<string> {\n    return await this.discoveryApi.getBaseUrl('techdocs');\n  }\n\n  async getStorageUrl(): Promise<string> {\n    return (\n      this.configApi.getOptionalString('techdocs.storageUrl') ??\n      `${await this.discoveryApi.getBaseUrl('techdocs')}/static/docs`\n    );\n  }\n\n  async getBuilder(): Promise<string> {\n    return this.configApi.getString('techdocs.builder');\n  }\n\n  /**\n   * Fetch HTML content as text for an individual docs page in an entity's docs site.\n   *\n   * @param entityId - Object containing entity data like name, namespace, etc.\n   * @param path - The unique path to an individual docs page e.g. overview/what-is-new\n   * @returns HTML content of the docs page as string\n   * @throws Throws error when the page is not found.\n   */\n  async getEntityDocs(\n    entityId: CompoundEntityRef,\n    path: string,\n  ): Promise<string> {\n    const { kind, namespace, name } = entityId;\n\n    const storageUrl = await this.getStorageUrl();\n    const url = `${storageUrl}/${namespace}/${kind}/${name}/${path}`;\n\n    const request = await this.fetchApi.fetch(\n      `${url.endsWith('/') ? url : `${url}/`}index.html`,\n    );\n\n    let errorMessage = '';\n    switch (request.status) {\n      case 404:\n        errorMessage = 'Page not found. ';\n        // path is empty for the home page of an entity's docs site\n        if (!path) {\n          errorMessage +=\n            'This could be because there is no index.md file in the root of the docs directory of this repository.';\n        }\n        throw new NotFoundError(errorMessage);\n      case 500:\n        errorMessage =\n          'Could not generate documentation or an error in the TechDocs backend. ';\n        throw new Error(errorMessage);\n      default:\n        // Do nothing\n        break;\n    }\n\n    return request.text();\n  }\n\n  /**\n   * Check if docs are on the latest version and trigger rebuild if not\n   *\n   * @param entityId - Object containing entity data like name, namespace, etc.\n   * @param logHandler - Callback to receive log messages from the build process\n   * @returns Whether documents are currently synchronized to newest version\n   * @throws Throws error on error from sync endpoint in Techdocs Backend\n   */\n  async syncEntityDocs(\n    entityId: CompoundEntityRef,\n    logHandler: (line: string) => void = () => {},\n  ): Promise<SyncResult> {\n    const { kind, namespace, name } = entityId;\n\n    const apiOrigin = await this.getApiOrigin();\n    const url = `${apiOrigin}/sync/${namespace}/${kind}/${name}`;\n    const { token } = await this.identityApi.getCredentials();\n\n    return new Promise((resolve, reject) => {\n      // Polyfill is used to add support for custom headers and auth\n      const source = new EventSourcePolyfill(url, {\n        withCredentials: true,\n        headers: token ? { Authorization: `Bearer ${token}` } : {},\n      });\n\n      source.addEventListener('log', (e: any) => {\n        if (e.data) {\n          logHandler(JSON.parse(e.data));\n        }\n      });\n\n      source.addEventListener('finish', (e: any) => {\n        let updated: boolean = false;\n\n        if (e.data) {\n          ({ updated } = JSON.parse(e.data));\n        }\n\n        resolve(updated ? 'updated' : 'cached');\n      });\n\n      source.onerror = (e: any) => {\n        source.close();\n\n        switch (e.status) {\n          // the endpoint returned a 404 status\n          case 404:\n            reject(new NotFoundError(e.message));\n            return;\n\n          // also handles the event-stream close. the reject is ignored if the Promise was already\n          // resolved by a finish event.\n          default:\n            reject(new Error(e.data));\n            return;\n        }\n      };\n    });\n  }\n\n  async getBaseUrl(\n    oldBaseUrl: string,\n    entityId: CompoundEntityRef,\n    path: string,\n  ): Promise<string> {\n    const { kind, namespace, name } = entityId;\n\n    const apiOrigin = await this.getApiOrigin();\n    const newBaseUrl = `${apiOrigin}/static/docs/${namespace}/${kind}/${name}/${path}`;\n\n    return new URL(\n      oldBaseUrl,\n      newBaseUrl.endsWith('/') ? newBaseUrl : `${newBaseUrl}/`,\n    ).toString();\n  }\n}\n","/*\n * Copyright 2021 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { Config } from '@backstage/config';\n\n// Lower-case entity triplets by default, but allow override.\nexport function toLowerMaybe(str: string, config: Config) {\n  return config.getOptionalBoolean(\n    'techdocs.legacyUseCaseSensitiveTripletPaths',\n  )\n    ? str\n    : str.toLocaleLowerCase('en-US');\n}\n","/*\n * Copyright 2021 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React from 'react';\nimport {\n  Content,\n  ContentHeader,\n  SupportButton,\n} from '@backstage/core-components';\nimport {\n  CatalogFilterLayout,\n  EntityListProvider,\n  EntityOwnerPicker,\n  EntityTagPicker,\n  UserListPicker,\n} from '@backstage/plugin-catalog-react';\nimport { TechDocsPageWrapper } from './TechDocsPageWrapper';\nimport { TechDocsPicker } from './TechDocsPicker';\nimport { EntityListDocsTable } from './Tables';\nimport { TechDocsIndexPageProps } from './TechDocsIndexPage';\n\n/**\n * Props for {@link DefaultTechDocsHome}\n *\n * @public\n * @deprecated Please use `TechDocsIndexPageProps` instead.\n */\nexport type DefaultTechDocsHomeProps = TechDocsIndexPageProps;\n\n/**\n * Component which renders a default documentation landing page.\n *\n * @public\n */\nexport const DefaultTechDocsHome = (props: TechDocsIndexPageProps) => {\n  const { initialFilter = 'owned', columns, actions } = props;\n  return (\n    <TechDocsPageWrapper>\n      <Content>\n        <ContentHeader title=\"\">\n          <SupportButton>\n            Discover documentation in your ecosystem.\n          </SupportButton>\n        </ContentHeader>\n        <EntityListProvider>\n          <CatalogFilterLayout>\n            <CatalogFilterLayout.Filters>\n              <TechDocsPicker />\n              <UserListPicker initialFilter={initialFilter} />\n              <EntityOwnerPicker />\n              <EntityTagPicker />\n            </CatalogFilterLayout.Filters>\n            <CatalogFilterLayout.Content>\n              <EntityListDocsTable actions={actions} columns={columns} />\n            </CatalogFilterLayout.Content>\n          </CatalogFilterLayout>\n        </EntityListProvider>\n      </Content>\n    </TechDocsPageWrapper>\n  );\n};\n","/*\n * Copyright 2021 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { rootDocsRouteRef } from '../../../routes';\nimport { toLowerMaybe } from '../../../helpers';\nimport { Entity } from '@backstage/catalog-model';\nimport { useApi, useRouteRef, configApiRef } from '@backstage/core-plugin-api';\nimport {\n  Button,\n  ItemCardGrid,\n  ItemCardHeader,\n} from '@backstage/core-components';\nimport { Card, CardActions, CardContent, CardMedia } from '@material-ui/core';\nimport React from 'react';\n\n/**\n * Props for {@link DocsCardGrid}\n *\n * @public\n */\nexport type DocsCardGridProps = {\n  entities: Entity[] | undefined;\n};\n\n/**\n * Component which accepts a list of entities and renders a item card for each entity\n *\n * @public\n */\nexport const DocsCardGrid = (props: DocsCardGridProps) => {\n  const { entities } = props;\n  const getRouteToReaderPageFor = useRouteRef(rootDocsRouteRef);\n  const config = useApi(configApiRef);\n  if (!entities) return null;\n  return (\n    <ItemCardGrid data-testid=\"docs-explore\">\n      {!entities?.length\n        ? null\n        : entities.map((entity, index: number) => (\n            <Card key={index}>\n              <CardMedia>\n                <ItemCardHeader\n                  title={entity.metadata.title ?? entity.metadata.name}\n                />\n              </CardMedia>\n              <CardContent>{entity.metadata.description}</CardContent>\n              <CardActions>\n                <Button\n                  to={getRouteToReaderPageFor({\n                    namespace: toLowerMaybe(\n                      entity.metadata.namespace ?? 'default',\n                      config,\n                    ),\n                    kind: toLowerMaybe(entity.kind, config),\n                    name: toLowerMaybe(entity.metadata.name, config),\n                  })}\n                  color=\"primary\"\n                  data-testid=\"read_docs\"\n                >\n                  Read Docs\n                </Button>\n              </CardActions>\n            </Card>\n          ))}\n    </ItemCardGrid>\n  );\n};\n","/*\n * Copyright 2021 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { DocsCardGrid } from './DocsCardGrid';\nimport {\n  CodeSnippet,\n  Progress,\n  WarningPanel,\n} from '@backstage/core-components';\nimport { useEntityList } from '@backstage/plugin-catalog-react';\nimport React from 'react';\n\n/**\n * Component responsible to get entities from entity list context and pass down to DocsCardGrid\n *\n * @public\n */\nexport const EntityListDocsGrid = () => {\n  const { loading, error, entities } = useEntityList();\n\n  if (error) {\n    return (\n      <WarningPanel\n        severity=\"error\"\n        title=\"Could not load available documentation.\"\n      >\n        <CodeSnippet language=\"text\" text={error.toString()} />\n      </WarningPanel>\n    );\n  }\n\n  if (loading || !entities) {\n    return <Progress />;\n  }\n\n  entities.sort((a, b) =>\n    (a.metadata.title ?? a.metadata.name).localeCompare(\n      b.metadata.title ?? b.metadata.name,\n    ),\n  );\n\n  return <DocsCardGrid entities={entities} />;\n};\n","/*\n * Copyright 2021 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React from 'react';\nimport ShareIcon from '@material-ui/icons/Share';\nimport { DocsTableRow } from './types';\nimport { withStyles } from '@material-ui/styles';\nimport Star from '@material-ui/icons/Star';\nimport StarBorder from '@material-ui/icons/StarBorder';\n\nconst YellowStar = withStyles({\n  root: {\n    color: '#f3ba37',\n  },\n})(Star);\n\n/**\n * Not directly exported, but through DocsTable.actions and EntityListDocsTable.actions\n *\n * @public\n */\nexport const actionFactories = {\n  createCopyDocsUrlAction(copyToClipboard: Function) {\n    return (row: DocsTableRow) => {\n      return {\n        icon: () => <ShareIcon fontSize=\"small\" />,\n        tooltip: 'Click to copy documentation link to clipboard',\n        onClick: () =>\n          copyToClipboard(`${window.location.origin}${row.resolved.docsUrl}`),\n      };\n    };\n  },\n  createStarEntityAction(\n    isStarredEntity: Function,\n    toggleStarredEntity: Function,\n  ) {\n    return ({ entity }: DocsTableRow) => {\n      const isStarred = isStarredEntity(entity);\n      return {\n        cellStyle: { paddingLeft: '1em' },\n        icon: () => (isStarred ? <YellowStar /> : <StarBorder />),\n        tooltip: isStarred ? 'Remove from favorites' : 'Add to favorites',\n        onClick: () => toggleStarredEntity(entity),\n      };\n    };\n  },\n};\n","/*\n * Copyright 2021 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React from 'react';\nimport { Link, SubvalueCell, TableColumn } from '@backstage/core-components';\nimport { EntityRefLinks } from '@backstage/plugin-catalog-react';\nimport { Entity } from '@backstage/catalog-model';\nimport { DocsTableRow } from './types';\n\nfunction customTitle(entity: Entity): string {\n  return entity.metadata.title || entity.metadata.name;\n}\n\n/**\n * Not directly exported, but through DocsTable.columns and EntityListDocsTable.columns\n *\n * @public\n */\nexport const columnFactories = {\n  createNameColumn(): TableColumn<DocsTableRow> {\n    return {\n      title: 'Document',\n      field: 'entity.metadata.name',\n      highlight: true,\n      render: (row: DocsTableRow) => (\n        <SubvalueCell\n          value={\n            <Link to={row.resolved.docsUrl}>{customTitle(row.entity)}</Link>\n          }\n          subvalue={row.entity.metadata.description}\n        />\n      ),\n    };\n  },\n  createOwnerColumn(): TableColumn<DocsTableRow> {\n    return {\n      title: 'Owner',\n      field: 'resolved.ownedByRelationsTitle',\n      render: ({ resolved }) => (\n        <EntityRefLinks\n          entityRefs={resolved.ownedByRelations}\n          defaultKind=\"group\"\n        />\n      ),\n    };\n  },\n  createTypeColumn(): TableColumn<DocsTableRow> {\n    return {\n      title: 'Type',\n      field: 'entity.spec.type',\n    };\n  },\n};\n","/*\n * Copyright 2021 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React from 'react';\nimport useCopyToClipboard from 'react-use/lib/useCopyToClipboard';\n\nimport { useRouteRef, useApi, configApiRef } from '@backstage/core-plugin-api';\nimport { Entity, RELATION_OWNED_BY } from '@backstage/catalog-model';\nimport {\n  humanizeEntityRef,\n  getEntityRelations,\n} from '@backstage/plugin-catalog-react';\nimport { rootDocsRouteRef } from '../../../routes';\nimport {\n  Button,\n  EmptyState,\n  Table,\n  TableColumn,\n  TableProps,\n} from '@backstage/core-components';\nimport { actionFactories } from './actions';\nimport { columnFactories } from './columns';\nimport { toLowerMaybe } from '../../../helpers';\nimport { DocsTableRow } from './types';\n\n/**\n * Props for {@link DocsTable}.\n *\n * @public\n */\nexport type DocsTableProps = {\n  entities: Entity[] | undefined;\n  title?: string | undefined;\n  loading?: boolean | undefined;\n  columns?: TableColumn<DocsTableRow>[];\n  actions?: TableProps<DocsTableRow>['actions'];\n};\n\n/**\n * Component which renders a table documents\n *\n * @public\n */\nexport const DocsTable = (props: DocsTableProps) => {\n  const { entities, title, loading, columns, actions } = props;\n  const [, copyToClipboard] = useCopyToClipboard();\n  const getRouteToReaderPageFor = useRouteRef(rootDocsRouteRef);\n  const config = useApi(configApiRef);\n  if (!entities) return null;\n\n  const documents = entities.map(entity => {\n    const ownedByRelations = getEntityRelations(entity, RELATION_OWNED_BY);\n    return {\n      entity,\n      resolved: {\n        docsUrl: getRouteToReaderPageFor({\n          namespace: toLowerMaybe(\n            entity.metadata.namespace ?? 'default',\n            config,\n          ),\n          kind: toLowerMaybe(entity.kind, config),\n          name: toLowerMaybe(entity.metadata.name, config),\n        }),\n        ownedByRelations,\n        ownedByRelationsTitle: ownedByRelations\n          .map(r => humanizeEntityRef(r, { defaultKind: 'group' }))\n          .join(', '),\n      },\n    };\n  });\n\n  const defaultColumns: TableColumn<DocsTableRow>[] = [\n    columnFactories.createNameColumn(),\n    columnFactories.createOwnerColumn(),\n    columnFactories.createTypeColumn(),\n  ];\n\n  const defaultActions: TableProps<DocsTableRow>['actions'] = [\n    actionFactories.createCopyDocsUrlAction(copyToClipboard),\n  ];\n\n  return (\n    <>\n      {loading || (documents && documents.length > 0) ? (\n        <Table<DocsTableRow>\n          isLoading={loading}\n          options={{\n            paging: true,\n            pageSize: 20,\n            search: true,\n            actionsColumnIndex: -1,\n          }}\n          data={documents}\n          columns={columns || defaultColumns}\n          actions={actions || defaultActions}\n          title={\n            title\n              ? `${title} (${documents.length})`\n              : `All (${documents.length})`\n          }\n        />\n      ) : (\n        <EmptyState\n          missing=\"data\"\n          title=\"No documents to show\"\n          description=\"Create your own document. Check out our Getting Started Information\"\n          action={\n            <Button\n              color=\"primary\"\n              to=\"https://backstage.io/docs/features/techdocs/getting-started\"\n              variant=\"contained\"\n            >\n              DOCS\n            </Button>\n          }\n        />\n      )}\n    </>\n  );\n};\n\nDocsTable.columns = columnFactories;\nDocsTable.actions = actionFactories;\n","/*\n * Copyright 2021 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React from 'react';\nimport useCopyToClipboard from 'react-use/lib/useCopyToClipboard';\nimport { capitalize } from 'lodash';\nimport {\n  CodeSnippet,\n  TableColumn,\n  TableProps,\n  WarningPanel,\n} from '@backstage/core-components';\nimport {\n  useEntityList,\n  useStarredEntities,\n} from '@backstage/plugin-catalog-react';\nimport { DocsTable } from './DocsTable';\nimport { actionFactories } from './actions';\nimport { columnFactories } from './columns';\nimport { DocsTableRow } from './types';\n\n/**\n * Props for {@link EntityListDocsTable}.\n *\n * @public\n */\nexport type EntityListDocsTableProps = {\n  columns?: TableColumn<DocsTableRow>[];\n  actions?: TableProps<DocsTableRow>['actions'];\n};\n\n/**\n * Component which renders a table with entities from catalog.\n *\n * @public\n */\nexport const EntityListDocsTable = (props: EntityListDocsTableProps) => {\n  const { columns, actions } = props;\n  const { loading, error, entities, filters } = useEntityList();\n  const { isStarredEntity, toggleStarredEntity } = useStarredEntities();\n  const [, copyToClipboard] = useCopyToClipboard();\n\n  const title = capitalize(filters.user?.value ?? 'all');\n\n  const defaultActions = [\n    actionFactories.createCopyDocsUrlAction(copyToClipboard),\n    actionFactories.createStarEntityAction(\n      isStarredEntity,\n      toggleStarredEntity,\n    ),\n  ];\n\n  if (error) {\n    return (\n      <WarningPanel\n        severity=\"error\"\n        title=\"Could not load available documentation.\"\n      >\n        <CodeSnippet language=\"text\" text={error.toString()} />\n      </WarningPanel>\n    );\n  }\n\n  return (\n    <DocsTable\n      title={title}\n      entities={entities}\n      loading={loading}\n      actions={actions || defaultActions}\n      columns={columns}\n    />\n  );\n};\n\nEntityListDocsTable.columns = columnFactories;\nEntityListDocsTable.actions = actionFactories;\n","/*\n * Copyright 2021 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React from 'react';\nimport { useOutlet } from 'react-router';\nimport { TableColumn, TableProps } from '@backstage/core-components';\nimport { UserListFilterKind } from '@backstage/plugin-catalog-react';\nimport { DefaultTechDocsHome } from './DefaultTechDocsHome';\nimport { DocsTableRow } from './Tables';\n\n/**\n * Props for {@link TechDocsIndexPage}\n *\n * @public\n */\nexport type TechDocsIndexPageProps = {\n  initialFilter?: UserListFilterKind;\n  columns?: TableColumn<DocsTableRow>[];\n  actions?: TableProps<DocsTableRow>['actions'];\n};\n\nexport const TechDocsIndexPage = (props: TechDocsIndexPageProps) => {\n  const outlet = useOutlet();\n\n  return outlet || <DefaultTechDocsHome {...props} />;\n};\n","/*\n * Copyright 2021 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React from 'react';\n\nimport { PageWithHeader } from '@backstage/core-components';\nimport { useApi, configApiRef } from '@backstage/core-plugin-api';\n\n/**\n * Props for {@link TechDocsPageWrapper}\n *\n * @public\n */\nexport type TechDocsPageWrapperProps = {\n  children?: React.ReactNode;\n};\n\n/**\n * Component wrapping a techdocs page with Page and Header components\n *\n * @public\n */\nexport const TechDocsPageWrapper = (props: TechDocsPageWrapperProps) => {\n  const { children } = props;\n  const configApi = useApi(configApiRef);\n  const generatedSubtitle = `Documentation available in ${\n    configApi.getOptionalString('organization.name') ?? 'Backstage'\n  }`;\n\n  return (\n    <PageWithHeader\n      title=\"Documentation\"\n      subtitle={generatedSubtitle}\n      themeId=\"documentation\"\n    >\n      {children}\n    </PageWithHeader>\n  );\n};\n","/*\n * Copyright 2021 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { useEffect } from 'react';\nimport {\n  CATALOG_FILTER_EXISTS,\n  DefaultEntityFilters,\n  EntityFilter,\n  useEntityList,\n} from '@backstage/plugin-catalog-react';\n\nclass TechDocsFilter implements EntityFilter {\n  getCatalogFilters(): Record<string, string | symbol | (string | symbol)[]> {\n    return {\n      'metadata.annotations.backstage.io/techdocs-ref': CATALOG_FILTER_EXISTS,\n    };\n  }\n}\n\ntype CustomFilters = DefaultEntityFilters & {\n  techdocs?: TechDocsFilter;\n};\n\n/**\n * Component responsible for updating TechDocs filters\n *\n * @public\n */\nexport const TechDocsPicker = () => {\n  const { updateFilters } = useEntityList<CustomFilters>();\n\n  useEffect(() => {\n    updateFilters({\n      techdocs: new TechDocsFilter(),\n    });\n  }, [updateFilters]);\n\n  return null;\n};\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  techdocsApiRef,\n  techdocsStorageApiRef,\n} from '@backstage/plugin-techdocs-react';\nimport { TechDocsClient, TechDocsStorageClient } from './client';\nimport {\n  rootDocsRouteRef,\n  rootRouteRef,\n  rootCatalogDocsRouteRef,\n} from './routes';\nimport {\n  configApiRef,\n  createApiFactory,\n  createPlugin,\n  createRoutableExtension,\n  discoveryApiRef,\n  fetchApiRef,\n  identityApiRef,\n} from '@backstage/core-plugin-api';\n\n/**\n * The Backstage plugin that renders technical documentation for your components\n *\n * @public\n */\nexport const techdocsPlugin = createPlugin({\n  id: 'techdocs',\n  apis: [\n    createApiFactory({\n      api: techdocsStorageApiRef,\n      deps: {\n        configApi: configApiRef,\n        discoveryApi: discoveryApiRef,\n        identityApi: identityApiRef,\n        fetchApi: fetchApiRef,\n      },\n      factory: ({ configApi, discoveryApi, identityApi, fetchApi }) =>\n        new TechDocsStorageClient({\n          configApi,\n          discoveryApi,\n          identityApi,\n          fetchApi,\n        }),\n    }),\n    createApiFactory({\n      api: techdocsApiRef,\n      deps: {\n        configApi: configApiRef,\n        discoveryApi: discoveryApiRef,\n        fetchApi: fetchApiRef,\n      },\n      factory: ({ configApi, discoveryApi, fetchApi }) =>\n        new TechDocsClient({\n          configApi,\n          discoveryApi,\n          fetchApi,\n        }),\n    }),\n  ],\n  routes: {\n    root: rootRouteRef,\n    docRoot: rootDocsRouteRef,\n    entityContent: rootCatalogDocsRouteRef,\n  },\n});\n\n/**\n * Routable extension used to render docs\n *\n * @public\n */\nexport const TechdocsPage = techdocsPlugin.provide(\n  createRoutableExtension({\n    name: 'TechdocsPage',\n    component: () => import('./Router').then(m => m.Router),\n    mountPoint: rootRouteRef,\n  }),\n);\n\n/**\n * Routable extension used to render docs on Entity page\n *\n * @public\n */\nexport const EntityTechdocsContent = techdocsPlugin.provide(\n  createRoutableExtension({\n    name: 'EntityTechdocsContent',\n    component: () => import('./Router').then(m => m.EmbeddedDocsRouter),\n    mountPoint: rootCatalogDocsRouteRef,\n  }),\n);\n\n/**\n * Component which takes a custom tabs config object and renders a documentation landing page.\n *\n * @public\n */\nexport const TechDocsCustomHome = techdocsPlugin.provide(\n  createRoutableExtension({\n    name: 'TechDocsCustomHome',\n    component: () =>\n      import('./home/components/TechDocsCustomHome').then(\n        m => m.TechDocsCustomHome,\n      ),\n    mountPoint: rootRouteRef,\n  }),\n);\n\n/**\n * Responsible for rendering the provided router element\n *\n * @public\n */\nexport const TechDocsIndexPage = techdocsPlugin.provide(\n  createRoutableExtension({\n    name: 'TechDocsIndexPage',\n    component: () =>\n      import('./home/components/TechDocsIndexPage').then(\n        m => m.TechDocsIndexPage,\n      ),\n    mountPoint: rootRouteRef,\n  }),\n);\n\n/**\n * Component responsible for composing a TechDocs reader page experience\n *\n * @public\n */\nexport const TechDocsReaderPage = techdocsPlugin.provide(\n  createRoutableExtension({\n    name: 'TechDocsReaderPage',\n    component: () =>\n      import('./reader/components/TechDocsReaderPage').then(\n        m => m.TechDocsReaderPage,\n      ),\n    mountPoint: rootDocsRouteRef,\n  }),\n);\n","/*\n * Copyright 2022 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React, { ReactNode, Children, ReactElement } from 'react';\nimport { useOutlet } from 'react-router-dom';\n\nimport { Page } from '@backstage/core-components';\nimport { CompoundEntityRef } from '@backstage/catalog-model';\nimport {\n  TECHDOCS_ADDONS_WRAPPER_KEY,\n  TechDocsReaderPageProvider,\n} from '@backstage/plugin-techdocs-react';\n\nimport { TechDocsReaderPageRenderFunction } from '../../../types';\n\nimport { TechDocsReaderPageContent } from '../TechDocsReaderPageContent';\nimport { TechDocsReaderPageHeader } from '../TechDocsReaderPageHeader';\nimport { TechDocsReaderPageSubheader } from '../TechDocsReaderPageSubheader';\nimport { rootDocsRouteRef } from '../../../routes';\nimport {\n  getComponentData,\n  useRouteRefParams,\n} from '@backstage/core-plugin-api';\n\n/**\n * Props for {@link TechDocsReaderLayout}\n * @public\n */\nexport type TechDocsReaderLayoutProps = {\n  /**\n   * Show or hide the header, defaults to true.\n   */\n  withHeader?: boolean;\n  /**\n   * Show or hide the content search bar, defaults to true.\n   */\n  withSearch?: boolean;\n};\n\n/**\n * Default TechDocs reader page structure composed with a header and content\n * @public\n */\nexport const TechDocsReaderLayout = ({\n  withSearch,\n  withHeader = true,\n}: TechDocsReaderLayoutProps) => {\n  return (\n    <Page themeId=\"documentation\">\n      {withHeader && <TechDocsReaderPageHeader />}\n      <TechDocsReaderPageSubheader />\n      <TechDocsReaderPageContent withSearch={withSearch} />\n    </Page>\n  );\n};\n\n/**\n * @public\n */\nexport type TechDocsReaderPageProps = {\n  entityRef?: CompoundEntityRef;\n  children?: TechDocsReaderPageRenderFunction | ReactNode;\n};\n\n/**\n * An addon-aware implementation of the TechDocsReaderPage.\n * @public\n */\nexport const TechDocsReaderPage = (props: TechDocsReaderPageProps) => {\n  const { kind, name, namespace } = useRouteRefParams(rootDocsRouteRef);\n  const { children, entityRef = { kind, name, namespace } } = props;\n\n  const outlet = useOutlet();\n\n  if (!children) {\n    const childrenList = outlet ? Children.toArray(outlet.props.children) : [];\n\n    const page = childrenList.find(child => {\n      if (getComponentData(child, TECHDOCS_ADDONS_WRAPPER_KEY)) {\n        return false;\n      }\n\n      // react-router 6 stable wraps children in a routing context provider, so check one level deeper\n      const nestedChildren = (child as ReactElement)?.props?.children;\n      if (nestedChildren) {\n        return !Children.toArray(nestedChildren).some(nested =>\n          getComponentData(nested, TECHDOCS_ADDONS_WRAPPER_KEY),\n        );\n      }\n      return true;\n    });\n\n    return (\n      <TechDocsReaderPageProvider entityRef={entityRef}>\n        {(page as JSX.Element) || <TechDocsReaderLayout />}\n      </TechDocsReaderPageProvider>\n    );\n  }\n\n  return (\n    <TechDocsReaderPageProvider entityRef={entityRef}>\n      {({ metadata, entityMetadata, onReady }) => (\n        <div className=\"techdocs-reader-page\">\n          <Page themeId=\"documentation\">\n            {children instanceof Function\n              ? children({\n                  entityRef,\n                  techdocsMetadataValue: metadata.value,\n                  entityMetadataValue: entityMetadata.value,\n                  onReady,\n                })\n              : children}\n          </Page>\n        </div>\n      )}\n    </TechDocsReaderPageProvider>\n  );\n};\n","/*\n * Copyright 2021 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { LogViewer } from '@backstage/core-components';\nimport {\n  Button,\n  createStyles,\n  Drawer,\n  Grid,\n  IconButton,\n  makeStyles,\n  Theme,\n  Typography,\n} from '@material-ui/core';\nimport Close from '@material-ui/icons/Close';\nimport React, { useState } from 'react';\n\nconst useDrawerStyles = makeStyles((theme: Theme) =>\n  createStyles({\n    paper: {\n      width: '100%',\n      [theme.breakpoints.up('sm')]: {\n        width: '75%',\n      },\n      [theme.breakpoints.up('md')]: {\n        width: '50%',\n      },\n      padding: theme.spacing(2.5),\n    },\n    root: {\n      height: '100%',\n      overflow: 'hidden',\n    },\n    logs: {\n      background: theme.palette.background.default,\n    },\n  }),\n);\n\nexport const TechDocsBuildLogsDrawerContent = ({\n  buildLog,\n  onClose,\n}: {\n  buildLog: string[];\n  onClose: () => void;\n}) => {\n  const classes = useDrawerStyles();\n  const logText =\n    buildLog.length === 0 ? 'Waiting for logs...' : buildLog.join('\\n');\n  return (\n    <Grid\n      container\n      direction=\"column\"\n      className={classes.root}\n      spacing={0}\n      wrap=\"nowrap\"\n    >\n      <Grid\n        item\n        container\n        justifyContent=\"space-between\"\n        alignItems=\"center\"\n        spacing={0}\n        wrap=\"nowrap\"\n      >\n        <Typography variant=\"h5\">Build Details</Typography>\n        <IconButton\n          key=\"dismiss\"\n          title=\"Close the drawer\"\n          onClick={onClose}\n          color=\"inherit\"\n        >\n          <Close />\n        </IconButton>\n      </Grid>\n      <LogViewer text={logText} classes={{ root: classes.logs }} />\n    </Grid>\n  );\n};\n\nexport const TechDocsBuildLogs = ({ buildLog }: { buildLog: string[] }) => {\n  const classes = useDrawerStyles();\n  const [open, setOpen] = useState(false);\n\n  return (\n    <>\n      <Button color=\"inherit\" onClick={() => setOpen(true)}>\n        Show Build Logs\n      </Button>\n      <Drawer\n        classes={{ paper: classes.paper }}\n        anchor=\"right\"\n        open={open}\n        onClose={() => setOpen(false)}\n      >\n        <TechDocsBuildLogsDrawerContent\n          buildLog={buildLog}\n          onClose={() => setOpen(false)}\n        />\n      </Drawer>\n    </>\n  );\n};\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React from 'react';\nimport { useApi, configApiRef } from '@backstage/core-plugin-api';\nimport { ErrorPage } from '@backstage/core-components';\n\ntype Props = {\n  errorMessage?: string;\n};\n\nexport const TechDocsNotFound = ({ errorMessage }: Props) => {\n  const techdocsBuilder =\n    useApi(configApiRef).getOptionalString('techdocs.builder');\n\n  let additionalInfo = '';\n  if (techdocsBuilder !== 'local') {\n    additionalInfo =\n      \"Note that techdocs.builder is not set to 'local' in your config, which means this Backstage app will not \" +\n      \"generate docs if they are not found. Make sure the project's docs are generated and published by some external \" +\n      \"process (e.g. CI/CD pipeline). Or change techdocs.builder to 'local' to generate docs from this Backstage \" +\n      'instance.';\n  }\n\n  return (\n    <ErrorPage\n      status=\"404\"\n      statusMessage={errorMessage || 'Documentation not found'}\n      additionalInfo={additionalInfo}\n    />\n  );\n};\n","/*\n * Copyright 2021 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React from 'react';\nimport { CircularProgress, Button, makeStyles } from '@material-ui/core';\nimport { Alert } from '@material-ui/lab';\n\nimport { TechDocsBuildLogs } from './TechDocsBuildLogs';\nimport { TechDocsNotFound } from './TechDocsNotFound';\nimport { useTechDocsReader } from './TechDocsReaderProvider';\n\nconst useStyles = makeStyles(theme => ({\n  root: {\n    marginBottom: theme.spacing(2),\n  },\n  message: {\n    // `word-break: break-word` is deprecated, but gives legacy support to browsers not supporting `overflow-wrap` yet\n    // https://developer.mozilla.org/en-US/docs/Web/CSS/word-break\n    wordBreak: 'break-word',\n    overflowWrap: 'anywhere',\n  },\n}));\n\nexport const TechDocsStateIndicator = () => {\n  let StateAlert: JSX.Element | null = null;\n  const classes = useStyles();\n\n  const {\n    state,\n    contentReload,\n    contentErrorMessage,\n    syncErrorMessage,\n    buildLog,\n  } = useTechDocsReader();\n\n  if (state === 'INITIAL_BUILD') {\n    StateAlert = (\n      <Alert\n        classes={{ root: classes.root }}\n        variant=\"outlined\"\n        severity=\"info\"\n        icon={<CircularProgress size=\"24px\" />}\n        action={<TechDocsBuildLogs buildLog={buildLog} />}\n      >\n        Documentation is accessed for the first time and is being prepared. The\n        subsequent loads are much faster.\n      </Alert>\n    );\n  }\n\n  if (state === 'CONTENT_STALE_REFRESHING') {\n    StateAlert = (\n      <Alert\n        variant=\"outlined\"\n        severity=\"info\"\n        icon={<CircularProgress size=\"24px\" />}\n        action={<TechDocsBuildLogs buildLog={buildLog} />}\n        classes={{ root: classes.root }}\n      >\n        A newer version of this documentation is being prepared and will be\n        available shortly.\n      </Alert>\n    );\n  }\n\n  if (state === 'CONTENT_STALE_READY') {\n    StateAlert = (\n      <Alert\n        variant=\"outlined\"\n        severity=\"success\"\n        action={\n          <Button color=\"inherit\" onClick={() => contentReload()}>\n            Refresh\n          </Button>\n        }\n        classes={{ root: classes.root }}\n      >\n        A newer version of this documentation is now available, please refresh\n        to view.\n      </Alert>\n    );\n  }\n\n  if (state === 'CONTENT_STALE_ERROR') {\n    StateAlert = (\n      <Alert\n        variant=\"outlined\"\n        severity=\"error\"\n        action={<TechDocsBuildLogs buildLog={buildLog} />}\n        classes={{ root: classes.root, message: classes.message }}\n      >\n        Building a newer version of this documentation failed.{' '}\n        {syncErrorMessage}\n      </Alert>\n    );\n  }\n\n  if (state === 'CONTENT_NOT_FOUND') {\n    StateAlert = (\n      <>\n        {syncErrorMessage && (\n          <Alert\n            variant=\"outlined\"\n            severity=\"error\"\n            action={<TechDocsBuildLogs buildLog={buildLog} />}\n            classes={{ root: classes.root, message: classes.message }}\n          >\n            Building a newer version of this documentation failed.{' '}\n            {syncErrorMessage}\n          </Alert>\n        )}\n        <TechDocsNotFound errorMessage={contentErrorMessage} />\n      </>\n    );\n  }\n\n  return StateAlert;\n};\n","/*\n * Copyright 2022 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nconst MKDOCS_CSS = /main\\.[A-Fa-f0-9]{8}\\.min\\.css$/;\nconst GOOGLE_FONTS = /^https:\\/\\/fonts\\.googleapis\\.com/;\nconst GSTATIC_FONTS = /^https:\\/\\/fonts\\.gstatic\\.com/;\n\n/**\n * Checks whether a node is link or not.\n * @param node - can be any element.\n * @returns true when node is link.\n */\nconst isLink = (node: Element) => node.nodeName === 'LINK';\n\n/**\n * Checks whether a link is safe or not.\n * @param node - is an link element.\n * @returns true when link is mkdocs css, google fonts or gstatic fonts.\n */\nconst isSafe = (node: Element) => {\n  const href = node?.getAttribute('href') || '';\n  const isMkdocsCss = href.match(MKDOCS_CSS);\n  const isGoogleFonts = href.match(GOOGLE_FONTS);\n  const isGstaticFonts = href.match(GSTATIC_FONTS);\n  return isMkdocsCss || isGoogleFonts || isGstaticFonts;\n};\n\n/**\n * Function that removes unsafe link nodes.\n * @param node - can be any element.\n * @param hosts - list of allowed hosts.\n */\nexport const removeUnsafeLinks = (node: Element) => {\n  if (isLink(node) && !isSafe(node)) {\n    node.remove();\n  }\n  return node;\n};\n","/*\n * Copyright 2022 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/**\n * Checks whether a node is iframe or not.\n * @param node - can be any element.\n * @returns true when node is iframe.\n */\nconst isIframe = (node: Element) => node.nodeName === 'IFRAME';\n\n/**\n * Checks whether a iframe is safe or not.\n * @param node - is an iframe element.\n * @param hosts - list of allowed hosts.\n * @returns true when iframe is included in hosts.\n */\nconst isSafe = (node: Element, hosts: string[]) => {\n  const src = node.getAttribute('src') || '';\n  try {\n    const { host } = new URL(src);\n    return hosts.includes(host);\n  } catch {\n    return false;\n  }\n};\n\n/**\n * Returns a function that removes unsafe iframe nodes.\n * @param node - can be any element.\n * @param hosts - list of allowed hosts.\n */\nexport const removeUnsafeIframes = (hosts: string[]) => (node: Element) => {\n  if (isIframe(node) && !isSafe(node, hosts)) {\n    node.remove();\n  }\n  return node;\n};\n","/*\n * Copyright 2022 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport DOMPurify from 'dompurify';\nimport { useMemo, useCallback } from 'react';\n\nimport { useApi, configApiRef } from '@backstage/core-plugin-api';\n\nimport { Transformer } from '../transformer';\nimport { removeUnsafeLinks, removeUnsafeIframes } from './hooks';\n\n/**\n * Returns html sanitizer configuration\n */\nconst useSanitizerConfig = () => {\n  const configApi = useApi(configApiRef);\n\n  return useMemo(() => {\n    return configApi.getOptionalConfig('techdocs.sanitizer');\n  }, [configApi]);\n};\n\n/**\n * Returns a transformer that sanitizes the dom's internal html.\n */\nexport const useSanitizerTransformer = (): Transformer => {\n  const config = useSanitizerConfig();\n\n  return useCallback(\n    async (dom: Element) => {\n      const hosts = config?.getOptionalStringArray('allowedIframeHosts');\n\n      DOMPurify.addHook('beforeSanitizeElements', removeUnsafeLinks);\n      const tags = ['link'];\n\n      if (hosts) {\n        tags.push('iframe');\n        DOMPurify.addHook('beforeSanitizeElements', removeUnsafeIframes(hosts));\n      }\n\n      return DOMPurify.sanitize(dom.innerHTML, {\n        ADD_TAGS: tags,\n        FORBID_TAGS: ['style'],\n        WHOLE_DOCUMENT: true,\n        RETURN_DOM: true,\n      });\n    },\n    [config],\n  );\n};\n","/*\n * Copyright 2022 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { RuleOptions } from './types';\nimport { alpha, lighten } from '@material-ui/core';\n\nexport default ({ theme }: RuleOptions) => `\n/*==================  Variables  ==================*/\n/*\n  As the MkDocs output is rendered in shadow DOM, the CSS variable definitions on the root selector are not applied. Instead, they have to be applied on :host.\n  As there is no way to transform the served main*.css yet (for example in the backend), we have to copy from main*.css and modify them.\n*/\n\n:host {\n  /* FONT */\n  --md-default-fg-color: ${theme.palette.text.primary};\n  --md-default-fg-color--light: ${theme.palette.text.secondary};\n  --md-default-fg-color--lighter: ${lighten(theme.palette.text.secondary, 0.7)};\n  --md-default-fg-color--lightest: ${lighten(\n    theme.palette.text.secondary,\n    0.3,\n  )};\n\n  /* BACKGROUND */\n  --md-default-bg-color:${theme.palette.background.default};\n  --md-default-bg-color--light: ${theme.palette.background.paper};\n  --md-default-bg-color--lighter: ${lighten(\n    theme.palette.background.paper,\n    0.7,\n  )};\n  --md-default-bg-color--lightest: ${lighten(\n    theme.palette.background.paper,\n    0.3,\n  )};\n\n  /* PRIMARY */\n  --md-primary-fg-color: ${theme.palette.primary.main};\n  --md-primary-fg-color--light: ${theme.palette.primary.light};\n  --md-primary-fg-color--dark: ${theme.palette.primary.dark};\n  --md-primary-bg-color: ${theme.palette.primary.contrastText};\n  --md-primary-bg-color--light: ${lighten(\n    theme.palette.primary.contrastText,\n    0.7,\n  )};\n\n  /* ACCENT */\n  --md-accent-fg-color: var(--md-primary-fg-color);\n\n  /* SHADOW */\n  --md-shadow-z1: ${theme.shadows[1]};\n  --md-shadow-z2: ${theme.shadows[2]};\n  --md-shadow-z3: ${theme.shadows[3]};\n\n  /* EXTENSIONS */\n  --md-admonition-fg-color: var(--md-default-fg-color);\n  --md-admonition-bg-color: var(--md-default-bg-color);\n  /* Admonitions and others are using SVG masks to define icons. These masks are defined as CSS variables. */\n  --md-admonition-icon--note: url('data:image/svg+xml;charset=utf-8,<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\"><path d=\"M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z\"/></svg>');\n  --md-admonition-icon--abstract: url('data:image/svg+xml;charset=utf-8,<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\"><path d=\"M4 5h16v2H4V5m0 4h16v2H4V9m0 4h16v2H4v-2m0 4h10v2H4v-2z\"/></svg>');\n  --md-admonition-icon--info: url('data:image/svg+xml;charset=utf-8,<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\"><path d=\"M13 9h-2V7h2m0 10h-2v-6h2m-1-9A10 10 0 002 12a10 10 0 0010 10 10 10 0 0010-10A10 10 0 0012 2z\"/></svg>');\n  --md-admonition-icon--tip: url('data:image/svg+xml;charset=utf-8,<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\"><path d=\"M17.55 11.2c-.23-.3-.5-.56-.76-.82-.65-.6-1.4-1.03-2.03-1.66C13.3 7.26 13 4.85 13.91 3c-.91.23-1.75.75-2.45 1.32-2.54 2.08-3.54 5.75-2.34 8.9.04.1.08.2.08.33 0 .22-.15.42-.35.5-.22.1-.46.04-.64-.12a.83.83 0 01-.15-.17c-1.1-1.43-1.28-3.48-.53-5.12C5.89 10 5 12.3 5.14 14.47c.04.5.1 1 .27 1.5.14.6.4 1.2.72 1.73 1.04 1.73 2.87 2.97 4.84 3.22 2.1.27 4.35-.12 5.96-1.6 1.8-1.66 2.45-4.32 1.5-6.6l-.13-.26c-.2-.46-.47-.87-.8-1.25l.05-.01m-3.1 6.3c-.28.24-.73.5-1.08.6-1.1.4-2.2-.16-2.87-.82 1.19-.28 1.89-1.16 2.09-2.05.17-.8-.14-1.46-.27-2.23-.12-.74-.1-1.37.18-2.06.17.38.37.76.6 1.06.76 1 1.95 1.44 2.2 2.8.04.14.06.28.06.43.03.82-.32 1.72-.92 2.27h.01z\"/></svg>');\n  --md-admonition-icon--success: url('data:image/svg+xml;charset=utf-8,<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\"><path d=\"M12 2C6.5 2 2 6.5 2 12s4.5 10 10 10 10-4.5 10-10S17.5 2 12 2m-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z\"/></svg>');\n  --md-admonition-icon--question: url('data:image/svg+xml;charset=utf-8,<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\"><path d=\"M15.07 11.25l-.9.92C13.45 12.89 13 13.5 13 15h-2v-.5c0-1.11.45-2.11 1.17-2.83l1.24-1.26c.37-.36.59-.86.59-1.41a2 2 0 00-2-2 2 2 0 00-2 2H8a4 4 0 014-4 4 4 0 014 4 3.2 3.2 0 01-.93 2.25M13 19h-2v-2h2M12 2A10 10 0 002 12a10 10 0 0010 10 10 10 0 0010-10c0-5.53-4.5-10-10-10z\"/></svg>');\n  --md-admonition-icon--warning: url('data:image/svg+xml;charset=utf-8,<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\"><path d=\"M13 14h-2v-4h2m0 8h-2v-2h2M1 21h22L12 2 1 21z\"/></svg>');\n  --md-admonition-icon--failure: url('data:image/svg+xml;charset=utf-8,<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\"><path d=\"M12 2c5.53 0 10 4.47 10 10s-4.47 10-10 10S2 17.53 2 12 6.47 2 12 2m3.59 5L12 10.59 8.41 7 7 8.41 10.59 12 7 15.59 8.41 17 12 13.41 15.59 17 17 15.59 13.41 12 17 8.41 15.59 7z\"/></svg>');\n  --md-admonition-icon--danger: url('data:image/svg+xml;charset=utf-8,<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\"><path d=\"M11.5 20l4.86-9.73H13V4l-5 9.73h3.5V20M12 2c2.75 0 5.1 1 7.05 2.95C21 6.9 22 9.25 22 12s-1 5.1-2.95 7.05C17.1 21 14.75 22 12 22s-5.1-1-7.05-2.95C3 17.1 2 14.75 2 12s1-5.1 2.95-7.05C6.9 3 9.25 2 12 2z\"/></svg>');\n  --md-admonition-icon--bug: url('data:image/svg+xml;charset=utf-8,<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\"><path d=\"M14 12h-4v-2h4m0 6h-4v-2h4m6-6h-2.81a5.985 5.985 0 00-1.82-1.96L17 4.41 15.59 3l-2.17 2.17a6.002 6.002 0 00-2.83 0L8.41 3 7 4.41l1.62 1.63C7.88 6.55 7.26 7.22 6.81 8H4v2h2.09c-.05.33-.09.66-.09 1v1H4v2h2v1c0 .34.04.67.09 1H4v2h2.81c1.04 1.79 2.97 3 5.19 3s4.15-1.21 5.19-3H20v-2h-2.09c.05-.33.09-.66.09-1v-1h2v-2h-2v-1c0-.34-.04-.67-.09-1H20V8z\"/></svg>');\n  --md-admonition-icon--example: url('data:image/svg+xml;charset=utf-8,<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\"><path d=\"M7 13v-2h14v2H7m0 6v-2h14v2H7M7 7V5h14v2H7M3 8V5H2V4h2v4H3m-1 9v-1h3v4H2v-1h2v-.5H3v-1h1V17H2m2.25-7a.75.75 0 01.75.75c0 .2-.08.39-.21.52L3.12 13H5v1H2v-.92L4 11H2v-1h2.25z\"/></svg>');\n  --md-admonition-icon--quote: url('data:image/svg+xml;charset=utf-8,<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\"><path d=\"M14 17h3l2-4V7h-6v6h3M6 17h3l2-4V7H5v6h3l-2 4z\"/></svg>');\n  --md-footnotes-icon: url('data:image/svg+xml;charset=utf-8,<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\"><path d=\"M19 7v4H5.83l3.58-3.59L8 6l-6 6 6 6 1.41-1.42L5.83 13H21V7h-2z\"/></svg>');\n  --md-details-icon: url('data:image/svg+xml;charset=utf-8,<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\"><path d=\"M8.59 16.58 13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z\"/></svg>');\n  --md-tasklist-icon: url('data:image/svg+xml;charset=utf-8,<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\"><path d=\"M0 0h24v24H0z\" fill=\"none\"/><path d=\"M19 5v14H5V5h14m0-2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2z\"/></svg>');\n  --md-tasklist-icon--checked: url('data:image/svg+xml;charset=utf-8,<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\"><path d=\"M0 0h24v24H0z\" fill=\"none\"/><path d=\"M19 3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.11 0 2-.9 2-2V5c0-1.1-.89-2-2-2zm-9 14l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z\"/></svg>');\n  --md-nav-icon--prev: url('data:image/svg+xml;charset=utf-8,<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\"><path d=\"M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z\"/></svg>');\n  --md-nav-icon--next: url('data:image/svg+xml;charset=utf-8,<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\"><path d=\"M8.59 16.58 13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z\"/></svg>');\n  --md-toc-icon: url('data:image/svg+xml;charset=utf-8,<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\"><path d=\"M3 9h14V7H3v2m0 4h14v-2H3v2m0 4h14v-2H3v2m16 0h2v-2h-2v2m0-10v2h2V7h-2m0 6h2v-2h-2v2z\"/></svg>');\n  --md-clipboard-icon: url('data:image/svg+xml;charset=utf-8,<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\"><path d=\"M19 21H8V7h11m0-2H8a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h11a2 2 0 0 0 2-2V7a2 2 0 0 0-2-2m-3-4H4a2 2 0 0 0-2 2v14h2V3h12V1z\"/></svg>');\n  --md-search-result-icon: url('data:image/svg+xml;charset=utf-8,<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\"><path d=\"M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h7c-.41-.25-.8-.56-1.14-.9-.33-.33-.61-.7-.86-1.1H6V4h7v5h5v1.18c.71.16 1.39.43 2 .82V8l-6-6m6.31 16.9c1.33-2.11.69-4.9-1.4-6.22-2.11-1.33-4.91-.68-6.22 1.4-1.34 2.11-.69 4.89 1.4 6.22 1.46.93 3.32.93 4.79.02L22 23.39 23.39 22l-3.08-3.1m-3.81.1a2.5 2.5 0 0 1-2.5-2.5 2.5 2.5 0 0 1 2.5-2.5 2.5 2.5 0 0 1 2.5 2.5 2.5 2.5 0 0 1-2.5 2.5z\"/></svg>');\n  --md-source-forks-icon: url('data:image/svg+xml;charset=utf-8,<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 16 16\"><path fill-rule=\"evenodd\" d=\"M5 3.25a.75.75 0 1 1-1.5 0 .75.75 0 0 1 1.5 0zm0 2.122a2.25 2.25 0 1 0-1.5 0v.878A2.25 2.25 0 0 0 5.75 8.5h1.5v2.128a2.251 2.251 0 1 0 1.5 0V8.5h1.5a2.25 2.25 0 0 0 2.25-2.25v-.878a2.25 2.25 0 1 0-1.5 0v.878a.75.75 0 0 1-.75.75h-4.5A.75.75 0 0 1 5 6.25v-.878zm3.75 7.378a.75.75 0 1 1-1.5 0 .75.75 0 0 1 1.5 0zm3-8.75a.75.75 0 1 0 0-1.5.75.75 0 0 0 0 1.5z\"/></svg>');\n  --md-source-repositories-icon: url('data:image/svg+xml;charset=utf-8,<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 16 16\"><path fill-rule=\"evenodd\" d=\"M2 2.5A2.5 2.5 0 0 1 4.5 0h8.75a.75.75 0 0 1 .75.75v12.5a.75.75 0 0 1-.75.75h-2.5a.75.75 0 1 1 0-1.5h1.75v-2h-8a1 1 0 0 0-.714 1.7.75.75 0 0 1-1.072 1.05A2.495 2.495 0 0 1 2 11.5v-9zm10.5-1V9h-8c-.356 0-.694.074-1 .208V2.5a1 1 0 0 1 1-1h8zM5 12.25v3.25a.25.25 0 0 0 .4.2l1.45-1.087a.25.25 0 0 1 .3 0L8.6 15.7a.25.25 0 0 0 .4-.2v-3.25a.25.25 0 0 0-.25-.25h-3.5a.25.25 0 0 0-.25.25z\"/></svg>');\n  --md-source-stars-icon: url('data:image/svg+xml;charset=utf-8,<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 16 16\"><path fill-rule=\"evenodd\" d=\"M8 .25a.75.75 0 0 1 .673.418l1.882 3.815 4.21.612a.75.75 0 0 1 .416 1.279l-3.046 2.97.719 4.192a.75.75 0 0 1-1.088.791L8 12.347l-3.766 1.98a.75.75 0 0 1-1.088-.79l.72-4.194L.818 6.374a.75.75 0 0 1 .416-1.28l4.21-.611L7.327.668A.75.75 0 0 1 8 .25zm0 2.445L6.615 5.5a.75.75 0 0 1-.564.41l-3.097.45 2.24 2.184a.75.75 0 0 1 .216.664l-.528 3.084 2.769-1.456a.75.75 0 0 1 .698 0l2.77 1.456-.53-3.084a.75.75 0 0 1 .216-.664l2.24-2.183-3.096-.45a.75.75 0 0 1-.564-.41L8 2.694v.001z\"/></svg>');\n  --md-source-version-icon: url('data:image/svg+xml;charset=utf-8,<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 16 16\"><path fill-rule=\"evenodd\" d=\"M2.5 7.775V2.75a.25.25 0 0 1 .25-.25h5.025a.25.25 0 0 1 .177.073l6.25 6.25a.25.25 0 0 1 0 .354l-5.025 5.025a.25.25 0 0 1-.354 0l-6.25-6.25a.25.25 0 0 1-.073-.177zm-1.5 0V2.75C1 1.784 1.784 1 2.75 1h5.025c.464 0 .91.184 1.238.513l6.25 6.25a1.75 1.75 0 0 1 0 2.474l-5.026 5.026a1.75 1.75 0 0 1-2.474 0l-6.25-6.25A1.75 1.75 0 0 1 1 7.775zM6 5a1 1 0 1 0 0 2 1 1 0 0 0 0-2z\"/></svg>');\n  --md-version-icon: url('data:image/svg+xml;charset=utf-8,<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 320 512\"><!--! Font Awesome Free 6.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d=\"m310.6 246.6-127.1 128c-7.1 6.3-15.3 9.4-23.5 9.4s-16.38-3.125-22.63-9.375l-127.1-128C.224 237.5-2.516 223.7 2.438 211.8S19.07 192 32 192h255.1c12.94 0 24.62 7.781 29.58 19.75s3.12 25.75-6.08 34.85z\"/></svg>');\n}\n\n:host > * {\n  /* CODE */\n  --md-code-fg-color: ${theme.palette.text.primary};\n  --md-code-bg-color: ${theme.palette.background.paper};\n  --md-code-hl-color: ${alpha(theme.palette.warning.main, 0.5)};\n  --md-code-hl-keyword-color: ${\n    theme.palette.type === 'dark'\n      ? theme.palette.primary.light\n      : theme.palette.primary.dark\n  };\n  --md-code-hl-function-color: ${\n    theme.palette.type === 'dark'\n      ? theme.palette.secondary.light\n      : theme.palette.secondary.dark\n  };\n  --md-code-hl-string-color: ${\n    theme.palette.type === 'dark'\n      ? theme.palette.success.light\n      : theme.palette.success.dark\n  };\n  --md-code-hl-number-color: ${\n    theme.palette.type === 'dark'\n      ? theme.palette.error.light\n      : theme.palette.error.dark\n  };\n  --md-code-hl-constant-color: var(--md-code-hl-function-color);\n  --md-code-hl-special-color: var(--md-code-hl-function-color);\n  --md-code-hl-name-color: var(--md-code-fg-color);\n  --md-code-hl-comment-color: var(--md-default-fg-color--light);\n  --md-code-hl-generic-color: var(--md-default-fg-color--light);\n  --md-code-hl-variable-color: var(--md-default-fg-color--light);\n  --md-code-hl-operator-color: var(--md-default-fg-color--light);\n  --md-code-hl-punctuation-color: var(--md-default-fg-color--light);\n\n  /* TYPESET */\n  --md-typeset-font-size: 1rem;\n  --md-typeset-color: var(--md-default-fg-color);\n  --md-typeset-a-color: var(--md-accent-fg-color);\n  --md-typeset-table-color: ${theme.palette.text.primary};\n  --md-typeset-del-color: ${\n    theme.palette.type === 'dark'\n      ? alpha(theme.palette.error.dark, 0.5)\n      : alpha(theme.palette.error.light, 0.5)\n  };\n  --md-typeset-ins-color: ${\n    theme.palette.type === 'dark'\n      ? alpha(theme.palette.success.dark, 0.5)\n      : alpha(theme.palette.success.light, 0.5)\n  };\n  --md-typeset-mark-color: ${\n    theme.palette.type === 'dark'\n      ? alpha(theme.palette.warning.dark, 0.5)\n      : alpha(theme.palette.warning.light, 0.5)\n  };\n}\n\n@media screen and (max-width: 76.1875em) {\n  :host > * {\n    /* TYPESET */\n    --md-typeset-font-size: .9rem;\n  }\n}\n\n@media screen and (max-width: 600px) {\n  :host > * {\n    /* TYPESET */\n    --md-typeset-font-size: .7rem;\n  }\n}\n`;\n","/*\n * Copyright 2022 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { RuleOptions } from './types';\n\nexport default ({ theme }: RuleOptions) => `\n/*==================  Reset  ==================*/\n\nbody {\n  --md-text-color: var(--md-default-fg-color);\n  --md-text-link-color: var(--md-accent-fg-color);\n  --md-text-font-family: ${theme.typography.fontFamily};\n  font-family: var(--md-text-font-family);\n  background-color: unset;\n}\n`;\n","/*\n * Copyright 2022 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { RuleOptions } from './types';\n\nconst SIDEBAR_WIDTH = '224px';\n\nexport default ({ theme, sidebar }: RuleOptions) => `\n/*==================  Layout  ==================*/\n\n.md-grid {\n  max-width: 100%;\n  margin: 0;\n}\n\n.md-nav {\n  font-size: calc(var(--md-typeset-font-size) * 0.9);\n}\n.md-nav__link {\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n}\n.md-nav__icon {\n  height: 20px !important;\n  width: 20px !important;\n  margin-left:${theme.spacing(1)}px;\n}\n.md-nav__icon svg {\n  margin: 0;\n  width: 20px !important;\n  height: 20px !important;\n}\n.md-nav__icon:after {\n  width: 20px !important;\n  height: 20px !important;\n}\n\n.md-nav__item--active > .md-nav__link, a.md-nav__link--active {\n  text-decoration: underline;\n  color: var(--md-typeset-a-color);\n}\n\n.md-main__inner {\n  margin-top: 0;\n}\n\n.md-sidebar {\n  bottom: 75px;\n  position: fixed;\n  width: 16rem;\n  overflow-y: auto;\n  overflow-x: hidden;\n  scrollbar-color: rgb(193, 193, 193) #eee;\n  scrollbar-width: thin;\n}\n.md-sidebar .md-sidebar__scrollwrap {\n  width: calc(12.1rem);\n}\n.md-sidebar--secondary {\n  right: ${theme.spacing(3)}px;\n}\n.md-sidebar::-webkit-scrollbar {\n  width: 5px;\n}\n.md-sidebar::-webkit-scrollbar-button {\n  width: 5px;\n  height: 5px;\n}\n.md-sidebar::-webkit-scrollbar-track {\n  background: #eee;\n  border: 1 px solid rgb(250, 250, 250);\n  box-shadow: 0px 0px 3px #dfdfdf inset;\n  border-radius: 3px;\n}\n.md-sidebar::-webkit-scrollbar-thumb {\n  width: 5px;\n  background: rgb(193, 193, 193);\n  border: transparent;\n  border-radius: 3px;\n}\n.md-sidebar::-webkit-scrollbar-thumb:hover {\n  background: rgb(125, 125, 125);\n}\n\n.md-content {\n  max-width: calc(100% - 16rem * 2);\n  margin-left: 16rem;\n  margin-bottom: 50px;\n}\n\n.md-footer {\n  position: fixed;\n  bottom: 0px;\n}\n.md-footer__title {\n  background-color: unset;\n}\n.md-footer-nav__link {\n  width: 16rem;\n}\n\n.md-dialog {\n  background-color: unset;\n}\n\n@media screen and (min-width: 76.25em) {\n  .md-sidebar {\n    height: auto;\n  }\n}\n\n@media screen and (max-width: 76.1875em) {\n  .md-nav {\n    transition: none !important;\n    background-color: var(--md-default-bg-color)\n  }\n  .md-nav--primary .md-nav__title {\n    cursor: auto;\n    color: var(--md-default-fg-color);\n    font-weight: 700;\n    white-space: normal;\n    line-height: 1rem;\n    height: auto;\n    display: flex;\n    flex-flow: column;\n    row-gap: 1.6rem;\n    padding: 1.2rem .8rem .8rem;\n    background-color: var(--md-default-bg-color);\n  }\n  .md-nav--primary .md-nav__title~.md-nav__list {\n    box-shadow: none;\n  }\n  .md-nav--primary .md-nav__title ~ .md-nav__list > :first-child {\n    border-top: none;\n  }\n  .md-nav--primary .md-nav__title .md-nav__button {\n    display: none;\n  }\n  .md-nav--primary .md-nav__title .md-nav__icon {\n    color: var(--md-default-fg-color);\n    position: static;\n    height: auto;\n    margin: 0 0 0 -0.2rem;\n  }\n  .md-nav--primary > .md-nav__title [for=\"none\"] {\n    padding-top: 0;\n  }\n  .md-nav--primary .md-nav__item {\n    border-top: none;\n  }\n  .md-nav--primary :is(.md-nav__title,.md-nav__item) {\n    font-size : var(--md-typeset-font-size);\n  }\n  .md-nav .md-source {\n    display: none;\n  }\n\n  .md-sidebar {\n    height: 100%;\n  }\n  .md-sidebar--primary {\n    width: 12.1rem !important;\n    z-index: 200;\n    left: ${\n      sidebar.isPinned\n        ? `calc(-12.1rem + ${SIDEBAR_WIDTH})`\n        : 'calc(-12.1rem + 72px)'\n    } !important;\n  }\n  .md-sidebar--secondary:not([hidden]) {\n    display: none;\n  }\n\n  .md-content {\n    max-width: 100%;\n    margin-left: 0;\n  }\n\n  .md-header__button {\n    margin: 0.4rem 0;\n    margin-left: 0.4rem;\n    padding: 0;\n  }\n\n  .md-overlay {\n    left: 0;\n  }\n\n  .md-footer {\n    position: static;\n    padding-left: 0;\n  }\n  .md-footer-nav__link {\n    /* footer links begin to overlap at small sizes without setting width */\n    width: 50%;\n  }\n}\n\n@media screen and (max-width: 600px) {\n  .md-sidebar--primary {\n    left: -12.1rem !important;\n    width: 12.1rem;\n  }\n}\n`;\n","/*\n * Copyright 2022 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { RuleOptions } from './types';\n\ntype RuleTypography = RuleOptions['theme']['typography'];\n\ntype BackstageTypography = RuleTypography & {\n  htmlFontSize?: number;\n};\n\ntype TypographyHeadings = Pick<\n  RuleTypography,\n  'h1' | 'h2' | 'h3' | 'h4' | 'h5' | 'h6'\n>;\n\ntype TypographyHeadingsKeys = keyof TypographyHeadings;\n\nconst headings: TypographyHeadingsKeys[] = ['h1', 'h2', 'h3', 'h4', 'h5', 'h6'];\n\nexport default ({ theme }: RuleOptions) => `\n/*==================  Typeset  ==================*/\n\n.md-typeset {\n  font-size: var(--md-typeset-font-size);\n}\n\n${headings.reduce<string>((style, heading) => {\n  const htmlFontSize =\n    (theme.typography as BackstageTypography).htmlFontSize ?? 16;\n  const styles = theme.typography[heading];\n  const { lineHeight, fontFamily, fontWeight, fontSize } = styles;\n  const calculate = (value: typeof fontSize) => {\n    let factor: number | string = 1;\n    if (typeof value === 'number') {\n      // convert px to rem\n      // 60% of the size defined because it is too big\n      factor = (value / htmlFontSize) * 0.6;\n    }\n    if (typeof value === 'string') {\n      factor = value.replace('rem', '');\n    }\n    return `calc(${factor} * var(--md-typeset-font-size))`;\n  };\n  return style.concat(`\n    .md-typeset ${heading} {\n      color: var(--md-default-fg-color);\n      line-height: ${lineHeight};\n      font-family: ${fontFamily};\n      font-weight: ${fontWeight};\n      font-size: ${calculate(fontSize)};\n    }\n  `);\n}, '')}\n\n.md-typeset .md-content__button {\n  color: var(--md-default-fg-color);\n}\n\n.md-typeset hr {\n  border-bottom: 0.05rem dotted ${theme.palette.divider};\n}\n\n.md-typeset details {\n  font-size: var(--md-typeset-font-size) !important;\n}\n.md-typeset details summary {\n  padding-left: 2.5rem !important;\n}\n.md-typeset details summary:before,\n.md-typeset details summary:after {\n  top: 50% !important;\n  width: 20px !important;\n  height: 20px !important;\n  transform: rotate(0deg) translateY(-50%) !important;\n}\n.md-typeset details[open] > summary:after {\n  transform: rotate(90deg) translateX(-50%) !important;\n}\n\n.md-typeset blockquote {\n  color: var(--md-default-fg-color--light);\n  border-left: 0.2rem solid var(--md-default-fg-color--light);\n}\n\n.md-typeset table:not([class]) {\n  font-size: var(--md-typeset-font-size);\n  border: 1px solid var(--md-default-fg-color);\n  border-bottom: none;\n  border-collapse: collapse;\n}\n.md-typeset table:not([class]) th {\n  font-weight: bold;\n}\n.md-typeset table:not([class]) td, .md-typeset table:not([class]) th {\n  border-bottom: 1px solid var(--md-default-fg-color);\n}\n\n.md-typeset pre > code::-webkit-scrollbar-thumb {\n  background-color: hsla(0, 0%, 0%, 0.32);\n}\n.md-typeset pre > code::-webkit-scrollbar-thumb:hover {\n  background-color: hsla(0, 0%, 0%, 0.87);\n}\n`;\n","/*\n * Copyright 2022 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nexport default () => `\n/*==================  Animations  ==================*/\n/*\n  Disable CSS animations on link colors as they lead to issues in dark mode.\n  The dark mode color theme is applied later and theirfore there is always an animation from light to dark mode when navigation between pages.\n*/\n.md-dialog, .md-nav__link, .md-footer__link, .md-typeset a, .md-typeset a::before, .md-typeset .headerlink {\n  transition: none;\n}\n`;\n","/*\n * Copyright 2022 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { RuleOptions } from './types';\n\nexport default ({ theme }: RuleOptions) => `\n/*==================  Extensions  ==================*/\n\n/* HIGHLIGHT */\n.highlight .md-clipboard:after {\n  content: unset;\n}\n\n.highlight .nx {\n  color: ${theme.palette.type === 'dark' ? '#ff53a3' : '#ec407a'};\n}\n\n/* CODE HILITE */\n.codehilite .gd {\n  background-color: ${\n    theme.palette.type === 'dark' ? 'rgba(248,81,73,0.65)' : '#fdd'\n  };\n}\n\n.codehilite .gi {\n  background-color: ${\n    theme.palette.type === 'dark' ? 'rgba(46,160,67,0.65)' : '#dfd'\n  };\n}\n\n/* TABBED */\n.tabbed-set>input:nth-child(1):checked~.tabbed-labels>:nth-child(1),\n.tabbed-set>input:nth-child(2):checked~.tabbed-labels>:nth-child(2),\n.tabbed-set>input:nth-child(3):checked~.tabbed-labels>:nth-child(3),\n.tabbed-set>input:nth-child(4):checked~.tabbed-labels>:nth-child(4),\n.tabbed-set>input:nth-child(5):checked~.tabbed-labels>:nth-child(5),\n.tabbed-set>input:nth-child(6):checked~.tabbed-labels>:nth-child(6),\n.tabbed-set>input:nth-child(7):checked~.tabbed-labels>:nth-child(7),\n.tabbed-set>input:nth-child(8):checked~.tabbed-labels>:nth-child(8),\n.tabbed-set>input:nth-child(9):checked~.tabbed-labels>:nth-child(9),\n.tabbed-set>input:nth-child(10):checked~.tabbed-labels>:nth-child(10),\n.tabbed-set>input:nth-child(11):checked~.tabbed-labels>:nth-child(11),\n.tabbed-set>input:nth-child(12):checked~.tabbed-labels>:nth-child(12),\n.tabbed-set>input:nth-child(13):checked~.tabbed-labels>:nth-child(13),\n.tabbed-set>input:nth-child(14):checked~.tabbed-labels>:nth-child(14),\n.tabbed-set>input:nth-child(15):checked~.tabbed-labels>:nth-child(15),\n.tabbed-set>input:nth-child(16):checked~.tabbed-labels>:nth-child(16),\n.tabbed-set>input:nth-child(17):checked~.tabbed-labels>:nth-child(17),\n.tabbed-set>input:nth-child(18):checked~.tabbed-labels>:nth-child(18),\n.tabbed-set>input:nth-child(19):checked~.tabbed-labels>:nth-child(19),\n.tabbed-set>input:nth-child(20):checked~.tabbed-labels>:nth-child(20) {\n  color: var(--md-accent-fg-color);\n  border-color: var(--md-accent-fg-color);\n}\n\n/* TASK-LIST */\n.task-list-control .task-list-indicator::before {\n  background-color: ${theme.palette.action.disabledBackground};\n}\n.task-list-control [type=\"checkbox\"]:checked + .task-list-indicator:before {\n background-color: ${theme.palette.success.main};\n}\n\n/* ADMONITION */\n.admonition {\n  font-size: var(--md-typeset-font-size) !important;\n}\n.admonition .admonition-title {\n  padding-left: 2.5rem !important;\n}\n\n.admonition .admonition-title:before {\n  top: 50% !important;\n  width: 20px !important;\n  height: 20px !important;\n  transform: translateY(-50%) !important;\n}\n`;\n","/*\n * Copyright 2022 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { default as variables } from './variables';\nimport { default as reset } from './reset';\nimport { default as layout } from './layout';\nimport { default as typeset } from './typeset';\nimport { default as animations } from './animations';\nimport { default as extensions } from './extensions';\n\n/**\n * A list of style rules that will be applied to an element in the order they were added.\n *\n * @remarks\n * The order of items is important, which means that a rule can override any other rule previously added to the list,\n * i.e. the rules will be applied from the first added to the last added.\n */\nexport const rules = [\n  variables,\n  reset,\n  layout,\n  typeset,\n  animations,\n  extensions,\n];\n","/*\n * Copyright 2022 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { useCallback, useMemo } from 'react';\n\nimport { useTheme } from '@material-ui/core';\n\nimport { useSidebarPinState } from '@backstage/core-components';\nimport { BackstageTheme } from '@backstage/theme';\n\nimport { Transformer } from '../transformer';\nimport { rules } from './rules';\n\n/**\n * Sidebar pinned state to be used in computing style injections.\n */\nconst useSidebar = () => useSidebarPinState();\n\n/**\n * Process all rules and concatenate their definitions into a single style.\n * @returns a string containing all processed style definitions.\n */\nconst useRuleStyles = () => {\n  const sidebar = useSidebar();\n  const theme = useTheme<BackstageTheme>();\n\n  return useMemo(() => {\n    const options = { theme, sidebar };\n    return rules.reduce<string>((styles, rule) => styles + rule(options), '');\n  }, [theme, sidebar]);\n};\n\n/**\n * Returns a transformer that inserts all style rules into the given element's head tag.\n */\nexport const useStylesTransformer = (): Transformer => {\n  const styles = useRuleStyles();\n\n  return useCallback(\n    (dom: Element) => {\n      dom\n        .getElementsByTagName('head')[0]\n        .insertAdjacentHTML('beforeend', `<style>${styles}</style>`);\n      return dom;\n    },\n    [styles],\n  );\n};\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport { CompoundEntityRef } from '@backstage/catalog-model';\nimport { TechDocsStorageApi } from '../../api';\nimport type { Transformer } from './transformer';\n\ntype AddBaseUrlOptions = {\n  techdocsStorageApi: TechDocsStorageApi;\n  entityId: CompoundEntityRef;\n  path: string;\n};\n\n/**\n * TechDocs backend serves SVGs with text/plain content-type for security. This\n * helper determines if an SVG is being loaded from the backend, and thus needs\n * inlining to be displayed properly.\n */\nconst isSvgNeedingInlining = (\n  attrName: string,\n  attrVal: string,\n  apiOrigin: string,\n) => {\n  const isSrcToSvg = attrName === 'src' && attrVal.endsWith('.svg');\n  const isRelativeUrl = !attrVal.match(/^([a-z]*:)?\\/\\//i);\n  const pointsToOurBackend = attrVal.startsWith(apiOrigin);\n  return isSrcToSvg && (isRelativeUrl || pointsToOurBackend);\n};\n\nexport const addBaseUrl = ({\n  techdocsStorageApi,\n  entityId,\n  path,\n}: AddBaseUrlOptions): Transformer => {\n  return async dom => {\n    const apiOrigin = await techdocsStorageApi.getApiOrigin();\n\n    const updateDom = async <T extends Element>(\n      list: HTMLCollectionOf<T> | NodeListOf<T>,\n      attributeName: string,\n    ) => {\n      for (const elem of list) {\n        if (elem.hasAttribute(attributeName)) {\n          const elemAttribute = elem.getAttribute(attributeName);\n          if (!elemAttribute) return;\n\n          // Special handling for SVG images.\n          const newValue = await techdocsStorageApi.getBaseUrl(\n            elemAttribute,\n            entityId,\n            path,\n          );\n\n          if (isSvgNeedingInlining(attributeName, elemAttribute, apiOrigin)) {\n            try {\n              const svg = await fetch(newValue, { credentials: 'include' });\n              const svgContent = await svg.text();\n              elem.setAttribute(\n                attributeName,\n                `data:image/svg+xml;base64,${btoa(\n                  unescape(encodeURIComponent(svgContent)),\n                )}`,\n              );\n            } catch (e) {\n              elem.setAttribute('alt', `Error: ${elemAttribute}`);\n            }\n          } else {\n            elem.setAttribute(attributeName, newValue);\n          }\n        }\n      }\n    };\n\n    await Promise.all([\n      updateDom<HTMLImageElement>(dom.querySelectorAll('img'), 'src'),\n      updateDom<HTMLScriptElement>(dom.querySelectorAll('script'), 'src'),\n      updateDom<HTMLSourceElement>(dom.querySelectorAll('source'), 'src'),\n      updateDom<HTMLLinkElement>(dom.querySelectorAll('link'), 'href'),\n      updateDom<HTMLAnchorElement>(dom.querySelectorAll('a[download]'), 'href'),\n    ]);\n\n    return dom;\n  };\n};\n","/*\n * Copyright 2021 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport type { Transformer } from './index';\nimport {\n  replaceGitHubUrlType,\n  ScmIntegrationRegistry,\n} from '@backstage/integration';\nimport FeedbackOutlinedIcon from '@material-ui/icons/FeedbackOutlined';\nimport React from 'react';\nimport ReactDOM from 'react-dom';\nimport parseGitUrl from 'git-url-parse';\n\n// requires repo\nexport const addGitFeedbackLink = (\n  scmIntegrationsApi: ScmIntegrationRegistry,\n): Transformer => {\n  return dom => {\n    // attempting to use selectors that are more likely to be static as MkDocs updates over time\n    const sourceAnchor = dom.querySelector(\n      '[title=\"Edit this page\"]',\n    ) as HTMLAnchorElement;\n\n    // don't show if edit link not available in raw page\n    if (!sourceAnchor || !sourceAnchor.href) {\n      return dom;\n    }\n\n    const sourceURL = new URL(sourceAnchor.href);\n    const integration = scmIntegrationsApi.byUrl(sourceURL);\n\n    // don't show if can't identify edit link hostname as a gitlab/github hosting\n    if (integration?.type !== 'github' && integration?.type !== 'gitlab') {\n      return dom;\n    }\n\n    // topmost h1 only contains title for whole page\n    const title =\n      (dom.querySelector('article>h1') as HTMLElement)?.childNodes[0]\n        .textContent || '';\n    const issueTitle = encodeURIComponent(`Documentation Feedback: ${title}`);\n    const issueDesc = encodeURIComponent(\n      `Page source:\\n${sourceAnchor.href}\\n\\nFeedback:`,\n    );\n\n    // Convert GitHub edit url to blob type so it can be parsed by git-url-parse correctly\n    const gitUrl =\n      integration?.type === 'github'\n        ? replaceGitHubUrlType(sourceURL.href, 'blob')\n        : sourceURL.href;\n    const gitInfo = parseGitUrl(gitUrl);\n    const repoPath = `/${gitInfo.organization}/${gitInfo.name}`;\n\n    const feedbackLink = sourceAnchor.cloneNode() as HTMLAnchorElement;\n    switch (integration?.type) {\n      case 'gitlab':\n        feedbackLink.href = `${sourceURL.origin}${repoPath}/issues/new?issue[title]=${issueTitle}&issue[description]=${issueDesc}`;\n        break;\n      case 'github':\n        feedbackLink.href = `${sourceURL.origin}${repoPath}/issues/new?title=${issueTitle}&body=${issueDesc}`;\n        break;\n      default:\n        return dom;\n    }\n    ReactDOM.render(React.createElement(FeedbackOutlinedIcon), feedbackLink);\n    feedbackLink.style.paddingLeft = '5px';\n    feedbackLink.title = 'Leave feedback for this page';\n    feedbackLink.id = 'git-feedback-link';\n    sourceAnchor?.insertAdjacentElement('beforebegin', feedbackLink);\n    return dom;\n  };\n};\n","/*\n * Copyright 2021 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport type { Transformer } from './index';\nimport MenuIcon from '@material-ui/icons/Menu';\nimport React from 'react';\nimport ReactDOM from 'react-dom';\n\nexport const addSidebarToggle = (): Transformer => {\n  return dom => {\n    // attempting to use selectors that are more likely to be static as MkDocs updates over time\n    const mkdocsToggleSidebar = dom.querySelector(\n      '.md-header label[for=\"__drawer\"]',\n    ) as HTMLLabelElement;\n    const article = dom.querySelector('article') as HTMLElement;\n\n    // Fail gracefully\n    if (!mkdocsToggleSidebar || !article) {\n      return dom;\n    }\n\n    const toggleSidebar = mkdocsToggleSidebar.cloneNode() as HTMLLabelElement;\n    ReactDOM.render(React.createElement(MenuIcon), toggleSidebar);\n    toggleSidebar.id = 'toggle-sidebar';\n    toggleSidebar.title = 'Toggle Sidebar';\n    toggleSidebar.classList.add('md-content__button');\n    toggleSidebar.style.setProperty('padding', '0 0 0 5px');\n    toggleSidebar.style.setProperty('margin', '0.4rem 0 0.4rem 0.4rem');\n    article?.prepend(toggleSidebar);\n    return dom;\n  };\n};\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport type { Transformer } from './transformer';\n\nexport const rewriteDocLinks = (): Transformer => {\n  return dom => {\n    const updateDom = <T extends Element>(\n      list: Array<T>,\n      attributeName: string,\n    ): void => {\n      Array.from(list)\n        .filter(elem => elem.hasAttribute(attributeName))\n        .forEach((elem: T) => {\n          const elemAttribute = elem.getAttribute(attributeName);\n          if (elemAttribute) {\n            // if link is external, add target to open in a new window or tab\n            if (elemAttribute.match(/^https?:\\/\\//i)) {\n              elem.setAttribute('target', '_blank');\n            }\n\n            try {\n              const normalizedWindowLocation = normalizeUrl(\n                window.location.href,\n              );\n              elem.setAttribute(\n                attributeName,\n                new URL(elemAttribute, normalizedWindowLocation).toString(),\n              );\n            } catch (_e) {\n              // Non-parseable links should be re-written as plain text.\n              elem.replaceWith(elem.textContent || elemAttribute);\n            }\n          }\n        });\n    };\n\n    updateDom(Array.from(dom.getElementsByTagName('a')), 'href');\n\n    return dom;\n  };\n};\n\n/** Make sure that the input url always ends with a '/' */\nexport function normalizeUrl(input: string): string {\n  const url = new URL(input);\n\n  if (!url.pathname.endsWith('/') && !url.pathname.endsWith('.html')) {\n    url.pathname += '/';\n  }\n\n  return url.toString();\n}\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport type { Transformer } from './transformer';\n\ntype AddLinkClickListenerOptions = {\n  baseUrl: string;\n  onClick: (e: MouseEvent, newUrl: string) => void;\n};\n\nexport const addLinkClickListener = ({\n  baseUrl,\n  onClick,\n}: AddLinkClickListenerOptions): Transformer => {\n  return dom => {\n    Array.from(dom.getElementsByTagName('a')).forEach(elem => {\n      elem.addEventListener('click', (e: MouseEvent) => {\n        const target = elem as HTMLAnchorElement;\n        const href = target.getAttribute('href');\n\n        if (!href) return;\n        if (href.startsWith(baseUrl) && !elem.hasAttribute('download')) {\n          e.preventDefault();\n          onClick(e, href);\n        }\n      });\n    });\n\n    return dom;\n  };\n};\n","/*\n * Copyright 2022 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React, { useState, useCallback } from 'react';\nimport ReactDom from 'react-dom';\nimport {\n  withStyles,\n  Theme,\n  ThemeProvider,\n  SvgIcon,\n  Tooltip,\n} from '@material-ui/core';\n\nconst CopyToClipboardTooltip = withStyles(theme => ({\n  tooltip: {\n    fontSize: 'inherit',\n    color: theme.palette.text.primary,\n    margin: 0,\n    padding: theme.spacing(0.5),\n    backgroundColor: 'transparent',\n    boxShadow: 'none',\n  },\n}))(Tooltip);\n\nconst CopyToClipboardIcon = () => (\n  <SvgIcon>\n    <path d=\"M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z\" />\n  </SvgIcon>\n);\n\ntype CopyToClipboardButtonProps = {\n  text: string;\n};\n\nconst CopyToClipboardButton = ({ text }: CopyToClipboardButtonProps) => {\n  const [open, setOpen] = useState(false);\n\n  const handleClick = useCallback(() => {\n    navigator.clipboard.writeText(text);\n    setOpen(true);\n  }, [text]);\n\n  const handleClose = useCallback(() => {\n    setOpen(false);\n  }, [setOpen]);\n\n  return (\n    <CopyToClipboardTooltip\n      title=\"Copied to clipboard\"\n      placement=\"left\"\n      open={open}\n      onClose={handleClose}\n      leaveDelay={1000}\n    >\n      <button className=\"md-clipboard md-icon\" onClick={handleClick}>\n        <CopyToClipboardIcon />\n      </button>\n    </CopyToClipboardTooltip>\n  );\n};\n\nimport type { Transformer } from './transformer';\n\n/**\n * Recreates copy-to-clipboard functionality attached to <code> snippets that\n * is native to mkdocs-material theme.\n */\nexport const copyToClipboard = (theme: Theme): Transformer => {\n  return dom => {\n    const codes = dom.querySelectorAll('pre > code');\n    for (const code of codes) {\n      const text = code.textContent || '';\n      const container = document.createElement('div');\n      code?.parentElement?.prepend(container);\n      ReactDom.render(\n        <ThemeProvider theme={theme}>\n          <CopyToClipboardButton text={text} />\n        </ThemeProvider>,\n        container,\n      );\n    }\n    return dom;\n  };\n};\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport type { Transformer } from './transformer';\n\nexport const removeMkdocsHeader = (): Transformer => {\n  return dom => {\n    // Remove the header\n    dom.querySelector('.md-header')?.remove();\n\n    return dom;\n  };\n};\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport type { Transformer } from './transformer';\n\nexport const simplifyMkdocsFooter = (): Transformer => {\n  return dom => {\n    // Remove new mkdocs copyright\n    dom.querySelector('.md-footer .md-copyright')?.remove();\n    // Remove old mkdocs copyright\n    dom.querySelector('.md-footer-copyright')?.remove();\n    return dom;\n  };\n};\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { SHADOW_DOM_STYLE_LOAD_EVENT } from '@backstage/plugin-techdocs-react';\nimport type { Transformer } from './transformer';\n\ntype OnCssReadyOptions = {\n  onLoading: () => void;\n  onLoaded: () => void;\n};\n\nexport const onCssReady = ({\n  onLoading,\n  onLoaded,\n}: OnCssReadyOptions): Transformer => {\n  return dom => {\n    onLoading();\n    dom.addEventListener(\n      SHADOW_DOM_STYLE_LOAD_EVENT,\n      function handleShadowDomStyleLoad() {\n        onLoaded();\n        dom.removeEventListener(\n          SHADOW_DOM_STYLE_LOAD_EVENT,\n          handleShadowDomStyleLoad,\n        );\n      },\n    );\n    return dom;\n  };\n};\n","/*\n * Copyright 2021 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport type { Transformer } from './transformer';\n\nexport const scrollIntoAnchor = (): Transformer => {\n  return dom => {\n    setTimeout(() => {\n      // Scroll to the desired anchor on initial navigation\n      if (window.location.hash) {\n        const hash = window.location.hash.slice(1);\n        // fix invalid selector error for anchor starting with number\n        dom?.querySelector(`[id=\"${hash}\"]`)?.scrollIntoView();\n      }\n    }, 200);\n    return dom;\n  };\n};\n","/*\n * Copyright 2021 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport type { Transformer } from './transformer';\n\nexport const scrollIntoNavigation = (): Transformer => {\n  return dom => {\n    setTimeout(() => {\n      const activeNavItems = dom?.querySelectorAll(`li.md-nav__item--active`);\n      if (activeNavItems.length !== 0) {\n        // expand all navigation items that are active\n        activeNavItems.forEach(activeNavItem => {\n          const checkbox = activeNavItem?.querySelector('input');\n          if (!checkbox?.checked) {\n            checkbox?.click();\n          }\n        });\n\n        const lastItem = activeNavItems[activeNavItems.length - 1];\n        lastItem.scrollIntoView();\n      }\n    }, 200);\n    return dom;\n  };\n};\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nexport type Transformer = (dom: Element) => Element | Promise<Element>;\n\nexport const transform = async (\n  html: string | Element,\n  transformers: Transformer[],\n): Promise<Element> => {\n  let dom: Element;\n\n  if (typeof html === 'string') {\n    dom = new DOMParser().parseFromString(html, 'text/html').documentElement;\n  } else if (html instanceof Element) {\n    dom = html;\n  } else {\n    throw new Error('dom is not a recognized type');\n  }\n\n  for (const transformer of transformers) {\n    dom = await transformer(dom);\n  }\n\n  return dom;\n};\n","/*\n * Copyright 2022 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { useCallback, useEffect, useState } from 'react';\nimport { useNavigate } from 'react-router-dom';\n\nimport { useTheme, useMediaQuery } from '@material-ui/core';\n\nimport { BackstageTheme } from '@backstage/theme';\nimport { CompoundEntityRef } from '@backstage/catalog-model';\nimport { useApi } from '@backstage/core-plugin-api';\nimport { scmIntegrationsApiRef } from '@backstage/integration-react';\n\nimport {\n  techdocsStorageApiRef,\n  useShadowDomStylesLoading,\n} from '@backstage/plugin-techdocs-react';\n\nimport { useTechDocsReader } from '../TechDocsReaderProvider';\n\nimport {\n  addBaseUrl,\n  addGitFeedbackLink,\n  addLinkClickListener,\n  addSidebarToggle,\n  onCssReady,\n  removeMkdocsHeader,\n  rewriteDocLinks,\n  simplifyMkdocsFooter,\n  scrollIntoAnchor,\n  scrollIntoNavigation,\n  transform as transformer,\n  copyToClipboard,\n  useSanitizerTransformer,\n  useStylesTransformer,\n} from '../../transformers';\n\nconst MOBILE_MEDIA_QUERY = 'screen and (max-width: 76.1875em)';\n\n/**\n * Hook that encapsulates the behavior of getting raw HTML and applying\n * transforms to it in order to make it function at a basic level in the\n * Backstage UI.\n */\nexport const useTechDocsReaderDom = (\n  entityRef: CompoundEntityRef,\n): Element | null => {\n  const navigate = useNavigate();\n  const theme = useTheme<BackstageTheme>();\n  const isMobileMedia = useMediaQuery(MOBILE_MEDIA_QUERY);\n  const sanitizerTransformer = useSanitizerTransformer();\n  const stylesTransformer = useStylesTransformer();\n\n  const techdocsStorageApi = useApi(techdocsStorageApiRef);\n  const scmIntegrationsApi = useApi(scmIntegrationsApiRef);\n\n  const { state, path, content: rawPage } = useTechDocsReader();\n\n  const [dom, setDom] = useState<HTMLElement | null>(null);\n  const isStyleLoading = useShadowDomStylesLoading(dom);\n\n  const updateSidebarPosition = useCallback(() => {\n    if (!dom) return;\n\n    const sidebars = dom.querySelectorAll<HTMLElement>('.md-sidebar');\n\n    sidebars.forEach(element => {\n      // set sidebar position to render in correct position\n      if (isMobileMedia) {\n        element.style.top = '0px';\n      } else {\n        const page = document?.querySelector('.techdocs-reader-page');\n        const pageTop = page?.getBoundingClientRect().top ?? 0;\n        let domTop = dom.getBoundingClientRect().top ?? 0;\n\n        const tabs = dom.querySelector('.md-container > .md-tabs');\n        const tabsHeight = tabs?.getBoundingClientRect().height ?? 0;\n\n        // the sidebars should not scroll beyond the total height of the header and tabs\n        if (domTop < pageTop) {\n          domTop = pageTop;\n        }\n        element.style.top = `${Math.max(domTop, 0) + tabsHeight}px`;\n      }\n\n      // show the sidebar only after updating its position\n      element.style.setProperty('opacity', '1');\n    });\n  }, [dom, isMobileMedia]);\n\n  useEffect(() => {\n    window.addEventListener('resize', updateSidebarPosition);\n    window.addEventListener('scroll', updateSidebarPosition, true);\n    return () => {\n      window.removeEventListener('resize', updateSidebarPosition);\n      window.removeEventListener('scroll', updateSidebarPosition, true);\n    };\n  }, [dom, updateSidebarPosition]);\n\n  // dynamically set width of footer to accommodate for pinning of the sidebar\n  const updateFooterWidth = useCallback(() => {\n    if (!dom) return;\n    const footer = dom.querySelector<HTMLElement>('.md-footer');\n    if (footer) {\n      footer.style.width = `${dom.getBoundingClientRect().width}px`;\n    }\n  }, [dom]);\n\n  useEffect(() => {\n    window.addEventListener('resize', updateFooterWidth);\n    return () => {\n      window.removeEventListener('resize', updateFooterWidth);\n    };\n  }, [dom, updateFooterWidth]);\n\n  // an update to \"state\" might lead to an updated UI so we include it as a trigger\n  useEffect(() => {\n    if (!isStyleLoading) {\n      updateFooterWidth();\n      updateSidebarPosition();\n    }\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [state, isStyleLoading, updateFooterWidth, updateSidebarPosition]);\n\n  // a function that performs transformations that are executed prior to adding it to the DOM\n  const preRender = useCallback(\n    (rawContent: string, contentPath: string) =>\n      transformer(rawContent, [\n        sanitizerTransformer,\n        addBaseUrl({\n          techdocsStorageApi,\n          entityId: entityRef,\n          path: contentPath,\n        }),\n        rewriteDocLinks(),\n        addSidebarToggle(),\n        removeMkdocsHeader(),\n        simplifyMkdocsFooter(),\n        addGitFeedbackLink(scmIntegrationsApi),\n        stylesTransformer,\n      ]),\n    [\n      // only add dependencies that are in state or memorized variables to avoid unnecessary calls between re-renders\n      entityRef,\n      scmIntegrationsApi,\n      techdocsStorageApi,\n      sanitizerTransformer,\n      stylesTransformer,\n    ],\n  );\n\n  // a function that performs transformations that are executed after adding it to the DOM\n  const postRender = useCallback(\n    async (transformedElement: Element) =>\n      transformer(transformedElement, [\n        scrollIntoAnchor(),\n        scrollIntoNavigation(),\n        copyToClipboard(theme),\n        addLinkClickListener({\n          baseUrl: window.location.origin,\n          onClick: (event: MouseEvent, url: string) => {\n            // detect if CTRL or META keys are pressed so that links can be opened in a new tab with `window.open`\n            const modifierActive = event.ctrlKey || event.metaKey;\n            const parsedUrl = new URL(url);\n\n            // hash exists when anchor is clicked on secondary sidebar\n            if (parsedUrl.hash) {\n              if (modifierActive) {\n                window.open(`${parsedUrl.pathname}${parsedUrl.hash}`, '_blank');\n              } else {\n                navigate(`${parsedUrl.pathname}${parsedUrl.hash}`);\n                // Scroll to hash if it's on the current page\n                transformedElement\n                  ?.querySelector(`[id=\"${parsedUrl.hash.slice(1)}\"]`)\n                  ?.scrollIntoView();\n              }\n            } else {\n              if (modifierActive) {\n                window.open(parsedUrl.pathname, '_blank');\n              } else {\n                navigate(parsedUrl.pathname);\n              }\n            }\n          },\n        }),\n        // disable MkDocs drawer toggling ('for' attribute => checkbox mechanism)\n        onCssReady({\n          onLoading: () => {},\n          onLoaded: () => {\n            transformedElement\n              .querySelector('.md-nav__title')\n              ?.removeAttribute('for');\n          },\n        }),\n        // hide sidebars until their positions are updated\n        onCssReady({\n          onLoading: () => {\n            const sidebars = Array.from(\n              transformedElement.querySelectorAll<HTMLElement>('.md-sidebar'),\n            );\n            sidebars.forEach(element => {\n              element.style.setProperty('opacity', '0');\n            });\n          },\n          onLoaded: () => {},\n        }),\n      ]),\n    [theme, navigate],\n  );\n\n  useEffect(() => {\n    if (!rawPage) return () => {};\n\n    // if false, there is already a newer execution of this effect\n    let shouldReplaceContent = true;\n\n    // Pre-render\n    preRender(rawPage, path).then(async preTransformedDomElement => {\n      if (!preTransformedDomElement?.innerHTML) {\n        return; // An unexpected error occurred\n      }\n\n      // don't manipulate the shadow dom if this isn't the latest effect execution\n      if (!shouldReplaceContent) {\n        return;\n      }\n\n      // Scroll to top after render\n      window.scroll({ top: 0 });\n\n      // Post-render\n      const postTransformedDomElement = await postRender(\n        preTransformedDomElement,\n      );\n      setDom(postTransformedDomElement as HTMLElement);\n    });\n\n    // cancel this execution\n    return () => {\n      shouldReplaceContent = false;\n    };\n  }, [rawPage, path, preRender, postRender]);\n\n  return dom;\n};\n","/*\n * Copyright 2022 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React from 'react';\nimport { Portal } from '@material-ui/core';\nimport {\n  useTechDocsAddons,\n  TechDocsAddonLocations as locations,\n  useTechDocsReaderPage,\n} from '@backstage/plugin-techdocs-react';\n\nexport const TechDocsReaderPageContentAddons = () => {\n  const addons = useTechDocsAddons();\n\n  const { shadowRoot } = useTechDocsReaderPage();\n\n  const contentElement = shadowRoot?.querySelector(\n    '[data-md-component=\"content\"]',\n  );\n\n  const primarySidebarElement = shadowRoot?.querySelector(\n    'div[data-md-component=\"sidebar\"][data-md-type=\"navigation\"], div[data-md-component=\"navigation\"]',\n  );\n  let primarySidebarAddonLocation = primarySidebarElement?.querySelector(\n    '[data-techdocs-addons-location=\"primary sidebar\"]',\n  );\n  if (!primarySidebarAddonLocation) {\n    primarySidebarAddonLocation = document.createElement('div');\n    primarySidebarAddonLocation.setAttribute(\n      'data-techdocs-addons-location',\n      'primary sidebar',\n    );\n    primarySidebarElement?.prepend(primarySidebarAddonLocation);\n  }\n\n  const secondarySidebarElement = shadowRoot?.querySelector(\n    'div[data-md-component=\"sidebar\"][data-md-type=\"toc\"], div[data-md-component=\"toc\"]',\n  );\n  let secondarySidebarAddonLocation = secondarySidebarElement?.querySelector(\n    '[data-techdocs-addons-location=\"secondary sidebar\"]',\n  );\n  if (!secondarySidebarAddonLocation) {\n    secondarySidebarAddonLocation = document.createElement('div');\n    secondarySidebarAddonLocation.setAttribute(\n      'data-techdocs-addons-location',\n      'secondary sidebar',\n    );\n    secondarySidebarElement?.prepend(secondarySidebarAddonLocation);\n  }\n\n  return (\n    <>\n      <Portal container={primarySidebarAddonLocation}>\n        {addons.renderComponentsByLocation(locations.PrimarySidebar)}\n      </Portal>\n      <Portal container={contentElement}>\n        {addons.renderComponentsByLocation(locations.Content)}\n      </Portal>\n      <Portal container={secondarySidebarAddonLocation}>\n        {addons.renderComponentsByLocation(locations.SecondarySidebar)}\n      </Portal>\n    </>\n  );\n};\n","/*\n * Copyright 2022 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React, { useCallback } from 'react';\n\nimport { makeStyles, Grid } from '@material-ui/core';\n\nimport {\n  TechDocsShadowDom,\n  useTechDocsReaderPage,\n} from '@backstage/plugin-techdocs-react';\nimport { CompoundEntityRef } from '@backstage/catalog-model';\nimport { Content, ErrorPage } from '@backstage/core-components';\n\nimport { TechDocsSearch } from '../../../search';\nimport { TechDocsStateIndicator } from '../TechDocsStateIndicator';\n\nimport { useTechDocsReaderDom } from './dom';\nimport { withTechDocsReaderProvider } from '../TechDocsReaderProvider';\nimport { TechDocsReaderPageContentAddons } from './TechDocsReaderPageContentAddons';\n\nconst useStyles = makeStyles({\n  search: {\n    width: '100%',\n    '@media (min-width: 76.1875em)': {\n      width: 'calc(100% - 34.4rem)',\n      margin: '0 auto',\n    },\n  },\n});\n\n/**\n * Props for {@link TechDocsReaderPageContent}\n * @public\n */\nexport type TechDocsReaderPageContentProps = {\n  /**\n   * @deprecated No need to pass down entityRef as property anymore. Consumes the entityName from `TechDocsReaderPageContext`. Use the {@link @backstage/plugin-techdocs-react#useTechDocsReaderPage} hook for custom reader page content.\n   */\n  entityRef?: CompoundEntityRef;\n  /**\n   * Show or hide the search bar, defaults to true.\n   */\n  withSearch?: boolean;\n  /**\n   * Callback called when the content is rendered.\n   */\n  onReady?: () => void;\n};\n\n/**\n * Renders the reader page content\n * @public\n */\nexport const TechDocsReaderPageContent = withTechDocsReaderProvider(\n  (props: TechDocsReaderPageContentProps) => {\n    const { withSearch = true, onReady } = props;\n    const classes = useStyles();\n\n    const {\n      entityMetadata: { value: entityMetadata, loading: entityMetadataLoading },\n      entityRef,\n      setShadowRoot,\n    } = useTechDocsReaderPage();\n\n    const dom = useTechDocsReaderDom(entityRef);\n\n    const handleAppend = useCallback(\n      (newShadowRoot: ShadowRoot) => {\n        setShadowRoot(newShadowRoot);\n        if (onReady instanceof Function) {\n          onReady();\n        }\n      },\n      [setShadowRoot, onReady],\n    );\n\n    // No entity metadata = 404. Don't render content at all.\n    if (entityMetadataLoading === false && !entityMetadata)\n      return <ErrorPage status=\"404\" statusMessage=\"PAGE NOT FOUND\" />;\n\n    // Do not return content until dom is ready; instead, render a state\n    // indicator, which handles progress and content errors on our behalf.\n    if (!dom) {\n      return (\n        <Content>\n          <Grid container>\n            <Grid xs={12} item>\n              <TechDocsStateIndicator />\n            </Grid>\n          </Grid>\n        </Content>\n      );\n    }\n\n    return (\n      <Content>\n        <Grid container>\n          <Grid xs={12} item>\n            <TechDocsStateIndicator />\n          </Grid>\n          {withSearch && (\n            <Grid className={classes.search} xs=\"auto\" item>\n              <TechDocsSearch\n                entityId={entityRef}\n                entityTitle={entityMetadata?.metadata?.title}\n              />\n            </Grid>\n          )}\n          <Grid xs={12} item>\n            {/* Centers the styles loaded event to avoid having multiple locations setting the opacity style in Shadow Dom causing the screen to flash multiple times */}\n            <TechDocsShadowDom element={dom} onAppend={handleAppend}>\n              <TechDocsReaderPageContentAddons />\n            </TechDocsShadowDom>\n          </Grid>\n        </Grid>\n      </Content>\n    );\n  },\n);\n\n/**\n * Props for {@link Reader}\n *\n * @public\n * @deprecated use `TechDocsReaderPageContentProps` instead.\n */\nexport type ReaderProps = TechDocsReaderPageContentProps;\n\n/**\n * Component responsible for rendering TechDocs documentation\n * @public\n * @deprecated use `TechDocsReaderPageContent` component instead.\n */\nexport const Reader = TechDocsReaderPageContent;\n","/*\n * Copyright 2022 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React, { PropsWithChildren, useEffect } from 'react';\nimport Helmet from 'react-helmet';\n\nimport { Skeleton } from '@material-ui/lab';\nimport CodeIcon from '@material-ui/icons/Code';\n\nimport {\n  TechDocsAddonLocations as locations,\n  useTechDocsAddons,\n  useTechDocsReaderPage,\n  TechDocsEntityMetadata,\n  TechDocsMetadata,\n} from '@backstage/plugin-techdocs-react';\nimport {\n  EntityRefLink,\n  EntityRefLinks,\n  getEntityRelations,\n} from '@backstage/plugin-catalog-react';\nimport { RELATION_OWNED_BY, CompoundEntityRef } from '@backstage/catalog-model';\nimport { Header, HeaderLabel } from '@backstage/core-components';\nimport { useRouteRef, configApiRef, useApi } from '@backstage/core-plugin-api';\n\nimport { rootRouteRef } from '../../../routes';\n\nconst skeleton = <Skeleton animation=\"wave\" variant=\"text\" height={40} />;\n\n/**\n * Props for {@link TechDocsReaderPageHeader}\n *\n * @public\n * @deprecated No need to pass down properties anymore. The component consumes data from `TechDocsReaderPageContext` instead. Use the {@link @backstage/plugin-techdocs-react#useTechDocsReaderPage} hook for custom header.\n */\nexport type TechDocsReaderPageHeaderProps = PropsWithChildren<{\n  entityRef?: CompoundEntityRef;\n  entityMetadata?: TechDocsEntityMetadata;\n  techDocsMetadata?: TechDocsMetadata;\n}>;\n\n/**\n * Renders the reader page header.\n * This component does not accept props, please use\n * the Tech Docs add-ons to customize it\n * @public\n */\nexport const TechDocsReaderPageHeader = (\n  props: TechDocsReaderPageHeaderProps,\n) => {\n  const { children } = props;\n  const addons = useTechDocsAddons();\n  const configApi = useApi(configApiRef);\n\n  const {\n    title,\n    setTitle,\n    subtitle,\n    setSubtitle,\n    entityRef,\n    metadata: { value: metadata, loading: metadataLoading },\n    entityMetadata: { value: entityMetadata, loading: entityMetadataLoading },\n  } = useTechDocsReaderPage();\n\n  useEffect(() => {\n    if (!metadata) return;\n    setTitle(metadata.site_name);\n    setSubtitle(() => {\n      let { site_description } = metadata;\n      if (!site_description || site_description === 'None') {\n        site_description = 'Home';\n      }\n      return site_description;\n    });\n  }, [metadata, setTitle, setSubtitle]);\n\n  const appTitle = configApi.getOptional('app.title') || 'Backstage';\n  const tabTitle = [title, subtitle, appTitle].filter(Boolean).join(' | ');\n\n  const { locationMetadata, spec } = entityMetadata || {};\n  const lifecycle = spec?.lifecycle;\n\n  const ownedByRelations = entityMetadata\n    ? getEntityRelations(entityMetadata, RELATION_OWNED_BY)\n    : [];\n\n  const docsRootLink = useRouteRef(rootRouteRef)();\n\n  const labels = (\n    <>\n      <HeaderLabel\n        label=\"Component\"\n        value={\n          <EntityRefLink\n            color=\"inherit\"\n            entityRef={entityRef}\n            title={entityMetadata?.metadata.title}\n            defaultKind=\"Component\"\n          />\n        }\n      />\n      {ownedByRelations.length > 0 && (\n        <HeaderLabel\n          label=\"Owner\"\n          value={\n            <EntityRefLinks\n              color=\"inherit\"\n              entityRefs={ownedByRelations}\n              defaultKind=\"group\"\n            />\n          }\n        />\n      )}\n      {lifecycle ? <HeaderLabel label=\"Lifecycle\" value={lifecycle} /> : null}\n      {locationMetadata &&\n      locationMetadata.type !== 'dir' &&\n      locationMetadata.type !== 'file' ? (\n        <HeaderLabel\n          label=\"\"\n          value={\n            <a\n              href={locationMetadata.target}\n              target=\"_blank\"\n              rel=\"noopener noreferrer\"\n            >\n              <CodeIcon style={{ marginTop: '-25px', fill: '#fff' }} />\n            </a>\n          }\n        />\n      ) : null}\n    </>\n  );\n\n  // If there is no entity or techdocs metadata, there's no reason to show the\n  // header (hides the header on 404 error pages).\n  const noEntMetadata = !entityMetadataLoading && entityMetadata === undefined;\n  const noTdMetadata = !metadataLoading && metadata === undefined;\n  if (noEntMetadata || noTdMetadata) return null;\n\n  return (\n    <Header\n      type=\"Documentation\"\n      typeLink={docsRootLink}\n      title={title || skeleton}\n      subtitle={subtitle || skeleton}\n    >\n      <Helmet titleTemplate=\"%s\">\n        <title>{tabTitle}</title>\n      </Helmet>\n      {labels}\n      {children}\n      {addons.renderComponentsByLocation(locations.Header)}\n    </Header>\n  );\n};\n","/*\n * Copyright 2022 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React, { MouseEvent, useState, useCallback } from 'react';\n\nimport {\n  Box,\n  makeStyles,\n  Toolbar,\n  ToolbarProps,\n  Menu,\n  Tooltip,\n  IconButton,\n} from '@material-ui/core';\nimport SettingsIcon from '@material-ui/icons/Settings';\n\nimport {\n  TechDocsAddonLocations as locations,\n  useTechDocsAddons,\n  useTechDocsReaderPage,\n} from '@backstage/plugin-techdocs-react';\n\nconst useStyles = makeStyles(theme => ({\n  root: {\n    gridArea: 'pageSubheader',\n    flexDirection: 'column',\n    minHeight: 'auto',\n    padding: theme.spacing(3, 3, 0),\n  },\n}));\n\n/**\n * Renders the reader page subheader.\n * Please use the Tech Docs add-ons to customize it\n * @public\n */\nexport const TechDocsReaderPageSubheader = (props: {\n  toolbarProps?: ToolbarProps;\n}) => {\n  const classes = useStyles();\n  const [anchorEl, setAnchorEl] = useState<null | HTMLElement>(null);\n\n  const handleClick = useCallback((event: MouseEvent<HTMLButtonElement>) => {\n    setAnchorEl(event.currentTarget);\n  }, []);\n\n  const handleClose = useCallback(() => {\n    setAnchorEl(null);\n  }, []);\n\n  const {\n    entityMetadata: { value: entityMetadata, loading: entityMetadataLoading },\n  } = useTechDocsReaderPage();\n\n  const addons = useTechDocsAddons();\n\n  const subheaderAddons = addons.renderComponentsByLocation(\n    locations.Subheader,\n  );\n\n  const settingsAddons = addons.renderComponentsByLocation(locations.Settings);\n\n  if (!subheaderAddons && !settingsAddons) return null;\n\n  // No entity metadata = 404. Don't render subheader on 404.\n  if (entityMetadataLoading === false && !entityMetadata) return null;\n\n  return (\n    <Toolbar classes={classes} {...props.toolbarProps}>\n      <Box\n        display=\"flex\"\n        justifyContent=\"flex-end\"\n        width=\"100%\"\n        flexWrap=\"wrap\"\n      >\n        {subheaderAddons}\n        {settingsAddons ? (\n          <>\n            <Tooltip title=\"Settings\">\n              <IconButton\n                aria-controls=\"tech-docs-reader-page-settings\"\n                aria-haspopup=\"true\"\n                onClick={handleClick}\n              >\n                <SettingsIcon />\n              </IconButton>\n            </Tooltip>\n            <Menu\n              id=\"tech-docs-reader-page-settings\"\n              getContentAnchorEl={null}\n              anchorEl={anchorEl}\n              anchorOrigin={{ vertical: 'bottom', horizontal: 'right' }}\n              open={Boolean(anchorEl)}\n              onClose={handleClose}\n              keepMounted\n            >\n              {settingsAddons}\n            </Menu>\n          </>\n        ) : null}\n      </Box>\n    </Toolbar>\n  );\n};\n","/*\n * Copyright 2021 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { useApi } from '@backstage/core-plugin-api';\nimport { useMemo, useReducer, useRef } from 'react';\nimport useAsync from 'react-use/lib/useAsync';\nimport useAsyncRetry from 'react-use/lib/useAsyncRetry';\nimport { techdocsStorageApiRef } from '@backstage/plugin-techdocs-react';\n\n/**\n * @public\n * A state representation that is used to configure the UI of <Reader />\n */\nexport type ContentStateTypes =\n  /** There is nothing to display but a loading indicator */\n  | 'CHECKING'\n\n  /** There is no content yet -> present a full screen loading page */\n  | 'INITIAL_BUILD'\n\n  /** There is content, but the backend is about to update it */\n  | 'CONTENT_STALE_REFRESHING'\n\n  /** There is content, but after a reload, the content will be different */\n  | 'CONTENT_STALE_READY'\n\n  /** There is content, the backend tried to update it, but failed */\n  | 'CONTENT_STALE_ERROR'\n\n  /** There is nothing to see but a \"not found\" page. Is also shown on page load errors */\n  | 'CONTENT_NOT_FOUND'\n\n  /** There is only the latest and greatest content */\n  | 'CONTENT_FRESH';\n\n/**\n * Calculate the state that should be reported to the display component.\n */\nexport function calculateDisplayState({\n  contentLoading,\n  content,\n  activeSyncState,\n}: Pick<\n  ReducerState,\n  'contentLoading' | 'content' | 'activeSyncState'\n>): ContentStateTypes {\n  // we have nothing to display yet\n  if (contentLoading) {\n    return 'CHECKING';\n  }\n\n  // the build is ready, but it triggered a content reload and the content variable is not trusted\n  if (activeSyncState === 'BUILD_READY_RELOAD') {\n    return 'CHECKING';\n  }\n\n  // there is no content, but the sync process is still evaluating\n  if (!content && activeSyncState === 'CHECKING') {\n    return 'CHECKING';\n  }\n\n  // there is no content yet so we assume that we are building it for the first time\n  if (!content && activeSyncState === 'BUILDING') {\n    return 'INITIAL_BUILD';\n  }\n\n  // if there is still no content after building, it might just not exist\n  if (!content) {\n    return 'CONTENT_NOT_FOUND';\n  }\n\n  // we are still building, but we already show stale content\n  if (activeSyncState === 'BUILDING') {\n    return 'CONTENT_STALE_REFRESHING';\n  }\n\n  // the build is ready, but the content is still stale\n  if (activeSyncState === 'BUILD_READY') {\n    return 'CONTENT_STALE_READY';\n  }\n\n  // the build failed, but the content is still stale\n  if (activeSyncState === 'ERROR') {\n    return 'CONTENT_STALE_ERROR';\n  }\n\n  // seems like the content is up-to-date (or we don't know yet and the sync process is still evaluating in the background)\n  return 'CONTENT_FRESH';\n}\n\n/**\n * The state of the synchronization task. It checks whether the docs are\n * up-to-date. If they aren't, it triggers a build.\n */\ntype SyncStates =\n  /** Checking if it should be synced */\n  | 'CHECKING'\n\n  /** Building the documentation */\n  | 'BUILDING'\n\n  /** Finished building the documentation */\n  | 'BUILD_READY'\n\n  /**\n   * Finished building the documentation and triggered a content reload.\n   * This state is left toward UP_TO_DATE when the content loading has finished.\n   */\n  | 'BUILD_READY_RELOAD'\n\n  /** No need for a sync. The content was already up-to-date. */\n  | 'UP_TO_DATE'\n\n  /** An error occurred */\n  | 'ERROR';\n\ntype ReducerActions =\n  | {\n      type: 'sync';\n      state: SyncStates;\n      syncError?: Error;\n    }\n  | { type: 'contentLoading' }\n  | {\n      type: 'content';\n      path?: string;\n      content?: string;\n      contentError?: Error;\n    }\n  | { type: 'buildLog'; log: string };\n\ntype ReducerState = {\n  /**\n   * The path of the current page\n   */\n  path: string;\n\n  /**\n   * The current sync state\n   */\n  activeSyncState: SyncStates;\n\n  /**\n   * If true, the content is downloading from the storage.\n   */\n  contentLoading: boolean;\n  /**\n   * The content that has been downloaded and should be displayed.\n   */\n  content?: string;\n\n  contentError?: Error;\n  syncError?: Error;\n\n  /**\n   * A list of log messages that were emitted by the build process.\n   */\n  buildLog: string[];\n};\n\nexport function reducer(\n  oldState: ReducerState,\n  action: ReducerActions,\n): ReducerState {\n  const newState = { ...oldState };\n\n  switch (action.type) {\n    case 'sync':\n      // reset the build log when a new check starts\n      if (action.state === 'CHECKING') {\n        newState.buildLog = [];\n      }\n\n      newState.activeSyncState = action.state;\n      newState.syncError = action.syncError;\n      break;\n\n    case 'contentLoading':\n      newState.contentLoading = true;\n\n      // only reset errors but keep the old content until it is replaced by the 'content' action\n      newState.contentError = undefined;\n      break;\n\n    case 'content':\n      // only override the path if it is part of the action\n      if (typeof action.path === 'string') {\n        newState.path = action.path;\n      }\n\n      newState.contentLoading = false;\n      newState.content = action.content;\n      newState.contentError = action.contentError;\n      break;\n\n    case 'buildLog':\n      newState.buildLog = newState.buildLog.concat(action.log);\n      break;\n\n    default:\n      throw new Error();\n  }\n\n  // a content update loads fresh content so the build is updated to being up-to-date\n  if (\n    ['BUILD_READY', 'BUILD_READY_RELOAD'].includes(newState.activeSyncState) &&\n    ['contentLoading', 'content'].includes(action.type)\n  ) {\n    newState.activeSyncState = 'UP_TO_DATE';\n    newState.buildLog = [];\n  }\n\n  return newState;\n}\n/**\n * @public shared reader state\n */\nexport type ReaderState = {\n  state: ContentStateTypes;\n  path: string;\n  contentReload: () => void;\n  content?: string;\n  contentErrorMessage?: string;\n  syncErrorMessage?: string;\n  buildLog: string[];\n};\n\nexport function useReaderState(\n  kind: string,\n  namespace: string,\n  name: string,\n  path: string,\n): ReaderState {\n  const [state, dispatch] = useReducer(reducer, {\n    activeSyncState: 'CHECKING',\n    path,\n    contentLoading: true,\n    buildLog: [],\n  });\n\n  const techdocsStorageApi = useApi(techdocsStorageApiRef);\n\n  // try to load the content. the function will fire events and we don't care for the return values\n  const { retry: contentReload } = useAsyncRetry(async () => {\n    dispatch({ type: 'contentLoading' });\n\n    try {\n      const entityDocs = await techdocsStorageApi.getEntityDocs(\n        { kind, namespace, name },\n        path,\n      );\n\n      // update content and path at the same time\n      dispatch({ type: 'content', content: entityDocs, path });\n\n      return entityDocs;\n    } catch (e) {\n      dispatch({ type: 'content', contentError: e, path });\n    }\n\n    return undefined;\n  }, [techdocsStorageApi, kind, namespace, name, path]);\n\n  // create a ref that holds the latest content. This provides a useAsync hook\n  // with the latest content without restarting the useAsync hook.\n  const contentRef = useRef<{ content?: string; reload: () => void }>({\n    content: undefined,\n    reload: () => {},\n  });\n  contentRef.current = { content: state.content, reload: contentReload };\n\n  // try to derive the state. the function will fire events and we don't care for the return values\n  useAsync(async () => {\n    dispatch({ type: 'sync', state: 'CHECKING' });\n\n    // should only switch to BUILDING if the request takes more than 1 seconds\n    const buildingTimeout = setTimeout(() => {\n      dispatch({ type: 'sync', state: 'BUILDING' });\n    }, 1000);\n\n    try {\n      const result = await techdocsStorageApi.syncEntityDocs(\n        {\n          kind,\n          namespace,\n          name,\n        },\n        log => {\n          dispatch({ type: 'buildLog', log });\n        },\n      );\n\n      switch (result) {\n        case 'updated':\n          // if there was no content prior to building, retry the loading\n          if (!contentRef.current.content) {\n            contentRef.current.reload();\n            dispatch({ type: 'sync', state: 'BUILD_READY_RELOAD' });\n          } else {\n            dispatch({ type: 'sync', state: 'BUILD_READY' });\n          }\n          break;\n        case 'cached':\n          dispatch({ type: 'sync', state: 'UP_TO_DATE' });\n          break;\n\n        default:\n          dispatch({\n            type: 'sync',\n            state: 'ERROR',\n            syncError: new Error('Unexpected return state'),\n          });\n          break;\n      }\n    } catch (e) {\n      dispatch({ type: 'sync', state: 'ERROR', syncError: e });\n    } finally {\n      // Cancel the timer that sets the state \"BUILDING\"\n      clearTimeout(buildingTimeout);\n    }\n  }, [kind, name, namespace, techdocsStorageApi, dispatch, contentRef]);\n\n  const displayState = useMemo(\n    () =>\n      calculateDisplayState({\n        activeSyncState: state.activeSyncState,\n        contentLoading: state.contentLoading,\n        content: state.content,\n      }),\n    [state.activeSyncState, state.content, state.contentLoading],\n  );\n\n  return {\n    state: displayState,\n    contentReload,\n    path: state.path,\n    content: state.content,\n    contentErrorMessage: state.contentError?.toString(),\n    syncErrorMessage: state.syncError?.toString(),\n    buildLog: state.buildLog,\n  };\n}\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React, {\n  ComponentType,\n  createContext,\n  useContext,\n  ReactNode,\n} from 'react';\nimport { useParams } from 'react-router-dom';\nimport { useTechDocsReaderPage } from '@backstage/plugin-techdocs-react';\n\nimport { useReaderState, ReaderState } from './useReaderState';\n\nconst TechDocsReaderContext = createContext<ReaderState>({} as ReaderState);\n\nexport const useTechDocsReader = () => useContext(TechDocsReaderContext);\n\n/**\n * @public Render function for {@link TechDocsReaderProvider}\n */\nexport type TechDocsReaderProviderRenderFunction = (\n  value: ReaderState,\n) => JSX.Element;\n\n/**\n * @public Props for {@link TechDocsReaderProvider}\n */\nexport type TechDocsReaderProviderProps = {\n  children: TechDocsReaderProviderRenderFunction | ReactNode;\n};\n\n/**\n * Provides shared building process state to the reader page components.\n *\n * @public\n */\nexport const TechDocsReaderProvider = ({\n  children,\n}: TechDocsReaderProviderProps) => {\n  const { '*': path = '' } = useParams();\n  const { entityRef } = useTechDocsReaderPage();\n  const { kind, namespace, name } = entityRef;\n  const value = useReaderState(kind, namespace, name, path);\n\n  return (\n    <TechDocsReaderContext.Provider value={value}>\n      {children instanceof Function ? children(value) : children}\n    </TechDocsReaderContext.Provider>\n  );\n};\n\nexport const withTechDocsReaderProvider =\n  <T extends {}>(Component: ComponentType<T>) =>\n  (props: T) =>\n    (\n      <TechDocsReaderProvider>\n        <Component {...props} />\n      </TechDocsReaderProvider>\n    );\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { createRouteRef } from '@backstage/core-plugin-api';\n\nexport const rootRouteRef = createRouteRef({\n  id: 'techdocs:index-page',\n});\n\nexport const rootDocsRouteRef = createRouteRef({\n  id: 'techdocs:reader-page',\n  params: ['namespace', 'kind', 'name'],\n});\n\nexport const rootCatalogDocsRouteRef = createRouteRef({\n  id: 'techdocs:catalog-reader-view',\n});\n","/*\n * Copyright 2021 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React, { PropsWithChildren, ReactNode } from 'react';\nimport {\n  Divider,\n  ListItem,\n  ListItemIcon,\n  ListItemText,\n  makeStyles,\n} from '@material-ui/core';\nimport { Link } from '@backstage/core-components';\nimport { useAnalytics } from '@backstage/core-plugin-api';\nimport { ResultHighlight } from '@backstage/plugin-search-common';\nimport { HighlightedSearchResultText } from '@backstage/plugin-search-react';\n\nconst useStyles = makeStyles({\n  flexContainer: {\n    flexWrap: 'wrap',\n  },\n  itemText: {\n    width: '100%',\n    marginBottom: '1rem',\n  },\n});\n\n/**\n * Props for {@link TechDocsSearchResultListItem}.\n *\n * @public\n */\nexport type TechDocsSearchResultListItemProps = {\n  icon?: ReactNode;\n  result: any;\n  highlight?: ResultHighlight;\n  rank?: number;\n  lineClamp?: number;\n  asListItem?: boolean;\n  asLink?: boolean;\n  title?: string;\n};\n\n/**\n * Component which renders documentation and related metadata.\n *\n * @public\n */\nexport const TechDocsSearchResultListItem = (\n  props: TechDocsSearchResultListItemProps,\n) => {\n  const {\n    result,\n    highlight,\n    rank,\n    lineClamp = 5,\n    asListItem = true,\n    asLink = true,\n    title,\n    icon,\n  } = props;\n  const classes = useStyles();\n\n  const analytics = useAnalytics();\n  const handleClick = () => {\n    analytics.captureEvent('discover', result.title, {\n      attributes: { to: result.location },\n      value: rank,\n    });\n  };\n\n  const TextItem = () => {\n    const resultTitle = highlight?.fields.title ? (\n      <HighlightedSearchResultText\n        text={highlight.fields.title}\n        preTag={highlight.preTag}\n        postTag={highlight.postTag}\n      />\n    ) : (\n      result.title\n    );\n\n    const entityTitle = highlight?.fields.entityTitle ? (\n      <HighlightedSearchResultText\n        text={highlight.fields.entityTitle}\n        preTag={highlight.preTag}\n        postTag={highlight.postTag}\n      />\n    ) : (\n      result.entityTitle\n    );\n\n    const resultName = highlight?.fields.name ? (\n      <HighlightedSearchResultText\n        text={highlight.fields.name}\n        preTag={highlight.preTag}\n        postTag={highlight.postTag}\n      />\n    ) : (\n      result.name\n    );\n\n    return (\n      <ListItemText\n        className={classes.itemText}\n        primaryTypographyProps={{ variant: 'h6' }}\n        primary={\n          title ? (\n            title\n          ) : (\n            <>\n              {resultTitle} | {entityTitle ?? resultName} docs\n            </>\n          )\n        }\n        secondary={\n          <span\n            style={{\n              display: '-webkit-box',\n              WebkitBoxOrient: 'vertical',\n              WebkitLineClamp: lineClamp,\n              overflow: 'hidden',\n            }}\n          >\n            {highlight?.fields.text ? (\n              <HighlightedSearchResultText\n                text={highlight.fields.text}\n                preTag={highlight.preTag}\n                postTag={highlight.postTag}\n              />\n            ) : (\n              result.text\n            )}\n          </span>\n        }\n      />\n    );\n  };\n\n  const LinkWrapper = ({ children }: PropsWithChildren<{}>) =>\n    asLink ? (\n      <Link noTrack to={result.location} onClick={handleClick}>\n        {children}\n      </Link>\n    ) : (\n      <>{children}</>\n    );\n\n  const ListItemWrapper = ({ children }: PropsWithChildren<{}>) =>\n    asListItem ? (\n      <>\n        <ListItem alignItems=\"flex-start\">\n          {icon && <ListItemIcon>{icon}</ListItemIcon>}\n          <div className={classes.flexContainer}>{children}</div>\n        </ListItem>\n        <Divider component=\"li\" />\n      </>\n    ) : (\n      <>{children}</>\n    );\n\n  return (\n    <LinkWrapper>\n      <ListItemWrapper>\n        <TextItem />\n      </ListItemWrapper>\n    </LinkWrapper>\n  );\n};\n","/*\n * Copyright 2021 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { CompoundEntityRef } from '@backstage/catalog-model';\nimport { ResultHighlight } from '@backstage/plugin-search-common';\nimport {\n  SearchAutocomplete,\n  SearchContextProvider,\n  useSearch,\n} from '@backstage/plugin-search-react';\nimport { makeStyles, Paper } from '@material-ui/core';\nimport React, { useEffect, useState } from 'react';\nimport { useNavigate } from 'react-router';\nimport { TechDocsSearchResultListItem } from './TechDocsSearchResultListItem';\n\nconst useStyles = makeStyles(theme => ({\n  root: {\n    width: '100%',\n  },\n  bar: {\n    padding: theme.spacing(1),\n  },\n}));\n\n/**\n * Props for {@link TechDocsSearch}\n *\n * @public\n */\nexport type TechDocsSearchProps = {\n  entityId: CompoundEntityRef;\n  entityTitle?: string;\n  debounceTime?: number;\n};\n\ntype TechDocsDoc = {\n  namespace: string;\n  kind: string;\n  name: string;\n  path: string;\n  location: string;\n  title: string;\n};\n\ntype TechDocsSearchResult = {\n  type: string;\n  document: TechDocsDoc;\n  highlight?: ResultHighlight;\n};\n\nconst isTechDocsSearchResult = (\n  option: any,\n): option is TechDocsSearchResult => {\n  return option?.document;\n};\n\nconst TechDocsSearchBar = (props: TechDocsSearchProps) => {\n  const { entityId, entityTitle, debounceTime = 150 } = props;\n  const [open, setOpen] = useState(false);\n  const navigate = useNavigate();\n  const {\n    setFilters,\n    result: { loading, value: searchVal },\n  } = useSearch();\n  const classes = useStyles();\n  const [options, setOptions] = useState<any[]>([]);\n  useEffect(() => {\n    let mounted = true;\n\n    if (mounted && searchVal) {\n      // TODO: Change this into getting only subset of search results from the BE in the first place\n      // once pagination is implemented for search engines\n      // See: https://github.com/backstage/backstage/issues/6062\n      const searchResults = searchVal.results.slice(0, 10);\n      setOptions(searchResults);\n    }\n    return () => {\n      mounted = false;\n    };\n  }, [loading, searchVal]);\n\n  // Update the filter context when the entityId changes, e.g. when the search\n  // bar continues to be rendered, navigating between different TechDocs sites.\n  const { kind, name, namespace } = entityId;\n  useEffect(() => {\n    setFilters(prevFilters => {\n      return {\n        ...prevFilters,\n        kind,\n        namespace,\n        name,\n      };\n    });\n  }, [kind, namespace, name, setFilters]);\n\n  const handleSelection = (\n    _: any,\n    selection: TechDocsSearchResult | string | null,\n  ) => {\n    if (isTechDocsSearchResult(selection)) {\n      const { location } = selection.document;\n      navigate(location);\n    }\n  };\n\n  return (\n    <Paper className={classes.bar} variant=\"outlined\">\n      <SearchAutocomplete\n        classes={{ root: classes.root }}\n        data-testid=\"techdocs-search-bar\"\n        size=\"small\"\n        open={open}\n        getOptionLabel={() => ''}\n        filterOptions={x => {\n          return x; // This is needed to get renderOption to be called after options change. Bug in material-ui?\n        }}\n        onClose={() => {\n          setOpen(false);\n        }}\n        onFocus={() => {\n          setOpen(true);\n        }}\n        onChange={handleSelection}\n        blurOnSelect\n        noOptionsText=\"No results found\"\n        value={null}\n        options={options}\n        renderOption={({ document, highlight }) => (\n          <TechDocsSearchResultListItem\n            result={document}\n            lineClamp={3}\n            asListItem={false}\n            asLink={false}\n            title={document.title}\n            highlight={highlight}\n          />\n        )}\n        loading={loading}\n        inputDebounceTime={debounceTime}\n        inputPlaceholder={`Search ${entityTitle || entityId.name} docs`}\n        freeSolo={false}\n      />\n    </Paper>\n  );\n};\n\n/**\n * Component used to render search bar on TechDocs page, scoped to\n *\n * @public\n */\nexport const TechDocsSearch = (props: TechDocsSearchProps) => {\n  const initialState = {\n    term: '',\n    types: ['techdocs'],\n    pageCursor: '',\n    filters: props.entityId,\n  };\n  return (\n    <SearchContextProvider initialState={initialState}>\n      <TechDocsSearchBar {...props} />\n    </SearchContextProvider>\n  );\n};\n"],"sourceRoot":""}